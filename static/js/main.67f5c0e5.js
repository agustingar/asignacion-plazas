/*! For license information please see main.67f5c0e5.js.LICENSE.txt */
(()=>{"use strict";var e={43:(e,t,n)=>{e.exports=n(202)},52:(e,t,n)=>{n.d(t,{KO:()=>X,MF:()=>Q,Sx:()=>Y,Wp:()=>J,j6:()=>q,om:()=>B,xZ:()=>H});var r=n(812),i=n(443),o=n(529),s=n(799);class a{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const l="@firebase/app",c="0.11.4",u=new i.Vy("@firebase/app"),d="@firebase/app-compat",h="@firebase/analytics-compat",f="@firebase/analytics",p="@firebase/app-check-compat",g="@firebase/app-check",m="@firebase/auth",y="@firebase/auth-compat",v="@firebase/database",b="@firebase/data-connect",w="@firebase/database-compat",x="@firebase/functions",I="@firebase/functions-compat",S="@firebase/installations",E="@firebase/installations-compat",_="@firebase/messaging",T="@firebase/messaging-compat",k="@firebase/performance",C="@firebase/performance-compat",A="@firebase/remote-config",N="@firebase/remote-config-compat",D="@firebase/storage",P="@firebase/storage-compat",R="@firebase/firestore",O="@firebase/vertexai",L="@firebase/firestore-compat",j="firebase",M="[DEFAULT]",z={[l]:"fire-core",[d]:"fire-core-compat",[f]:"fire-analytics",[h]:"fire-analytics-compat",[g]:"fire-app-check",[p]:"fire-app-check-compat",[m]:"fire-auth",[y]:"fire-auth-compat",[v]:"fire-rtdb",[b]:"fire-data-connect",[w]:"fire-rtdb-compat",[x]:"fire-fn",[I]:"fire-fn-compat",[S]:"fire-iid",[E]:"fire-iid-compat",[_]:"fire-fcm",[T]:"fire-fcm-compat",[k]:"fire-perf",[C]:"fire-perf-compat",[A]:"fire-rc",[N]:"fire-rc-compat",[D]:"fire-gcs",[P]:"fire-gcs-compat",[R]:"fire-fst",[L]:"fire-fst-compat",[O]:"fire-vertex","fire-js":"fire-js",[j]:"fire-js-all"},F=new Map,V=new Map,U=new Map;function $(e,t){try{e.container.addComponent(t)}catch(n){u.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function B(e){const t=e.name;if(U.has(t))return u.debug(`There were multiple attempts to register component ${t}.`),!1;U.set(t,e);for(const n of F.values())$(n,e);for(const n of V.values())$(n,e);return!0}function q(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function H(e){return null!==e&&void 0!==e&&void 0!==e.settings}const K={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},G=new o.FA("app","Firebase",K);class W{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.uA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw G.create("app-deleted",{appName:this._name})}}const Q="11.6.0";function J(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;if("object"!==typeof t){t={name:t}}const i=Object.assign({name:M,automaticDataCollectionEnabled:!1},t),s=i.name;if("string"!==typeof s||!s)throw G.create("bad-app-name",{appName:String(s)});if(n||(n=(0,o.T9)()),!n)throw G.create("no-options");const a=F.get(s);if(a){if((0,o.bD)(n,a.options)&&(0,o.bD)(i,a.config))return a;throw G.create("duplicate-app",{appName:s})}const l=new r.h1(s);for(const r of U.values())l.addComponent(r);const c=new W(n,i,l);return F.set(s,c),c}function Y(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M;const t=F.get(e);if(!t&&e===M&&(0,o.T9)())return J();if(!t)throw G.create("no-app",{appName:e});return t}function X(e,t,n){var i;let o=null!==(i=z[e])&&void 0!==i?i:e;n&&(o+=`-${n}`);const s=o.match(/\s|\//),a=t.match(/\s|\//);if(s||a){const e=[`Unable to register library "${o}" with version "${t}":`];return s&&e.push(`library name "${o}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void u.warn(e.join(" "))}B(new r.uA(`${o}-version`,(()=>({library:o,version:t})),"VERSION"))}const Z="firebase-heartbeat-store";let ee=null;function te(){return ee||(ee=(0,s.P2)("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Z)}catch(n){console.warn(n)}}}).catch((e=>{throw G.create("idb-open",{originalErrorMessage:e.message})}))),ee}async function ne(e,t){try{const n=(await te()).transaction(Z,"readwrite"),r=n.objectStore(Z);await r.put(t,re(e)),await n.done}catch(n){if(n instanceof o.g)u.warn(n.message);else{const e=G.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});u.warn(e.message)}}}function re(e){return`${e.name}!${e.options.appId}`}class ie{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new se(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=oe();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){u.warn(n)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=oe(),{heartbeatsToSend:n,unsentEntries:r}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),ae(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),ae(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=(0,o.Uj)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return u.warn(t),""}}}function oe(){return(new Date).toISOString().substring(0,10)}class se{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,o.zW)()&&(0,o.eX)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await te()).transaction(Z),n=await t.objectStore(Z).get(re(e));return await t.done,n}catch(t){if(t instanceof o.g)u.warn(t.message);else{const e=G.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});u.warn(e.message)}}}(this.app);return(null===e||void 0===e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ne(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ne(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function ae(e){return(0,o.Uj)(JSON.stringify({version:2,heartbeats:e})).length}var le;le="",B(new r.uA("platform-logger",(e=>new a(e)),"PRIVATE")),B(new r.uA("heartbeat",(e=>new ie(e)),"PRIVATE")),X(l,c,le),X(l,c,"esm2017"),X("fire-js","")},153:(e,t,n)=>{var r=n(43),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,o={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,r)&&!l.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:o,_owner:a.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},202:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function v(){}function b(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var w=b.prototype=new v;w.constructor=b,g(w,y.prototype),w.isPureReactComponent=!0;var x=Array.isArray,I=Object.prototype.hasOwnProperty,S={current:null},E={key:!0,ref:!0,__self:!0,__source:!0};function _(e,t,r){var i,o={},s=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)I.call(t,i)&&!E.hasOwnProperty(i)&&(o[i]=t[i]);var l=arguments.length-2;if(1===l)o.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===o[i]&&(o[i]=l[i]);return{$$typeof:n,type:e,key:s,ref:a,props:o,_owner:S.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var k=/\/+/g;function C(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function A(e,t,i,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return s=s(l=e),e=""===o?"."+C(l,0):o,x(s)?(i="",null!=e&&(i=e.replace(k,"$&/")+"/"),A(s,t,i,"",(function(e){return e}))):null!=s&&(T(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,i+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(k,"$&/")+"/")+e)),t.push(s)),1;if(l=0,o=""===o?".":o+":",x(e))for(var c=0;c<e.length;c++){var u=o+C(a=e[c],c);l+=A(a,t,i,u,s)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(a=e.next()).done;)l+=A(a=a.value,t,i,u=o+C(a,c++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function N(e,t,n){if(null==e)return e;var r=[],i=0;return A(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function D(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},R={transition:null},O={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:R,ReactCurrentOwner:S};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:N,forEach:function(e,t,n){N(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return N(e,(function(){t++})),t},toArray:function(e){return N(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=i,t.Profiler=s,t.PureComponent=b,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.act=L,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=g({},e.props),o=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=S.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)I.call(t,c)&&!E.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:n,type:e.type,key:o,ref:s,props:i,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=_,t.createFactory=function(e){var t=_.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:D}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=R.transition;R.transition={};try{e()}finally{R.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,n){return P.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,n){return P.current.useReducer(e,t,n)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return P.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return P.current.useTransition()},t.version="18.3.1"},213:(e,t,n)=>{n.d(t,{db:()=>Xr});var r=n(52);(0,r.KO)("firebase","11.6.0","app");var i=n(472),o=n(443),s=n(529),a=n(812),l=n(799);const c="@firebase/installations",u="0.6.13",d=1e4,h=`w:${u}`,f="FIS_v2",p=36e5,g={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},m=new s.FA("installations","Installations",g);function y(e){return e instanceof s.g&&e.code.includes("request-failed")}function v(e){let{projectId:t}=e;return`https://firebaseinstallations.googleapis.com/v1/projects/${t}/installations`}function b(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function w(e,t){const n=(await t.json()).error;return m.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function x(e){let{apiKey:t}=e;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function I(e,t){let{refreshToken:n}=t;const r=x(e);return r.append("Authorization",function(e){return`${f} ${e}`}(n)),r}async function S(e){const t=await e();return t.status>=500&&t.status<600?e():t}function E(e){return new Promise((t=>{setTimeout(t,e)}))}const _=/^[cdef][\w-]{21}$/;function T(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){const t=(n=e,btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_"));var n;return t.substr(0,22)}(e);return _.test(t)?t:""}catch(e){return""}}function k(e){return`${e.appName}!${e.appId}`}const C=new Map;function A(e,t){const n=k(e);N(n,t),function(e,t){const n=P();n&&n.postMessage({key:e,fid:t});R()}(n,t)}function N(e,t){const n=C.get(e);if(n)for(const r of n)r(t)}let D=null;function P(){return!D&&"BroadcastChannel"in self&&(D=new BroadcastChannel("[Firebase] FID Change"),D.onmessage=e=>{N(e.data.key,e.data.fid)}),D}function R(){0===C.size&&D&&(D.close(),D=null)}const O="firebase-installations-store";let L=null;function j(){return L||(L=(0,l.P2)("firebase-installations-database",1,{upgrade:(e,t)=>{if(0===t)e.createObjectStore(O)}})),L}async function M(e,t){const n=k(e),r=(await j()).transaction(O,"readwrite"),i=r.objectStore(O),o=await i.get(n);return await i.put(t,n),await r.done,o&&o.fid===t.fid||A(e,t.fid),t}async function z(e){const t=k(e),n=(await j()).transaction(O,"readwrite");await n.objectStore(O).delete(t),await n.done}async function F(e,t){const n=k(e),r=(await j()).transaction(O,"readwrite"),i=r.objectStore(O),o=await i.get(n),s=t(o);return void 0===s?await i.delete(n):await i.put(s,n),await r.done,!s||o&&o.fid===s.fid||A(e,s.fid),s}async function V(e){let t;const n=await F(e.appConfig,(n=>{const r=function(e){const t=e||{fid:T(),registrationStatus:0};return B(t)}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine){return{installationEntry:t,registrationPromise:Promise.reject(m.create("app-offline"))}}const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(e,t){try{const n=await async function(e,t){let{appConfig:n,heartbeatServiceProvider:r}=e,{fid:i}=t;const o=v(n),s=x(n),a=r.getImmediate({optional:!0});if(a){const e=await a.getHeartbeatsHeader();e&&s.append("x-firebase-client",e)}const l={fid:i,authVersion:f,appId:n.appId,sdkVersion:h},c={method:"POST",headers:s,body:JSON.stringify(l)},u=await S((()=>fetch(o,c)));if(u.ok){const e=await u.json();return{fid:e.fid||i,registrationStatus:2,refreshToken:e.refreshToken,authToken:b(e.authToken)}}throw await w("Create Installation",u)}(e,t);return M(e.appConfig,n)}catch(n){throw y(n)&&409===n.customData.serverCode?await z(e.appConfig):await M(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:U(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry}));return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function U(e){let t=await $(e.appConfig);for(;1===t.registrationStatus;)await E(100),t=await $(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await V(e);return n||t}return t}function $(e){return F(e,(e=>{if(!e)throw m.create("installation-not-found");return B(e)}))}function B(e){return 1===(t=e).registrationStatus&&t.registrationTime+d<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function q(e,t){let{appConfig:n,heartbeatServiceProvider:r}=e;const i=function(e,t){let{fid:n}=t;return`${v(e)}/${n}/authTokens:generate`}(n,t),o=I(n,t),s=r.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&o.append("x-firebase-client",e)}const a={installation:{sdkVersion:h,appId:n.appId}},l={method:"POST",headers:o,body:JSON.stringify(a)},c=await S((()=>fetch(i,l)));if(c.ok){return b(await c.json())}throw await w("Generate Auth Token",c)}async function H(e){let t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=await F(e.appConfig,(r=>{if(!G(r))throw m.create("not-registered");const i=r.authToken;if(!n&&function(e){return 2===e.requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+p}(e)}(i))return r;if(1===i.requestStatus)return t=async function(e,t){let n=await K(e.appConfig);for(;1===n.authToken.requestStatus;)await E(100),n=await K(e.appConfig);const r=n.authToken;return 0===r.requestStatus?H(e,t):r}(e,n),r;{if(!navigator.onLine)throw m.create("app-offline");const n=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(r);return t=async function(e,t){try{const n=await q(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await M(e.appConfig,r),n}catch(n){if(!y(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await M(e.appConfig,n)}else await z(e.appConfig);throw n}}(e,n),n}}));return t?await t:r.authToken}function K(e){return F(e,(e=>{if(!G(e))throw m.create("not-registered");const t=e.authToken;return 1===(n=t).requestStatus&&n.requestTime+d<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var n}))}function G(e){return void 0!==e&&2===e.registrationStatus}async function W(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e;await async function(e){const{registrationPromise:t}=await V(e);t&&await t}(n);return(await H(n,t)).token}function Q(e){return m.create("missing-app-config-values",{valueName:e})}const J="installations",Y=e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw Q("App Configuration");if(!e.name)throw Q("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw Q(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:(0,r.j6)(t,"heartbeat"),_delete:()=>Promise.resolve()}},X=e=>{const t=e.getProvider("app").getImmediate(),n=(0,r.j6)(t,J).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:r}=await V(t);return r?r.catch(console.error):H(t).catch(console.error),n.fid}(n),getToken:e=>W(n,e)}};(0,r.om)(new a.uA(J,Y,"PUBLIC")),(0,r.om)(new a.uA("installations-internal",X,"PRIVATE")),(0,r.KO)(c,u),(0,r.KO)(c,u,"esm2017");const Z="analytics",ee="https://www.googletagmanager.com/gtag/js",te=new o.Vy("@firebase/analytics"),ne={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},re=new s.FA("analytics","Analytics",ne);function ie(e){if(!e.startsWith(ee)){const t=re.create("invalid-gtag-resource",{gtagURL:e});return te.warn(t.message),""}return e}function oe(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}function se(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(e,t)),n}("firebase-js-sdk-policy",{createScriptURL:ie}),r=document.createElement("script"),i=`${ee}?l=${e}&id=${t}`;r.src=n?null===n||void 0===n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}function ae(e,t,n,r){return async function(i){try{for(var o=arguments.length,s=new Array(o>1?o-1:0),a=1;a<o;a++)s[a-1]=arguments[a];if("event"===i){const[r,i]=s;await async function(e,t,n,r,i){try{let o=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=await oe(n);for(const n of e){const e=r.find((e=>e.measurementId===n)),i=e&&t[e.appId];if(!i){o=[];break}o.push(i)}}0===o.length&&(o=Object.values(t)),await Promise.all(o),e("event",r,i||{})}catch(o){te.error(o)}}(e,t,n,r,i)}else if("config"===i){const[i,o]=s;await async function(e,t,n,r,i,o){const s=r[i];try{if(s)await t[s];else{const e=(await oe(n)).find((e=>e.measurementId===i));e&&await t[e.appId]}}catch(a){te.error(a)}e("config",i,o)}(e,t,n,r,i,o)}else if("consent"===i){const[t,n]=s;e("consent",t,n)}else if("get"===i){const[t,n,r]=s;e("get",t,n,r)}else if("set"===i){const[t]=s;e("set",t)}else e(i,...s)}catch(l){te.error(l)}}}const le=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function ce(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function ue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:le,n=arguments.length>2?arguments[2]:void 0;const{appId:r,apiKey:i,measurementId:o}=e.options;if(!r)throw re.create("no-app-id");if(!i){if(o)return{measurementId:o,appId:r};throw re.create("no-api-key")}const s=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new he;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),de({appId:r,apiKey:i,measurementId:o},s,a,t)}async function de(e,t,n){let{throttleEndTimeMillis:r,backoffCount:i}=t,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:le;var a;const{appId:l,measurementId:c}=e;try{await function(e,t){return new Promise(((n,r)=>{const i=Math.max(t-Date.now(),0),o=setTimeout(n,i);e.addEventListener((()=>{clearTimeout(o),r(re.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(n,r)}catch(u){if(c)return te.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null===u||void 0===u?void 0:u.message}]`),{appId:l,measurementId:c};throw u}try{const t=await async function(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:ce(r)},o="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),s=await fetch(o,i);if(200!==s.status&&304!==s.status){let e="";try{const n=await s.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(a){}throw re.create("config-fetch-failed",{httpStatus:s.status,responseMessage:e})}return s.json()}(e);return o.deleteThrottleMetadata(l),t}catch(u){const t=u;if(!function(e){if(!(e instanceof s.g)||!e.customData)return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(t)){if(o.deleteThrottleMetadata(l),c)return te.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null===t||void 0===t?void 0:t.message}]`),{appId:l,measurementId:c};throw u}const r=503===Number(null===(a=null===t||void 0===t?void 0:t.customData)||void 0===a?void 0:a.httpStatus)?(0,s.p9)(i,o.intervalMillis,30):(0,s.p9)(i,o.intervalMillis),d={throttleEndTimeMillis:Date.now()+r,backoffCount:i+1};return o.setThrottleMetadata(l,d),te.debug(`Calling attemptFetch again in ${r} millis`),de(e,d,n,o)}}class he{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let fe,pe;function ge(e){pe=e}function me(e){fe=e}async function ye(e,t,n,r,i,o,a){var l;const c=ue(e);c.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&te.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>te.error(e))),t.push(c);const u=async function(){if(!(0,s.zW)())return te.warn(re.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await(0,s.eX)()}catch(e){return te.warn(re.create("indexeddb-unavailable",{errorInfo:null===e||void 0===e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?r.getId():void 0)),[d,h]=await Promise.all([c,u]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(ee)&&n.src.includes(e))return n;return null})(o)||se(o,d.measurementId),pe&&(i("consent","default",pe),ge(void 0)),i("js",new Date);const f=null!==(l=null===a||void 0===a?void 0:a.config)&&void 0!==l?l:{};return f.origin="firebase",f.update=!0,null!=h&&(f.firebase_id=h),i("config",d.measurementId,f),fe&&(i("set",fe),me(void 0)),d.measurementId}class ve{constructor(e){this.app=e}_delete(){return delete be[this.app.options.appId],Promise.resolve()}}let be={},we=[];const xe={};let Ie,Se,Ee="dataLayer",_e="gtag",Te=!1;function ke(e,t,n){!function(){const e=[];if((0,s.sr)()&&e.push("This is a browser extension environment."),(0,s.dM)()||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=re.create("invalid-analytics-context",{errorInfo:t});te.warn(n.message)}}();const r=e.options.appId;if(!r)throw re.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw re.create("no-api-key");te.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=be[r])throw re.create("already-exists",{id:r});if(!Te){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(Ee);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let o=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];window[r].push(arguments)};return window[i]&&"function"===typeof window[i]&&(o=window[i]),window[i]=ae(o,e,t,n),{gtagCore:o,wrappedGtag:window[i]}}(be,we,xe,Ee,_e);Se=e,Ie=t,Te=!0}be[r]=ye(e,we,xe,t,Ie,Ee,n);return new ve(e)}function Ce(e,t,n,r){e=(0,s.Ku)(e),async function(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=await t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}(Se,be[e.app.options.appId],t,n,r).catch((e=>te.error(e)))}const Ae="@firebase/analytics",Ne="0.10.12";(0,r.om)(new a.uA(Z,((e,t)=>{let{options:n}=t;return ke(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),n)}),"PUBLIC")),(0,r.om)(new a.uA("analytics-internal",(function(e){try{const t=e.getProvider(Z).getImmediate();return{logEvent:(e,n,r)=>Ce(t,e,n,r)}}catch(t){throw re.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),(0,r.KO)(Ae,Ne),(0,r.KO)(Ae,Ne,"esm2017");function De(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;function Pe(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Re=Pe,Oe=new s.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Le=new o.Vy("@firebase/auth");function je(e){if(Le.logLevel<=o.$b.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Le.error(`Auth (${r.MF}): ${e}`,...n)}}function Me(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw Ue(e,...n)}function ze(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Ue(e,...n)}function Fe(e,t,n){const r=Object.assign(Object.assign({},Re()),{[t]:n});return new s.FA("auth","Firebase",r).create(t,{appName:e.name})}function Ve(e){return Fe(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ue(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("string"!==typeof e){const t=n[0],r=[...n.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(t,...r)}return Oe.create(e,...n)}function $e(e,t){if(!e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];throw Ue(t,...r)}}function Be(e){const t="INTERNAL ASSERTION FAILED: "+e;throw je(t),new Error(t)}function qe(e,t){e||Be(t)}function He(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Ke(){return"http:"===Ge()||"https:"===Ge()}function Ge(){var e;return"undefined"!==typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class We{constructor(e,t){this.shortDelay=e,this.longDelay=t,qe(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,s.jZ)()||(0,s.lV)()}get(){return"undefined"!==typeof navigator&&navigator&&"onLine"in navigator&&"boolean"===typeof navigator.onLine&&(Ke()||(0,s.sr)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Qe(e,t){qe(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Je{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!==typeof self&&"fetch"in self?self.fetch:"undefined"!==typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!==typeof fetch?fetch:void Be("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!==typeof self&&"Headers"in self?self.Headers:"undefined"!==typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!==typeof Headers?Headers:void Be("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!==typeof self&&"Response"in self?self.Response:"undefined"!==typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!==typeof Response?Response:void Be("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Ye={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Xe=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Ze=new We(3e4,6e4);function et(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function tt(e,t,n,r){return nt(e,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},(async()=>{let i={},o={};r&&("GET"===t?o=r:i={body:JSON.stringify(r)});const a=(0,s.Am)(Object.assign({key:e.config.apiKey},o)).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:l},i);return(0,s.c1)()||(c.referrerPolicy="no-referrer"),Je.fetch()(await it(e,e.config.apiHost,n,a),c)}))}async function nt(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Ye),t);try{const t=new st(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw at(e,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const t=i.ok?o.errorMessage:o.error.message,[n,s]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw at(e,"credential-already-in-use",o);if("EMAIL_EXISTS"===n)throw at(e,"email-already-in-use",o);if("USER_DISABLED"===n)throw at(e,"user-disabled",o);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(s)throw Fe(e,a,s);Me(e,a)}}catch(i){if(i instanceof s.g)throw i;Me(e,"network-request-failed",{message:String(i)})}}async function rt(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const o=await tt(e,t,n,r,i);return"mfaPendingCredential"in o&&Me(e,"multi-factor-auth-required",{_serverResponse:o}),o}async function it(e,t,n,r){const i=`${t}${n}?${r}`,o=e,s=o.config.emulator?Qe(e.config,i):`${e.config.apiScheme}://${i}`;if(Xe.includes(n)&&(await o._persistenceManagerAvailable,"COOKIE"===o._getPersistenceType())){return o._getPersistence()._getFinalTarget(s).toString()}return s}function ot(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class st{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(ze(this.auth,"network-request-failed"))),Ze.get())}))}}function at(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=ze(e,t,r);return i.customData._tokenResponse=n,i}function lt(e){return void 0!==e&&void 0!==e.enterprise}class ct{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return ot(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function ut(e,t){return tt(e,"GET","/v2/recaptchaConfig",et(e,t))}async function dt(e,t){return tt(e,"POST","/v1/accounts:lookup",t)}function ht(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function ft(e){return 1e3*Number(e)}function pt(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return je("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,s.u)(n);return e?JSON.parse(e):(je("Failed to decode base64 JWT payload"),null)}catch(i){return je("Caught error parsing JWT payload as JSON",null===i||void 0===i?void 0:i.toString()),null}}function gt(e){const t=pt(e);return $e(t,"internal-error"),$e("undefined"!==typeof t.exp,"internal-error"),$e("undefined"!==typeof t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function mt(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return t;try{return await t}catch(n){throw n instanceof s.g&&function(e){let{code:t}=e;return"auth/user-disabled"===t||"auth/user-token-expired"===t}(n)&&e.auth.currentUser===e&&await e.auth.signOut(),n}}class yt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null===e||void 0===e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class vt{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ht(this.lastLoginAt),this.creationTime=ht(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function bt(e){var t;const n=e.auth,r=await e.getIdToken(),i=await mt(e,dt(n,{idToken:r}));$e(null===i||void 0===i?void 0:i.users.length,n,"internal-error");const o=i.users[0];e._notifyReloadListener(o);const s=(null===(t=o.providerUserInfo)||void 0===t?void 0:t.length)?wt(o.providerUserInfo):[],a=(l=e.providerData,c=s,[...l.filter((e=>!c.some((t=>t.providerId===e.providerId)))),...c]);var l,c;const u=e.isAnonymous,d=!(e.email&&o.passwordHash)&&!(null===a||void 0===a?void 0:a.length),h=!!u&&d,f={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:a,metadata:new vt(o.createdAt,o.lastLoginAt),isAnonymous:h};Object.assign(e,f)}function wt(e){return e.map((e=>{var{providerId:t}=e,n=De(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class xt{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){$e(e.idToken,"internal-error"),$e("undefined"!==typeof e.idToken,"internal-error"),$e("undefined"!==typeof e.refreshToken,"internal-error");const t="expiresIn"in e&&"undefined"!==typeof e.expiresIn?Number(e.expiresIn):gt(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){$e(0!==e.length,"internal-error");const t=gt(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]||!this.accessToken||this.isExpired?($e(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await nt(e,{},(async()=>{const n=(0,s.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,o=await it(e,r,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Je.fetch()(o,{method:"POST",headers:a,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,o=new xt;return n&&($e("string"===typeof n,"internal-error",{appName:e}),o.refreshToken=n),r&&($e("string"===typeof r,"internal-error",{appName:e}),o.accessToken=r),i&&($e("number"===typeof i,"internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new xt,this.toJSON())}_performRefresh(){return Be("not implemented")}}function It(e,t){$e("string"===typeof e||"undefined"===typeof e,"internal-error",{appName:t})}class St{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=De(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new yt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new vt(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await mt(this,this.stsTokenManager.getToken(this.auth,e));return $e(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=(0,s.Ku)(e),r=await n.getIdToken(t),i=pt(r);$e(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const o="object"===typeof i.firebase?i.firebase:void 0,a=null===o||void 0===o?void 0:o.sign_in_provider;return{claims:i,token:r,authTime:ht(ft(i.auth_time)),issuedAtTime:ht(ft(i.iat)),expirationTime:ht(ft(i.exp)),signInProvider:a||null,signInSecondFactor:(null===o||void 0===o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,s.Ku)(e);await bt(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&($e(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new St(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){$e(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await bt(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,r.xZ)(this.auth.app))return Promise.reject(Ve(this.auth));const e=await this.getIdToken();return await mt(this,async function(e,t){return tt(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,o,s,a,l,c;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(r=t.email)&&void 0!==r?r:void 0,h=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(o=t.photoURL)&&void 0!==o?o:void 0,p=null!==(s=t.tenantId)&&void 0!==s?s:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:v,emailVerified:b,isAnonymous:w,providerData:x,stsTokenManager:I}=t;$e(v&&I,e,"internal-error");const S=xt.fromJSON(this.name,I);$e("string"===typeof v,e,"internal-error"),It(u,e.name),It(d,e.name),$e("boolean"===typeof b,e,"internal-error"),$e("boolean"===typeof w,e,"internal-error"),It(h,e.name),It(f,e.name),It(p,e.name),It(g,e.name),It(m,e.name),It(y,e.name);const E=new St({uid:v,auth:e,email:d,emailVerified:b,displayName:u,isAnonymous:w,photoURL:f,phoneNumber:h,tenantId:p,stsTokenManager:S,createdAt:m,lastLoginAt:y});return x&&Array.isArray(x)&&(E.providerData=x.map((e=>Object.assign({},e)))),g&&(E._redirectEventId=g),E}static async _fromIdTokenResponse(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=new xt;r.updateFromServerResponse(t);const i=new St({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await bt(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];$e(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?wt(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length),s=new xt;s.updateFromIdToken(n);const a=new St({uid:r.localId,auth:e,stsTokenManager:s,isAnonymous:o}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new vt(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!(null===i||void 0===i?void 0:i.length)};return Object.assign(a,l),a}}const Et=new Map;function _t(e){qe(e instanceof Function,"Expected a class definition");let t=Et.get(e);return t?(qe(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Et.set(e,t),t)}class Tt{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Tt.type="NONE";const kt=Tt;function Ct(e,t,n){return`firebase:${e}:${t}:${n}`}class At{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Ct(this.userKey,r.apiKey,i),this.fullPersistenceKey=Ct("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"===typeof e){const t=await dt(this.auth,{idToken:e}).catch((()=>{}));return t?St._fromGetAccountInfoResponse(this.auth,t,e):null}return St._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"authUser";if(!t.length)return new At(_t(kt),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||_t(kt);const o=Ct(n,e.config.apiKey,e.name);let s=null;for(const c of t)try{const t=await c._get(o);if(t){let n;if("string"===typeof t){const r=await dt(e,{idToken:t}).catch((()=>{}));if(!r)break;n=await St._fromGetAccountInfoResponse(e,r,t)}else n=St._fromJSON(e,t);c!==i&&(s=n),i=c;break}}catch(l){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],s&&await i._set(o,s.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(o)}catch(l){}}))),new At(i,e,n)):new At(i,e,n)}}function Nt(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Ot(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Dt(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(jt(t))return"Blackberry";if(Mt(t))return"Webos";if(Pt(t))return"Safari";if((t.includes("chrome/")||Rt(t))&&!t.includes("edge/"))return"Chrome";if(Lt(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null===n||void 0===n?void 0:n.length))return n[1]}return"Other"}function Dt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/firefox\//i.test(e)}function Pt(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)()).toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Rt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/crios\//i.test(e)}function Ot(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/iemobile/i.test(e)}function Lt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/android/i.test(e)}function jt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/blackberry/i.test(e)}function Mt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/webos/i.test(e)}function zt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Ft(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)();return zt(e)||Lt(e)||Mt(e)||jt(e)||/windows phone/i.test(e)||Ot(e)}function Vt(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];switch(e){case"Browser":t=Nt((0,s.ZQ)());break;case"Worker":t=`${Nt((0,s.ZQ)())}-${e}`;break;default:t=e}const i=n.length?n.join(","):"FirebaseCore-web";return`${t}/JsCore/${r.MF}/${i}`}class Ut{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(i){r(i)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(n){t.reverse();for(const e of t)try{e()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===n||void 0===n?void 0:n.message})}}}class $t{constructor(e){var t,n,r,i;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=o.minPasswordLength)&&void 0!==t?t:6,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),void 0!==o.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),void 0!==o.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),void 0!==o.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),void 0!==o.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,o,s;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(o=a.containsNumericCharacter)||void 0===o||o),a.isValid&&(a.isValid=null===(s=a.containsNonAlphanumericCharacter)||void 0===s||s),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Bt{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ht(this),this.idTokenSubscription=new Ht(this),this.beforeStateQueue=new Ut(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Oe,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise((e=>this._resolvePersistenceManagerAvailable=e))}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=_t(t)),this._initializationPromise=this.queue((async()=>{var n,r,i;if(!this._deleted&&(this.persistenceManager=await At.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null===(r=this._popupRedirectResolver)||void 0===r?void 0:r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(o){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await dt(this,{idToken:e}),n=await St._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if((0,r.xZ)(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,o=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null===i||void 0===i?void 0:i._redirectEventId,s=await this.tryRedirectSignIn(e);n&&n!==r||!(null===s||void 0===s?void 0:s.user)||(i=s.user,o=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(o)try{await this.beforeStateQueue.runMiddleware(i)}catch(s){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(s)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return $e(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(n){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await bt(e)}catch(t){if("auth/network-request-failed"!==(null===t||void 0===t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"===typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,r.xZ)(this.app))return Promise.reject(Ve(this));const t=e?(0,s.Ku)(e):null;return t&&$e(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._deleted)return e&&$e(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return(0,r.xZ)(this.app)?Promise.reject(Ve(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,r.xZ)(this.app)?Promise.reject(Ve(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(_t(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e){return tt(e,"GET","/v2/passwordPolicy",et(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}(this),t=new $t(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new s.FA("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return tt(e,"POST","/v2/accounts:revokeToken",et(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&_t(e)||this._popupRedirectResolver;$e(t,this,"argument-error"),this.redirectPersistenceManager=await At.create(this,[_t(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"===typeof t?t:t.next.bind(t);let o=!1;const s=this._isInitialized?Promise.resolve():this._initializationPromise;if($e(s,this,"internal-error"),s.then((()=>{o||i(this.currentUser)})),"function"===typeof t){const i=e.addObserver(t,n,r);return()=>{o=!0,i()}}{const n=e.addObserver(t);return()=>{o=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return $e(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Vt(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if((0,r.xZ)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null===t||void 0===t?void 0:t.error)&&function(e){if(Le.logLevel<=o.$b.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];Le.warn(`Auth (${r.MF}): ${e}`,...n)}}(`Error while retrieving App Check token: ${t.error}`),null===t||void 0===t?void 0:t.token}}function qt(e){return(0,s.Ku)(e)}class Ht{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,s.tD)((e=>this.observer=e))}get next(){return $e(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Kt={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Gt(e){return Kt.loadJS(e)}function Wt(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Qt{constructor(){this.enterprise=new Jt}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Jt{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Yt="NO_RECAPTCHA";class Xt{constructor(e){this.type="recaptcha-enterprise",this.auth=qt(e)}async verify(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"verify",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(t,n,r){const i=window.grecaptcha;lt(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n(Yt)}))})):r(Error("No reCAPTCHA enterprise script loaded."))}if(this.auth.settings.appVerificationDisabledForTesting){return(new Qt).execute("siteKey",{action:"verify"})}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{ut(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new ct(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&lt(window.grecaptcha))n(i,e,r);else{if("undefined"===typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Kt.recaptchaEnterpriseScript;0!==t.length&&(t+=i),Gt(t).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function Zt(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=new Xt(e);let s;if(i)s=Yt;else try{s=await o.verify(n)}catch(l){s=await o.verify(n,!0)}const a=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function en(e,t,n,r,i){var o,s;if("EMAIL_PASSWORD_PROVIDER"===i){if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await Zt(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch((async i=>{if("auth/missing-recaptcha-token"===i.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await Zt(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)}))}if("PHONE_PROVIDER"===i){if(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.isProviderEnabled("PHONE_PROVIDER")){const i=await Zt(e,t,n);return r(e,i).catch((async i=>{var o;if("AUDIT"===(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const i=await Zt(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)}))}{const i=await Zt(e,t,n,!1,!0);return r(e,i)}}return Promise.reject(i+" provider is not supported.")}async function tn(e){const t=qt(e),n=await ut(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new ct(n);if(null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()){new Xt(t).verify()}}function nn(e,t,n){const r=qt(e);$e(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null===n||void 0===n?void 0:n.disableWarnings),o=rn(t),{host:a,port:l}=function(e){const t=rn(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:on(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:on(t)}}}(t),c={url:`${o}//${a}${null===l?"":`:${l}`}/`},u=Object.freeze({host:a,port:l,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator)return $e(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void $e((0,s.bD)(c,r.config.emulator)&&(0,s.bD)(u,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=c,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");"undefined"!==typeof window&&"undefined"!==typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}function rn(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function on(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class sn{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Be("not implemented")}_getIdTokenResponse(e){return Be("not implemented")}_linkToIdToken(e,t){return Be("not implemented")}_getReauthenticationResolver(e){return Be("not implemented")}}async function an(e,t){return tt(e,"POST","/v1/accounts:signUp",t)}async function ln(e,t){return rt(e,"POST","/v1/accounts:signInWithPassword",et(e,t))}class cn extends sn{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new cn(e,t,"password")}static _fromEmailAndCode(e,t){return new cn(e,t,"emailLink",arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e;if((null===t||void 0===t?void 0:t.email)&&(null===t||void 0===t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return en(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",ln,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return rt(e,"POST","/v1/accounts:signInWithEmailLink",et(e,t))}(e,{email:this._email,oobCode:this._password});default:Me(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return en(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",an,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return rt(e,"POST","/v1/accounts:signInWithEmailLink",et(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Me(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function un(e,t){return rt(e,"POST","/v1/accounts:signInWithIdp",et(e,t))}class dn extends sn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new dn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Me("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"===typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=De(t,["providerId","signInMethod"]);if(!n||!r)return null;const o=new dn(n,r);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){return un(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,un(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,un(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,s.Am)(t)}return e}}async function hn(e,t){return tt(e,"POST","/v1/accounts:sendVerificationCode",et(e,t))}const fn={USER_NOT_FOUND:"user-not-found"};class pn extends sn{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new pn({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new pn({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return rt(e,"POST","/v1/accounts:signInWithPhoneNumber",et(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await rt(e,"POST","/v1/accounts:signInWithPhoneNumber",et(e,t));if(n.temporaryProof)throw at(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return rt(e,"POST","/v1/accounts:signInWithPhoneNumber",et(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),fn)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"===typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new pn({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class gn{constructor(e){var t,n,r,i,o,a;const l=(0,s.I9)((0,s.hp)(e)),c=null!==(t=l.apiKey)&&void 0!==t?t:null,u=null!==(n=l.oobCode)&&void 0!==n?n:null,d=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=l.mode)&&void 0!==r?r:null);$e(c&&u&&d,"argument-error"),this.apiKey=c,this.operation=d,this.code=u,this.continueUrl=null!==(i=l.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(o=l.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=l.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,s.I9)((0,s.hp)(e)).link,n=t?(0,s.I9)((0,s.hp)(t)).deep_link_id:null,r=(0,s.I9)((0,s.hp)(e)).deep_link_id;return(r?(0,s.I9)((0,s.hp)(r)).link:null)||r||n||t||e}(e);try{return new gn(t)}catch(n){return null}}}class mn{constructor(){this.providerId=mn.PROVIDER_ID}static credential(e,t){return cn._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=gn.parseLink(t);return $e(n,"argument-error"),cn._fromEmailAndCode(e,n.code,n.tenantId)}}mn.PROVIDER_ID="password",mn.EMAIL_PASSWORD_SIGN_IN_METHOD="password",mn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class yn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class vn extends yn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class bn extends vn{constructor(){super("facebook.com")}static credential(e){return dn._fromParams({providerId:bn.PROVIDER_ID,signInMethod:bn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return bn.credentialFromTaggedObject(e)}static credentialFromError(e){return bn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return bn.credential(t.oauthAccessToken)}catch(n){return null}}}bn.FACEBOOK_SIGN_IN_METHOD="facebook.com",bn.PROVIDER_ID="facebook.com";class wn extends vn{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return dn._fromParams({providerId:wn.PROVIDER_ID,signInMethod:wn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return wn.credentialFromTaggedObject(e)}static credentialFromError(e){return wn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthIdToken:n,oauthAccessToken:r}=t;if(!n&&!r)return null;try{return wn.credential(n,r)}catch(i){return null}}}wn.GOOGLE_SIGN_IN_METHOD="google.com",wn.PROVIDER_ID="google.com";class xn extends vn{constructor(){super("github.com")}static credential(e){return dn._fromParams({providerId:xn.PROVIDER_ID,signInMethod:xn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return xn.credentialFromTaggedObject(e)}static credentialFromError(e){return xn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return xn.credential(t.oauthAccessToken)}catch(n){return null}}}xn.GITHUB_SIGN_IN_METHOD="github.com",xn.PROVIDER_ID="github.com";class In extends vn{constructor(){super("twitter.com")}static credential(e,t){return dn._fromParams({providerId:In.PROVIDER_ID,signInMethod:In.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return In.credentialFromTaggedObject(e)}static credentialFromError(e){return In.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=t;if(!n||!r)return null;try{return In.credential(n,r)}catch(i){return null}}}In.TWITTER_SIGN_IN_METHOD="twitter.com",In.PROVIDER_ID="twitter.com";class Sn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=await St._fromIdTokenResponse(e,n,r),o=En(n);return new Sn({user:i,providerId:o,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=En(n);return new Sn({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function En(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class _n extends s.g{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,_n.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new _n(e,t,n,r)}}function Tn(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw _n._fromErrorAndOperation(e,n,t,r);throw n}))}async function kn(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=await mt(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Sn._forOperation(e,"link",r)}async function Cn(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{auth:i}=e;if((0,r.xZ)(i.app))return Promise.reject(Ve(i));const o="reauthenticate";try{const r=await mt(e,Tn(i,o,t,e),n);$e(r.idToken,i,"internal-error");const s=pt(r.idToken);$e(s,i,"internal-error");const{sub:a}=s;return $e(e.uid===a,i,"user-mismatch"),Sn._forOperation(e,o,r)}catch(s){throw"auth/user-not-found"===(null===s||void 0===s?void 0:s.code)&&Me(i,"user-mismatch"),s}}async function An(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,r.xZ)(e.app))return Promise.reject(Ve(e));const i="signIn",o=await Tn(e,i,t),s=await Sn._fromIdTokenResponse(e,i,o);return n||await e._updateCurrentUser(s.user),s}function Nn(e,t){return tt(e,"POST","/v2/accounts/mfaEnrollment:start",et(e,t))}new WeakMap;const Dn="__sak";class Pn{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Dn,"1"),this.storage.removeItem(Dn),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Rn extends Pn{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ft(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);(0,s.lT)()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Rn.type="LOCAL";const On=Rn;function Ln(e){var t,n;const r=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),i=RegExp(`${r}=([^;]+)`);return null!==(n=null===(t=document.cookie.match(i))||void 0===t?void 0:t[1])&&void 0!==n?n:null}function jn(e){return`${"http:"===window.location.protocol?"__dev_":"__HOST-"}FIREBASE_${e.split(":")[3]}`}class Mn{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){if(void 0===typeof window)return e;const t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){var e;return!("boolean"===typeof isSecureContext&&!isSecureContext)&&("undefined"!==typeof navigator&&"undefined"!==typeof document&&(null===(e=navigator.cookieEnabled)||void 0===e||e))}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;const t=jn(e);if(window.cookieStore){const e=await window.cookieStore.get(t);return null===e||void 0===e?void 0:e.value}return Ln(t)}async _remove(e){if(!this._isAvailable())return;if(!await this._get(e))return;const t=jn(e);document.cookie=`${t}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch((()=>{}))}_addListener(e,t){if(!this._isAvailable())return;const n=jn(e);if(window.cookieStore){const e=e=>{const r=e.changed.find((e=>e.name===n));r&&t(r.value);e.deleted.find((e=>e.name===n))&&t(null)},r=()=>window.cookieStore.removeEventListener("change",e);return this.listenerUnsubscribes.set(t,r),window.cookieStore.addEventListener("change",e)}let r=Ln(n);const i=setInterval((()=>{const e=Ln(n);e!==r&&(t(e),r=e)}),1e3);this.listenerUnsubscribes.set(t,(()=>clearInterval(i)))}_removeListener(e,t){const n=this.listenerUnsubscribes.get(t);n&&(n(),this.listenerUnsubscribes.delete(t))}}Mn.type="COOKIE";class zn extends Pn{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}zn.type="SESSION";const Fn=zn;class Vn{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Vn(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,o=this.handlersMap[r];if(!(null===o||void 0===o?void 0:o.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const s=Array.from(o).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}})))}(s);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Un(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n="";for(let r=0;r<t;r++)n+=Math.floor(10*Math.random());return e+n}Vn.receivers=[];class $n{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;const r="undefined"!==typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,o;return new Promise(((s,a)=>{const l=Un("",20);r.port1.start();const c=setTimeout((()=>{a(new Error("unsupported_event"))}),n);o={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),s(t.data.response);break;default:clearTimeout(c),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(o),r.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])})).finally((()=>{o&&this.removeMessageHandler(o)}))}}function Bn(){return window}function qn(){return"undefined"!==typeof Bn().WorkerGlobalScope&&"function"===typeof Bn().importScripts}const Hn="firebaseLocalStorageDb",Kn="firebaseLocalStorage",Gn="fbase_key";class Wn{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function Qn(e,t){return e.transaction([Kn],t?"readwrite":"readonly").objectStore(Kn)}function Jn(){const e=indexedDB.open(Hn,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Kn,{keyPath:Gn})}catch(r){n(r)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Kn)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Hn);return new Wn(e).toPromise()}(),t(await Jn()))}))}))}async function Yn(e,t,n){const r=Qn(e,!0).put({[Gn]:t,value:n});return new Wn(r).toPromise()}function Xn(e,t){const n=Qn(e,!0).delete(t);return new Wn(n).toPromise()}class Zn{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Jn()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(n){if(t++>3)throw n;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return qn()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Vn._getInstance(qn()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new $n(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Jn();return await Yn(e,Dn,"1"),await Xn(e,Dn),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Yn(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=Qn(e,!1).get(t),r=await new Wn(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Xn(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=Qn(e,!1).getAll();return new Wn(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!n.has(r)&&(this.notifyListeners(r,null),t.push(r));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const r of Array.from(n))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Zn.type="LOCAL";const er=Zn;function tr(e,t){return tt(e,"POST","/v2/accounts/mfaSignIn:start",et(e,t))}Wt("rcb"),new We(3e4,6e4);const nr="recaptcha";async function rr(e,t,n){var r;if(!e._getRecaptchaConfig())try{await tn(e)}catch(i){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"===typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){$e("enroll"===t.type,e,"internal-error");const r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},o=en(e,r,"mfaSmsEnrollment",(async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===Yt){$e((null===n||void 0===n?void 0:n.type)===nr,e,"argument-error");return Nn(e,await ir(e,t,n))}return Nn(e,t)}),"PHONE_PROVIDER");return(await o.catch((e=>Promise.reject(e)))).phoneSessionInfo.sessionInfo}{$e("signin"===t.type,e,"internal-error");const o=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;$e(o,e,"missing-multi-factor-info");const s={mfaPendingCredential:t.credential,mfaEnrollmentId:o,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=en(e,s,"mfaSmsSignIn",(async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===Yt){$e((null===n||void 0===n?void 0:n.type)===nr,e,"argument-error");return tr(e,await ir(e,t,n))}return tr(e,t)}),"PHONE_PROVIDER");return(await a.catch((e=>Promise.reject(e)))).phoneResponseInfo.sessionInfo}}{const t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=en(e,t,"sendVerificationCode",(async(e,t)=>{if(t.captchaResponse===Yt){$e((null===n||void 0===n?void 0:n.type)===nr,e,"argument-error");return hn(e,await ir(e,t,n))}return hn(e,t)}),"PHONE_PROVIDER");return(await r.catch((e=>Promise.reject(e)))).sessionInfo}}finally{null===n||void 0===n||n._reset()}}async function ir(e,t,n){$e(n.type===nr,e,"argument-error");const r=await n.verify();$e("string"===typeof r,e,"argument-error");const i=Object.assign({},t);if("phoneEnrollmentInfo"in i){const e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,o=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:o}}),i}if("phoneSignInInfo"in i){const e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}return Object.assign(i,{recaptchaToken:r}),i}class or{constructor(e){this.providerId=or.PROVIDER_ID,this.auth=qt(e)}verifyPhoneNumber(e,t){return rr(this.auth,e,(0,s.Ku)(t))}static credential(e,t){return pn._fromVerification(e,t)}static credentialFromResult(e){const t=e;return or.credentialFromTaggedObject(t)}static credentialFromError(e){return or.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject(e){let{_tokenResponse:t}=e;if(!t)return null;const{phoneNumber:n,temporaryProof:r}=t;return n&&r?pn._fromTokenResponse(n,r):null}}function sr(e,t){return t?_t(t):($e(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}or.PROVIDER_ID="phone",or.PHONE_SIGN_IN_METHOD="phone";class ar extends sn{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return un(e,this._buildIdpRequest())}_linkToIdToken(e,t){return un(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return un(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function lr(e){return An(e.auth,new ar(e),e.bypassAuthState)}function cr(e){const{auth:t,user:n}=e;return $e(n,t,"internal-error"),Cn(n,new ar(e),e.bypassAuthState)}async function ur(e){const{auth:t,user:n}=e;return $e(n,t,"internal-error"),kn(n,new ar(e),e.bypassAuthState)}class dr{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(n){this.reject(n)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:o,type:s}=e;if(o)return void this.reject(o);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(s)(a))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return lr;case"linkViaPopup":case"linkViaRedirect":return ur;case"reauthViaPopup":case"reauthViaRedirect":return cr;default:Me(this.auth,"internal-error")}}resolve(e){qe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){qe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const hr=new We(2e3,1e4);class fr extends dr{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,fr.currentPopupAction&&fr.currentPopupAction.cancel(),fr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return $e(e,this.auth,"internal-error"),e}async onExecution(){qe(1===this.filter.length,"Popup operations only handle one event");const e=Un();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(ze(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(ze(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,fr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(ze(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,hr.get())};e()}}fr.currentPopupAction=null;const pr=new Map;class gr extends dr{constructor(e,t){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.eventId=null}async execute(){let e=pr.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=vr(t),r=yr(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}pr.set(this.auth._key(),e)}return this.bypassAuthState||pr.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function mr(e,t){pr.set(e._key(),t)}function yr(e){return _t(e._redirectPersistence)}function vr(e){return Ct("pendingRedirect",e.config.apiKey,e.name)}async function br(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,r.xZ)(e.app))return Promise.reject(Ve(e));const i=qt(e),o=sr(i,t),s=new gr(i,o,n),a=await s.execute();return a&&!n&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,t)),a}class wr{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ir(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Ir(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(ze(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(xr(e))}saveEventToCache(e){this.cachedEventUids.add(xr(e)),this.lastProcessedEventTime=Date.now()}}function xr(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Ir(e){let{type:t,error:n}=e;return"unknown"===t&&"auth/no-auth-event"===(null===n||void 0===n?void 0:n.code)}const Sr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Er=/^https?/;async function _r(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e){return tt(e,"GET","/v1/projects",arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}(e);for(const r of t)try{if(Tr(r))return}catch(n){}Me(e,"unauthorized-domain")}function Tr(e){const t=He(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Er.test(n))return!1;if(Sr.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const kr=new We(3e4,6e4);function Cr(){const e=Bn().___jsl;if(null===e||void 0===e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let n=0;n<e.CP.length;n++)e.CP[n]=null}function Ar(e){return new Promise(((t,n)=>{var r,i,o;function s(){Cr(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Cr(),n(ze(e,"network-request-failed"))},timeout:kr.get()})}if(null===(i=null===(r=Bn().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(o=Bn().gapi)||void 0===o?void 0:o.load)){const t=Wt("iframefcb");return Bn()[t]=()=>{gapi.load?s():n(ze(e,"network-request-failed"))},Gt(`${Kt.gapiScript}?onload=${t}`).catch((e=>n(e)))}s()}})).catch((e=>{throw Nr=null,e}))}let Nr=null;const Dr=new We(5e3,15e3),Pr={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Rr=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Or(e){const t=e.config;$e(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?Qe(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:r.MF},o=Rr.get(e.config.apiHost);o&&(i.eid=o);const a=e._getFrameworks();return a.length&&(i.fw=a.join(",")),`${n}?${(0,s.Am)(i).slice(1)}`}async function Lr(e){const t=await function(e){return Nr=Nr||Ar(e),Nr}(e),n=Bn().gapi;return $e(n,e,"internal-error"),t.open({where:document.body,url:Or(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Pr,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=ze(e,"network-request-failed"),o=Bn().setTimeout((()=>{r(i)}),Dr.get());function s(){Bn().clearTimeout(o),n(t)}t.ping(s).then(s,(()=>{r(i)}))}))))}const jr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Mr{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function zr(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const o=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const c=Object.assign(Object.assign({},jr),{width:r.toString(),height:i.toString(),top:o,left:a}),u=(0,s.ZQ)().toLowerCase();n&&(l=Rt(u)?"_blank":n),Dt(u)&&(t=t||"http://localhost",c.scrollbars="yes");const d=Object.entries(c).reduce(((e,t)=>{let[n,r]=t;return`${e}${n}=${r},`}),"");if(function(){var e;return zt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.ZQ)())&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(u)&&"_self"!==l)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",l),new Mr(null);const h=window.open(t||"",l,d);$e(h,e,"popup-blocked");try{h.focus()}catch(f){}return new Mr(h)}const Fr="__/auth/handler",Vr="emulator/auth/handler",Ur=encodeURIComponent("fac");async function $r(e,t,n,i,o,a){$e(e.config.authDomain,e,"auth-domain-config-required"),$e(e.config.apiKey,e,"invalid-api-key");const l={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:r.MF,eventId:o};if(t instanceof yn){t.setDefaultLanguage(e.languageCode),l.providerId=t.providerId||"",(0,s.Im)(t.getCustomParameters())||(l.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))l[e]=t}if(t instanceof vn){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(l.scopes=e.join(","))}e.tenantId&&(l.tid=e.tenantId);const c=l;for(const r of Object.keys(c))void 0===c[r]&&delete c[r];const u=await e._getAppCheckToken(),d=u?`#${Ur}=${encodeURIComponent(u)}`:"";return`${function(e){let{config:t}=e;if(!t.emulator)return`https://${t.authDomain}/${Fr}`;return Qe(t,Vr)}(e)}?${(0,s.Am)(c).slice(1)}${d}`}const Br="webStorageSupport";const qr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Fn,this._completeRedirectFn=br,this._overrideRedirectResult=mr}async _openPopup(e,t,n,r){var i;qe(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()");return zr(e,await $r(e,t,n,He(),r),Un())}async _openRedirect(e,t,n,r){await this._originValidation(e);return function(e){Bn().location.href=e}(await $r(e,t,n,He(),r)),new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(qe(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await Lr(e),n=new wr(e);return t.register("authEvent",(t=>{$e(null===t||void 0===t?void 0:t.authEvent,e,"invalid-auth-event");return{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Br,{type:Br},(n=>{var r;const i=null===(r=null===n||void 0===n?void 0:n[0])||void 0===r?void 0:r[Br];void 0!==i&&t(!!i),Me(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=_r(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ft()||Pt()||zt()}};var Hr="@firebase/auth",Kr="1.10.0";class Gr{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){if(this.assertAuthConfigured(),await this.auth._initializationPromise,!this.auth.currentUser)return null;return{accessToken:await this.auth.currentUser.getIdToken(e)}}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null===t||void 0===t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){$e(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Wr=(0,s.XA)("authIdTokenMaxAge")||300;let Qr=null;var Jr;Kt={loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=ze("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Jr="Browser",(0,r.om)(new a.uA("auth",((e,t)=>{let{options:n}=t;const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:s,authDomain:a}=r.options;$e(s&&!s.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:s,authDomain:a,clientPlatform:Jr,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Vt(Jr)},c=new Bt(r,i,o,l);return function(e,t){const n=(null===t||void 0===t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(_t);(null===t||void 0===t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null===t||void 0===t?void 0:t.popupRedirectResolver)}(c,n),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),(0,r.om)(new a.uA("auth-internal",(e=>(e=>new Gr(e))(qt(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,r.KO)(Hr,Kr,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Jr)),(0,r.KO)(Hr,Kr,"esm2017");const Yr=(0,r.Wp)({apiKey:"AIzaSyDo7X1BLIW1hNYQpJLZcDws_L4aGHJWXOQ",authDomain:"asignacion-plazas.firebaseapp.com",projectId:"asignacion-plazas",storageBucket:"asignacion-plazas.firebasestorage.app",messagingSenderId:"525955676079",appId:"1:525955676079:web:a7e0b00391e75c902fe15a",measurementId:"G-E0DLWYPVKP"}),Xr=(0,i.aU)(Yr);!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,r.Sx)();const t=(0,r.j6)(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=(0,r.j6)(e,"auth");if(n.isInitialized()){const e=n.getImmediate(),r=n.getOptions();if((0,s.bD)(r,null!==t&&void 0!==t?t:{}))return e;Me(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:qr,persistence:[er,On,Fn]}),i=(0,s.XA)("authTokenSyncURL");if(i&&"boolean"===typeof isSecureContext&&isSecureContext){const e=new URL(i,location.origin);if(location.origin===e.origin){const t=(o=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>Wr)return;const r=null===t||void 0===t?void 0:t.token;Qr!==r&&(Qr=r,await fetch(o,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(e,t,n){(0,s.Ku)(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e,t,n,r){(0,s.Ku)(e).onIdTokenChanged(t,n,r)}(n,(e=>t(e)))}}var o;const a=(0,s.Tj)("auth");a&&nn(n,`http://${a}`)}(Yr);try{(0,i.ol)(Xr).catch((e=>{"failed-precondition"===e.code||e.code}))}catch(Zr){}},234:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,s=i>>>1;r<s;){var a=2*(r+1)-1,l=e[a],c=a+1,u=e[c];if(0>o(l,n))c<i&&0>o(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[a]=n,r=a);else{if(!(c<i&&0>o(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],d=1,h=null,f=3,p=!1,g=!1,m=!1,y="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function w(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function x(e){if(m=!1,w(e),!g)if(null!==r(c))g=!0,R(I);else{var t=r(u);null!==t&&O(x,t.startTime-e)}}function I(e,n){g=!1,m&&(m=!1,v(T),T=-1),p=!0;var o=f;try{for(w(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!A());){var s=h.callback;if("function"===typeof s){h.callback=null,f=h.priorityLevel;var a=s(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?h.callback=a:h===r(c)&&i(c),w(n)}else i(c);h=r(c)}if(null!==h)var l=!0;else{var d=r(u);null!==d&&O(x,d.startTime-n),l=!1}return l}finally{h=null,f=o,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,E=!1,_=null,T=-1,k=5,C=-1;function A(){return!(t.unstable_now()-C<k)}function N(){if(null!==_){var e=t.unstable_now();C=e;var n=!0;try{n=_(!0,e)}finally{n?S():(E=!1,_=null)}}else E=!1}if("function"===typeof b)S=function(){b(N)};else if("undefined"!==typeof MessageChannel){var D=new MessageChannel,P=D.port2;D.port1.onmessage=N,S=function(){P.postMessage(null)}}else S=function(){y(N,0)};function R(e){_=e,E||(E=!0,S())}function O(e,n){T=y((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||p||(g=!0,R(I))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,i,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===r(c)&&e===r(u)&&(m?(v(T),T=-1):m=!0,O(x,o-s))):(e.sortIndex=a,n(c,e),g||p||(g=!0,R(I))),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},391:(e,t,n)=>{var r=n(950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},443:(e,t,n)=>{n.d(t,{$b:()=>i,Vy:()=>c});const r=[];var i;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));const o={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},s=i.INFO,a={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},l=function(e,t){if(t<e.logLevel)return;const n=(new Date).toISOString(),r=a[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);for(var i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];console[r](`[${n}]  ${e.name}:`,...o)};class c{constructor(e){this.name=e,this._logLevel=s,this._logHandler=l,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?o[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...t),this._logHandler(this,i.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...t),this._logHandler(this,i.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.INFO,...t),this._logHandler(this,i.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.WARN,...t),this._logHandler(this,i.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,i.ERROR,...t),this._logHandler(this,i.ERROR,...t)}}},472:(e,t,n)=>{n.d(t,{rJ:()=>Ou,kd:()=>qd,H9:()=>Lu,ol:()=>Bu,GG:()=>Ud,aU:()=>Vu,AB:()=>Ad,aQ:()=>Hd,P:()=>Ed,O5:()=>Jd,BN:()=>$d,mZ:()=>Bd,_M:()=>Td,wP:()=>Yd});var r,i,o=n(52),s=n(812),a=n(443),l=n(529),c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},u={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"===typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var o=e.g[3],s=t+(o^n&(i^o))+r[0]+3614090360&4294967295;s=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=(n=(i=(o=(t=n+(s<<7&4294967295|s>>>25))+((s=o+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^o&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(o^t))+r[3]+3250441966&4294967295)<<22&4294967295|s>>>10))+((s=t+(o^n&(i^o))+r[4]+4118548399&4294967295)<<7&4294967295|s>>>25))+((s=o+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^o&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(o^t))+r[7]+4249261313&4294967295)<<22&4294967295|s>>>10))+((s=t+(o^n&(i^o))+r[8]+1770035416&4294967295)<<7&4294967295|s>>>25))+((s=o+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^o&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(o^t))+r[11]+2304563134&4294967295)<<22&4294967295|s>>>10))+((s=t+(o^n&(i^o))+r[12]+1804603682&4294967295)<<7&4294967295|s>>>25))+((s=o+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|s>>>20))+((s=i+(n^o&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|s>>>15))+((s=n+(t^i&(o^t))+r[15]+1236535329&4294967295)<<22&4294967295|s>>>10))+((s=t+(i^o&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|s>>>27))+((s=o+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(o^t))+r[11]+643717713&4294967295)<<14&4294967295|s>>>18))+((s=n+(o^t&(i^o))+r[0]+3921069994&4294967295)<<20&4294967295|s>>>12))+((s=t+(i^o&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|s>>>27))+((s=o+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(o^t))+r[15]+3634488961&4294967295)<<14&4294967295|s>>>18))+((s=n+(o^t&(i^o))+r[4]+3889429448&4294967295)<<20&4294967295|s>>>12))+((s=t+(i^o&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|s>>>27))+((s=o+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(o^t))+r[3]+4107603335&4294967295)<<14&4294967295|s>>>18))+((s=n+(o^t&(i^o))+r[8]+1163531501&4294967295)<<20&4294967295|s>>>12))+((s=t+(i^o&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|s>>>27))+((s=o+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|s>>>23))+((s=i+(t^n&(o^t))+r[7]+1735328473&4294967295)<<14&4294967295|s>>>18))+((s=n+(o^t&(i^o))+r[12]+2368359562&4294967295)<<20&4294967295|s>>>12))+((s=t+(n^i^o)+r[5]+4294588738&4294967295)<<4&4294967295|s>>>28))+((s=o+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|s>>>21))+((s=i+(o^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^o^t)+r[14]+4259657740&4294967295)<<23&4294967295|s>>>9))+((s=t+(n^i^o)+r[1]+2763975236&4294967295)<<4&4294967295|s>>>28))+((s=o+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|s>>>21))+((s=i+(o^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^o^t)+r[10]+3200236656&4294967295)<<23&4294967295|s>>>9))+((s=t+(n^i^o)+r[13]+681279174&4294967295)<<4&4294967295|s>>>28))+((s=o+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|s>>>21))+((s=i+(o^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^o^t)+r[6]+76029189&4294967295)<<23&4294967295|s>>>9))+((s=t+(n^i^o)+r[9]+3654602809&4294967295)<<4&4294967295|s>>>28))+((s=o+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|s>>>21))+((s=i+(o^t^n)+r[15]+530742520&4294967295)<<16&4294967295|s>>>16))+((s=n+(i^o^t)+r[2]+3299628645&4294967295)<<23&4294967295|s>>>9))+((s=t+(i^(n|~o))+r[0]+4096336452&4294967295)<<6&4294967295|s>>>26))+((s=o+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|s>>>22))+((s=i+(t^(o|~n))+r[14]+2878612391&4294967295)<<15&4294967295|s>>>17))+((s=n+(o^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|s>>>11))+((s=t+(i^(n|~o))+r[12]+1700485571&4294967295)<<6&4294967295|s>>>26))+((s=o+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|s>>>22))+((s=i+(t^(o|~n))+r[10]+4293915773&4294967295)<<15&4294967295|s>>>17))+((s=n+(o^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|s>>>11))+((s=t+(i^(n|~o))+r[8]+1873313359&4294967295)<<6&4294967295|s>>>26))+((s=o+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|s>>>22))+((s=i+(t^(o|~n))+r[6]+2734768916&4294967295)<<15&4294967295|s>>>17))+((s=n+(o^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|s>>>11))+((o=(t=n+((s=t+(i^(n|~o))+r[4]+4149444226&4294967295)<<6&4294967295|s>>>26))+((s=o+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|s>>>22))^((i=o+((s=i+(t^(o|~n))+r[2]+718787259&4294967295)<<15&4294967295|s>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(s<<21&4294967295|s>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+o&4294967295}function o(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var o=0|e[i];r&&o==t||(n[i]=o,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return t.prototype[n].apply(e,i)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,o=this.h,s=0;s<t;){if(0==o)for(;s<=r;)n(this,e,s),s+=this.blockSize;if("string"===typeof e){for(;s<t;)if(i[o++]=e.charCodeAt(s++),o==this.blockSize){n(this,i),o=0;break}}else for(;s<t;)if(i[o++]=e[s++],o==this.blockSize){n(this,i),o=0;break}}this.h=o,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var s={};function a(e){return-128<=e&&128>e?function(e,t){var n=s;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(e){return new o([0|e],0>e?-1:0)})):new o([0|e],0>e?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return c;if(0>e)return g(l(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new o(t,0)}var c=a(0),d=a(1),h=a(16777216);function f(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function p(e){return-1==e.h}function g(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new o(n,~e.h).add(d)}function m(e,t){return e.add(g(t))}function y(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function b(e,t){if(f(t))throw Error("division by zero");if(f(e))return new v(c,c);if(p(e))return t=b(g(e),t),new v(g(t.g),g(t.h));if(p(t))return t=b(e,g(t)),new v(g(t.g),t.h);if(30<e.g.length){if(p(e)||p(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,r=t;0>=r.l(e);)n=w(n),r=w(r);var i=x(n,1),o=x(r,1);for(r=x(r,2),n=x(n,2);!f(r);){var s=o.add(r);0>=s.l(e)&&(i=i.add(n),o=s),r=x(r,1),n=x(n,1)}return t=m(e,i.j(t)),new v(i,t)}for(i=c;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),s=(o=l(n)).j(t);p(s)||0<s.l(e);)s=(o=l(n-=r)).j(t);f(o)&&(o=d),i=i.add(o),e=m(e,s)}return new v(i,e)}function w(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new o(n,e.h)}function x(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],s=0;s<r;s++)i[s]=0<t?e.i(s+n)>>>t|e.i(s+n+1)<<32-t:e.i(s+n);return new o(i,e.h)}(e=o.prototype).m=function(){if(p(this))return-g(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(f(this))return"0";if(p(this))return"-"+g(this).toString(e);for(var t=l(Math.pow(e,6)),n=this,r="";;){var i=b(n,t).g,o=((0<(n=m(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(f(n=i))return o+r;for(;6>o.length;)o="0"+o;r=o+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return p(e=m(this,e))?-1:f(e)?0:1},e.abs=function(){return p(this)?g(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var s=r+(65535&this.i(i))+(65535&e.i(i)),a=(s>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=a>>>16,s&=65535,a&=65535,n[i]=a<<16|s}return new o(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(f(this)||f(e))return c;if(p(this))return p(e)?g(this).j(g(e)):g(g(this).j(e));if(p(e))return g(this.j(g(e)));if(0>this.l(h)&&0>e.l(h))return l(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var s=this.i(r)>>>16,a=65535&this.i(r),u=e.i(i)>>>16,d=65535&e.i(i);n[2*r+2*i]+=a*d,y(n,2*r+2*i),n[2*r+2*i+1]+=s*d,y(n,2*r+2*i+1),n[2*r+2*i+1]+=a*u,y(n,2*r+2*i+1),n[2*r+2*i+2]+=s*u,y(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new o(n,0)},e.A=function(e){return b(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new o(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new o(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new o(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,i=u.Md5=t,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=l,o.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return g(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=l(Math.pow(n,8)),i=c,o=0;o<t.length;o+=8){var s=Math.min(8,t.length-o),a=parseInt(t.substring(o,o+s),n);8>s?(s=l(Math.pow(n,s)),i=i.j(s).add(l(a))):i=(i=i.j(r)).add(l(a))}return i},r=u.Integer=o}).apply("undefined"!==typeof c?c:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var d,h,f,p,g,m,y,v,b="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},w={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e};var n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof b&&b];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var o=0;o<e.length-1;o++){var s=e[o];if(!(s in i))break e;i=i[s]}(r=r(o=i[e=e[e.length-1]]))!=o&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return t}))}}));var r=r||{},i=this||self;function o(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function s(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function c(e,t,n){return(c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:l).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function x(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return t.prototype[n].apply(e,i)}}function S(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function E(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];if(o(t)){const n=e.length||0,r=t.length||0;e.length=n+r;for(let i=0;i<r;i++)e[n+i]=t[i]}else e.push(t)}}function _(e){return/^[\s\xa0]*$/.test(e)}function T(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function k(e){return k[" "](e),e}k[" "]=function(){};var C=-1!=T().indexOf("Gecko")&&!(-1!=T().toLowerCase().indexOf("webkit")&&-1==T().indexOf("Edge"))&&!(-1!=T().indexOf("Trident")||-1!=T().indexOf("MSIE"))&&-1==T().indexOf("Edge");function A(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function N(e){const t={};for(const n in e)t[n]=e[n];return t}const D="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function P(e,t){let n,r;for(let i=1;i<arguments.length;i++){for(n in r=arguments[i],r)e[n]=r[n];for(let t=0;t<D.length;t++)n=D[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function R(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function O(e){i.setTimeout((()=>{throw e}),0)}function L(){var e=V;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var j=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new M),(e=>e.reset()));class M{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let z,F=!1,V=new class{constructor(){this.h=this.g=null}add(e,t){const n=j.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},U=()=>{const e=i.Promise.resolve(void 0);z=()=>{e.then($)}};var $=()=>{for(var e;e=L();){try{e.h.call(e.g)}catch(n){O(n)}var t=j;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}F=!1};function B(){this.s=this.s,this.C=this.C}function q(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}B.prototype.s=!1,B.prototype.ma=function(){this.s||(this.s=!0,this.N())},B.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},q.prototype.h=function(){this.defaultPrevented=!0};var H=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(n){}return e}();function K(e,t){if(q.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(C){e:{try{k(t.nodeName);var i=!0;break e}catch(o){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:G[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&K.aa.h.call(this)}}x(K,q);var G={2:"touch",3:"pen",4:"mouse"};K.prototype.h=function(){K.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var W="closure_listenable_"+(1e6*Math.random()|0),Q=0;function J(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++Q,this.da=this.fa=!1}function Y(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function X(e){this.src=e,this.g={},this.h=0}function Z(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],o=Array.prototype.indexOf.call(i,t,void 0);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Y(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function ee(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.da&&o.listener==t&&o.capture==!!n&&o.ha==r)return i}return-1}X.prototype.add=function(e,t,n,r,i){var o=e.toString();(e=this.g[o])||(e=this.g[o]=[],this.h++);var s=ee(e,t,r,i);return-1<s?(t=e[s],n||(t.fa=!1)):((t=new J(t,this.src,o,!!r,i)).fa=n,e.push(t)),t};var te="closure_lm_"+(1e6*Math.random()|0),ne={};function re(e,t,n,r,i){if(r&&r.once)return oe(e,t,n,r,i);if(Array.isArray(t)){for(var o=0;o<t.length;o++)re(e,t[o],n,r,i);return null}return n=he(n),e&&e[W]?e.K(t,n,s(r)?!!r.capture:!!r,i):ie(e,t,n,!1,r,i)}function ie(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var a=s(i)?!!i.capture:!!i,l=ue(e);if(l||(e[te]=l=new X(e)),(n=l.add(t,n,r,a,o)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}const t=ce;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)H||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(le(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function oe(e,t,n,r,i){if(Array.isArray(t)){for(var o=0;o<t.length;o++)oe(e,t[o],n,r,i);return null}return n=he(n),e&&e[W]?e.L(t,n,s(r)?!!r.capture:!!r,i):ie(e,t,n,!0,r,i)}function se(e,t,n,r,i){if(Array.isArray(t))for(var o=0;o<t.length;o++)se(e,t[o],n,r,i);else r=s(r)?!!r.capture:!!r,n=he(n),e&&e[W]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=ee(o=e.g[t],n,r,i))&&(Y(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete e.g[t],e.h--)))):e&&(e=ue(e))&&(t=e.g[t.toString()],e=-1,t&&(e=ee(t,n,r,i)),(n=-1<e?t[e]:null)&&ae(n))}function ae(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[W])Z(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(le(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ue(t))?(Z(n,e),0==n.h&&(n.src=null,t[te]=null)):Y(e)}}}function le(e){return e in ne?ne[e]:ne[e]="on"+e}function ce(e,t){if(e.da)e=!0;else{t=new K(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&ae(e),e=n.call(r,t)}return e}function ue(e){return(e=e[te])instanceof X?e:null}var de="__closure_events_fn_"+(1e9*Math.random()>>>0);function he(e){return"function"===typeof e?e:(e[de]||(e[de]=function(t){return e.handleEvent(t)}),e[de])}function fe(){B.call(this),this.i=new X(this),this.M=this,this.F=null}function pe(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"===typeof t)t=new q(t,e);else if(t instanceof q)t.target=t.target||e;else{var i=t;P(t=new q(r,e),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=t.g=n[o];i=ge(s,r,!0,t)&&i}if(i=ge(s=t.g=e,r,!0,t)&&i,i=ge(s,r,!1,t)&&i,n)for(o=0;o<n.length;o++)i=ge(s=t.g=n[o],r,!1,t)&&i}function ge(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var s=t[o];if(s&&!s.da&&s.capture==n){var a=s.listener,l=s.ha||s.src;s.fa&&Z(e.i,s),i=!1!==a.call(l,r)&&i}}return i&&!r.defaultPrevented}function me(e,t,n){if("function"===typeof e)n&&(e=c(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function ye(e){e.g=me((()=>{e.g=null,e.i&&(e.i=!1,ye(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}x(fe,B),fe.prototype[W]=!0,fe.prototype.removeEventListener=function(e,t,n,r){se(this,e,t,n,r)},fe.prototype.N=function(){if(fe.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Y(n[r]);delete t.g[e],t.h--}}this.F=null},fe.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},fe.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ve extends B{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ye(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function be(e){B.call(this),this.h=e,this.g={}}x(be,B);var we=[];function xe(e){A(e.g,(function(e,t){this.g.hasOwnProperty(t)&&ae(e)}),e),e.g={}}be.prototype.N=function(){be.aa.N.call(this),xe(this)},be.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ie=i.JSON.stringify,Se=i.JSON.parse,Ee=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function _e(){}function Te(e){return e.h||(e.h=e.i())}function ke(){}_e.prototype.h=null;var Ce={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ae(){q.call(this,"d")}function Ne(){q.call(this,"c")}x(Ae,q),x(Ne,q);var De={},Pe=null;function Re(){return Pe=Pe||new fe}function Oe(e){q.call(this,De.La,e)}function Le(e){const t=Re();pe(t,new Oe(t))}function je(e,t){q.call(this,De.STAT_EVENT,e),this.stat=t}function Me(e){const t=Re();pe(t,new je(t,e))}function ze(e,t){q.call(this,De.Ma,e),this.size=t}function Fe(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){e()}),t)}function Ve(){this.g=!0}function Ue(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Ie(n)}catch(a){return t}}(e,n)+(r?" "+r:"")}))}De.La="serverreachability",x(Oe,q),De.STAT_EVENT="statevent",x(je,q),De.Ma="timingevent",x(ze,q),Ve.prototype.xa=function(){this.g=!1},Ve.prototype.info=function(){};var $e,Be={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},qe={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function He(){}function Ke(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new be(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ge}function Ge(){this.i=null,this.g="",this.h=!1}x(He,_e),He.prototype.g=function(){return new XMLHttpRequest},He.prototype.i=function(){return{}},$e=new He;var We={},Qe={};function Je(e,t,n){e.L=1,e.v=It(yt(t)),e.m=n,e.P=!0,Ye(e,null)}function Ye(e,t){e.F=Date.now(),et(e),e.A=yt(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),jt(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Ge,e.g=En(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ve(c(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(we[0]=i.toString()),i=we);for(var o=0;o<i.length;o++){var s=re(n,i[o],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}t=e.H?N(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Le(),function(e,t,n,r,i,o){e.info((function(){if(e.g)if(o)for(var s="",a=o.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var d=u.split("_");s=2<=d.length&&"type"==d[1]?s+(u+"=")+c+"&":s+(u+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+s}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function Xe(e){return!!e.g&&("GET"==e.u&&2!=e.L&&e.j.Ca)}function Ze(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Qe:(n=Number(t.substring(n,r)),isNaN(n)?We:(r+=1)+n>t.length?Qe:(t=t.slice(r,r+n),e.C=r+n,t))}function et(e){e.S=Date.now()+e.I,tt(e,e.I)}function tt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Fe(c(e.ba,e),t)}function nt(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function rt(e){0==e.j.G||e.J||bn(e.j,e)}function it(e){nt(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,xe(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function ot(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||ut(n.h,e)))if(!e.K&&ut(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(u){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;vn(n),ln(n)}gn(n),Me(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Fe(c(n.Za,n),6e3));if(1>=ct(n.h)&&n.ca){try{n.ca()}catch(u){}n.ca=void 0}}else xn(n,11)}else if((e.K||n.g==e)&&vn(n),!_(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let c=i[t];if(n.T=c[0],c=c[1],2==n.G)if("c"==c[0]){n.K=c[1],n.ia=c[2];const t=c[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=c[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const u=c[5];null!=u&&"number"===typeof u&&0<u&&(r=1.5*u,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const d=e.g;if(d){const e=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var o=r.h;o.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(o.j=o.l,o.g=new Set,o.h&&(dt(o,o.h),o.h=null))}if(r.D){const e=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,xt(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var s=e;if((r=n).qa=Sn(r,r.J?r.ia:null,r.W),s.K){ht(r.h,s);var a=s,l=r.L;l&&(a.I=l),a.B&&(nt(a),et(a)),r.g=s}else pn(r);0<n.i.length&&un(n)}else"stop"!=c[0]&&"close"!=c[0]||xn(n,7);else 3==n.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?xn(n,7):an(n):"noop"!=c[0]&&n.l&&n.l.ta(c),n.v=0)}Le()}catch(u){}}Ke.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==nn(e)?t.j():this.Y(e)},Ke.prototype.Y=function(e){try{if(e==this.g)e:{const h=nn(this.g);var t=this.g.Ba();this.g.Z();if(!(3>h)&&(3!=h||this.g&&(this.h.h||this.g.oa()||rn(this.g)))){this.J||4!=h||7==t||Le(),nt(this);var n=this.g.Z();this.X=n;t:if(Xe(this)){var r=rn(this.g);e="";var o=r.length,s=4==nn(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){it(this),rt(this);var a="";break t}this.h.i=new i.TextDecoder}for(t=0;t<o;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(s&&t==o-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,o,s){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+o+" "+s}))}(this.i,this.u,this.A,this.l,this.R,h,n),this.o){if(this.T&&!this.K){t:{if(this.g){var l,c=this.g;if((l=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(l)){var u=l;break t}}u=null}if(!(n=u)){this.o=!1,this.s=3,Me(12),it(this),rt(this);break e}Ue(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ot(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=Ze(this,a),e==Qe){4==h&&(this.s=4,Me(14),n=!1),Ue(this.i,this.l,null,"[Incomplete Response]");break}if(e==We){this.s=4,Me(15),Ue(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Ue(this.i,this.l,e,null),ot(this,e)}if(Xe(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=h||0!=a.length||this.h.h||(this.s=1,Me(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.ba&&!d.M&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),mn(d),d.M=!0,Me(11))}}else Ue(this.i,this.l,a,"[Invalid Chunked Response]"),it(this),rt(this)}else Ue(this.i,this.l,a,null),ot(this,a);4==h&&it(this),this.o&&!this.J&&(4==h?bn(this.j,this):(this.o=!1,et(this)))}else(function(e){const t={};e=(e.g&&2<=nn(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(_(e[r]))continue;var n=R(e[r]);const i=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const o=t[i]||[];t[i]=o,o.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Me(12)):(this.s=0,Me(13)),it(this),rt(this)}}}catch(h){}},Ke.prototype.cancel=function(){this.J=!0,it(this)},Ke.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(Le(),Me(17)),it(this),this.s=2,rt(this)):tt(this,this.S-e)};var st=class{constructor(e,t){this.g=e,this.map=t}};function at(e){this.l=e||10,i.PerformanceNavigationTiming?e=0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function lt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function ct(e){return e.h?1:e.g?e.g.size:0}function ut(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function dt(e,t){e.g?e.g.add(t):e.h=t}function ht(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function ft(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return S(e.i)}function pt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(o(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(o(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(o(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}at.prototype.cancel=function(){if(this.i=ft(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var gt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mt(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof mt){this.h=e.h,vt(this,e.j),this.o=e.o,this.g=e.g,bt(this,e.s),this.l=e.l;var t=e.i,n=new Pt;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),wt(this,n),this.m=e.m}else e&&(t=String(e).match(gt))?(this.h=!1,vt(this,t[1]||"",!0),this.o=St(t[2]||""),this.g=St(t[3]||"",!0),bt(this,t[4]),this.l=St(t[5]||"",!0),wt(this,t[6]||"",!0),this.m=St(t[7]||"")):(this.h=!1,this.i=new Pt(null,this.h))}function yt(e){return new mt(e)}function vt(e,t,n){e.j=n?St(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function bt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function wt(e,t,n){t instanceof Pt?(e.i=t,function(e,t){t&&!e.j&&(Rt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Ot(this,t),jt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=Et(t,Nt)),e.i=new Pt(t,e.h))}function xt(e,t,n){e.i.set(t,n)}function It(e){return xt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function St(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Et(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,_t),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function _t(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}mt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Et(t,kt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(Et(t,kt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(Et(n,"/"==n.charAt(0)?At:Ct,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",Et(n,Dt)),e.join("")};var Tt,kt=/[#\/\?@]/g,Ct=/[#\?:]/g,At=/[#\?]/g,Nt=/[#\?@]/g,Dt=/#/g;function Pt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Rt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var o=e[n].substring(0,r);i=e[n].substring(r+1)}else o=e[n];t(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Ot(e,t){Rt(e),t=Mt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Lt(e,t){return Rt(e),t=Mt(e,t),e.g.has(t)}function jt(e,t,n){Ot(e,t),0<n.length&&(e.i=null,e.g.set(Mt(e,t),S(n)),e.h+=n.length)}function Mt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function zt(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(o){}}function Ft(){this.g=new Ee}function Vt(e,t,n){const r=n||"";try{pt(e,(function(e,n){let i=e;s(e)&&(i=Ie(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Ut(e){this.l=e.Ub||null,this.j=e.eb||!1}function $t(e,t){fe.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function Bt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function qt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Ht(e)}function Ht(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Kt(e){let t="";return A(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Gt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Kt(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):xt(e,t,n))}function Wt(e){fe.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=Pt.prototype).add=function(e,t){Rt(this),this.i=null,e=Mt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){Rt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},e.na=function(){Rt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},e.V=function(e){Rt(this);let t=[];if("string"===typeof e)Lt(this,e)&&(t=t.concat(this.g.get(Mt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return Rt(this),this.i=null,Lt(this,e=Mt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const o=encodeURIComponent(String(r)),s=this.V(r);for(r=0;r<s.length;r++){var i=o;""!==s[r]&&(i+="="+encodeURIComponent(String(s[r]))),e.push(i)}}return this.i=e.join("&")},x(Ut,_e),Ut.prototype.g=function(){return new $t(this.l,this.j)},Ut.prototype.i=(Tt={},function(){return Tt}),x($t,fe),(e=$t.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Ht(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,qt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ht(this)),this.g&&(this.readyState=3,Ht(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if("undefined"!==typeof i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Bt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?qt(this):Ht(this),3==this.readyState&&Bt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,qt(this))},e.Qa=function(e){this.g&&(this.response=e,qt(this))},e.ga=function(){this.g&&qt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty($t.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),x(Wt,fe);var Qt=/^https?$/i,Jt=["POST","PUT"];function Yt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Xt(e),en(e)}function Xt(e){e.A||(e.A=!0,pe(e,"complete"),pe(e,"error"))}function Zt(e){if(e.h&&"undefined"!=typeof r&&(!e.v[1]||4!=nn(e)||2!=e.Z()))if(e.u&&4==nn(e))me(e.Ea,0,e);else if(pe(e,"readystatechange"),4==nn(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var o;if(o=0===r){var s=String(e.D).match(gt)[1]||null;!s&&i.self&&i.self.location&&(s=i.self.location.protocol.slice(0,-1)),o=!Qt.test(s?s.toLowerCase():"")}n=o}if(n)pe(e,"complete"),pe(e,"success");else{e.m=6;try{var a=2<nn(e)?e.g.statusText:""}catch(l){a=""}e.l=a+" ["+e.Z()+"]",Xt(e)}}finally{en(e)}}}function en(e,t){if(e.g){tn(e);const r=e.g,i=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||pe(e,"ready");try{r.onreadystatechange=i}catch(n){}}}function tn(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function nn(e){return e.g?e.g.readyState:0}function rn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(I){return null}}function on(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function sn(e){this.Aa=0,this.i=[],this.j=new Ve,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=on("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=on("baseRetryDelayMs",5e3,e),this.cb=on("retryDelaySeedMs",1e4,e),this.Wa=on("forwardChannelMaxRetries",2,e),this.wa=on("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new at(e&&e.concurrentRequestLimit),this.Da=new Ft,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function an(e){if(cn(e),3==e.G){var t=e.U++,n=yt(e.I);if(xt(n,"SID",e.K),xt(n,"RID",t),xt(n,"TYPE","terminate"),hn(e,n),(t=new Ke(e,e.j,t)).L=2,t.v=It(yt(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=En(t.j,null),t.g.ea(t.v)),t.F=Date.now(),et(t)}In(e)}function ln(e){e.g&&(mn(e),e.g.cancel(),e.g=null)}function cn(e){ln(e),e.u&&(i.clearTimeout(e.u),e.u=null),vn(e),e.h.cancel(),e.s&&("number"===typeof e.s&&i.clearTimeout(e.s),e.s=null)}function un(e){if(!lt(e.h)&&!e.s){e.s=!0;var t=e.Ga;z||U(),F||(z(),F=!0),V.add(t,e),e.B=0}}function dn(e,t){var n;n=t?t.l:e.U++;const r=yt(e.I);xt(r,"SID",e.K),xt(r,"RID",n),xt(r,"AID",e.T),hn(e,r),e.m&&e.o&&Gt(r,e.m,e.o),n=new Ke(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=fn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),dt(e.h,n),Je(n,r,t)}function hn(e,t){e.H&&A(e.H,(function(e,n){xt(t,n,e)})),e.l&&pt({},(function(e,n){xt(t,n,e)}))}function fn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?c(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=i[a].g;const l=i[a].map;if(n-=t,0>n)t=Math.max(0,i[a].g-100),s=!1;else try{Vt(l,e,"req"+n+"_")}catch(o){r&&r(l)}}if(s){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function pn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;z||U(),F||(z(),F=!0),V.add(t,e),e.v=0}}function gn(e){return!(e.g||e.u||3<=e.v)&&(e.Y++,e.u=Fe(c(e.Fa,e),wn(e,e.v)),e.v++,!0)}function mn(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function yn(e){e.g=new Ke(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=yt(e.qa);xt(t,"RID","rpc"),xt(t,"SID",e.K),xt(t,"AID",e.T),xt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&xt(t,"TO",e.ja),xt(t,"TYPE","xmlhttp"),hn(e,t),e.m&&e.o&&Gt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=It(yt(t)),n.m=null,n.P=!0,Ye(n,e)}function vn(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function bn(e,t){var n=null;if(e.g==t){vn(e),mn(e),e.g=null;var r=2}else{if(!ut(e.h,t))return;n=t.D,ht(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;pe(r=Re(),new ze(r,n)),un(e)}else pn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(ct(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa))&&(e.s=Fe(c(e.Ga,e,t),wn(e,e.B)),e.B++,!0))}(e,t)||2==r&&gn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:xn(e,5);break;case 4:xn(e,10);break;case 3:xn(e,6);break;default:xn(e,2)}}function wn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function xn(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.fb,e),r=e.Xa;const t=!r;r=new mt(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||vt(r,"https"),It(r),t?function(e,t){const n=new Ve;if(i.Image){const r=new Image;r.onload=u(zt,n,"TestLoadImage: loaded",!0,t,r),r.onerror=u(zt,n,"TestLoadImage: error",!1,t,r),r.onabort=u(zt,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=u(zt,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ve;const n=new AbortController,r=setTimeout((()=>{n.abort(),zt(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(r),e.ok?zt(0,0,!0,t):zt(0,0,!1,t)})).catch((()=>{clearTimeout(r),zt(0,0,!1,t)}))}(r.toString(),n)}else Me(2);e.G=0,e.l&&e.l.sa(t),In(e),cn(e)}function In(e){if(e.G=0,e.ka=[],e.l){const t=ft(e.h);0==t.length&&0==e.i.length||(E(e.ka,t),E(e.ka,e.i),e.h.i.length=0,S(e.i),e.i.length=0),e.l.ra()}}function Sn(e,t,n){var r=n instanceof mt?yt(n):new mt(n);if(""!=r.g)t&&(r.g=t+"."+r.g),bt(r,r.s);else{var o=i.location;r=o.protocol,t=t?t+"."+o.hostname:o.hostname,o=+o.port;var s=new mt(null);r&&vt(s,r),t&&(s.g=t),o&&bt(s,o),n&&(s.l=n),r=s}return n=e.D,t=e.ya,n&&t&&xt(r,n,t),xt(r,"VER",e.la),hn(e,r),r}function En(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Wt(new Ut({eb:n})):new Wt(e.pa)).Ha(e.J),t}function _n(){}function Tn(){}function kn(e,t){fe.call(this),this.g=new sn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!_(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!_(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Nn(this)}function Cn(e){Ae.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function An(){Ne.call(this),this.status=1}function Nn(e){this.g=e}(e=Wt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():$e.g(),this.v=this.o?Te(this.o):Te($e),this.g.onreadystatechange=c(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(s){return void Yt(this,s)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var o in r)n.set(o,r[o]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),o=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Jt,t,void 0))||r||o||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,a]of n)this.g.setRequestHeader(i,a);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tn(this),this.u=!0,this.g.send(e),this.u=!1}catch(s){Yt(this,s)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,pe(this,"complete"),pe(this,"abort"),en(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),en(this,!0)),Wt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Zt(this):this.bb())},e.bb=function(){Zt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<nn(this)?this.g.status:-1}catch(Tt){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(Tt){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Se(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=sn.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Me(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=Sn(this,null,this.W),un(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Ke(this,this.j,e);let o=this.o;if(this.S&&(o?(o=N(o),P(o,this.S)):o=this.S),null!==this.m||this.O||(i.H=o,o=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=fn(this,i,t),xt(n=yt(this.I),"RID",e),xt(n,"CVER",22),this.D&&xt(n,"X-HTTP-Session-Id",this.D),hn(this,n),o&&(this.O?t="headers="+encodeURIComponent(String(Kt(o)))+"&"+t:this.m&&Gt(n,this.m,o)),dt(this.h,i),this.Ua&&xt(n,"TYPE","init"),this.P?(xt(n,"$req",t),xt(n,"SID","null"),i.T=!0,Je(i,n,null)):Je(i,n,t),this.G=2}}else 3==this.G&&(e?dn(this,e):0==this.i.length||lt(this.h)||dn(this))},e.Fa=function(){if(this.u=null,yn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Fe(c(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Me(10),ln(this),yn(this))},e.Za=function(){null!=this.C&&(this.C=null,ln(this),gn(this),Me(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Me(2)):(this.j.info("Failed to ping google.com"),Me(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=_n.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},Tn.prototype.g=function(e,t){return new kn(e,t)},x(kn,fe),kn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},kn.prototype.close=function(){an(this.g)},kn.prototype.o=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=Ie(e),e=n);t.i.push(new st(t.Ya++,e)),3==t.G&&un(t)},kn.prototype.N=function(){this.g.l=null,delete this.j,an(this.g),delete this.g,kn.aa.N.call(this)},x(Cn,Ae),x(An,Ne),x(Nn,_n),Nn.prototype.ua=function(){pe(this.g,"a")},Nn.prototype.ta=function(e){pe(this.g,new Cn(e))},Nn.prototype.sa=function(e){pe(this.g,new An)},Nn.prototype.ra=function(){pe(this.g,"b")},Tn.prototype.createWebChannel=Tn.prototype.g,kn.prototype.send=kn.prototype.o,kn.prototype.open=kn.prototype.m,kn.prototype.close=kn.prototype.close,v=w.createWebChannelTransport=function(){return new Tn},y=w.getStatEventTarget=function(){return Re()},m=w.Event=De,g=w.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Be.NO_ERROR=0,Be.TIMEOUT=8,Be.HTTP_ERROR=6,p=w.ErrorCode=Be,qe.COMPLETE="complete",f=w.EventType=qe,ke.EventType=Ce,Ce.OPEN="a",Ce.CLOSE="b",Ce.ERROR="c",Ce.MESSAGE="d",fe.prototype.listen=fe.prototype.K,h=w.WebChannel=ke,w.FetchXmlHttpFactory=Ut,Wt.prototype.listenOnce=Wt.prototype.L,Wt.prototype.getLastError=Wt.prototype.Ka,Wt.prototype.getLastErrorCode=Wt.prototype.Ba,Wt.prototype.getStatus=Wt.prototype.Z,Wt.prototype.getResponseJson=Wt.prototype.Oa,Wt.prototype.getResponseText=Wt.prototype.oa,Wt.prototype.send=Wt.prototype.ea,Wt.prototype.setWithCredentials=Wt.prototype.Ha,d=w.XhrIo=Wt}).apply("undefined"!==typeof b?b:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const x="@firebase/firestore",I="4.7.10";class S{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}S.UNAUTHENTICATED=new S(null),S.GOOGLE_CREDENTIALS=new S("google-credentials-uid"),S.FIRST_PARTY=new S("first-party-uid"),S.MOCK_USER=new S("mock-user");let E="11.5.0";const _=new a.Vy("@firebase/firestore");function T(){return _.logLevel}function k(e){if(_.logLevel<=a.$b.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(N);_.debug(`Firestore (${E}): ${e}`,...i)}}function C(e){if(_.logLevel<=a.$b.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(N);_.error(`Firestore (${E}): ${e}`,...i)}}function A(e){if(_.logLevel<=a.$b.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=n.map(N);_.warn(`Firestore (${E}): ${e}`,...i)}}function N(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function D(){const e=`FIRESTORE (${E}) INTERNAL ASSERTION FAILED: `+(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state");throw C(e),new Error(e)}function P(e,t){e||D()}function R(e,t){return e}const O={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class L extends l.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class j{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class M{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class z{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(S.UNAUTHENTICATED)))}shutdown(){}}class F{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class V{constructor(e){this.t=e,this.currentUser=S.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){P(void 0===this.o);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new j;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new j,e.enqueueRetryable((()=>r(this.currentUser)))};const o=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},s=e=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((e=>s(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?s(e):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new j)}}),0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(P("string"==typeof t.accessToken),new M(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return P(null===e||"string"==typeof e),new S(e)}}class U{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=S.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class ${constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new U(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(S.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class B{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class q{constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,(0,o.xZ)(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,t){P(void 0===this.o);const n=e=>{null!=e.error&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,k("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.V)return Promise.resolve(new B(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(P("string"==typeof e.token),this.R=e.token,new B(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function H(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}function K(){return new TextEncoder}class G{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=H(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function W(e,t){return e<t?-1:e>t?1:0}function Q(e,t){let n=0;for(;n<e.length&&n<t.length;){const r=e.codePointAt(n),i=t.codePointAt(n);if(r!==i){if(r<128&&i<128)return W(r,i);{const o=K(),s=Y(o.encode(J(e,n)),o.encode(J(t,n)));return 0!==s?s:W(r,i)}}n+=r>65535?2:1}return W(e.length,t.length)}function J(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function Y(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return W(e[n],t[n]);return W(e.length,t.length)}function X(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function Z(e){return e+"\0"}const ee=-62135596800,te=1e6;class ne{static now(){return ne.fromMillis(Date.now())}static fromDate(e){return ne.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*te);return new ne(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new L(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new L(O.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ee)throw new L(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new L(O.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/te}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-ee;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class re{static fromTimestamp(e){return new re(e)}static min(){return new re(new ne(0,0))}static max(){return new re(new ne(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ie="__name__";class oe{constructor(e,t,n){void 0===t?t=0:t>e.length&&D(),void 0===n?n=e.length-t:n>e.length-t&&D(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===oe.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof oe?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=oe.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return W(e.length,t.length)}static compareSegments(e,t){const n=oe.isNumericId(e),r=oe.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?oe.extractNumericId(e).compare(oe.extractNumericId(t)):Q(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return r.fromString(e.substring(4,e.length-2))}}class se extends oe{construct(e,t,n){return new se(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n){if(i.indexOf("//")>=0)throw new L(O.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);e.push(...i.split("/").filter((e=>e.length>0)))}return new se(e)}static emptyPath(){return new se([])}}const ae=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class le extends oe{construct(e,t,n){return new le(e,t,n)}static isValidIdentifier(e){return ae.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),le.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ie}static keyField(){return new le([ie])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new L(O.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let o=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new L(O.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new L(O.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(o=!o,r++):"."!==t||o?(n+=t,r++):(i(),r++)}if(i(),o)throw new L(O.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new le(t)}static emptyPath(){return new le([])}}class ce{constructor(e){this.path=e}static fromPath(e){return new ce(se.fromString(e))}static fromName(e){return new ce(se.fromString(e).popFirst(5))}static empty(){return new ce(se.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===se.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return se.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ce(new se(e.slice()))}}const ue=-1;class de{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function he(e){return e.fields.find((e=>2===e.kind))}function fe(e){return e.fields.filter((e=>2!==e.kind))}de.UNKNOWN_ID=-1;class pe{constructor(e,t){this.fieldPath=e,this.kind=t}}class ge{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ge(0,ve.min())}}function me(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=re.fromTimestamp(1e9===r?new ne(n+1,0):new ne(n,r));return new ve(i,ce.empty(),t)}function ye(e){return new ve(e.readTime,e.key,ue)}class ve{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ve(re.min(),ce.empty(),ue)}static max(){return new ve(re.max(),ce.empty(),ue)}}function be(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ce.comparator(e.documentKey,t.documentKey),0!==n?n:W(e.largestBatchId,t.largestBatchId))}const we="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class xe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Ie(e){if(e.code!==O.FAILED_PRECONDITION||e.message!==we)throw e;k("LocalStore","Unexpectedly lost primary lease")}class Se{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&D(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Se(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Se?t:Se.resolve(t)}catch(e){return Se.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Se.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Se.reject(t)}static resolve(e){return new Se(((t,n)=>{t(e)}))}static reject(e){return new Se(((t,n)=>{n(e)}))}static waitFor(e){return new Se(((t,n)=>{let r=0,i=0,o=!1;e.forEach((e=>{++r,e.next((()=>{++i,o&&i===r&&t()}),(e=>n(e)))})),o=!0,i===r&&t()}))}static or(e){let t=Se.resolve(!1);for(const n of e)t=t.next((e=>e?Se.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new Se(((n,r)=>{const i=e.length,o=new Array(i);let s=0;for(let a=0;a<i;a++){const l=a;t(e[l]).next((e=>{o[l]=e,++s,s===i&&n(o)}),(e=>r(e)))}}))}static doWhile(e,t){return new Se(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}const Ee="SimpleDb";class _e{static open(e,t,n,r){try{return new _e(t,e.transaction(r,n))}catch(e){throw new Ae(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.m=new j,this.transaction.oncomplete=()=>{this.m.resolve()},this.transaction.onabort=()=>{t.error?this.m.reject(new Ae(e,t.error)):this.m.resolve()},this.transaction.onerror=t=>{const n=Oe(t.target.error);this.m.reject(new Ae(e,n))}}get p(){return this.m.promise}abort(e){e&&this.m.reject(e),this.aborted||(k(Ee,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}S(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new De(t)}}class Te{static delete(e){return k(Ee,"Removing database:",e),Pe(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,l.zW)())return!1;if(Te.v())return!0;const e=(0,l.ZQ)(),t=Te.C(e),n=0<t&&t<10,r=ke(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static v(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static C(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.O=n,12.2===Te.C((0,l.ZQ)())&&C("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async N(e){return this.db||(k(Ee,"Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new Ae(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new L(O.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new L(O.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Ae(e,r))},r.onupgradeneeded=e=>{k(Ee,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.O.B(t,r.transaction,e.oldVersion,this.version).next((()=>{k(Ee,"Database upgrade to version "+this.version+" complete")}))}}))),this.L&&(this.db.onversionchange=e=>this.L(e)),this.db}k(e){this.L=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let o=0;for(;;){++o;try{this.db=await this.N(e);const t=_e.open(this.db,e,i?"readonly":"readwrite",n),o=r(t).next((e=>(t.S(),e))).catch((e=>(t.abort(e),Se.reject(e)))).toPromise();return o.catch((()=>{})),await t.p,o}catch(e){const t=e,n="FirebaseError"!==t.name&&o<3;if(k(Ee,"Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ke(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class Ce{constructor(e){this.q=e,this.$=!1,this.U=null}get isDone(){return this.$}get K(){return this.U}set cursor(e){this.q=e}done(){this.$=!0}W(e){this.U=e}delete(){return Pe(this.q.delete())}}class Ae extends L{constructor(e,t){super(O.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ne(e){return"IndexedDbTransactionError"===e.name}class De{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(k(Ee,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(k(Ee,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Pe(n)}add(e){return k(Ee,"ADD",this.store.name,e,e),Pe(this.store.add(e))}get(e){return Pe(this.store.get(e)).next((t=>(void 0===t&&(t=null),k(Ee,"GET",this.store.name,e,t),t)))}delete(e){return k(Ee,"DELETE",this.store.name,e),Pe(this.store.delete(e))}count(){return k(Ee,"COUNT",this.store.name),Pe(this.store.count())}G(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new Se(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.j(e,((e,n)=>{t.push(n)})).next((()=>t))}}H(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Se(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}J(e,t){k(Ee,"DELETE ALL",this.store.name);const n=this.options(e,t);n.Y=!1;const r=this.cursor(n);return this.j(r,((e,t,n)=>n.delete()))}Z(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.j(r,t)}X(e){const t=this.cursor({});return new Se(((n,r)=>{t.onerror=e=>{const t=Oe(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}j(e,t){const n=[];return new Se(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const o=new Ce(i),s=t(i.primaryKey,i.value,o);if(s instanceof Se){const e=s.catch((e=>(o.done(),Se.reject(e))));n.push(e)}o.isDone?r():null===o.K?i.continue():i.continue(o.K)}})).next((()=>Se.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.Y?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Pe(e){return new Se(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=Oe(e.target.error);n(t)}}))}let Re=!1;function Oe(e){const t=Te.C((0,l.ZQ)());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new L("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Re||(Re=!0,setTimeout((()=>{throw e}),0)),e}}return e}const Le="IndexBackfiller";class je{constructor(e,t){this.asyncQueue=e,this.ee=t,this.task=null}start(){this.te(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}te(e){k(Le,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(async()=>{this.task=null;try{const e=await this.ee.ne();k(Le,`Documents written: ${e}`)}catch(e){Ne(e)?k(Le,"Ignoring IndexedDB error during index backfill: ",e):await Ie(e)}await this.te(6e4)}))}}class Me{constructor(e,t){this.localStore=e,this.persistence=t}async ne(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(t=>this.re(t,e)))}re(e,t){const n=new Set;let r=t,i=!0;return Se.doWhile((()=>!0===i&&r>0),(()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((t=>{if(null!==t&&!n.has(t))return k(Le,`Processing collection: ${t}`),this.ie(e,t,r).next((e=>{r-=e,n.add(t)}));i=!1})))).next((()=>t-r))}ie(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((r=>this.localStore.localDocuments.getNextDocuments(e,t,r,n).next((n=>{const i=n.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next((()=>this.se(r,n))).next((n=>(k(Le,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n)))).next((()=>i.size))}))))}se(e,t){let n=e;return t.changes.forEach(((e,t)=>{const r=ye(t);be(r,n)>0&&(n=r)})),new ve(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class ze{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.oe(e),this._e=e=>t.writeSequenceNumber(e))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}ze.ae=-1;const Fe=-1;function Ve(e){return null==e}function Ue(e){return 0===e&&1/e==-1/0}function $e(e){return"number"==typeof e&&Number.isInteger(e)&&!Ue(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const Be="\x01";function qe(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Ke(t)),t=He(e.get(n),t);return Ke(t)}function He(e,t){let n=t;const r=e.length;for(let i=0;i<r;i++){const t=e.charAt(i);switch(t){case"\0":n+="\x01\x10";break;case Be:n+="\x01\x11";break;default:n+=t}}return n}function Ke(e){return e+Be+"\x01"}function Ge(e){const t=e.length;if(P(t>=2),2===t)return P(e.charAt(0)===Be&&"\x01"===e.charAt(1)),se.emptyPath();const n=t-2,r=[];let i="";for(let o=0;o<t;){const t=e.indexOf(Be,o);switch((t<0||t>n)&&D(),e.charAt(t+1)){case"\x01":const n=e.substring(o,t);let s;0===i.length?s=n:(i+=n,s=i,i=""),r.push(s);break;case"\x10":i+=e.substring(o,t),i+="\0";break;case"\x11":i+=e.substring(o,t+1);break;default:D()}o=t+2}return new se(r)}const We="remoteDocuments",Qe="owner",Je="owner",Ye="mutationQueues",Xe="mutations",Ze="batchId",et="userMutationsIndex",tt=["userId","batchId"];function nt(e,t){return[e,qe(t)]}function rt(e,t,n){return[e,qe(t),n]}const it={},ot="documentMutations",st="remoteDocumentsV14",at=["prefixPath","collectionGroup","readTime","documentId"],lt="documentKeyIndex",ct=["prefixPath","collectionGroup","documentId"],ut="collectionGroupIndex",dt=["collectionGroup","readTime","prefixPath","documentId"],ht="remoteDocumentGlobal",ft="remoteDocumentGlobalKey",pt="targets",gt="queryTargetsIndex",mt=["canonicalId","targetId"],yt="targetDocuments",vt=["targetId","path"],bt="documentTargetsIndex",wt=["path","targetId"],xt="targetGlobalKey",It="targetGlobal",St="collectionParents",Et=["collectionId","parent"],_t="clientMetadata",Tt="bundles",kt="namedQueries",Ct="indexConfiguration",At="collectionGroupIndex",Nt="indexState",Dt=["indexId","uid"],Pt="sequenceNumberIndex",Rt=["uid","sequenceNumber"],Ot="indexEntries",Lt=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],jt="documentKeyIndex",Mt=["indexId","uid","orderedDocumentKey"],zt="documentOverlays",Ft=["userId","collectionPath","documentId"],Vt="collectionPathOverlayIndex",Ut=["userId","collectionPath","largestBatchId"],$t="collectionGroupOverlayIndex",Bt=["userId","collectionGroup","largestBatchId"],qt="globals",Ht=[Ye,Xe,ot,We,pt,Qe,It,yt,_t,ht,St,Tt,kt],Kt=[...Ht,zt],Gt=[Ye,Xe,ot,st,pt,Qe,It,yt,_t,ht,St,Tt,kt,zt],Wt=Gt,Qt=[...Wt,Ct,Nt,Ot],Jt=Qt,Yt=[...Qt,qt];class Xt extends xe{constructor(e,t){super(),this.ue=e,this.currentSequenceNumber=t}}function Zt(e,t){const n=R(e);return Te.M(n.ue,t)}function en(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function tn(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function nn(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class rn{constructor(e,t){this.comparator=e,this.root=t||sn.EMPTY}insert(e,t){return new rn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,sn.BLACK,null,null))}remove(e){return new rn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new on(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new on(this.root,e,this.comparator,!1)}getReverseIterator(){return new on(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new on(this.root,e,this.comparator,!0)}}class on{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class sn{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:sn.RED,this.left=null!=r?r:sn.EMPTY,this.right=null!=i?i:sn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new sn(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return sn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return sn.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,sn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,sn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw D();if(this.right.isRed())throw D();const e=this.left.check();if(e!==this.right.check())throw D();return e+(this.isRed()?0:1)}}sn.EMPTY=null,sn.RED=!0,sn.BLACK=!1,sn.EMPTY=new class{constructor(){this.size=0}get key(){throw D()}get value(){throw D()}get color(){throw D()}get left(){throw D()}get right(){throw D()}copy(e,t,n,r,i){return this}insert(e,t,n){return new sn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class an{constructor(e){this.comparator=e,this.data=new rn(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ln(this.data.getIterator())}getIteratorFrom(e){return new ln(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof an))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new an(this.comparator);return t.data=e,t}}class ln{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function cn(e){return e.hasNext()?e.getNext():void 0}class un{constructor(e){this.fields=e,e.sort(le.comparator)}static empty(){return new un([])}unionWith(e){let t=new an(le.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new un(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return X(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class dn extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class hn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new dn("Invalid base64 string: "+e):e}}(e);return new hn(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new hn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}hn.EMPTY_BYTE_STRING=new hn("");const fn=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function pn(e){if(P(!!e),"string"==typeof e){let t=0;const n=fn.exec(e);if(P(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:gn(e.seconds),nanos:gn(e.nanos)}}function gn(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function mn(e){return"string"==typeof e?hn.fromBase64String(e):hn.fromUint8Array(e)}const yn="server_timestamp",vn="__type__",bn="__previous_value__",wn="__local_write_time__";function xn(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[vn])||void 0===n?void 0:n.stringValue)===yn}function In(e){const t=e.mapValue.fields[bn];return xn(t)?In(t):t}function Sn(e){const t=pn(e.mapValue.fields[wn].timestampValue);return new ne(t.seconds,t.nanos)}class En{constructor(e,t,n,r,i,o,s,a,l){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.longPollingOptions=a,this.useFetchStreams=l}}const _n="(default)";class Tn{constructor(e,t){this.projectId=e,this.database=t||_n}static empty(){return new Tn("","")}get isDefaultDatabase(){return this.database===_n}isEqual(e){return e instanceof Tn&&e.projectId===this.projectId&&e.database===this.database}}const kn="__type__",Cn="__max__",An={mapValue:{fields:{__type__:{stringValue:Cn}}}},Nn="__vector__",Dn="value",Pn={nullValue:"NULL_VALUE"};function Rn(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?xn(e)?4:Jn(e)?9007199254740991:Wn(e)?10:11:D()}function On(e,t){if(e===t)return!0;const n=Rn(e);if(n!==Rn(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Sn(e).isEqual(Sn(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=pn(e.timestampValue),r=pn(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return mn(e.bytesValue).isEqual(mn(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return gn(e.geoPointValue.latitude)===gn(t.geoPointValue.latitude)&&gn(e.geoPointValue.longitude)===gn(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return gn(e.integerValue)===gn(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=gn(e.doubleValue),r=gn(t.doubleValue);return n===r?Ue(n)===Ue(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return X(e.arrayValue.values||[],t.arrayValue.values||[],On);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(en(n)!==en(r))return!1;for(const i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!On(n[i],r[i])))return!1;return!0}(e,t);default:return D()}}function Ln(e,t){return void 0!==(e.values||[]).find((e=>On(e,t)))}function jn(e,t){if(e===t)return 0;const n=Rn(e),r=Rn(t);if(n!==r)return W(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return W(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=gn(e.integerValue||e.doubleValue),r=gn(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Mn(e.timestampValue,t.timestampValue);case 4:return Mn(Sn(e),Sn(t));case 5:return Q(e.stringValue,t.stringValue);case 6:return function(e,t){const n=mn(e),r=mn(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let i=0;i<n.length&&i<r.length;i++){const e=W(n[i],r[i]);if(0!==e)return e}return W(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=W(gn(e.latitude),gn(t.latitude));return 0!==n?n:W(gn(e.longitude),gn(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return zn(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,o;const s=e.fields||{},a=t.fields||{},l=null===(n=s[Dn])||void 0===n?void 0:n.arrayValue,c=null===(r=a[Dn])||void 0===r?void 0:r.arrayValue,u=W((null===(i=null==l?void 0:l.values)||void 0===i?void 0:i.length)||0,(null===(o=null==c?void 0:c.values)||void 0===o?void 0:o.length)||0);return 0!==u?u:zn(l,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===An.mapValue&&t===An.mapValue)return 0;if(e===An.mapValue)return 1;if(t===An.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},o=Object.keys(i);r.sort(),o.sort();for(let s=0;s<r.length&&s<o.length;++s){const e=Q(r[s],o[s]);if(0!==e)return e;const t=jn(n[r[s]],i[o[s]]);if(0!==t)return t}return W(r.length,o.length)}(e.mapValue,t.mapValue);default:throw D()}}function Mn(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return W(e,t);const n=pn(e),r=pn(t),i=W(n.seconds,r.seconds);return 0!==i?i:W(n.nanos,r.nanos)}function zn(e,t){const n=e.values||[],r=t.values||[];for(let i=0;i<n.length&&i<r.length;++i){const e=jn(n[i],r[i]);if(e)return e}return W(n.length,r.length)}function Fn(e){return Vn(e)}function Vn(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=pn(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return mn(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return ce.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=Vn(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${Vn(e.fields[i])}`;return n+"}"}(e.mapValue):D()}function Un(e){switch(Rn(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=In(e);return t?16+Un(t):16;case 5:return 2*e.stringValue.length;case 6:return mn(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce(((e,t)=>e+Un(t)),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return tn(e.fields,((e,n)=>{t+=e.length+Un(n)})),t}(e.mapValue);default:throw D()}}function $n(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Bn(e){return!!e&&"integerValue"in e}function qn(e){return!!e&&"arrayValue"in e}function Hn(e){return!!e&&"nullValue"in e}function Kn(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Gn(e){return!!e&&"mapValue"in e}function Wn(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[kn])||void 0===n?void 0:n.stringValue)===Nn}function Qn(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return tn(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Qn(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Qn(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Jn(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===Cn}const Yn={mapValue:{fields:{[kn]:{stringValue:Nn},[Dn]:{arrayValue:{}}}}};function Xn(e){return"nullValue"in e?Pn:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?$n(Tn.empty(),ce.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?Wn(e)?Yn:{mapValue:{}}:D()}function Zn(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?$n(Tn.empty(),ce.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?Yn:"mapValue"in e?Wn(e)?{mapValue:{}}:An:D()}function er(e,t){const n=jn(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function tr(e,t){const n=jn(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class nr{constructor(e){this.value=e}static empty(){return new nr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Gn(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qn(t)}setAll(e){let t=le.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Qn(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Gn(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return On(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Gn(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){tn(t,((t,n)=>e[t]=n));for(const r of n)delete e[r]}clone(){return new nr(Qn(this.value))}}function rr(e){const t=[];return tn(e.fields,((e,n)=>{const r=new le([e]);if(Gn(n)){const e=rr(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new un(t)}class ir{constructor(e,t,n,r,i,o,s){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=o,this.documentState=s}static newInvalidDocument(e){return new ir(e,0,re.min(),re.min(),re.min(),nr.empty(),0)}static newFoundDocument(e,t,n,r){return new ir(e,1,t,re.min(),n,r,0)}static newNoDocument(e,t){return new ir(e,2,t,re.min(),re.min(),nr.empty(),0)}static newUnknownDocument(e,t){return new ir(e,3,t,re.min(),re.min(),nr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(re.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=re.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ir&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ir(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class or{constructor(e,t){this.position=e,this.inclusive=t}}function sr(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const o=t[i],s=e.position[i];if(r=o.field.isKeyField()?ce.comparator(ce.fromName(s.referenceValue),n.key):jn(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return r}function ar(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!On(e.position[n],t.position[n]))return!1;return!0}class lr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function cr(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class ur{}class dr extends ur{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new xr(e,t,n):"array-contains"===t?new _r(e,n):"in"===t?new Tr(e,n):"not-in"===t?new kr(e,n):"array-contains-any"===t?new Cr(e,n):new dr(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Ir(e,n):new Sr(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(jn(t,this.value)):null!==t&&Rn(this.value)===Rn(t)&&this.matchesComparison(jn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return D()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class hr extends ur{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new hr(e,t)}matches(e){return fr(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function fr(e){return"and"===e.op}function pr(e){return"or"===e.op}function gr(e){return mr(e)&&fr(e)}function mr(e){for(const t of e.filters)if(t instanceof hr)return!1;return!0}function yr(e){if(e instanceof dr)return e.field.canonicalString()+e.op.toString()+Fn(e.value);if(gr(e))return e.filters.map((e=>yr(e))).join(",");{const t=e.filters.map((e=>yr(e))).join(",");return`${e.op}(${t})`}}function vr(e,t){return e instanceof dr?function(e,t){return t instanceof dr&&e.op===t.op&&e.field.isEqual(t.field)&&On(e.value,t.value)}(e,t):e instanceof hr?function(e,t){return t instanceof hr&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&vr(n,t.filters[r])),!0)}(e,t):void D()}function br(e,t){const n=e.filters.concat(t);return hr.create(n,e.op)}function wr(e){return e instanceof dr?function(e){return`${e.field.canonicalString()} ${e.op} ${Fn(e.value)}`}(e):e instanceof hr?function(e){return e.op.toString()+" {"+e.getFilters().map(wr).join(" ,")+"}"}(e):"Filter"}class xr extends dr{constructor(e,t,n){super(e,t,n),this.key=ce.fromName(n.referenceValue)}matches(e){const t=ce.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ir extends dr{constructor(e,t){super(e,"in",t),this.keys=Er("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Sr extends dr{constructor(e,t){super(e,"not-in",t),this.keys=Er("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Er(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>ce.fromName(e.referenceValue)))}class _r extends dr{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return qn(t)&&Ln(t.arrayValue,this.value)}}class Tr extends dr{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Ln(this.value.arrayValue,t)}}class kr extends dr{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ln(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Ln(this.value.arrayValue,t)}}class Cr extends dr{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!qn(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>Ln(this.value.arrayValue,e)))}}class Ar{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.le=null}}function Nr(e){return new Ar(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Dr(e){const t=R(e);if(null===t.le){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>yr(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),Ve(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>Fn(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>Fn(e))).join(",")),t.le=e}return t.le}function Pr(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!cr(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!vr(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ar(e.startAt,t.startAt)&&ar(e.endAt,t.endAt)}function Rr(e){return ce.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Or(e,t){return e.filters.filter((e=>e instanceof dr&&e.field.isEqual(t)))}function Lr(e,t,n){let r=Pn,i=!0;for(const o of Or(e,t)){let e=Pn,t=!0;switch(o.op){case"<":case"<=":e=Xn(o.value);break;case"==":case"in":case">=":e=o.value;break;case">":e=o.value,t=!1;break;case"!=":case"not-in":e=Pn}er({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let o=0;o<e.orderBy.length;++o)if(e.orderBy[o].field.isEqual(t)){const e=n.position[o];er({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function jr(e,t,n){let r=An,i=!0;for(const o of Or(e,t)){let e=An,t=!0;switch(o.op){case">=":case">":e=Zn(o.value),t=!1;break;case"==":case"in":case"<=":e=o.value;break;case"<":e=o.value,t=!1;break;case"!=":case"not-in":e=An}tr({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let o=0;o<e.orderBy.length;++o)if(e.orderBy[o].field.isEqual(t)){const e=n.position[o];tr({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class Mr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function zr(e,t,n,r,i,o,s,a){return new Mr(e,t,n,r,i,o,s,a)}function Fr(e){return new Mr(e)}function Vr(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Ur(e){return null!==e.collectionGroup}function $r(e){const t=R(e);if(null===t.he){t.he=[];const e=new Set;for(const i of t.explicitOrderBy)t.he.push(i),e.add(i.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new an(le.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.he.push(new lr(r,n))})),e.has(le.keyField().canonicalString())||t.he.push(new lr(le.keyField(),n))}return t.he}function Br(e){const t=R(e);return t.Pe||(t.Pe=qr(t,$r(e))),t.Pe}function qr(e,t){if("F"===e.limitType)return Nr(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new lr(e.field,t)}));const n=e.endAt?new or(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new or(e.startAt.position,e.startAt.inclusive):null;return Nr(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}function Hr(e,t){const n=e.filters.concat([t]);return new Mr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function Kr(e,t,n){return new Mr(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Gr(e,t){return Pr(Br(e),Br(t))&&e.limitType===t.limitType}function Wr(e){return`${Dr(Br(e))}|lt:${e.limitType}`}function Qr(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>wr(e))).join(", ")}]`),Ve(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>Fn(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>Fn(e))).join(",")),`Target(${t})`}(Br(e))}; limitType=${e.limitType})`}function Jr(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ce.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of $r(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=sr(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,$r(e),t))&&!(e.endAt&&!function(e,t,n){const r=sr(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,$r(e),t))}(e,t)}function Yr(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Xr(e){return(t,n)=>{let r=!1;for(const i of $r(e)){const e=Zr(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Zr(e,t,n){const r=e.field.isKeyField()?ce.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?jn(r,i):D()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return D()}}class ei{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[r,i]of n)if(this.equalsFn(r,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){tn(this.inner,((t,n)=>{for(const[r,i]of n)e(r,i)}))}isEmpty(){return nn(this.inner)}size(){return this.innerSize}}const ti=new rn(ce.comparator);function ni(){return ti}const ri=new rn(ce.comparator);function ii(){let e=ri;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.insert(i.key,i);return e}function oi(e){let t=ri;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function si(){return li()}function ai(){return li()}function li(){return new ei((e=>e.toString()),((e,t)=>e.isEqual(t)))}const ci=new rn(ce.comparator),ui=new an(ce.comparator);function di(){let e=ui;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)e=e.add(i);return e}const hi=new an(W);function fi(){return hi}function pi(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ue(t)?"-0":t}}function gi(e){return{integerValue:""+e}}function mi(e,t){return $e(t)?gi(t):pi(e,t)}class yi{constructor(){this._=void 0}}function vi(e,t,n){return e instanceof xi?function(e,t){const n={fields:{[vn]:{stringValue:yn},[wn]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&xn(t)&&(t=In(t)),t&&(n.fields[bn]=t),{mapValue:n}}(n,t):e instanceof Ii?Si(e,t):e instanceof Ei?_i(e,t):function(e,t){const n=wi(e,t),r=ki(n)+ki(e.Ie);return Bn(n)&&Bn(e.Ie)?gi(r):pi(e.serializer,r)}(e,t)}function bi(e,t,n){return e instanceof Ii?Si(e,t):e instanceof Ei?_i(e,t):n}function wi(e,t){return e instanceof Ti?function(e){return Bn(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class xi extends yi{}class Ii extends yi{constructor(e){super(),this.elements=e}}function Si(e,t){const n=Ci(t);for(const r of e.elements)n.some((e=>On(e,r)))||n.push(r);return{arrayValue:{values:n}}}class Ei extends yi{constructor(e){super(),this.elements=e}}function _i(e,t){let n=Ci(t);for(const r of e.elements)n=n.filter((e=>!On(e,r)));return{arrayValue:{values:n}}}class Ti extends yi{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function ki(e){return gn(e.integerValue||e.doubleValue)}function Ci(e){return qn(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ai{constructor(e,t){this.field=e,this.transform=t}}class Ni{constructor(e,t){this.version=e,this.transformResults=t}}class Di{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Di}static exists(e){return new Di(void 0,e)}static updateTime(e){return new Di(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Pi(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Ri{}function Oi(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new qi(e.key,Di.none()):new Fi(e.key,e.data,Di.none());{const n=e.data,r=nr.empty();let i=new an(le.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new Vi(e.key,r,new un(i.toArray()),Di.none())}}function Li(e,t,n){e instanceof Fi?function(e,t,n){const r=e.value.clone(),i=$i(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Vi?function(e,t,n){if(!Pi(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=$i(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Ui(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function ji(e,t,n,r){return e instanceof Fi?function(e,t,n,r){if(!Pi(e.precondition,t))return n;const i=e.value.clone(),o=Bi(e.fieldTransforms,r,t);return i.setAll(o),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Vi?function(e,t,n,r){if(!Pi(e.precondition,t))return n;const i=Bi(e.fieldTransforms,r,t),o=t.data;return o.setAll(Ui(e)),o.setAll(i),t.convertToFoundDocument(t.version,o).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Pi(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Mi(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=wi(r.transform,e||null);null!=i&&(null===n&&(n=nr.empty()),n.set(r.field,i))}return n||null}function zi(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&X(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Ii&&t instanceof Ii||e instanceof Ei&&t instanceof Ei?X(e.elements,t.elements,On):e instanceof Ti&&t instanceof Ti?On(e.Ie,t.Ie):e instanceof xi&&t instanceof xi}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Fi extends Ri{constructor(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Vi extends Ri{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Ui(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function $i(e,t,n){const r=new Map;P(e.length===n.length);for(let i=0;i<n.length;i++){const o=e[i],s=o.transform,a=t.data.field(o.field);r.set(o.field,bi(s,a,n[i]))}return r}function Bi(e,t,n){const r=new Map;for(const i of e){const e=i.transform,o=n.data.field(i.field);r.set(i.field,vi(e,o,t))}return r}class qi extends Ri{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Hi extends Ri{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Ki{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&Li(t,e,n[r])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ji(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ji(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=ai();return this.mutations.forEach((r=>{const i=e.get(r.key),o=i.overlayedDocument;let s=this.applyToLocalView(o,i.mutatedFields);s=t.has(r.key)?null:s;const a=Oi(o,s);null!==a&&n.set(r.key,a),o.isValidDocument()||o.convertToNoDocument(re.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),di())}isEqual(e){return this.batchId===e.batchId&&X(this.mutations,e.mutations,((e,t)=>zi(e,t)))&&X(this.baseMutations,e.baseMutations,((e,t)=>zi(e,t)))}}class Gi{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){P(e.mutations.length===n.length);let r=ci;const i=e.mutations;for(let o=0;o<i.length;o++)r=r.insert(i[o].key,n[o].version);return new Gi(e,t,n,r)}}class Wi{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Qi{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ji,Yi;function Xi(e){switch(e){case O.OK:return D();case O.CANCELLED:case O.UNKNOWN:case O.DEADLINE_EXCEEDED:case O.RESOURCE_EXHAUSTED:case O.INTERNAL:case O.UNAVAILABLE:case O.UNAUTHENTICATED:return!1;case O.INVALID_ARGUMENT:case O.NOT_FOUND:case O.ALREADY_EXISTS:case O.PERMISSION_DENIED:case O.FAILED_PRECONDITION:case O.ABORTED:case O.OUT_OF_RANGE:case O.UNIMPLEMENTED:case O.DATA_LOSS:return!0;default:return D()}}function Zi(e){if(void 0===e)return C("GRPC error has no .code"),O.UNKNOWN;switch(e){case Ji.OK:return O.OK;case Ji.CANCELLED:return O.CANCELLED;case Ji.UNKNOWN:return O.UNKNOWN;case Ji.DEADLINE_EXCEEDED:return O.DEADLINE_EXCEEDED;case Ji.RESOURCE_EXHAUSTED:return O.RESOURCE_EXHAUSTED;case Ji.INTERNAL:return O.INTERNAL;case Ji.UNAVAILABLE:return O.UNAVAILABLE;case Ji.UNAUTHENTICATED:return O.UNAUTHENTICATED;case Ji.INVALID_ARGUMENT:return O.INVALID_ARGUMENT;case Ji.NOT_FOUND:return O.NOT_FOUND;case Ji.ALREADY_EXISTS:return O.ALREADY_EXISTS;case Ji.PERMISSION_DENIED:return O.PERMISSION_DENIED;case Ji.FAILED_PRECONDITION:return O.FAILED_PRECONDITION;case Ji.ABORTED:return O.ABORTED;case Ji.OUT_OF_RANGE:return O.OUT_OF_RANGE;case Ji.UNIMPLEMENTED:return O.UNIMPLEMENTED;case Ji.DATA_LOSS:return O.DATA_LOSS;default:return D()}}(Yi=Ji||(Ji={}))[Yi.OK=0]="OK",Yi[Yi.CANCELLED=1]="CANCELLED",Yi[Yi.UNKNOWN=2]="UNKNOWN",Yi[Yi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Yi[Yi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Yi[Yi.NOT_FOUND=5]="NOT_FOUND",Yi[Yi.ALREADY_EXISTS=6]="ALREADY_EXISTS",Yi[Yi.PERMISSION_DENIED=7]="PERMISSION_DENIED",Yi[Yi.UNAUTHENTICATED=16]="UNAUTHENTICATED",Yi[Yi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Yi[Yi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Yi[Yi.ABORTED=10]="ABORTED",Yi[Yi.OUT_OF_RANGE=11]="OUT_OF_RANGE",Yi[Yi.UNIMPLEMENTED=12]="UNIMPLEMENTED",Yi[Yi.INTERNAL=13]="INTERNAL",Yi[Yi.UNAVAILABLE=14]="UNAVAILABLE",Yi[Yi.DATA_LOSS=15]="DATA_LOSS";let eo=null;const to=new r([4294967295,4294967295],0);function no(e){const t=K().encode(e),n=new i;return n.update(t),new Uint8Array(n.digest())}function ro(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),o=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new r([n,i],0),new r([o,s],0)]}class io{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new oo(`Invalid padding: ${t}`);if(n<0)throw new oo(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new oo(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new oo(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=r.fromNumber(this.Ee)}Ae(e,t,n){let i=e.add(t.multiply(r.fromNumber(n)));return 1===i.compare(to)&&(i=new r([i.getBits(0),i.getBits(1)],0)),i.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ee)return!1;const t=no(e),[n,r]=ro(t);for(let i=0;i<this.hashCount;i++){const e=this.Ae(n,r,i);if(!this.Re(e))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new io(i,r,t);return n.forEach((e=>o.insert(e))),o}insert(e){if(0===this.Ee)return;const t=no(e),[n,r]=ro(t);for(let i=0;i<this.hashCount;i++){const e=this.Ae(n,r,i);this.Ve(e)}}Ve(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class oo extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class so{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,ao.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new so(re.min(),r,new rn(W),ni(),di())}}class ao{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new ao(n,t,di(),di(),di())}}class lo{constructor(e,t,n,r){this.me=e,this.removedTargetIds=t,this.key=n,this.fe=r}}class co{constructor(e,t){this.targetId=e,this.ge=t}}class uo{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:hn.EMPTY_BYTE_STRING,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class ho{constructor(){this.pe=0,this.ye=go(),this.we=hn.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return 0!==this.pe}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=di(),t=di(),n=di();return this.ye.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:D()}})),new ao(this.we,this.Se,e,t,n)}Me(){this.be=!1,this.ye=go()}xe(e,t){this.be=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,P(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class fo{constructor(e){this.ke=e,this.qe=new Map,this.Qe=ni(),this.$e=po(),this.Ue=po(),this.Ke=new rn(W)}We(e){for(const t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(const t of e.removedTargetIds)this.ze(t,e.key,e.fe)}je(e){this.forEachTarget(e,(t=>{const n=this.He(t);switch(e.state){case 0:this.Je(t)&&n.Ce(e.resumeToken);break;case 1:n.Be(),n.De||n.Me(),n.Ce(e.resumeToken);break;case 2:n.Be(),n.De||this.removeTarget(t);break;case 3:this.Je(t)&&(n.Le(),n.Ce(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),n.Ce(e.resumeToken));break;default:D()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach(((e,n)=>{this.Je(n)&&t(n)}))}Ze(e){const t=e.targetId,n=e.ge.count,r=this.Xe(t);if(r){const i=r.target;if(Rr(i))if(0===n){const e=new ce(i.path);this.ze(t,e,ir.newNoDocument(e,re.min()))}else P(1===n);else{const r=this.et(t);if(r!==n){const n=this.tt(e),i=n?this.nt(n,e,r):1;if(0!==i){this.Ye(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,e)}null==eo||eo.rt(function(e,t,n,r,i){var o,s,a,l,c,u;const d={localCacheCount:e,existenceFilterCount:t.count,databaseId:n.database,projectId:n.projectId},h=t.unchangedNames;return h&&(d.bloomFilter={applied:0===i,hashCount:null!==(o=null==h?void 0:h.hashCount)&&void 0!==o?o:0,bitmapLength:null!==(l=null===(a=null===(s=null==h?void 0:h.bits)||void 0===s?void 0:s.bitmap)||void 0===a?void 0:a.length)&&void 0!==l?l:0,padding:null!==(u=null===(c=null==h?void 0:h.bits)||void 0===c?void 0:c.padding)&&void 0!==u?u:0,mightContain:e=>{var t;return null!==(t=null==r?void 0:r.mightContain(e))&&void 0!==t&&t}}),d}(r,e.ge,this.ke.it(),n,i))}}}}tt(e){const t=e.ge.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let o,s;try{o=mn(n).toUint8Array()}catch(e){if(e instanceof dn)return A("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{s=new io(o,r,i)}catch(e){return A(e instanceof oo?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===s.Ee?null:s}nt(e,t,n){return t.ge.count===n-this.st(e,t.targetId)?0:2}st(e,t){const n=this.ke.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.ke.it(),o=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(o)||(this.ze(t,n,null),r++)})),r}ot(e){const t=new Map;this.qe.forEach(((n,r)=>{const i=this.Xe(r);if(i){if(n.current&&Rr(i.target)){const t=new ce(i.target.path);this._t(t).has(r)||this.ut(r,t)||this.ze(r,t,ir.newNoDocument(t,e))}n.ve&&(t.set(r,n.Fe()),n.Me())}}));let n=di();this.Ue.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Xe(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.Qe.forEach(((t,n)=>n.setReadTime(e)));const r=new so(e,t,this.Ke,this.Qe,n);return this.Qe=ni(),this.$e=po(),this.Ue=po(),this.Ke=new rn(W),r}Ge(e,t){if(!this.Je(e))return;const n=this.ut(e,t.key)?2:0;this.He(e).xe(t.key,n),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ue=this.Ue.insert(t.key,this.ct(t.key).add(e))}ze(e,t,n){if(!this.Je(e))return;const r=this.He(e);this.ut(e,t)?r.xe(t,1):r.Oe(t),this.Ue=this.Ue.insert(t,this.ct(t).delete(e)),this.Ue=this.Ue.insert(t,this.ct(t).add(e)),n&&(this.Qe=this.Qe.insert(t,n))}removeTarget(e){this.qe.delete(e)}et(e){const t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new ho,this.qe.set(e,t)),t}ct(e){let t=this.Ue.get(e);return t||(t=new an(W),this.Ue=this.Ue.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new an(W),this.$e=this.$e.insert(e,t)),t}Je(e){const t=null!==this.Xe(e);return t||k("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new ho),this.ke.getRemoteKeysForTarget(e).forEach((t=>{this.ze(e,t,null)}))}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}}function po(){return new rn(ce.comparator)}function go(){return new rn(ce.comparator)}const mo={asc:"ASCENDING",desc:"DESCENDING"},yo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},vo={and:"AND",or:"OR"};class bo{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function wo(e,t){return e.useProto3Json||Ve(t)?t:{value:t}}function xo(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Io(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function So(e,t){return xo(e,t.toTimestamp())}function Eo(e){return P(!!e),re.fromTimestamp(function(e){const t=pn(e);return new ne(t.seconds,t.nanos)}(e))}function _o(e,t){return To(e,t).canonicalString()}function To(e,t){const n=function(e){return new se(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function ko(e){const t=se.fromString(e);return P(Qo(t)),t}function Co(e,t){return _o(e.databaseId,t.path)}function Ao(e,t){const n=ko(t);if(n.get(1)!==e.databaseId.projectId)throw new L(O.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new L(O.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ce(Ro(n))}function No(e,t){return _o(e.databaseId,t)}function Do(e){const t=ko(e);return 4===t.length?se.emptyPath():Ro(t)}function Po(e){return new se(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Ro(e){return P(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Oo(e,t,n){return{name:Co(e,t),fields:n.value.mapValue.fields}}function Lo(e,t,n){const r=Ao(e,t.name),i=Eo(t.updateTime),o=t.createTime?Eo(t.createTime):re.min(),s=new nr({mapValue:{fields:t.fields}}),a=ir.newFoundDocument(r,i,o,s);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function jo(e,t){let n;if(t instanceof Fi)n={update:Oo(e,t.key,t.value)};else if(t instanceof qi)n={delete:Co(e,t.key)};else if(t instanceof Vi)n={update:Oo(e,t.key,t.data),updateMask:Wo(t.fieldMask)};else{if(!(t instanceof Hi))return D();n={verify:Co(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof xi)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ii)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ei)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ti)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw D()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:So(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:D()}(e,t.precondition)),n}function Mo(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Di.updateTime(Eo(e.updateTime)):void 0!==e.exists?Di.exists(e.exists):Di.none()}(t.currentDocument):Di.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)P("REQUEST_TIME"===t.setToServerValue),n=new xi;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new Ii(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new Ei(e)}else"increment"in t?n=new Ti(e,t.increment):D();const r=le.fromServerFormat(t.fieldPath);return new Ai(r,n)}(e,t))):[];if(t.update){t.update.name;const i=Ao(e,t.update.name),o=new nr({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new un(t.map((e=>le.fromServerFormat(e))))}(t.updateMask);return new Vi(i,o,e,n,r)}return new Fi(i,o,n,r)}if(t.delete){const r=Ao(e,t.delete);return new qi(r,n)}if(t.verify){const r=Ao(e,t.verify);return new Hi(r,n)}return D()}function zo(e,t){return{documents:[No(e,t.path)]}}function Fo(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=No(e,i);const o=function(e){if(0!==e.length)return Go(hr.create(e,"and"))}(t.filters);o&&(n.structuredQuery.where=o);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Ho(e.field),direction:$o(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const a=wo(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ht:n,parent:i}}function Vo(e){let t=Do(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){P(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let o=[];n.where&&(o=function(e){const t=Uo(e);return t instanceof hr&&gr(t)?t.getFilters():[t]}(n.where));let s=[];n.orderBy&&(s=function(e){return e.map((e=>function(e){return new lr(Ko(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ve(t)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){const t=!!e.before,n=e.values||[];return new or(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new or(n,t)}(n.endAt)),zr(t,i,s,o,a,"F",l,c)}function Uo(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Ko(e.unaryFilter.field);return dr.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Ko(e.unaryFilter.field);return dr.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ko(e.unaryFilter.field);return dr.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Ko(e.unaryFilter.field);return dr.create(i,"!=",{nullValue:"NULL_VALUE"});default:return D()}}(e):void 0!==e.fieldFilter?function(e){return dr.create(Ko(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return D()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return hr.create(e.compositeFilter.filters.map((e=>Uo(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return D()}}(e.compositeFilter.op))}(e):D()}function $o(e){return mo[e]}function Bo(e){return yo[e]}function qo(e){return vo[e]}function Ho(e){return{fieldPath:e.canonicalString()}}function Ko(e){return le.fromServerFormat(e.fieldPath)}function Go(e){return e instanceof dr?function(e){if("=="===e.op){if(Kn(e.value))return{unaryFilter:{field:Ho(e.field),op:"IS_NAN"}};if(Hn(e.value))return{unaryFilter:{field:Ho(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Kn(e.value))return{unaryFilter:{field:Ho(e.field),op:"IS_NOT_NAN"}};if(Hn(e.value))return{unaryFilter:{field:Ho(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ho(e.field),op:Bo(e.op),value:e.value}}}(e):e instanceof hr?function(e){const t=e.getFilters().map((e=>Go(e)));return 1===t.length?t[0]:{compositeFilter:{op:qo(e.op),filters:t}}}(e):D()}function Wo(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Qo(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Jo{constructor(e,t,n,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:re.min(),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:re.min(),s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:hn.EMPTY_BYTE_STRING,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s,this.expectedCount=a}withSequenceNumber(e){return new Jo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Jo(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Jo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Jo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Yo{constructor(e){this.Tt=e}}function Xo(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Zo(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Co(e,t.key),fields:t.data.value.mapValue.fields,updateTime:xo(e,t.version.toTimestamp()),createTime:xo(e,t.createTime.toTimestamp())}}(e.Tt,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:es(t.version)};else{if(!t.isUnknownDocument())return D();r.unknownDocument={path:n.path.toArray(),version:es(t.version)}}return r}function Zo(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function es(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function ts(e){const t=new ne(e.seconds,e.nanoseconds);return re.fromTimestamp(t)}function ns(e,t){const n=(t.baseMutations||[]).map((t=>Mo(e.Tt,t)));for(let o=0;o<t.mutations.length-1;++o){const e=t.mutations[o];if(o+1<t.mutations.length&&void 0!==t.mutations[o+1].transform){const n=t.mutations[o+1];e.updateTransforms=n.transform.fieldTransforms,t.mutations.splice(o+1,1),++o}}const r=t.mutations.map((t=>Mo(e.Tt,t))),i=ne.fromMillis(t.localWriteTimeMs);return new Ki(t.batchId,i,n,r)}function rs(e){const t=ts(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?ts(e.lastLimboFreeSnapshotVersion):re.min();let r;return r=function(e){return void 0!==e.documents}(e.query)?function(e){return P(1===e.documents.length),Br(Fr(Do(e.documents[0])))}(e.query):function(e){return Br(Vo(e))}(e.query),new Jo(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,hn.fromBase64String(e.resumeToken))}function is(e,t){const n=es(t.snapshotVersion),r=es(t.lastLimboFreeSnapshotVersion);let i;i=Rr(t.target)?zo(e.Tt,t.target):Fo(e.Tt,t.target).ht;const o=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Dr(t.target),readTime:n,resumeToken:o,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function os(e){const t=Vo({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Kr(t,t.limit,"L"):t}function ss(e,t){return new Wi(t.largestBatchId,Mo(e.Tt,t.overlayMutation))}function as(e,t){const n=t.path.lastSegment();return[e,qe(t.path.popLast()),n]}function ls(e,t,n,r){return{indexId:e,uid:t,sequenceNumber:n,readTime:es(r.readTime),documentKey:qe(r.documentKey.path),largestBatchId:r.largestBatchId}}class cs{getBundleMetadata(e,t){return us(e).get(t).next((e=>{if(e)return function(e){return{id:e.bundleId,createTime:ts(e.createTime),version:e.version}}(e)}))}saveBundleMetadata(e,t){return us(e).put(function(e){return{bundleId:e.id,createTime:es(Eo(e.createTime)),version:e.version}}(t))}getNamedQuery(e,t){return ds(e).get(t).next((e=>{if(e)return function(e){return{name:e.name,query:os(e.bundledQuery),readTime:ts(e.readTime)}}(e)}))}saveNamedQuery(e,t){return ds(e).put(function(e){return{name:e.name,readTime:es(Eo(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function us(e){return Zt(e,Tt)}function ds(e){return Zt(e,kt)}class hs{constructor(e,t){this.serializer=e,this.userId=t}static It(e,t){const n=t.uid||"";return new hs(e,n)}getOverlay(e,t){return fs(e).get(as(this.userId,t)).next((e=>e?ss(this.serializer,e):null))}getOverlays(e,t){const n=si();return Se.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const o=new Wi(t,i);r.push(this.Et(e,o))})),Se.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(qe(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(fs(e).J(Vt,r))})),Se.waitFor(i)}getOverlaysForCollection(e,t,n){const r=si(),i=qe(t),o=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return fs(e).G(Vt,o).next((e=>{for(const t of e){const e=ss(this.serializer,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=si();let o;const s=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return fs(e).Z({index:$t,range:s},((e,t,n)=>{const s=ss(this.serializer,t);i.size()<r||s.largestBatchId===o?(i.set(s.getKey(),s),o=s.largestBatchId):n.done()})).next((()=>i))}Et(e,t){return fs(e).put(function(e,t,n){const[r,i,o]=as(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:o,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:jo(e.Tt,n.mutation)}}(this.serializer,this.userId,t))}}function fs(e){return Zt(e,zt)}class ps{dt(e){return Zt(e,qt)}getSessionToken(e){return this.dt(e).get("sessionToken").next((e=>{const t=null==e?void 0:e.value;return t?hn.fromUint8Array(t):hn.EMPTY_BYTE_STRING}))}setSessionToken(e,t){return this.dt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class gs{constructor(){}At(e,t){this.Rt(e,t),t.Vt()}Rt(e,t){if("nullValue"in e)this.ft(t,5);else if("booleanValue"in e)this.ft(t,10),t.gt(e.booleanValue?1:0);else if("integerValue"in e)this.ft(t,15),t.gt(gn(e.integerValue));else if("doubleValue"in e){const n=gn(e.doubleValue);isNaN(n)?this.ft(t,13):(this.ft(t,15),Ue(n)?t.gt(0):t.gt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.ft(t,20),"string"==typeof n&&(n=pn(n)),t.yt(`${n.seconds||""}`),t.gt(n.nanos||0)}else if("stringValue"in e)this.wt(e.stringValue,t),this.St(t);else if("bytesValue"in e)this.ft(t,30),t.bt(mn(e.bytesValue)),this.St(t);else if("referenceValue"in e)this.Dt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ft(t,45),t.gt(n.latitude||0),t.gt(n.longitude||0)}else"mapValue"in e?Jn(e)?this.ft(t,Number.MAX_SAFE_INTEGER):Wn(e)?this.vt(e.mapValue,t):(this.Ct(e.mapValue,t),this.St(t)):"arrayValue"in e?(this.Ft(e.arrayValue,t),this.St(t)):D()}wt(e,t){this.ft(t,25),this.Mt(e,t)}Mt(e,t){t.yt(e)}Ct(e,t){const n=e.fields||{};this.ft(t,55);for(const r of Object.keys(n))this.wt(r,t),this.Rt(n[r],t)}vt(e,t){var n,r;const i=e.fields||{};this.ft(t,53);const o=Dn,s=(null===(r=null===(n=i[o].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.ft(t,15),t.gt(gn(s)),this.wt(o,t),this.Rt(i[o],t)}Ft(e,t){const n=e.values||[];this.ft(t,50);for(const r of n)this.Rt(r,t)}Dt(e,t){this.ft(t,37),ce.fromName(e).path.forEach((e=>{this.ft(t,60),this.Mt(e,t)}))}ft(e,t){e.gt(t)}St(e){e.gt(2)}}gs.xt=new gs;const ms=255;function ys(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}function vs(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=ys(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}class bs{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ot(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Nt(n.value),n=t.next();this.Bt()}Lt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.kt(n.value),n=t.next();this.qt()}Qt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Nt(e);else if(e<2048)this.Nt(960|e>>>6),this.Nt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Nt(480|e>>>12),this.Nt(128|63&e>>>6),this.Nt(128|63&e);else{const e=t.codePointAt(0);this.Nt(240|e>>>18),this.Nt(128|63&e>>>12),this.Nt(128|63&e>>>6),this.Nt(128|63&e)}}this.Bt()}$t(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.kt(e);else if(e<2048)this.kt(960|e>>>6),this.kt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.kt(480|e>>>12),this.kt(128|63&e>>>6),this.kt(128|63&e);else{const e=t.codePointAt(0);this.kt(240|e>>>18),this.kt(128|63&e>>>12),this.kt(128|63&e>>>6),this.kt(128|63&e)}}this.qt()}Ut(e){const t=this.Kt(e),n=vs(t);this.Wt(1+n),this.buffer[this.position++]=255&n;for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}Gt(e){const t=this.Kt(e),n=vs(t);this.Wt(1+n),this.buffer[this.position++]=~(255&n);for(let r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}zt(){this.jt(ms),this.jt(255)}Ht(){this.Jt(ms),this.Jt(255)}reset(){this.position=0}seed(e){this.Wt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Yt(){return this.buffer.slice(0,this.position)}Kt(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let r=1;r<t.length;++r)t[r]^=n?255:0;return t}Nt(e){const t=255&e;0===t?(this.jt(0),this.jt(255)):t===ms?(this.jt(ms),this.jt(0)):this.jt(t)}kt(e){const t=255&e;0===t?(this.Jt(0),this.Jt(255)):t===ms?(this.Jt(ms),this.Jt(0)):this.Jt(e)}Bt(){this.jt(0),this.jt(1)}qt(){this.Jt(0),this.Jt(1)}jt(e){this.Wt(1),this.buffer[this.position++]=e}Jt(e){this.Wt(1),this.buffer[this.position++]=~e}Wt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class ws{constructor(e){this.Zt=e}bt(e){this.Zt.Ot(e)}yt(e){this.Zt.Qt(e)}gt(e){this.Zt.Ut(e)}Vt(){this.Zt.zt()}}class xs{constructor(e){this.Zt=e}bt(e){this.Zt.Lt(e)}yt(e){this.Zt.$t(e)}gt(e){this.Zt.Gt(e)}Vt(){this.Zt.Ht()}}class Is{constructor(){this.Zt=new bs,this.Xt=new ws(this.Zt),this.en=new xs(this.Zt)}seed(e){this.Zt.seed(e)}tn(e){return 0===e?this.Xt:this.en}Yt(){return this.Zt.Yt()}reset(){this.Zt.reset()}}class Ss{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}nn(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new Ss(this.indexId,this.documentKey,this.arrayValue,n)}}function Es(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=_s(e.arrayValue,t.arrayValue),0!==n?n:(n=_s(e.directionalValue,t.directionalValue),0!==n?n:ce.comparator(e.documentKey,t.documentKey)))}function _s(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class Ts{constructor(e){this.rn=new an(((e,t)=>le.comparator(e.field,t.field))),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.sn=e.orderBy,this._n=[];for(const t of e.filters){const e=t;e.isInequality()?this.rn=this.rn.add(e):this._n.push(e)}}get an(){return this.rn.size>1}un(e){if(P(e.collectionGroup===this.collectionId),this.an)return!1;const t=he(e);if(void 0!==t&&!this.cn(t))return!1;const n=fe(e);let r=new Set,i=0,o=0;for(;i<n.length&&this.cn(n[i]);++i)r=r.add(n[i].fieldPath.canonicalString());if(i===n.length)return!0;if(this.rn.size>0){const e=this.rn.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=n[i];if(!this.ln(e,t)||!this.hn(this.sn[o++],t))return!1}++i}for(;i<n.length;++i){const e=n[i];if(o>=this.sn.length||!this.hn(this.sn[o++],e))return!1}return!0}Pn(){if(this.an)return null;let e=new an(le.comparator);const t=[];for(const n of this._n)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new pe(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new pe(n.field,0))}for(const n of this.sn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new pe(n.field,"asc"===n.dir?0:1)));return new de(de.UNKNOWN_ID,this.collectionId,t,ge.empty())}cn(e){for(const t of this._n)if(this.ln(t,e))return!0;return!1}ln(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}hn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function ks(e){var t,n;if(P(e instanceof dr||e instanceof hr),e instanceof dr){if(e instanceof Tr){const r=(null===(n=null===(t=e.value.arrayValue)||void 0===t?void 0:t.values)||void 0===n?void 0:n.map((t=>dr.create(e.field,"==",t))))||[];return hr.create(r,"or")}return e}const r=e.filters.map((e=>ks(e)));return hr.create(r,e.op)}function Cs(e){if(0===e.getFilters().length)return[];const t=Ps(ks(e));return P(Ds(t)),As(t)||Ns(t)?[t]:t.getFilters()}function As(e){return e instanceof dr}function Ns(e){return e instanceof hr&&gr(e)}function Ds(e){return As(e)||Ns(e)||function(e){if(e instanceof hr&&pr(e)){for(const t of e.getFilters())if(!As(t)&&!Ns(t))return!1;return!0}return!1}(e)}function Ps(e){if(P(e instanceof dr||e instanceof hr),e instanceof dr)return e;if(1===e.filters.length)return Ps(e.filters[0]);const t=e.filters.map((e=>Ps(e)));let n=hr.create(t,e.op);return n=Ls(n),Ds(n)?n:(P(n instanceof hr),P(fr(n)),P(n.filters.length>1),n.filters.reduce(((e,t)=>Rs(e,t))))}function Rs(e,t){let n;return P(e instanceof dr||e instanceof hr),P(t instanceof dr||t instanceof hr),n=e instanceof dr?t instanceof dr?function(e,t){return hr.create([e,t],"and")}(e,t):Os(e,t):t instanceof dr?Os(t,e):function(e,t){if(P(e.filters.length>0&&t.filters.length>0),fr(e)&&fr(t))return br(e,t.getFilters());const n=pr(e)?e:t,r=pr(e)?t:e,i=n.filters.map((e=>Rs(e,r)));return hr.create(i,"or")}(e,t),Ls(n)}function Os(e,t){if(fr(t))return br(t,e.getFilters());{const n=t.filters.map((t=>Rs(e,t)));return hr.create(n,"or")}}function Ls(e){if(P(e instanceof dr||e instanceof hr),e instanceof dr)return e;const t=e.getFilters();if(1===t.length)return Ls(t[0]);if(mr(e))return e;const n=t.map((e=>Ls(e))),r=[];return n.forEach((t=>{t instanceof dr?r.push(t):t instanceof hr&&(t.op===e.op?r.push(...t.filters):r.push(t))})),1===r.length?r[0]:hr.create(r,e.op)}class js{constructor(){this.Tn=new Ms}addToCollectionParentIndex(e,t){return this.Tn.add(t),Se.resolve()}getCollectionParents(e,t){return Se.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return Se.resolve()}deleteFieldIndex(e,t){return Se.resolve()}deleteAllFieldIndexes(e){return Se.resolve()}createTargetIndexes(e,t){return Se.resolve()}getDocumentsMatchingTarget(e,t){return Se.resolve(null)}getIndexType(e,t){return Se.resolve(0)}getFieldIndexes(e,t){return Se.resolve([])}getNextCollectionGroupToUpdate(e){return Se.resolve(null)}getMinOffset(e,t){return Se.resolve(ve.min())}getMinOffsetFromCollectionGroup(e,t){return Se.resolve(ve.min())}updateCollectionGroup(e,t,n){return Se.resolve()}updateIndexEntries(e,t){return Se.resolve()}}class Ms{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new an(se.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new an(se.comparator)).toArray()}}const zs="IndexedDbIndexManager",Fs=new Uint8Array(0);class Vs{constructor(e,t){this.databaseId=t,this.In=new Ms,this.En=new ei((e=>Dr(e)),((e,t)=>Pr(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.In.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.In.add(t)}));const i={collectionId:n,parent:qe(r)};return Us(e).put(i)}return Se.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[Z(t),""],!1,!0);return Us(e).G(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(Ge(r.parent))}return n}))}addFieldIndex(e,t){const n=Bs(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);delete r.indexId;const i=n.add(r);if(t.indexState){const n=qs(e);return i.next((e=>{n.put(ls(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}deleteFieldIndex(e,t){const n=Bs(e),r=qs(e),i=$s(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}deleteAllFieldIndexes(e){const t=Bs(e),n=$s(e),r=qs(e);return t.J().next((()=>n.J())).next((()=>r.J()))}createTargetIndexes(e,t){return Se.forEach(this.dn(t),(t=>this.getIndexType(e,t).next((n=>{if(0===n||1===n){const n=new Ts(t).Pn();if(null!=n)return this.addFieldIndex(e,n)}}))))}getDocumentsMatchingTarget(e,t){const n=$s(e);let r=!0;const i=new Map;return Se.forEach(this.dn(t),(t=>this.An(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=di();const r=[];return Se.forEach(i,((i,o)=>{k(zs,`Using index ${function(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`}(i)} to execute ${Dr(t)}`);const s=function(e,t){const n=he(t);if(void 0===n)return null;for(const r of Or(e,n.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}(o,i),a=function(e,t){const n=new Map;for(const r of fe(t))for(const t of Or(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(o,i),l=function(e,t){const n=[];let r=!0;for(const i of fe(t)){const t=0===i.kind?Lr(e,i.fieldPath,e.startAt):jr(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new or(n,r)}(o,i),c=function(e,t){const n=[];let r=!0;for(const i of fe(t)){const t=0===i.kind?jr(e,i.fieldPath,e.endAt):Lr(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new or(n,r)}(o,i),u=this.Rn(i,o,l),d=this.Rn(i,o,c),h=this.Vn(i,o,a),f=this.mn(i.indexId,s,u,l.inclusive,d,c.inclusive,h);return Se.forEach(f,(i=>n.H(i,t.limit).next((t=>{t.forEach((t=>{const n=ce.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return Se.resolve(null)}))}dn(e){let t=this.En.get(e);return t||(t=0===e.filters.length?[e]:Cs(hr.create(e.filters,"and")).map((t=>Nr(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt))),this.En.set(e,t),t)}mn(e,t,n,r,i,o,s){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),l=a/(null!=t?t.length:1),c=[];for(let u=0;u<a;++u){const a=t?this.fn(t[u/l]):Fs,d=this.gn(e,a,n[u%l],r),h=this.pn(e,a,i[u%l],o),f=s.map((t=>this.gn(e,a,t,!0)));c.push(...this.createRange(d,h,f))}return c}gn(e,t,n,r){const i=new Ss(e,ce.empty(),t,n);return r?i:i.nn()}pn(e,t,n,r){const i=new Ss(e,ce.empty(),t,n);return r?i.nn():i}An(e,t){const n=new Ts(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.un(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;const r=this.dn(t);return Se.forEach(r,(t=>this.An(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new an(le.comparator),n=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(const r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>function(e){return null!==e.limit}(t)&&r.length>1&&2===n?1:n))}yn(e,t){const n=new Is;for(const r of fe(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.tn(r.kind);gs.xt.At(e,i)}return n.Yt()}fn(e){const t=new Is;return gs.xt.At(e,t.tn(0)),t.Yt()}wn(e,t){const n=new Is;return gs.xt.At($n(this.databaseId,t),n.tn(function(e){const t=fe(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Yt()}Vn(e,t,n){if(null===n)return[];let r=[];r.push(new Is);let i=0;for(const o of fe(e)){const e=n[i++];for(const n of r)if(this.Sn(t,o.fieldPath)&&qn(e))r=this.bn(r,o,e);else{const t=n.tn(o.kind);gs.xt.At(e,t)}}return this.Dn(r)}Rn(e,t,n){return this.Vn(e,t,n.position)}Dn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Yt();return t}bn(e,t,n){const r=[...e],i=[];for(const o of n.arrayValue.values||[])for(const e of r){const n=new Is;n.seed(e.Yt()),gs.xt.At(o,n.tn(t.kind)),i.push(n)}return i}Sn(e,t){return!!e.filters.find((e=>e instanceof dr&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Bs(e),r=qs(e);return(t?n.G(At,IDBKeyRange.bound(t,t)):n.G()).next((e=>{const t=[];return Se.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new ge(t.sequenceNumber,new ve(ts(t.readTime),new ce(Ge(t.documentKey)),t.largestBatchId)):ge.empty(),r=e.fields.map((e=>{let[t,n]=e;return new pe(le.fromServerFormat(t),n)}));return new de(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:W(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=Bs(e),i=qs(e);return this.vn(e).next((e=>r.G(At,IDBKeyRange.bound(t,t)).next((t=>Se.forEach(t,(t=>i.put(ls(t.indexId,this.uid,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return Se.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?Se.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),Se.forEach(i,(n=>this.Cn(e,t,n).next((t=>{const i=this.Fn(r,n);return t.isEqual(i)?Se.resolve():this.Mn(e,r,n,t,i)})))))))}))}xn(e,t,n,r){return $s(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.wn(n,t.key),documentKey:t.key.path.toArray()})}On(e,t,n,r){return $s(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.wn(n,t.key),t.key.path.toArray()])}Cn(e,t,n){const r=$s(e);let i=new an(Es);return r.Z({index:jt,range:IDBKeyRange.only([n.indexId,this.uid,this.wn(n,t)])},((e,r)=>{i=i.add(new Ss(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}Fn(e,t){let n=new an(Es);const r=this.yn(t,e);if(null==r)return n;const i=he(t);if(null!=i){const o=e.data.field(i.fieldPath);if(qn(o))for(const i of o.arrayValue.values||[])n=n.add(new Ss(t.indexId,e.key,this.fn(i),r))}else n=n.add(new Ss(t.indexId,e.key,Fs,r));return n}Mn(e,t,n,r,i){k(zs,"Updating index entries for document '%s'",t.key);const o=[];return function(e,t,n,r,i){const o=e.getIterator(),s=t.getIterator();let a=cn(o),l=cn(s);for(;a||l;){let e=!1,t=!1;if(a&&l){const r=n(a,l);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(l),l=cn(s)):t?(i(a),a=cn(o)):(a=cn(o),l=cn(s))}}(r,i,Es,(r=>{o.push(this.xn(e,t,n,r))}),(r=>{o.push(this.On(e,t,n,r))})),Se.waitFor(o)}vn(e){let t=1;return qs(e).Z({index:Pt,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>Es(e,t))).filter(((e,t,n)=>!t||0!==Es(e,n[t-1])));const r=[];r.push(e);for(const o of n){const n=Es(o,e),i=Es(o,t);if(0===n)r[0]=e.nn();else if(n>0&&i<0)r.push(o),r.push(o.nn());else if(i>0)break}r.push(t);const i=[];for(let o=0;o<r.length;o+=2){if(this.Nn(r[o],r[o+1]))return[];const e=[r[o].indexId,this.uid,r[o].arrayValue,r[o].directionalValue,Fs,[]],t=[r[o+1].indexId,this.uid,r[o+1].arrayValue,r[o+1].directionalValue,Fs,[]];i.push(IDBKeyRange.bound(e,t))}return i}Nn(e,t){return Es(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Hs)}getMinOffset(e,t){return Se.mapArray(this.dn(t),(t=>this.An(e,t).next((e=>e||D())))).next(Hs)}}function Us(e){return Zt(e,St)}function $s(e){return Zt(e,Ot)}function Bs(e){return Zt(e,Ct)}function qs(e){return Zt(e,Nt)}function Hs(e){P(0!==e.length);let t=e[0].indexState.offset,n=t.largestBatchId;for(let r=1;r<e.length;r++){const i=e[r].indexState.offset;be(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new ve(t.readTime,t.documentKey,n)}const Ks={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Gs=41943040;class Ws{static withCacheSize(e){return new Ws(e,Ws.DEFAULT_COLLECTION_PERCENTILE,Ws.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function Qs(e,t,n){const r=e.store(Xe),i=e.store(ot),o=[],s=IDBKeyRange.only(n.batchId);let a=0;const l=r.Z({range:s},((e,t,n)=>(a++,n.delete())));o.push(l.next((()=>{P(1===a)})));const c=[];for(const u of n.mutations){const e=rt(t,u.key.path,n.batchId);o.push(i.delete(e)),c.push(u.key)}return Se.waitFor(o).next((()=>c))}function Js(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw D();t=e.noDocument}return JSON.stringify(t).length}Ws.DEFAULT_COLLECTION_PERCENTILE=10,Ws.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ws.DEFAULT=new Ws(Gs,Ws.DEFAULT_COLLECTION_PERCENTILE,Ws.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ws.DISABLED=new Ws(-1,0,0);class Ys{constructor(e,t,n,r){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=r,this.Bn={}}static It(e,t,n,r){P(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Ys(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Zs(e).Z({index:et,range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=ea(e),o=Zs(e);return o.add({}).next((s=>{P("number"==typeof s);const a=new Ki(s,t,n,r),l=function(e,t,n){const r=n.baseMutations.map((t=>jo(e.Tt,t))),i=n.mutations.map((t=>jo(e.Tt,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.serializer,this.userId,a),c=[];let u=new an(((e,t)=>W(e.canonicalString(),t.canonicalString())));for(const e of r){const t=rt(this.userId,e.key.path,s);u=u.add(e.key.path.popLast()),c.push(o.put(l)),c.push(i.put(t,it))}return u.forEach((t=>{c.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.Bn[s]=a.keys()})),Se.waitFor(c).next((()=>a))}))}lookupMutationBatch(e,t){return Zs(e).get(t).next((e=>e?(P(e.userId===this.userId),ns(this.serializer,e)):null))}Ln(e,t){return this.Bn[t]?Se.resolve(this.Bn[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.Bn[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Zs(e).Z({index:et,range:r},((e,t,r)=>{t.userId===this.userId&&(P(t.batchId>=n),i=ns(this.serializer,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=Fe;return Zs(e).Z({index:et,range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,Fe],[this.userId,Number.POSITIVE_INFINITY]);return Zs(e).G(et,t).next((e=>e.map((e=>ns(this.serializer,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=nt(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return ea(e).Z({range:r},((n,r,o)=>{const[s,a,l]=n,c=Ge(a);if(s===this.userId&&t.path.isEqual(c))return Zs(e).get(l).next((e=>{if(!e)throw D();P(e.userId===this.userId),i.push(ns(this.serializer,e))}));o.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new an(W);const r=[];return t.forEach((t=>{const i=nt(this.userId,t.path),o=IDBKeyRange.lowerBound(i),s=ea(e).Z({range:o},((e,r,i)=>{const[o,s,a]=e,l=Ge(s);o===this.userId&&t.path.isEqual(l)?n=n.add(a):i.done()}));r.push(s)})),Se.waitFor(r).next((()=>this.kn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=nt(this.userId,n),o=IDBKeyRange.lowerBound(i);let s=new an(W);return ea(e).Z({range:o},((e,t,i)=>{const[o,a,l]=e,c=Ge(a);o===this.userId&&n.isPrefixOf(c)?c.length===r&&(s=s.add(l)):i.done()})).next((()=>this.kn(e,s)))}kn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(Zs(e).get(t).next((e=>{if(null===e)throw D();P(e.userId===this.userId),n.push(ns(this.serializer,e))})))})),Se.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return Qs(e.ue,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this.qn(t.batchId)})),Se.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}qn(e){delete this.Bn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return Se.resolve();const n=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return ea(e).Z({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=Ge(e[1]);r.push(t)}else n.done()})).next((()=>{P(0===r.length)}))}))}containsKey(e,t){return Xs(e,this.userId,t)}Qn(e){return ta(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:Fe,lastStreamToken:""}))}}function Xs(e,t,n){const r=nt(t,n.path),i=r[1],o=IDBKeyRange.lowerBound(r);let s=!1;return ea(e).Z({range:o,Y:!0},((e,n,r)=>{const[o,a,l]=e;o===t&&a===i&&(s=!0),r.done()})).next((()=>s))}function Zs(e){return Zt(e,Xe)}function ea(e){return Zt(e,ot)}function ta(e){return Zt(e,Ye)}class na{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new na(0)}static Kn(){return new na(-1)}}class ra{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Wn(e).next((t=>{const n=new na(t.highestTargetId);return t.highestTargetId=n.next(),this.Gn(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.Wn(e).next((e=>re.fromTimestamp(new ne(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.Wn(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.Wn(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Gn(e,r))))}addTargetData(e,t){return this.zn(e,t).next((()=>this.Wn(e).next((n=>(n.targetCount+=1,this.jn(t,n),this.Gn(e,n))))))}updateTargetData(e,t){return this.zn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>ia(e).delete(t.targetId))).next((()=>this.Wn(e))).next((t=>(P(t.targetCount>0),t.targetCount-=1,this.Gn(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return ia(e).Z(((o,s)=>{const a=rs(s);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>Se.waitFor(i))).next((()=>r))}forEachTarget(e,t){return ia(e).Z(((e,n)=>{const r=rs(n);t(r)}))}Wn(e){return oa(e).get(xt).next((e=>(P(null!==e),e)))}Gn(e,t){return oa(e).put(xt,t)}zn(e,t){return ia(e).put(is(this.serializer,t))}jn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Wn(e).next((e=>e.targetCount))}getTargetData(e,t){const n=Dr(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return ia(e).Z({range:r,index:gt},((e,n,r)=>{const o=rs(n);Pr(t,o.target)&&(i=o,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=sa(e);return t.forEach((t=>{const o=qe(t.path);r.push(i.put({targetId:n,path:o})),r.push(this.referenceDelegate.addReference(e,n,t))})),Se.waitFor(r)}removeMatchingKeys(e,t,n){const r=sa(e);return Se.forEach(t,(t=>{const i=qe(t.path);return Se.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=sa(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=sa(e);let i=di();return r.Z({range:n,Y:!0},((e,t,n)=>{const r=Ge(e[1]),o=new ce(r);i=i.add(o)})).next((()=>i))}containsKey(e,t){const n=qe(t.path),r=IDBKeyRange.bound([n],[Z(n)],!1,!0);let i=0;return sa(e).Z({index:bt,Y:!0,range:r},((e,t,n)=>{let[r,o]=e;0!==r&&(i++,n.done())})).next((()=>i>0))}lt(e,t){return ia(e).get(t).next((e=>e?rs(e):null))}}function ia(e){return Zt(e,pt)}function oa(e){return Zt(e,It)}function sa(e){return Zt(e,yt)}const aa="LruGarbageCollector",la=1048576;function ca(e,t){let[n,r]=e,[i,o]=t;const s=W(n,i);return 0===s?W(r,o):s}class ua{constructor(e){this.Hn=e,this.buffer=new an(ca),this.Jn=0}Yn(){return++this.Jn}Zn(e){const t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();ca(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class da{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Xn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return null!==this.Xn}er(e){k(aa,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ne(e)?k(aa,"Ignoring IndexedDB error during garbage collection: ",e):await Ie(e)}await this.er(3e5)}))}}class ha{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Se.resolve(ze.ae);const n=new ua(t);return this.tr.forEachTarget(e,(e=>n.Zn(e.sequenceNumber))).next((()=>this.tr.rr(e,(e=>n.Zn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.tr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector","Garbage collection skipped; disabled"),Se.resolve(Ks)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ks):this.ir(e,t)))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,t){let n,r,i,o,s,l,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,o=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,s=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,l=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),T()<=a.$b.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-u}ms\n\tDetermined least recently used ${r} in `+(s-o)+"ms\n"+`\tRemoved ${i} targets in `+(l-s)+"ms\n"+`\tRemoved ${e} documents in `+(c-l)+"ms\n"+`Total Duration: ${c-u}ms`),Se.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}function fa(e,t){return new ha(e,t)}class pa{constructor(e,t){this.db=e,this.garbageCollector=fa(this,t)}nr(e){const t=this.sr(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}sr(e){let t=0;return this.rr(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}rr(e,t){return this._r(e,((e,n)=>t(n)))}addReference(e,t,n){return ga(e,n)}removeReference(e,t,n){return ga(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return ga(e,t)}ar(e,t){return function(e,t){let n=!1;return ta(e).X((r=>Xs(e,r,t).next((e=>(e&&(n=!0),Se.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this._r(e,((o,s)=>{if(s<=t){const t=this.ar(e,o).next((t=>{if(!t)return i++,n.getEntry(e,o).next((()=>(n.removeEntry(o,re.min()),sa(e).delete(function(e){return[0,qe(e.path)]}(o)))))}));r.push(t)}})).next((()=>Se.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return ga(e,t)}_r(e,t){const n=sa(e);let r,i=ze.ae;return n.Z({index:bt},((e,n)=>{let[o,s]=e,{path:a,sequenceNumber:l}=n;0===o?(i!==ze.ae&&t(new ce(Ge(r)),i),i=l,r=a):i=ze.ae})).next((()=>{i!==ze.ae&&t(new ce(Ge(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ga(e,t){return sa(e).put(function(e,t){return{targetId:0,path:qe(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class ma{constructor(){this.changes=new ei((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ir.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Se.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ya{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return xa(e).put(n)}removeEntry(e,t,n){return xa(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Zo(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.ur(e,n))))}getEntry(e,t){let n=ir.newInvalidDocument(t);return xa(e).Z({index:lt,range:IDBKeyRange.only(Ia(t))},((e,r)=>{n=this.cr(t,r)})).next((()=>n))}lr(e,t){let n={size:0,document:ir.newInvalidDocument(t)};return xa(e).Z({index:lt,range:IDBKeyRange.only(Ia(t))},((e,r)=>{n={document:this.cr(t,r),size:Js(r)}})).next((()=>n))}getEntries(e,t){let n=ni();return this.hr(e,t,((e,t)=>{const r=this.cr(e,t);n=n.insert(e,r)})).next((()=>n))}Pr(e,t){let n=ni(),r=new rn(ce.comparator);return this.hr(e,t,((e,t)=>{const i=this.cr(e,t);n=n.insert(e,i),r=r.insert(e,Js(t))})).next((()=>({documents:n,Tr:r})))}hr(e,t,n){if(t.isEmpty())return Se.resolve();let r=new an(Ea);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(Ia(r.first()),Ia(r.last())),o=r.getIterator();let s=o.getNext();return xa(e).Z({index:lt,range:i},((e,t,r)=>{const i=ce.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;s&&Ea(s,i)<0;)n(s,null),s=o.getNext();s&&s.isEqual(i)&&(n(s,t),s=o.hasNext()?o.getNext():null),s?r.W(Ia(s)):r.done()})).next((()=>{for(;s;)n(s,null),s=o.hasNext()?o.getNext():null}))}getDocumentsMatchingQuery(e,t,n,r,i){const o=t.path,s=[o.popLast().toArray(),o.lastSegment(),Zo(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return xa(e).G(IDBKeyRange.bound(s,a,!0)).next((e=>{null==i||i.incrementDocumentReadCount(e.length);let n=ni();for(const i of e){const e=this.cr(ce.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(Jr(t,e)||r.has(e.key))&&(n=n.insert(e.key,e))}return n}))}getAllFromCollectionGroup(e,t,n,r){let i=ni();const o=Sa(t,n),s=Sa(t,ve.max());return xa(e).Z({index:ut,range:IDBKeyRange.bound(o,s,!0)},((e,t,n)=>{const o=this.cr(ce.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(o.key,o),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new ba(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return wa(e).get(ft).next((e=>(P(!!e),e)))}ur(e,t){return wa(e).put(ft,t)}cr(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Lo(e.Tt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=ce.fromSegments(t.noDocument.path),r=ts(t.noDocument.readTime);n=ir.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return D();{const e=ce.fromSegments(t.unknownDocument.path),r=ts(t.unknownDocument.version);n=ir.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new ne(e[0],e[1]);return re.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(re.min()))return e}return ir.newInvalidDocument(e)}}function va(e){return new ya(e)}class ba extends ma{constructor(e,t){super(),this.Ir=e,this.trackRemovals=t,this.Er=new ei((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new an(((e,t)=>W(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,o)=>{const s=this.Er.get(i);if(t.push(this.Ir.removeEntry(e,i,s.readTime)),o.isValidDocument()){const a=Xo(this.Ir.serializer,o);r=r.add(i.path.popLast());const l=Js(a);n+=l-s.size,t.push(this.Ir.addEntry(e,i,a))}else if(n-=s.size,this.trackRemovals){const n=Xo(this.Ir.serializer,o.convertToNoDocument(re.min()));t.push(this.Ir.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.Ir.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.Ir.updateMetadata(e,n)),Se.waitFor(t)}getFromCache(e,t){return this.Ir.lr(e,t).next((e=>(this.Er.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.Ir.Pr(e,t).next((e=>{let{documents:t,Tr:n}=e;return n.forEach(((e,n)=>{this.Er.set(e,{size:n,readTime:t.get(e).readTime})})),t}))}}function wa(e){return Zt(e,ht)}function xa(e){return Zt(e,st)}function Ia(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Sa(e,t){const n=t.documentKey.path.toArray();return[e,Zo(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Ea(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let o=0;o<n.length-2&&o<r.length-2;++o)if(i=W(n[o],r[o]),i)return i;return i=W(n.length,r.length),i||(i=W(n[n.length-2],r[r.length-2]),i||W(n[n.length-1],r[r.length-1]))}class _a{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ta{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&ji(n.mutation,e,un.empty(),ne.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,di()).next((()=>t))))}getLocalViewOfDocuments(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:di();const r=si();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=ii();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=si();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,di())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=ni();const o=li(),s=li();return t.forEach(((e,t)=>{const s=n.get(t.key);r.has(t.key)&&(void 0===s||s.mutation instanceof Vi)?i=i.insert(t.key,t):void 0!==s?(o.set(t.key,s.mutation.getFieldMask()),ji(s.mutation,t,s.mutation.getFieldMask(),ne.now())):o.set(t.key,un.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>o.set(e,t))),t.forEach(((e,t)=>{var n;return s.set(e,new _a(t,null!==(n=o.get(e))&&void 0!==n?n:null))})),s)))}recalculateAndSaveOverlays(e,t){const n=li();let r=new rn(((e,t)=>e-t)),i=di();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const o=t.get(e);if(null===o)return;let s=n.get(e)||un.empty();s=i.applyToLocalView(o,s),n.set(e,s);const a=(r.get(i.batchId)||di()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const o=[],s=r.getReverseIterator();for(;s.hasNext();){const r=s.getNext(),a=r.key,l=r.value,c=ai();l.forEach((e=>{if(!i.has(e)){const r=Oi(t.get(e),n.get(e));null!==r&&c.set(e,r),i=i.add(e)}})),o.push(this.documentOverlayCache.saveOverlays(e,a,c))}return Se.waitFor(o)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return ce.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ur(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const o=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):Se.resolve(si());let s=ue,a=i;return o.next((t=>Se.forEach(t,((t,n)=>(s<n.largestBatchId&&(s=n.largestBatchId),i.get(t)?Se.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,di()))).next((e=>({batchId:s,changes:oi(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ce(t)).next((e=>{let t=ii();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let o=ii();return this.indexManager.getCollectionParents(e,i).next((s=>Se.forEach(s,(s=>{const a=function(e,t){return new Mr(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{o=o.insert(e,t)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,ir.newInvalidDocument(r)))}));let n=ii();return e.forEach(((e,r)=>{const o=i.get(e);void 0!==o&&ji(o.mutation,r,un.empty(),ne.now()),Jr(t,r)&&(n=n.insert(e,r))})),n}))}}class ka{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return Se.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Eo(e.createTime)}}(t)),Se.resolve()}getNamedQuery(e,t){return Se.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,function(e){return{name:e.name,query:os(e.bundledQuery),readTime:Eo(e.readTime)}}(t)),Se.resolve()}}class Ca{constructor(){this.overlays=new rn(ce.comparator),this.Rr=new Map}getOverlay(e,t){return Se.resolve(this.overlays.get(t))}getOverlays(e,t){const n=si();return Se.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.Et(e,t,r)})),Se.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Rr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.Rr.delete(n)),Se.resolve()}getOverlaysForCollection(e,t,n){const r=si(),i=t.length+1,o=new ce(t.child("")),s=this.overlays.getIteratorFrom(o);for(;s.hasNext();){const e=s.getNext().value,o=e.getKey();if(!t.isPrefixOf(o.path))break;o.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Se.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new rn(((e,t)=>e-t));const o=this.overlays.getIterator();for(;o.hasNext();){const e=o.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=si(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const s=si(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>s.set(e,t))),!(s.size()>=r)););return Se.resolve(s)}Et(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Rr.get(r.largestBatchId).delete(n.key);this.Rr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new Wi(t,n));let i=this.Rr.get(t);void 0===i&&(i=di(),this.Rr.set(t,i)),this.Rr.set(t,i.add(n.key))}}class Aa{constructor(){this.sessionToken=hn.EMPTY_BYTE_STRING}getSessionToken(e){return Se.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Se.resolve()}}class Na{constructor(){this.Vr=new an(Da.mr),this.gr=new an(Da.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){const n=new Da(e,t);this.Vr=this.Vr.add(n),this.gr=this.gr.add(n)}yr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.wr(new Da(e,t))}Sr(e,t){e.forEach((e=>this.removeReference(e,t)))}br(e){const t=new ce(new se([])),n=new Da(t,e),r=new Da(t,e+1),i=[];return this.gr.forEachInRange([n,r],(e=>{this.wr(e),i.push(e.key)})),i}Dr(){this.Vr.forEach((e=>this.wr(e)))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const t=new ce(new se([])),n=new Da(t,e),r=new Da(t,e+1);let i=di();return this.gr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Da(e,0),n=this.Vr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Da{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return ce.comparator(e.key,t.key)||W(e.Cr,t.Cr)}static pr(e,t){return W(e.Cr,t.Cr)||ce.comparator(e.key,t.key)}}class Pa{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new an(Da.mr)}checkEmpty(e){return Se.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Ki(i,t,n,r);this.mutationQueue.push(o);for(const s of r)this.Mr=this.Mr.add(new Da(s.key,i)),this.indexManager.addToCollectionParentIndex(e,s.key.path.popLast());return Se.resolve(o)}lookupMutationBatch(e,t){return Se.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.Nr(n),i=r<0?0:r;return Se.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Se.resolve(0===this.mutationQueue.length?Fe:this.Fr-1)}getAllMutationBatches(e){return Se.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Da(t,0),r=new Da(t,Number.POSITIVE_INFINITY),i=[];return this.Mr.forEachInRange([n,r],(e=>{const t=this.Or(e.Cr);i.push(t)})),Se.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new an(W);return t.forEach((e=>{const t=new Da(e,0),r=new Da(e,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([t,r],(e=>{n=n.add(e.Cr)}))})),Se.resolve(this.Br(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;ce.isDocumentKey(i)||(i=i.child(""));const o=new Da(new ce(i),0);let s=new an(W);return this.Mr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(s=s.add(e.Cr)),!0)}),o),Se.resolve(this.Br(s))}Br(e){const t=[];return e.forEach((e=>{const n=this.Or(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){P(0===this.Lr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Mr;return Se.forEach(t.mutations,(r=>{const i=new Da(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Mr=n}))}qn(e){}containsKey(e,t){const n=new Da(t,0),r=this.Mr.firstAfterOrEqual(n);return Se.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Se.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Or(e){const t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Ra{constructor(e){this.kr=e,this.docs=new rn(ce.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,o=this.kr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Se.resolve(n?n.document.mutableCopy():ir.newInvalidDocument(t))}getEntries(e,t){let n=ni();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ir.newInvalidDocument(e))})),Se.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=ni();const o=t.path,s=new ce(o.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(s);for(;a.hasNext();){const{key:e,value:{document:s}}=a.getNext();if(!o.isPrefixOf(e.path))break;e.path.length>o.length+1||be(ye(s),n)<=0||(r.has(s.key)||Jr(t,s))&&(i=i.insert(s.key,s.mutableCopy()))}return Se.resolve(i)}getAllFromCollectionGroup(e,t,n,r){D()}qr(e,t){return Se.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Oa(this)}getSize(e){return Se.resolve(this.size)}}class Oa extends ma{constructor(e){super(),this.Ir=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Ir.addEntry(e,r)):this.Ir.removeEntry(n)})),Se.waitFor(t)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}}class La{constructor(e){this.persistence=e,this.Qr=new ei((e=>Dr(e)),Pr),this.lastRemoteSnapshotVersion=re.min(),this.highestTargetId=0,this.$r=0,this.Ur=new Na,this.targetCount=0,this.Kr=na.Un()}forEachTarget(e,t){return this.Qr.forEach(((e,n)=>t(n))),Se.resolve()}getLastRemoteSnapshotVersion(e){return Se.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Se.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),Se.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.$r&&(this.$r=t),Se.resolve()}zn(e){this.Qr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Kr=new na(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,Se.resolve()}updateTargetData(e,t){return this.zn(t),Se.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Ur.br(t.targetId),this.targetCount-=1,Se.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Qr.forEach(((o,s)=>{s.sequenceNumber<=t&&null===n.get(s.targetId)&&(this.Qr.delete(o),i.push(this.removeMatchingKeysForTargetId(e,s.targetId)),r++)})),Se.waitFor(i).next((()=>r))}getTargetCount(e){return Se.resolve(this.targetCount)}getTargetData(e,t){const n=this.Qr.get(t)||null;return Se.resolve(n)}addMatchingKeys(e,t,n){return this.Ur.yr(t,n),Se.resolve()}removeMatchingKeys(e,t,n){this.Ur.Sr(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),Se.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ur.br(t),Se.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Ur.vr(t);return Se.resolve(n)}containsKey(e,t){return Se.resolve(this.Ur.containsKey(t))}}class ja{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new ze(0),this.zr=!1,this.zr=!0,this.jr=new Aa,this.referenceDelegate=e(this),this.Hr=new La(this),this.indexManager=new js,this.remoteDocumentCache=function(e){return new Ra(e)}((e=>this.referenceDelegate.Jr(e))),this.serializer=new Yo(t),this.Yr=new ka(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ca,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Wr[e.toKey()];return n||(n=new Pa(t,this.referenceDelegate),this.Wr[e.toKey()]=n),n}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,n){k("MemoryPersistence","Starting transaction:",e);const r=new Ma(this.Gr.next());return this.referenceDelegate.Zr(),n(r).next((e=>this.referenceDelegate.Xr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}ei(e,t){return Se.or(Object.values(this.Wr).map((n=>()=>n.containsKey(e,t))))}}class Ma extends xe{constructor(e){super(),this.currentSequenceNumber=e}}class za{constructor(e){this.persistence=e,this.ti=new Na,this.ni=null}static ri(e){return new za(e)}get ii(){if(this.ni)return this.ni;throw D()}addReference(e,t,n){return this.ti.addReference(n,t),this.ii.delete(n.toString()),Se.resolve()}removeReference(e,t,n){return this.ti.removeReference(n,t),this.ii.add(n.toString()),Se.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),Se.resolve()}removeTarget(e,t){this.ti.br(t.targetId).forEach((e=>this.ii.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.ii.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Zr(){this.ni=new Set}Xr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Se.forEach(this.ii,(n=>{const r=ce.fromPath(n);return this.si(e,r).next((e=>{e||t.removeEntry(r,re.min())}))})).next((()=>(this.ni=null,t.apply(e))))}updateLimboDocument(e,t){return this.si(e,t).next((e=>{e?this.ii.delete(t.toString()):this.ii.add(t.toString())}))}Jr(e){return 0}si(e,t){return Se.or([()=>Se.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}}class Fa{constructor(e,t){this.persistence=e,this.oi=new ei((e=>qe(e.path)),((e,t)=>e.isEqual(t))),this.garbageCollector=fa(this,t)}static ri(e,t){return new Fa(e,t)}Zr(){}Xr(e){return Se.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){const t=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}sr(e){let t=0;return this.rr(e,(e=>{t++})).next((()=>t))}rr(e,t){return Se.forEach(this.oi,((n,r)=>this.ar(e,n,r).next((e=>e?Se.resolve():t(r)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.qr(e,(r=>this.ar(e,r,t).next((e=>{e||(n++,i.removeEntry(r,re.min()))})))).next((()=>i.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),Se.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),Se.resolve()}removeReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),Se.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),Se.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Un(e.data.value)),t}ar(e,t,n){return Se.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.oi.get(t);return Se.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Va{constructor(e){this.serializer=e}B(e,t,n,r){const i=new _e("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(Qe)}(e),function(e){e.createObjectStore(Ye,{keyPath:"userId"});e.createObjectStore(Xe,{keyPath:Ze,autoIncrement:!0}).createIndex(et,tt,{unique:!0}),e.createObjectStore(ot)}(e),Ua(e),function(e){e.createObjectStore(We)}(e));let o=Se.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(yt),e.deleteObjectStore(pt),e.deleteObjectStore(It)}(e),Ua(e)),o=o.next((()=>function(e){const t=e.store(It),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:re.min().toTimestamp(),targetCount:0};return t.put(xt,n)}(i)))),n<4&&r>=4&&(0!==n&&(o=o.next((()=>function(e,t){return t.store(Xe).G().next((n=>{e.deleteObjectStore(Xe),e.createObjectStore(Xe,{keyPath:Ze,autoIncrement:!0}).createIndex(et,tt,{unique:!0});const r=t.store(Xe),i=n.map((e=>r.put(e)));return Se.waitFor(i)}))}(e,i)))),o=o.next((()=>{!function(e){e.createObjectStore(_t,{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(o=o.next((()=>this._i(i)))),n<6&&r>=6&&(o=o.next((()=>(function(e){e.createObjectStore(ht)}(e),this.ai(i))))),n<7&&r>=7&&(o=o.next((()=>this.ui(i)))),n<8&&r>=8&&(o=o.next((()=>this.ci(e,i)))),n<9&&r>=9&&(o=o.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(o=o.next((()=>this.li(i)))),n<11&&r>=11&&(o=o.next((()=>{!function(e){e.createObjectStore(Tt,{keyPath:"bundleId"})}(e),function(e){e.createObjectStore(kt,{keyPath:"name"})}(e)}))),n<12&&r>=12&&(o=o.next((()=>{!function(e){const t=e.createObjectStore(zt,{keyPath:Ft});t.createIndex(Vt,Ut,{unique:!1}),t.createIndex($t,Bt,{unique:!1})}(e)}))),n<13&&r>=13&&(o=o.next((()=>function(e){const t=e.createObjectStore(st,{keyPath:at});t.createIndex(lt,ct),t.createIndex(ut,dt)}(e))).next((()=>this.hi(e,i))).next((()=>e.deleteObjectStore(We)))),n<14&&r>=14&&(o=o.next((()=>this.Pi(e,i)))),n<15&&r>=15&&(o=o.next((()=>function(e){e.createObjectStore(Ct,{keyPath:"indexId",autoIncrement:!0}).createIndex(At,"collectionGroup",{unique:!1});e.createObjectStore(Nt,{keyPath:Dt}).createIndex(Pt,Rt,{unique:!1});e.createObjectStore(Ot,{keyPath:Lt}).createIndex(jt,Mt,{unique:!1})}(e)))),n<16&&r>=16&&(o=o.next((()=>{t.objectStore(Nt).clear()})).next((()=>{t.objectStore(Ot).clear()}))),n<17&&r>=17&&(o=o.next((()=>{!function(e){e.createObjectStore(qt,{keyPath:"name"})}(e)}))),o}ai(e){let t=0;return e.store(We).Z(((e,n)=>{t+=Js(n)})).next((()=>{const n={byteSize:t};return e.store(ht).put(ft,n)}))}_i(e){const t=e.store(Ye),n=e.store(Xe);return t.G().next((t=>Se.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,Fe],[t.userId,t.lastAcknowledgedBatchId]);return n.G(et,r).next((n=>Se.forEach(n,(n=>{P(n.userId===t.userId);const r=ns(this.serializer,n);return Qs(e,t.userId,r).next((()=>{}))}))))}))))}ui(e){const t=e.store(yt),n=e.store(We);return e.store(It).get(xt).next((e=>{const r=[];return n.Z(((n,i)=>{const o=new se(n),s=function(e){return[0,qe(e)]}(o);r.push(t.get(s).next((n=>n?Se.resolve():(n=>t.put({targetId:0,path:qe(n),sequenceNumber:e.highestListenSequenceNumber}))(o))))})).next((()=>Se.waitFor(r)))}))}ci(e,t){e.createObjectStore(St,{keyPath:Et});const n=t.store(St),r=new Ms,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:qe(r)})}};return t.store(We).Z({Y:!0},((e,t)=>{const n=new se(e);return i(n.popLast())})).next((()=>t.store(ot).Z({Y:!0},((e,t)=>{let[n,r,o]=e;const s=Ge(r);return i(s.popLast())}))))}li(e){const t=e.store(pt);return t.Z(((e,n)=>{const r=rs(n),i=is(this.serializer,r);return t.put(i)}))}hi(e,t){const n=t.store(We),r=[];return n.Z(((e,n)=>{const i=t.store(st),o=function(e){return e.document?new ce(se.fromString(e.document.name).popFirst(5)):e.noDocument?ce.fromSegments(e.noDocument.path):e.unknownDocument?ce.fromSegments(e.unknownDocument.path):D()}(n).path.toArray(),s={prefixPath:o.slice(0,o.length-2),collectionGroup:o[o.length-2],documentId:o[o.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(s))})).next((()=>Se.waitFor(r)))}Pi(e,t){const n=t.store(Xe),r=va(this.serializer),i=new ja(za.ri,this.serializer.Tt);return n.G().next((e=>{const n=new Map;return e.forEach((e=>{var t;let r=null!==(t=n.get(e.userId))&&void 0!==t?t:di();ns(this.serializer,e).keys().forEach((e=>r=r.add(e))),n.set(e.userId,r)})),Se.forEach(n,((e,n)=>{const o=new S(n),s=hs.It(this.serializer,o),a=i.getIndexManager(o),l=Ys.It(o,this.serializer,a,i.referenceDelegate);return new Ta(r,l,s,a).recalculateAndSaveOverlaysForDocumentKeys(new Xt(t,ze.ae),e).next()}))}))}}function Ua(e){e.createObjectStore(yt,{keyPath:vt}).createIndex(bt,wt,{unique:!0}),e.createObjectStore(pt,{keyPath:"targetId"}).createIndex(gt,mt,{unique:!0}),e.createObjectStore(It)}const $a="IndexedDbPersistence",Ba=18e5,qa=5e3,Ha="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ka="main";class Ga{constructor(e,t,n,r,i,o,s,a,l,c){let u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:17;if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Ti=i,this.window=o,this.document=s,this.Ii=l,this.Ei=c,this.di=u,this.Gr=null,this.zr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ai=null,this.inForeground=!1,this.Ri=null,this.Vi=null,this.mi=Number.NEGATIVE_INFINITY,this.fi=e=>Promise.resolve(),!Ga.D())throw new L(O.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new pa(this,r),this.gi=t+Ka,this.serializer=new Yo(a),this.pi=new Te(this.gi,this.di,new Va(this.serializer)),this.jr=new ps,this.Hr=new ra(this.referenceDelegate,this.serializer),this.remoteDocumentCache=va(this.serializer),this.Yr=new cs,this.window&&this.window.localStorage?this.yi=this.window.localStorage:(this.yi=null,!1===c&&C($a,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.wi().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new L(O.FAILED_PRECONDITION,Ha);return this.Si(),this.bi(),this.Di(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.Hr.getHighestSequenceNumber(e)))})).then((e=>{this.Gr=new ze(e,this.Ii)})).then((()=>{this.zr=!0})).catch((e=>(this.pi&&this.pi.close(),Promise.reject(e))))}Ci(e){return this.fi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.pi.k((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Ti.enqueueAndForget((async()=>{this.started&&await this.wi()})))}wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>Qa(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Fi(e).next((e=>{e||(this.isPrimary=!1,this.Ti.enqueueRetryable((()=>this.fi(!1))))}))})).next((()=>this.Mi(e))).next((t=>this.isPrimary&&!t?this.xi(e).next((()=>!1)):!!t&&this.Oi(e).next((()=>!0)))))).catch((e=>{if(Ne(e))return k($a,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return k($a,"Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Ti.enqueueRetryable((()=>this.fi(e))),this.isPrimary=e}))}Fi(e){return Wa(e).get(Je).next((e=>Se.resolve(this.Ni(e))))}Bi(e){return Qa(e).delete(this.clientId)}async Li(){if(this.isPrimary&&!this.ki(this.mi,Ba)){this.mi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=Zt(e,_t);return t.G().next((e=>{const n=this.qi(e,Ba),r=e.filter((e=>-1===n.indexOf(e)));return Se.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.yi)for(const t of e)this.yi.removeItem(this.Qi(t.clientId))}}Di(){this.Vi=this.Ti.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.wi().then((()=>this.Li())).then((()=>this.Di()))))}Ni(e){return!!e&&e.ownerId===this.clientId}Mi(e){return this.Ei?Se.resolve(!0):Wa(e).get(Je).next((t=>{if(null!==t&&this.ki(t.leaseTimestampMs,qa)&&!this.$i(t.ownerId)){if(this.Ni(t)&&this.networkEnabled)return!0;if(!this.Ni(t)){if(!t.allowTabSynchronization)throw new L(O.FAILED_PRECONDITION,Ha);return!1}}return!(!this.networkEnabled||!this.inForeground)||Qa(e).G().next((e=>void 0===this.qi(e,qa).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&k($a,`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.zr=!1,this.Ui(),this.Vi&&(this.Vi.cancel(),this.Vi=null),this.Ki(),this.Wi(),await this.pi.runTransaction("shutdown","readwrite",[Qe,_t],(e=>{const t=new Xt(e,ze.ae);return this.xi(t).next((()=>this.Bi(t)))})),this.pi.close(),this.Gi()}qi(e,t){return e.filter((e=>this.ki(e.updateTimeMs,t)&&!this.$i(e.clientId)))}zi(){return this.runTransaction("getActiveClients","readonly",(e=>Qa(e).G().next((e=>this.qi(e,Ba).map((e=>e.clientId))))))}get started(){return this.zr}getGlobalsCache(){return this.jr}getMutationQueue(e,t){return Ys.It(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Vs(e,this.serializer.Tt.databaseId)}getDocumentOverlayCache(e){return hs.It(this.serializer,e)}getBundleCache(){return this.Yr}runTransaction(e,t,n){k($a,"Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=function(e){return 17===e?Yt:16===e?Jt:15===e?Qt:14===e?Wt:13===e?Gt:12===e?Kt:11===e?Ht:void D()}(this.di);let o;return this.pi.runTransaction(e,r,i,(r=>(o=new Xt(r,this.Gr?this.Gr.next():ze.ae),"readwrite-primary"===t?this.Fi(o).next((e=>!!e||this.Mi(o))).next((t=>{if(!t)throw C(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Ti.enqueueRetryable((()=>this.fi(!1))),new L(O.FAILED_PRECONDITION,we);return n(o)})).next((e=>this.Oi(o).next((()=>e)))):this.ji(o).next((()=>n(o)))))).then((e=>(o.raiseOnCommittedEvent(),e)))}ji(e){return Wa(e).get(Je).next((e=>{if(null!==e&&this.ki(e.leaseTimestampMs,qa)&&!this.$i(e.ownerId)&&!this.Ni(e)&&!(this.Ei||this.allowTabSynchronization&&e.allowTabSynchronization))throw new L(O.FAILED_PRECONDITION,Ha)}))}Oi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Wa(e).put(Je,t)}static D(){return Te.D()}xi(e){const t=Wa(e);return t.get(Je).next((e=>this.Ni(e)?(k($a,"Releasing primary lease."),t.delete(Je)):Se.resolve()))}ki(e,t){const n=Date.now();return!(e<n-t)&&(!(e>n)||(C(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Si(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ri=()=>{this.Ti.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.wi())))},this.document.addEventListener("visibilitychange",this.Ri),this.inForeground="visible"===this.document.visibilityState)}Ki(){this.Ri&&(this.document.removeEventListener("visibilitychange",this.Ri),this.Ri=null)}bi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Ai=()=>{this.Ui();const e=/(?:Version|Mobile)\/1[456]/;(0,l.nr)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Ti.enterRestrictedMode(!0),this.Ti.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.Ai))}Wi(){this.Ai&&(this.window.removeEventListener("pagehide",this.Ai),this.Ai=null)}$i(e){var t;try{const n=null!==(null===(t=this.yi)||void 0===t?void 0:t.getItem(this.Qi(e)));return k($a,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return C($a,"Failed to get zombied client id.",e),!1}}Ui(){if(this.yi)try{this.yi.setItem(this.Qi(this.clientId),String(Date.now()))}catch(e){C("Failed to set zombie client id.",e)}}Gi(){if(this.yi)try{this.yi.removeItem(this.Qi(this.clientId))}catch(e){}}Qi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Wa(e){return Zt(e,Qe)}function Qa(e){return Zt(e,_t)}function Ja(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class Ya{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Hi=n,this.Ji=r}static Yi(e,t){let n=di(),r=di();for(const i of t.docChanges)switch(i.type){case 0:n=n.add(i.doc.key);break;case 1:r=r.add(i.doc.key)}return new Ya(e,t.fromCache,n,r)}}class Xa{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Za{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=(0,l.nr)()?8:ke((0,l.ZQ)())>0?6:4}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.rs(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.ss(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new Xa;return this._s(e,t,n).next((r=>{if(i.result=r,this.Xi)return this.us(e,t,n,r.size)}))})).next((()=>i.result))}us(e,t,n,r){return n.documentReadCount<this.es?(T()<=a.$b.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",Qr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),Se.resolve()):(T()<=a.$b.DEBUG&&k("QueryEngine","Query:",Qr(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ts*r?(T()<=a.$b.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",Qr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Br(t))):Se.resolve())}rs(e,t){if(Vr(t))return Se.resolve(null);let n=Br(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=Kr(t,null,"F"),n=Br(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=di(...r);return this.ns.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const o=this.cs(t,r);return this.ls(t,o,i,n.readTime)?this.rs(e,Kr(t,null,"F")):this.hs(e,o,t,n)}))))})))))}ss(e,t,n,r){return Vr(t)||r.isEqual(re.min())?Se.resolve(null):this.ns.getDocuments(e,n).next((i=>{const o=this.cs(t,i);return this.ls(t,o,n,r)?Se.resolve(null):(T()<=a.$b.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Qr(t)),this.hs(e,o,t,me(r,ue)).next((e=>e)))}))}cs(e,t){let n=new an(Xr(e));return t.forEach(((t,r)=>{Jr(e,r)&&(n=n.add(r))})),n}ls(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}_s(e,t,n){return T()<=a.$b.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",Qr(t)),this.ns.getDocumentsMatchingQuery(e,t,ve.min(),n)}hs(e,t,n,r){return this.ns.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}const el="LocalStore",tl=3e8;class nl{constructor(e,t,n,r){this.persistence=e,this.Ps=t,this.serializer=r,this.Ts=new rn(W),this.Is=new ei((e=>Dr(e)),Pr),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(n)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ta(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ts)))}}function rl(e,t,n,r){return new nl(e,t,n,r)}async function il(e,t){const n=R(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.As(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],o=[];let s=di();for(const e of r){i.push(e.batchId);for(const t of e.mutations)s=s.add(t.key)}for(const e of t){o.push(e.batchId);for(const t of e.mutations)s=s.add(t.key)}return n.localDocuments.getDocuments(e,s).next((e=>({Rs:e,removedBatchIds:i,addedBatchIds:o})))}))}))}function ol(e){const t=R(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Hr.getLastRemoteSnapshotVersion(e)))}function sl(e,t,n){let r=di(),i=di();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=ni();return n.forEach(((n,o)=>{const s=e.get(n);o.isFoundDocument()!==s.isFoundDocument()&&(i=i.add(n)),o.isNoDocument()&&o.version.isEqual(re.min())?(t.removeEntry(n,o.readTime),r=r.insert(n,o)):!s.isValidDocument()||o.version.compareTo(s.version)>0||0===o.version.compareTo(s.version)&&s.hasPendingWrites?(t.addEntry(o),r=r.insert(n,o)):k(el,"Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",o.version)})),{Vs:r,fs:i}}))}function al(e,t){const n=R(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=Fe),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}function ll(e,t){const n=R(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Hr.getTargetData(e,t).next((i=>i?(r=i,Se.resolve(r)):n.Hr.allocateTargetId(e).next((i=>(r=new Jo(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Hr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Ts.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ts=n.Ts.insert(e.targetId,e),n.Is.set(t,e.targetId)),e}))}async function cl(e,t,n){const r=R(e),i=r.Ts.get(t),o=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",o,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!Ne(e))throw e;k(el,`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ts=r.Ts.remove(t),r.Is.delete(i.target)}function ul(e,t,n){const r=R(e);let i=re.min(),o=di();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=R(e),i=r.Is.get(n);return void 0!==i?Se.resolve(r.Ts.get(i)):r.Hr.getTargetData(t,n)}(r,e,Br(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Hr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{o=e}))})).next((()=>r.Ps.getDocumentsMatchingQuery(e,t,n?i:re.min(),n?o:di()))).next((e=>(dl(r,Yr(t),e),{documents:e,gs:o})))))}function dl(e,t,n){let r=e.Es.get(t)||re.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Es.set(t,r)}class hl{constructor(){this.activeTargetIds=fi()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class fl{constructor(){this.ho=new hl,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,n){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new hl,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class pl{To(e){}shutdown(){}}const gl="ConnectivityMonitor";class ml{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){k(gl,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){k(gl,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let yl=null;function vl(){return null===yl?yl=268435456+Math.round(2147483648*Math.random()):yl++,"0x"+yl.toString(16)}const bl="RestConnection",wl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class xl{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${n}/databases/${r}`,this.wo=this.databaseId.database===_n?`project_id=${n}`:`project_id=${n}&database_id=${r}`}So(e,t,n,r,i){const o=vl(),s=this.bo(e,t.toUriEncodedString());k(bl,`Sending RPC '${e}' ${o}:`,s,n);const a={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(a,r,i),this.vo(e,s,a,n).then((t=>(k(bl,`Received RPC '${e}' ${o}: `,t),t)),(t=>{throw A(bl,`RPC '${e}' ${o} failed with error: `,t,"url: ",s,"request:",n),t}))}Co(e,t,n,r,i,o){return this.So(e,t,n,r,i)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+E,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}bo(e,t){const n=wl[e];return`${this.po}/v1/${t}:${n}`}terminate(){}}class Il{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}const Sl="WebChannelConnection";class El extends xl{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,n,r){const i=vl();return new Promise(((o,s)=>{const a=new d;a.setWithCredentials(!0),a.listenOnce(f.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case p.NO_ERROR:const t=a.getResponseJson();k(Sl,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),o(t);break;case p.TIMEOUT:k(Sl,`RPC '${e}' ${i} timed out`),s(new L(O.DEADLINE_EXCEEDED,"Request time out"));break;case p.HTTP_ERROR:const n=a.getStatus();if(k(Sl,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(O).indexOf(t)>=0?t:O.UNKNOWN}(t.status);s(new L(e,t.message))}else s(new L(O.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new L(O.UNAVAILABLE,"Connection failed."));break;default:D()}}finally{k(Sl,`RPC '${e}' ${i} completed.`)}}));const l=JSON.stringify(r);k(Sl,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",l,n,15)}))}Wo(e,t,n){const r=vl(),i=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=v(),s=y(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const c=i.join("");k(Sl,`Creating RPC '${e}' stream ${r}: ${c}`,a);const u=o.createWebChannel(c,a);let d=!1,f=!1;const p=new Il({Fo:t=>{f?k(Sl,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(d||(k(Sl,`Opening RPC '${e}' stream ${r} transport.`),u.open(),d=!0),k(Sl,`RPC '${e}' stream ${r} sending:`,t),u.send(t))},Mo:()=>u.close()}),b=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return b(u,h.EventType.OPEN,(()=>{f||(k(Sl,`RPC '${e}' stream ${r} transport opened.`),p.Qo())})),b(u,h.EventType.CLOSE,(()=>{f||(f=!0,k(Sl,`RPC '${e}' stream ${r} transport closed`),p.Uo())})),b(u,h.EventType.ERROR,(t=>{f||(f=!0,A(Sl,`RPC '${e}' stream ${r} transport errored:`,t),p.Uo(new L(O.UNAVAILABLE,"The operation could not be completed")))})),b(u,h.EventType.MESSAGE,(t=>{var n;if(!f){const i=t.data[0];P(!!i);const o=i,s=(null==o?void 0:o.error)||(null===(n=o[0])||void 0===n?void 0:n.error);if(s){k(Sl,`RPC '${e}' stream ${r} received error:`,s);const t=s.status;let n=function(e){const t=Ji[e];if(void 0!==t)return Zi(t)}(t),i=s.message;void 0===n&&(n=O.INTERNAL,i="Unknown error status: "+t+" with message "+s.message),f=!0,p.Uo(new L(n,i)),u.close()}else k(Sl,`RPC '${e}' stream ${r} received:`,i),p.Ko(i)}})),b(s,m.STAT_EVENT,(t=>{t.stat===g.PROXY?k(Sl,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===g.NOPROXY&&k(Sl,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{p.$o()}),0),p}}function _l(){return"undefined"!=typeof window?window:null}function Tl(){return"undefined"!=typeof document?document:null}function kl(e){return new bo(e,!0)}class Cl{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.Ti=e,this.timerId=t,this.Go=n,this.zo=r,this.jo=i,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const t=Math.floor(this.Ho+this.e_()),n=Math.max(0,Date.now()-this.Yo),r=Math.max(0,t-n);r>0&&k("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,r,(()=>(this.Yo=Date.now(),e()))),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){null!==this.Jo&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){null!==this.Jo&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}const Al="PersistentStream";class Nl{constructor(e,t,n,r,i,o,s,a){this.Ti=e,this.n_=n,this.r_=r,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=s,this.listener=a,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Cl(e,t)}u_(){return 1===this.state||5===this.state||this.c_()}c_(){return 2===this.state||3===this.state}start(){this.__=0,4!==this.state?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&null===this.s_&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,(()=>this.T_())))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,t){this.E_(),this.d_(),this.a_.cancel(),this.i_++,4!==e?this.a_.reset():t&&t.code===O.RESOURCE_EXHAUSTED?(C(t.toString()),C("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===O.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(t)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),t=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((e=>{let[n,r]=e;this.i_===t&&this.V_(n,r)}),(t=>{e((()=>{const e=new L(O.UNKNOWN,"Fetching auth token failed: "+t.message);return this.m_(e)}))}))}V_(e,t){const n=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo((()=>{n((()=>this.listener.xo()))})),this.stream.No((()=>{n((()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,(()=>(this.c_()&&(this.state=3),Promise.resolve()))),this.listener.No())))})),this.stream.Lo((e=>{n((()=>this.m_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.__?this.g_(e):this.onNext(e)))}))}l_(){this.state=5,this.a_.Xo((async()=>{this.state=0,this.start()}))}m_(e){return k(Al,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return t=>{this.Ti.enqueueAndForget((()=>this.i_===e?t():(k(Al,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Dl extends Nl{constructor(e,t,n,r,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,o),this.serializer=i}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:D()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=function(e,t){return e.useProto3Json?(P(void 0===t||"string"==typeof t),hn.fromBase64String(t||"")):(P(void 0===t||t instanceof Buffer||t instanceof Uint8Array),hn.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),s=t.targetChange.cause,a=s&&function(e){const t=void 0===e.code?O.UNKNOWN:Zi(e.code);return new L(t,e.message||"")}(s);n=new uo(r,i,o,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Ao(e,r.document.name),o=Eo(r.document.updateTime),s=r.document.createTime?Eo(r.document.createTime):re.min(),a=new nr({mapValue:{fields:r.document.fields}}),l=ir.newFoundDocument(i,o,s,a),c=r.targetIds||[],u=r.removedTargetIds||[];n=new lo(c,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Ao(e,r.document),o=r.readTime?Eo(r.readTime):re.min(),s=ir.newNoDocument(i,o),a=r.removedTargetIds||[];n=new lo([],a,s.key,s)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Ao(e,r.document),o=r.removedTargetIds||[];n=new lo([],o,i,null)}else{if(!("filter"in t))return D();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,o=new Qi(r,i),s=e.targetId;n=new co(s,o)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return re.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?re.min():t.readTime?Eo(t.readTime):re.min()}(e);return this.listener.p_(t,n)}y_(e){const t={};t.database=Po(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Rr(r)?{documents:zo(e,r)}:{query:Fo(e,r).ht},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Io(e,t.resumeToken);const r=wo(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(re.min())>0){n.readTime=xo(e,t.snapshotVersion.toTimestamp());const r=wo(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return D()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.I_(t)}w_(e){const t={};t.database=Po(this.serializer),t.removeTarget=e,this.I_(t)}}class Pl extends Nl{constructor(e,t,n,r,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,o),this.serializer=i}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,t){return this.connection.Wo("Write",e,t)}g_(e){return P(!!e.streamToken),this.lastStreamToken=e.streamToken,P(!e.writeResults||0===e.writeResults.length),this.listener.D_()}onNext(e){P(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const t=function(e,t){return e&&e.length>0?(P(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Eo(e.updateTime):Eo(t);return n.isEqual(re.min())&&(n=Eo(t)),new Ni(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Eo(e.commitTime);return this.listener.v_(n,t)}C_(){const e={};e.database=Po(this.serializer),this.I_(e)}b_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>jo(this.serializer,e)))};this.I_(t)}}class Rl{}class Ol extends Rl{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.F_=!1}M_(){if(this.F_)throw new L(O.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,r){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((i=>{let[o,s]=i;return this.connection.So(e,To(t,n),r,o,s)})).catch((e=>{throw"FirebaseError"===e.name?(e.code===O.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new L(O.UNKNOWN,e.toString())}))}Co(e,t,n,r,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((o=>{let[s,a]=o;return this.connection.Co(e,To(t,n),r,s,a,i)})).catch((e=>{throw"FirebaseError"===e.name?(e.code===O.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new L(O.UNKNOWN,e.toString())}))}terminate(){this.F_=!0,this.connection.terminate()}}class Ll{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){0===this.x_&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve()))))}q_(e){"Online"===this.state?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,"Online"===e&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(C(t),this.N_=!1):k("OnlineStateTracker",t)}Q_(){null!==this.O_&&(this.O_.cancel(),this.O_=null)}}const jl="RemoteStore";class Ml{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=i,this.z_.To((e=>{n.enqueueAndForget((async()=>{Kl(this)&&(k(jl,"Restarting streams for network reachability change."),await async function(e){const t=R(e);t.W_.add(4),await Fl(t),t.j_.set("Unknown"),t.W_.delete(4),await zl(t)}(this))}))})),this.j_=new Ll(n,r)}}async function zl(e){if(Kl(e))for(const t of e.G_)await t(!0)}async function Fl(e){for(const t of e.G_)await t(!1)}function Vl(e,t){const n=R(e);n.K_.has(t.targetId)||(n.K_.set(t.targetId,t),Hl(n)?ql(n):dc(n).c_()&&$l(n,t))}function Ul(e,t){const n=R(e),r=dc(n);n.K_.delete(t),r.c_()&&Bl(n,t),0===n.K_.size&&(r.c_()?r.P_():Kl(n)&&n.j_.set("Unknown"))}function $l(e,t){if(e.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(re.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}dc(e).y_(t)}function Bl(e,t){e.H_.Ne(t),dc(e).w_(t)}function ql(e){e.H_=new fo({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>e.K_.get(t)||null,it:()=>e.datastore.serializer.databaseId}),dc(e).start(),e.j_.B_()}function Hl(e){return Kl(e)&&!dc(e).u_()&&e.K_.size>0}function Kl(e){return 0===R(e).W_.size}function Gl(e){e.H_=void 0}async function Wl(e){e.j_.set("Online")}async function Ql(e){e.K_.forEach(((t,n)=>{$l(e,t)}))}async function Jl(e,t){Gl(e),Hl(e)?(e.j_.q_(t),ql(e)):e.j_.set("Unknown")}async function Yl(e,t,n){if(e.j_.set("Online"),t instanceof uo&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.K_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.K_.delete(r),e.H_.removeTarget(r))}(e,t)}catch(n){k(jl,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Xl(e,n)}else if(t instanceof lo?e.H_.We(t):t instanceof co?e.H_.Ze(t):e.H_.je(t),!n.isEqual(re.min()))try{const t=await ol(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.H_.ot(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.K_.get(r);i&&e.K_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.K_.get(t);if(!r)return;e.K_.set(t,r.withResumeToken(hn.EMPTY_BYTE_STRING,r.snapshotVersion)),Bl(e,t);const i=new Jo(r.target,t,n,r.sequenceNumber);$l(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){k(jl,"Failed to raise snapshot:",t),await Xl(e,t)}}async function Xl(e,t,n){if(!Ne(t))throw t;e.W_.add(1),await Fl(e),e.j_.set("Offline"),n||(n=()=>ol(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{k(jl,"Retrying IndexedDB access"),await n(),e.W_.delete(1),await zl(e)}))}function Zl(e,t){return t().catch((n=>Xl(e,n,t)))}async function ec(e){const t=R(e),n=hc(t);let r=t.U_.length>0?t.U_[t.U_.length-1].batchId:Fe;for(;tc(t);)try{const e=await al(t.localStore,r);if(null===e){0===t.U_.length&&n.P_();break}r=e.batchId,nc(t,e)}catch(e){await Xl(t,e)}rc(t)&&ic(t)}function tc(e){return Kl(e)&&e.U_.length<10}function nc(e,t){e.U_.push(t);const n=hc(e);n.c_()&&n.S_&&n.b_(t.mutations)}function rc(e){return Kl(e)&&!hc(e).u_()&&e.U_.length>0}function ic(e){hc(e).start()}async function oc(e){hc(e).C_()}async function sc(e){const t=hc(e);for(const n of e.U_)t.b_(n.mutations)}async function ac(e,t,n){const r=e.U_.shift(),i=Gi.from(r,t,n);await Zl(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await ec(e)}async function lc(e,t){t&&hc(e).S_&&await async function(e,t){if(function(e){return Xi(e)&&e!==O.ABORTED}(t.code)){const n=e.U_.shift();hc(e).h_(),await Zl(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await ec(e)}}(e,t),rc(e)&&ic(e)}async function cc(e,t){const n=R(e);n.asyncQueue.verifyOperationInProgress(),k(jl,"RemoteStore received new credentials");const r=Kl(n);n.W_.add(3),await Fl(n),r&&n.j_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.W_.delete(3),await zl(n)}async function uc(e,t){const n=R(e);t?(n.W_.delete(2),await zl(n)):t||(n.W_.add(2),await Fl(n),n.j_.set("Unknown"))}function dc(e){return e.J_||(e.J_=function(e,t,n){const r=R(e);return r.M_(),new Dl(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{xo:Wl.bind(null,e),No:Ql.bind(null,e),Lo:Jl.bind(null,e),p_:Yl.bind(null,e)}),e.G_.push((async t=>{t?(e.J_.h_(),Hl(e)?ql(e):e.j_.set("Unknown")):(await e.J_.stop(),Gl(e))}))),e.J_}function hc(e){return e.Y_||(e.Y_=function(e,t,n){const r=R(e);return r.M_(),new Pl(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{xo:()=>Promise.resolve(),No:oc.bind(null,e),Lo:lc.bind(null,e),D_:sc.bind(null,e),v_:ac.bind(null,e)}),e.G_.push((async t=>{t?(e.Y_.h_(),await ec(e)):(await e.Y_.stop(),e.U_.length>0&&(k(jl,`Stopping write stream with ${e.U_.length} pending writes`),e.U_=[]))}))),e.Y_}class fc{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new j,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const o=Date.now()+n,s=new fc(e,t,o,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new L(O.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function pc(e,t){if(C("AsyncQueue",`${t}: ${e}`),Ne(e))return new L(O.UNAVAILABLE,`${t}: ${e}`);throw e}class gc{static emptySet(e){return new gc(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||ce.comparator(t.key,n.key):(e,t)=>ce.comparator(e.key,t.key),this.keyedMap=ii(),this.sortedSet=new rn(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof gc))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new gc;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class mc{constructor(){this.Z_=new rn(ce.comparator)}track(e){const t=e.doc.key,n=this.Z_.get(t);n?0!==e.type&&3===n.type?this.Z_=this.Z_.insert(t,e):3===e.type&&1!==n.type?this.Z_=this.Z_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Z_=this.Z_.remove(t):1===e.type&&2===n.type?this.Z_=this.Z_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):D():this.Z_=this.Z_.insert(t,e)}X_(){const e=[];return this.Z_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class yc{constructor(e,t,n,r,i,o,s,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){const o=[];return t.forEach((e=>{o.push({type:0,doc:e})})),new yc(e,t,gc.emptySet(t),o,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Gr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}class vc{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some((e=>e.ra()))}}class bc{constructor(){this.queries=wc(),this.onlineState="Unknown",this.ia=new Set}terminate(){!function(e,t){const n=R(e),r=n.queries;n.queries=wc(),r.forEach(((e,n)=>{for(const r of n.ta)r.onError(t)}))}(this,new L(O.ABORTED,"Firestore shutting down"))}}function wc(){return new ei((e=>Wr(e)),Gr)}async function xc(e,t){const n=R(e);let r=3;const i=t.query;let o=n.queries.get(i);o?!o.na()&&t.ra()&&(r=2):(o=new vc,r=t.ra()?0:1);try{switch(r){case 0:o.ea=await n.onListen(i,!0);break;case 1:o.ea=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=pc(e,`Initialization of query '${Qr(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,o),o.ta.push(t),t.sa(n.onlineState),o.ea&&t.oa(o.ea)&&_c(n)}async function Ic(e,t){const n=R(e),r=t.query;let i=3;const o=n.queries.get(r);if(o){const e=o.ta.indexOf(t);e>=0&&(o.ta.splice(e,1),0===o.ta.length?i=t.ra()?0:1:!o.na()&&t.ra()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Sc(e,t){const n=R(e);let r=!1;for(const i of t){const e=i.query,t=n.queries.get(e);if(t){for(const e of t.ta)e.oa(i)&&(r=!0);t.ea=i}}r&&_c(n)}function Ec(e,t,n){const r=R(e),i=r.queries.get(t);if(i)for(const o of i.ta)o.onError(n);r.queries.delete(t)}function _c(e){e.ia.forEach((e=>{e.next()}))}var Tc,kc;(kc=Tc||(Tc={}))._a="default",kc.Cache="cache";class Cc{constructor(e,t,n){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=n||{}}oa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new yc(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ua?this.la(e)&&(this.aa.next(e),t=!0):this.ha(e,this.onlineState)&&(this.Pa(e),t=!0),this.ca=e,t}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){if(!e.fromCache)return!0;if(!this.ra())return!0;const n="Offline"!==t;return(!this.options.Ta||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}la(e){if(e.docChanges.length>0)return!0;const t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Pa(e){e=yc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==Tc.Cache}}class Ac{constructor(e){this.key=e}}class Nc{constructor(e){this.key=e}}class Dc{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=di(),this.mutatedKeys=di(),this.ya=Xr(e),this.wa=new gc(this.ya)}get Sa(){return this.fa}ba(e,t){const n=t?t.Da:new mc,r=t?t.wa:this.wa;let i=t?t.mutatedKeys:this.mutatedKeys,o=r,s=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const c=r.get(e),u=Jr(this.query,t)?t:null,d=!!c&&this.mutatedKeys.has(c.key),h=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;c&&u?c.data.isEqual(u.data)?d!==h&&(n.track({type:3,doc:u}),f=!0):this.va(c,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.ya(u,a)>0||l&&this.ya(u,l)<0)&&(s=!0)):!c&&u?(n.track({type:0,doc:u}),f=!0):c&&!u&&(n.track({type:1,doc:c}),f=!0,(a||l)&&(s=!0)),f&&(u?(o=o.add(u),i=h?i.add(e):i.delete(e)):(o=o.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;o.size>this.query.limit;){const e="F"===this.query.limitType?o.last():o.first();o=o.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{wa:o,Da:n,ls:s,mutatedKeys:i}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const o=e.Da.X_();o.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return D()}};return n(e)-n(t)}(e.type,t.type)||this.ya(e.doc,t.doc))),this.Ca(n),r=null!=r&&r;const s=t&&!r?this.Fa():[],a=0===this.pa.size&&this.current&&!r?1:0,l=a!==this.ga;return this.ga=a,0!==o.length||l?{snapshot:new yc(this.query,e.wa,i,o,e.mutatedKeys,0===a,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ma:s}:{Ma:s}}sa(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({wa:this.wa,Da:new mc,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach((e=>this.fa=this.fa.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.fa=this.fa.delete(e))),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=di(),this.wa.forEach((e=>{this.xa(e.key)&&(this.pa=this.pa.add(e.key))}));const t=[];return e.forEach((e=>{this.pa.has(e)||t.push(new Nc(e))})),this.pa.forEach((n=>{e.has(n)||t.push(new Ac(n))})),t}Oa(e){this.fa=e.gs,this.pa=di();const t=this.ba(e.documents);return this.applyChanges(t,!0)}Na(){return yc.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,0===this.ga,this.hasCachedResults)}}const Pc="SyncEngine";class Rc{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Oc{constructor(e){this.key=e,this.Ba=!1}}class Lc{constructor(e,t,n,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.La={},this.ka=new ei((e=>Wr(e)),Gr),this.qa=new Map,this.Qa=new Set,this.$a=new rn(ce.comparator),this.Ua=new Map,this.Ka=new Na,this.Wa={},this.Ga=new Map,this.za=na.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return!0===this.ja}}async function jc(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=ru(e);let i;const o=r.ka.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.view.Na()):i=await zc(r,t,n,!0),i}async function Mc(e,t){const n=ru(e);await zc(n,t,!0,!1)}async function zc(e,t,n,r){const i=await ll(e.localStore,Br(t)),o=i.targetId,s=e.sharedClientState.addLocalQueryTarget(o,n);let a;return r&&(a=await Fc(e,t,o,"current"===s,i.resumeToken)),e.isPrimaryClient&&n&&Vl(e.remoteStore,i),a}async function Fc(e,t,n,r,i){e.Ha=(t,n,r)=>async function(e,t,n,r){let i=t.view.ba(n);i.ls&&(i=await ul(e.localStore,t.query,!1).then((e=>{let{documents:n}=e;return t.view.ba(n,i)})));const o=r&&r.targetChanges.get(t.targetId),s=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,o,s);return Yc(e,t.targetId,a.Ma),a.snapshot}(e,t,n,r);const o=await ul(e.localStore,t,!0),s=new Dc(t,o.gs),a=s.ba(o.documents),l=ao.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),c=s.applyChanges(a,e.isPrimaryClient,l);Yc(e,n,c.Ma);const u=new Rc(t,n,s);return e.ka.set(t,u),e.qa.has(n)?e.qa.get(n).push(t):e.qa.set(n,[t]),c.snapshot}async function Vc(e,t,n){const r=R(e),i=r.ka.get(t),o=r.qa.get(i.targetId);if(o.length>1)return r.qa.set(i.targetId,o.filter((e=>!Gr(e,t)))),void r.ka.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await cl(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Ul(r.remoteStore,i.targetId),Qc(r,i.targetId)})).catch(Ie)):(Qc(r,i.targetId),await cl(r.localStore,i.targetId,!0))}async function Uc(e,t){const n=R(e),r=n.ka.get(t),i=n.qa.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Ul(n.remoteStore,r.targetId))}async function $c(e,t){const n=R(e);try{const e=await function(e,t){const n=R(e),r=t.snapshotVersion;let i=n.Ts;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const o=n.ds.newChangeBuffer({trackRemovals:!0});i=n.Ts;const s=[];t.targetChanges.forEach(((o,a)=>{const l=i.get(a);if(!l)return;s.push(n.Hr.removeMatchingKeys(e,o.removedDocuments,a).next((()=>n.Hr.addMatchingKeys(e,o.addedDocuments,a))));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?c=c.withResumeToken(hn.EMPTY_BYTE_STRING,re.min()).withLastLimboFreeSnapshotVersion(re.min()):o.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(o.resumeToken,r)),i=i.insert(a,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=tl||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(l,c,o)&&s.push(n.Hr.updateTargetData(e,c))}));let a=ni(),l=di();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),s.push(sl(e,o,t.documentUpdates).next((e=>{a=e.Vs,l=e.fs}))),!r.isEqual(re.min())){const t=n.Hr.getLastRemoteSnapshotVersion(e).next((t=>n.Hr.setTargetsMetadata(e,e.currentSequenceNumber,r)));s.push(t)}return Se.waitFor(s).next((()=>o.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,l))).next((()=>a))})).then((e=>(n.Ts=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Ua.get(t);r&&(P(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.Ba=!0:e.modifiedDocuments.size>0?P(r.Ba):e.removedDocuments.size>0&&(P(r.Ba),r.Ba=!1))})),await eu(n,e,t)}catch(e){await Ie(e)}}function Bc(e,t,n){const r=R(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ka.forEach(((n,r)=>{const i=r.view.sa(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=R(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const i of n.ta)i.sa(t)&&(r=!0)})),r&&_c(n)}(r.eventManager,t),e.length&&r.La.p_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function qc(e,t,n){const r=R(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Ua.get(t),o=i&&i.key;if(o){let e=new rn(ce.comparator);e=e.insert(o,ir.newNoDocument(o,re.min()));const n=di().add(o),i=new so(re.min(),new Map,new rn(W),e,n);await $c(r,i),r.$a=r.$a.remove(o),r.Ua.delete(t),Zc(r)}else await cl(r.localStore,t,!1).then((()=>Qc(r,t,n))).catch(Ie)}async function Hc(e,t){const n=R(e),r=t.batch.batchId;try{const e=await function(e,t){const n=R(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.ds.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,o=i.keys();let s=Se.resolve();return o.forEach((e=>{s=s.next((()=>r.getEntry(t,e))).next((t=>{const o=n.docVersions.get(e);P(null!==o),t.version.compareTo(o)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),s.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=di();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);Wc(n,r,null),Gc(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await eu(n,e)}catch(e){await Ie(e)}}async function Kc(e,t,n){const r=R(e);try{const e=await function(e,t){const n=R(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(P(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);Wc(r,t,n),Gc(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await eu(r,e)}catch(n){await Ie(n)}}function Gc(e,t){(e.Ga.get(t)||[]).forEach((e=>{e.resolve()})),e.Ga.delete(t)}function Wc(e,t,n){const r=R(e);let i=r.Wa[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Wa[r.currentUser.toKey()]=i}}function Qc(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.qa.get(t))e.ka.delete(r),n&&e.La.Ja(r,n);e.qa.delete(t),e.isPrimaryClient&&e.Ka.br(t).forEach((t=>{e.Ka.containsKey(t)||Jc(e,t)}))}function Jc(e,t){e.Qa.delete(t.path.canonicalString());const n=e.$a.get(t);null!==n&&(Ul(e.remoteStore,n),e.$a=e.$a.remove(t),e.Ua.delete(n),Zc(e))}function Yc(e,t,n){for(const r of n)r instanceof Ac?(e.Ka.addReference(r.key,t),Xc(e,r)):r instanceof Nc?(k(Pc,"Document no longer in limbo: "+r.key),e.Ka.removeReference(r.key,t),e.Ka.containsKey(r.key)||Jc(e,r.key)):D()}function Xc(e,t){const n=t.key,r=n.path.canonicalString();e.$a.get(n)||e.Qa.has(r)||(k(Pc,"New document in limbo: "+n),e.Qa.add(r),Zc(e))}function Zc(e){for(;e.Qa.size>0&&e.$a.size<e.maxConcurrentLimboResolutions;){const t=e.Qa.values().next().value;e.Qa.delete(t);const n=new ce(se.fromString(t)),r=e.za.next();e.Ua.set(r,new Oc(n)),e.$a=e.$a.insert(n,r),Vl(e.remoteStore,new Jo(Br(Fr(n.path)),r,"TargetPurposeLimboResolution",ze.ae))}}async function eu(e,t,n){const r=R(e),i=[],o=[],s=[];r.ka.isEmpty()||(r.ka.forEach(((e,a)=>{s.push(r.Ha(a,t,n).then((e=>{var t;if((e||n)&&r.isPrimaryClient){const i=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(e){i.push(e);const t=Ya.Yi(a.targetId,e);o.push(t)}})))})),await Promise.all(s),r.La.p_(i),await async function(e,t){const n=R(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Se.forEach(t,(t=>Se.forEach(t.Hi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Se.forEach(t.Ji,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Ne(e))throw e;k(el,"Failed to update sequence numbers: "+e)}for(const r of t){const e=r.targetId;if(!r.fromCache){const t=n.Ts.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.Ts=n.Ts.insert(e,i)}}}(r.localStore,o))}async function tu(e,t){const n=R(e);if(!n.currentUser.isEqual(t)){k(Pc,"User change. New user:",t.toKey());const e=await il(n.localStore,t);n.currentUser=t,function(e,t){e.Ga.forEach((e=>{e.forEach((e=>{e.reject(new L(O.CANCELLED,t))}))})),e.Ga.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await eu(n,e.Rs)}}function nu(e,t){const n=R(e),r=n.Ua.get(t);if(r&&r.Ba)return di().add(r.key);{let e=di();const r=n.qa.get(t);if(!r)return e;for(const t of r){const r=n.ka.get(t);e=e.unionWith(r.view.Sa)}return e}}function ru(e){const t=R(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=$c.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=nu.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=qc.bind(null,t),t.La.p_=Sc.bind(null,t.eventManager),t.La.Ja=Ec.bind(null,t.eventManager),t}function iu(e){const t=R(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Hc.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Kc.bind(null,t),t}class ou{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=kl(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,t){return null}nu(e,t){return null}eu(e){return rl(this.persistence,new Za,e.initialUser,this.serializer)}Xa(e){return new ja(za.ri,this.serializer)}Za(e){return new fl}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ou.provider={build:()=>new ou};class su extends ou{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){P(this.persistence.referenceDelegate instanceof Fa);const n=this.persistence.referenceDelegate.garbageCollector;return new da(n,e.asyncQueue,t)}Xa(e){const t=void 0!==this.cacheSizeBytes?Ws.withCacheSize(this.cacheSizeBytes):Ws.DEFAULT;return new ja((e=>Fa.ri(e,t)),this.serializer)}}class au extends ou{constructor(e,t,n){super(),this.ru=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.ru.initialize(this,e),await iu(this.ru.syncEngine),await ec(this.ru.remoteStore),await this.persistence.Ci((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve())))}eu(e){return rl(this.persistence,new Za,e.initialUser,this.serializer)}tu(e,t){const n=this.persistence.referenceDelegate.garbageCollector;return new da(n,e.asyncQueue,t)}nu(e,t){const n=new Me(t,this.persistence);return new je(e.asyncQueue,n)}Xa(e){const t=Ja(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Ws.withCacheSize(this.cacheSizeBytes):Ws.DEFAULT;return new Ga(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,_l(),Tl(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Za(e){return new fl}}class lu{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Bc(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=tu.bind(null,this.syncEngine),await uc(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new bc}createDatastore(e){const t=kl(e.databaseInfo.databaseId),n=function(e){return new El(e)}(e.databaseInfo);return function(e,t,n,r){return new Ol(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new Ml(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>Bc(this.syncEngine,e,0)),ml.D()?new ml:new pl)}createSyncEngine(e,t){return function(e,t,n,r,i,o,s){const a=new Lc(e,t,n,r,i,o);return s&&(a.ja=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=R(e);k(jl,"RemoteStore shutting down."),t.W_.add(5),await Fl(t),t.z_.shutdown(),t.j_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}lu.provider={build:()=>new lu};class cu{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):C("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const uu="FirestoreClient";class du{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=S.UNAUTHENTICATED,this.clientId=G.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async e=>{k(uu,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(k(uu,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new j;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=pc(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function hu(e,t){e.asyncQueue.verifyOperationInProgress(),k(uu,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await il(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function fu(e,t){e.asyncQueue.verifyOperationInProgress();const n=await pu(e);k(uu,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>cc(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>cc(t.remoteStore,n))),e._onlineComponents=t}async function pu(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){k(uu,"Using user provided OfflineComponentProvider");try{await hu(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===O.FAILED_PRECONDITION||e.code===O.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;A("Error using user provided cache. Falling back to memory cache: "+n),await hu(e,new ou)}}else k(uu,"Using default OfflineComponentProvider"),await hu(e,new su(void 0));return e._offlineComponents}async function gu(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(k(uu,"Using user provided OnlineComponentProvider"),await fu(e,e._uninitializedComponentsProvider._online)):(k(uu,"Using default OnlineComponentProvider"),await fu(e,new lu))),e._onlineComponents}function mu(e){return gu(e).then((e=>e.syncEngine))}async function yu(e){const t=await gu(e),n=t.eventManager;return n.onListen=jc.bind(null,t.syncEngine),n.onUnlisten=Vc.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Mc.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Uc.bind(null,t.syncEngine),n}function vu(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new j;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const o=new cu({next:n=>{o.su(),t.enqueueAndForget((()=>Ic(e,s))),n.fromCache&&"server"===r.source?i.reject(new L(O.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),s=new Cc(n,o,{includeMetadataChanges:!0,Ta:!0});return xc(e,s)}(await yu(e),e.asyncQueue,t,n,r))),r.promise}function bu(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const wu=new Map;function xu(e,t,n){if(!n)throw new L(O.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Iu(e){if(!ce.isDocumentKey(e))throw new L(O.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Su(e){if(ce.isDocumentKey(e))throw new L(O.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Eu(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":D()}function _u(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new L(O.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Eu(e);throw new L(O.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function Tu(e,t){if(t<=0)throw new L(O.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}const ku="firestore.googleapis.com",Cu=!0;class Au{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new L(O.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ku,this.ssl=Cu}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:Cu;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=Gs;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<la)throw new L(O.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new L(O.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=bu(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new L(O.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new L(O.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new L(O.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Nu{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Au({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new L(O.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new L(O.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Au(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new z;switch(e.type){case"firstParty":return new $(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new L(O.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=wu.get(e);t&&(k("ComponentProvider","Removing Datastore"),wu.delete(e),t.terminate())}(this),Promise.resolve()}}class Du{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Du(this.firestore,e,this._query)}}class Pu{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ru(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Pu(this.firestore,e,this._key)}}class Ru extends Du{constructor(e,t,n){super(e,t,Fr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Pu(this.firestore,null,new ce(e))}withConverter(e){return new Ru(this.firestore,e,this._path)}}function Ou(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,l.Ku)(e),xu("collection","path",t),e instanceof Nu){const n=se.fromString(t,...r);return Su(n),new Ru(e,null,n)}{if(!(e instanceof Pu||e instanceof Ru))throw new L(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(se.fromString(t,...r));return Su(n),new Ru(e.firestore,null,n)}}function Lu(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,l.Ku)(e),1===arguments.length&&(t=G.newId()),xu("doc","path",t),e instanceof Nu){const n=se.fromString(t,...r);return Iu(n),new Pu(e,null,new ce(n))}{if(!(e instanceof Pu||e instanceof Ru))throw new L(O.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(se.fromString(t,...r));return Iu(n),new Pu(e.firestore,e instanceof Ru?e.converter:null,new ce(n))}}const ju="AsyncQueue";class Mu{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Cl(this,"async_queue_retry"),this.Su=()=>{const e=Tl();e&&k(ju,"Visibility state changed to "+e.visibilityState),this.a_.t_()},this.bu=e;const t=Tl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const t=Tl();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise((()=>{}));const t=new j;return this.vu((()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Vu.push(e),this.Cu())))}async Cu(){if(0!==this.Vu.length){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!Ne(e))throw e;k(ju,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo((()=>this.Cu()))}}vu(e){const t=this.bu.then((()=>(this.pu=!0,e().catch((e=>{this.gu=e,this.pu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw C("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.pu=!1,e))))));return this.bu=t,t}enqueueAfterDelay(e,t,n){this.Du(),this.wu.indexOf(e)>-1&&(t=0);const r=fc.createAndSchedule(this,e,t,n,(e=>this.Fu(e)));return this.fu.push(r),r}Du(){this.gu&&D()}verifyOperationInProgress(){}async Mu(){let e;do{e=this.bu,await e}while(e!==this.bu)}xu(e){for(const t of this.fu)if(t.timerId===e)return!0;return!1}Ou(e){return this.Mu().then((()=>{this.fu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.fu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Mu()}))}Nu(e){this.wu.push(e)}Fu(e){const t=this.fu.indexOf(e);this.fu.splice(t,1)}}function zu(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const r of t)if(r in n&&"function"==typeof n[r])return!0;return!1}(e,["next","error","complete"])}class Fu extends Nu{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Mu,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Mu(e),this._firestoreClient=void 0,await e}}}function Vu(e,t){const n="object"==typeof e?e:(0,o.Sx)(),r="string"==typeof e?e:t||_n,i=(0,o.j6)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const e=(0,l.yU)("firestore");e&&function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};var i;const o=(e=_u(e,Nu))._getSettings(),s=Object.assign(Object.assign({},o),{emulatorOptions:e._getEmulatorOptions()}),a=`${t}:${n}`;o.host!==ku&&o.host!==a&&A("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c=Object.assign(Object.assign({},o),{host:a,ssl:!1,emulatorOptions:r});if(!(0,l.bD)(c,s)&&(e._setSettings(c),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=S.MOCK_USER;else{t=(0,l.Fy)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new L(O.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new S(o)}e._authCredentials=new F(new M(t,n))}}(i,...e)}return i}function Uu(e){if(e._terminated)throw new L(O.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||$u(e),e._firestoreClient}function $u(e){var t,n,r;const i=e._freezeSettings(),o=function(e,t,n,r){return new En(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,bu(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new du(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}function Bu(e,t){A("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=e._freezeSettings();return qu(e,lu.provider,{build:e=>new au(e,n.cacheSizeBytes,null==t?void 0:t.forceOwnership)}),Promise.resolve()}function qu(e,t,n){if((e=_u(e,Fu))._firestoreClient||e._terminated)throw new L(O.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new L(O.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:n},$u(e)}class Hu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Hu(hn.fromBase64String(e))}catch(e){throw new L(O.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Hu(hn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ku{constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(let r=0;r<t.length;++r)if(0===t[r].length)throw new L(O.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new le(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Gu{constructor(e){this._methodName=e}}class Wu{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new L(O.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new L(O.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}}class Qu{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const Ju=/^__.*__$/;class Yu{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new Vi(e,this.data,this.fieldMask,t,this.fieldTransforms):new Fi(e,this.data,t,this.fieldTransforms)}}class Xu{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new Vi(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Zu(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw D()}}class ed{constructor(e,t,n,r,i,o){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Bu(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new ed(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ku({path:n,Qu:!1});return r.$u(e),r}Uu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ku({path:n,Qu:!1});return r.Bu(),r}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return md(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(0===e.length)throw this.Wu("Document fields must not be empty");if(Zu(this.Lu)&&Ju.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class td{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||kl(e)}ju(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new ed({Lu:e,methodName:t,zu:n,path:le.emptyPath(),Qu:!1,Gu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function nd(e){const t=e._freezeSettings(),n=kl(e._databaseId);return new td(e._databaseId,!!t.ignoreUndefinedProperties,n)}function rd(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const s=e.ju(o.merge||o.mergeFields?2:0,t,n,i);hd("Data must be an object, but it was:",s,r);const a=ud(r,s);let l,c;if(o.merge)l=new un(s.fieldMask),c=s.fieldTransforms;else if(o.mergeFields){const e=[];for(const r of o.mergeFields){const i=fd(t,r,n);if(!s.contains(i))throw new L(O.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);yd(e,i)||e.push(i)}l=new un(e),c=s.fieldTransforms.filter((e=>l.covers(e.field)))}else l=null,c=s.fieldTransforms;return new Yu(new nr(a),l,c)}class id extends Gu{_toFieldTransform(e){if(2!==e.Lu)throw 1===e.Lu?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof id}}class od extends Gu{_toFieldTransform(e){return new Ai(e.path,new xi)}isEqual(e){return e instanceof od}}function sd(e,t,n,r){const i=e.ju(1,t,n);hd("Data must be an object, but it was:",i,r);const o=[],s=nr.empty();tn(r,((e,r)=>{const a=gd(t,e,n);r=(0,l.Ku)(r);const c=i.Uu(a);if(r instanceof id)o.push(a);else{const e=cd(r,c);null!=e&&(o.push(a),s.set(a,e))}}));const a=new un(o);return new Xu(s,a,i.fieldTransforms)}function ad(e,t,n,r,i,o){const s=e.ju(1,t,n),a=[fd(t,r,n)],c=[i];if(o.length%2!=0)throw new L(O.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let l=0;l<o.length;l+=2)a.push(fd(t,o[l])),c.push(o[l+1]);const u=[],d=nr.empty();for(let f=a.length-1;f>=0;--f)if(!yd(u,a[f])){const e=a[f];let t=c[f];t=(0,l.Ku)(t);const n=s.Uu(e);if(t instanceof id)u.push(e);else{const r=cd(t,n);null!=r&&(u.push(e),d.set(e,r))}}const h=new un(u);return new Xu(d,h,s.fieldTransforms)}function ld(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return cd(n,e.ju(r?4:3,t))}function cd(e,t){if(dd(e=(0,l.Ku)(e)))return hd("Unsupported field value:",t,e),ud(e,t);if(e instanceof Gu)return function(e,t){if(!Zu(t.Lu))throw t.Wu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Wu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Qu&&4!==t.Lu)throw t.Wu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=cd(i,t.Ku(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,l.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return mi(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ne.fromDate(e);return{timestampValue:xo(t.serializer,n)}}if(e instanceof ne){const n=new ne(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:xo(t.serializer,n)}}if(e instanceof Wu)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Hu)return{bytesValue:Io(t.serializer,e._byteString)};if(e instanceof Pu){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Wu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:_o(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Qu)return function(e,t){return{mapValue:{fields:{[kn]:{stringValue:Nn},[Dn]:{arrayValue:{values:e.toArray().map((e=>{if("number"!=typeof e)throw t.Wu("VectorValues must only contain numeric values.");return pi(t.serializer,e)}))}}}}}}(e,t);throw t.Wu(`Unsupported field value: ${Eu(e)}`)}(e,t)}function ud(e,t){const n={};return nn(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tn(e,((e,r)=>{const i=cd(r,t.qu(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function dd(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ne||e instanceof Wu||e instanceof Hu||e instanceof Pu||e instanceof Gu||e instanceof Qu)}function hd(e,t,n){if(!dd(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Eu(n);throw"an object"===r?t.Wu(e+" a custom object"):t.Wu(e+" "+r)}}function fd(e,t,n){if((t=(0,l.Ku)(t))instanceof Ku)return t._internalPath;if("string"==typeof t)return gd(e,t);throw md("Field path arguments must be of type string or ",e,!1,void 0,n)}const pd=new RegExp("[~\\*/\\[\\]]");function gd(e,t,n){if(t.search(pd)>=0)throw md(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Ku(...t.split("."))._internalPath}catch(r){throw md(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function md(e,t,n,r,i){const o=r&&!r.isEmpty(),s=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(o||s)&&(l+=" (found",o&&(l+=` in field ${r}`),s&&(l+=` in document ${i}`),l+=")"),new L(O.INVALID_ARGUMENT,a+e+l)}function yd(e,t){return e.some((e=>e.isEqual(t)))}class vd{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Pu(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new bd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(wd("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class bd extends vd{data(){return super.data()}}function wd(e,t){return"string"==typeof t?gd(e,t):t instanceof Ku?t._internalPath:t._delegate._internalPath}function xd(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new L(O.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Id{}class Sd extends Id{}function Ed(e,t){let n=[];for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];t instanceof Id&&n.push(t),n=n.concat(i),function(e){const t=e.filter((e=>e instanceof kd)).length,n=e.filter((e=>e instanceof _d)).length;if(t>1||t>0&&n>0)throw new L(O.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const s of n)e=s._apply(e);return e}class _d extends Sd{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new _d(e,t,n)}_apply(e){const t=this._parse(e);return Pd(e._query,t),new Du(e.firestore,e.converter,Hr(e._query,t))}_parse(e){const t=nd(e.firestore),n=function(e,t,n,r,i,o,s){let a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new L(O.INVALID_ARGUMENT,`Invalid Query. You can't perform '${o}' queries on documentId().`);if("in"===o||"not-in"===o){Dd(s,o);const t=[];for(const n of s)t.push(Nd(r,e,n));a={arrayValue:{values:t}}}else a=Nd(r,e,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Dd(s,o),a=ld(n,t,s,"in"===o||"not-in"===o);return dr.create(i,o,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function Td(e,t,n){const r=t,i=wd("where",e);return _d._create(i,r,n)}class kd extends Id{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new kd(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:hr.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const i of r)Pd(n,i),n=Hr(n,i)}(e._query,t),new Du(e.firestore,e.converter,Hr(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Cd extends Sd{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new Cd(e,t,n)}_apply(e){return new Du(e.firestore,e.converter,Kr(e._query,this._limit,this._limitType))}}function Ad(e){return Tu("limit",e),Cd._create("limit",e,"F")}function Nd(e,t,n){if("string"==typeof(n=(0,l.Ku)(n))){if(""===n)throw new L(O.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ur(t)&&-1!==n.indexOf("/"))throw new L(O.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(se.fromString(n));if(!ce.isDocumentKey(r))throw new L(O.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return $n(e,new ce(r))}if(n instanceof Pu)return $n(e,n._key);throw new L(O.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Eu(n)}.`)}function Dd(e,t){if(!Array.isArray(e)||0===e.length)throw new L(O.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Pd(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new L(O.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new L(O.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class Rd{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Rn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return gn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(mn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw D()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return tn(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertVectorValue(e){var t,n,r;const i=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t[Dn].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((e=>gn(e.doubleValue)));return new Qu(i)}convertGeoPoint(e){return new Wu(gn(e.latitude),gn(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=In(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Sn(e));default:return null}}convertTimestamp(e){const t=pn(e);return new ne(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=se.fromString(e);P(Qo(n));const r=new Tn(n.get(1),n.get(3)),i=new ce(n.popFirst(5));return r.isEqual(t)||C(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Od(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Ld{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class jd extends vd{constructor(e,t,n,r,i,o){super(e,t,n,r,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new Md(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(wd("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Md extends jd{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class zd{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Ld(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Md(this._firestore,this._userDataWriter,n.key,n,new Ld(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new L(O.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new Md(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Ld(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new Md(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Ld(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,o=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),o=n.indexOf(t.doc.key)),{type:Fd(t.type),doc:r,oldIndex:i,newIndex:o}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function Fd(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return D()}}class Vd extends Rd{constructor(e){super(),this.firestore=e}convertBytes(e){return new Hu(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Pu(this.firestore,null,t)}}function Ud(e){e=_u(e,Du);const t=_u(e.firestore,Fu),n=Uu(t),r=new Vd(t);return xd(e._query),vu(n,e._query).then((n=>new zd(t,r,e,n)))}function $d(e,t,n){e=_u(e,Pu);const r=_u(e.firestore,Fu),i=Od(e.converter,t,n);return Kd(r,[rd(nd(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Di.none())])}function Bd(e,t,n){e=_u(e,Pu);const r=_u(e.firestore,Fu),i=nd(r);let o;for(var s=arguments.length,a=new Array(s>3?s-3:0),c=3;c<s;c++)a[c-3]=arguments[c];return o="string"==typeof(t=(0,l.Ku)(t))||t instanceof Ku?ad(i,"updateDoc",e._key,t,n,a):sd(i,"updateDoc",e._key,t),Kd(r,[o.toMutation(e._key,Di.exists(!0))])}function qd(e){return Kd(_u(e.firestore,Fu),[new qi(e._key,Di.none())])}function Hd(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,o,s;e=(0,l.Ku)(e);let a={includeMetadataChanges:!1,source:"default"},c=0;"object"!=typeof n[c]||zu(n[c])||(a=n[c],c++);const u={includeMetadataChanges:a.includeMetadataChanges,source:a.source};if(zu(n[c])){const e=n[c];n[c]=null===(i=e.next)||void 0===i?void 0:i.bind(e),n[c+1]=null===(o=e.error)||void 0===o?void 0:o.bind(e),n[c+2]=null===(s=e.complete)||void 0===s?void 0:s.bind(e)}let d,h,f;if(e instanceof Pu)h=_u(e.firestore,Fu),f=Fr(e._key.path),d={next:t=>{n[c]&&n[c](Gd(h,e,t))},error:n[c+1],complete:n[c+2]};else{const t=_u(e,Du);h=_u(t.firestore,Fu),f=t._query;const r=new Vd(h);d={next:e=>{n[c]&&n[c](new zd(h,r,t,e))},error:n[c+1],complete:n[c+2]},xd(e._query)}return function(e,t,n,r){const i=new cu(r),o=new Cc(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>xc(await yu(e),o))),()=>{i.su(),e.asyncQueue.enqueueAndForget((async()=>Ic(await yu(e),o)))}}(Uu(h),f,u,d)}function Kd(e,t){return function(e,t){const n=new j;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=iu(e);try{const e=await function(e,t){const n=R(e),r=ne.now(),i=t.reduce(((e,t)=>e.add(t.key)),di());let o,s;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=ni(),l=di();return n.ds.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(l=l.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{o=i;const s=[];for(const e of t){const t=Mi(e,o.get(e.key).overlayedDocument);null!=t&&s.push(new Vi(e.key,t,rr(t.value.mapValue),Di.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,s,t)})).next((t=>{s=t;const r=t.applyToLocalDocumentSet(o,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:s.batchId,changes:oi(o)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Wa[e.currentUser.toKey()];r||(r=new rn(W)),r=r.insert(t,n),e.Wa[e.currentUser.toKey()]=r}(r,e.batchId,n),await eu(r,e.changes),await ec(r.remoteStore)}catch(e){const t=pc(e,"Failed to persist write");n.reject(t)}}(await mu(e),t,n))),n.promise}(Uu(e),t)}function Gd(e,t,n){const r=n.docs.get(t._key),i=new Vd(e);return new jd(e,i,t._key,r,new Ld(n.hasPendingWrites,n.fromCache),t.converter)}class Wd{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=nd(e)}set(e,t,n){this._verifyNotCommitted();const r=Qd(e,this._firestore),i=Od(r.converter,t,n),o=rd(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,Di.none())),this}update(e,t,n){this._verifyNotCommitted();const r=Qd(e,this._firestore);let i;for(var o=arguments.length,s=new Array(o>3?o-3:0),a=3;a<o;a++)s[a-3]=arguments[a];return i="string"==typeof(t=(0,l.Ku)(t))||t instanceof Ku?ad(this._dataReader,"WriteBatch.update",r._key,t,n,s):sd(this._dataReader,"WriteBatch.update",r._key,t),this._mutations.push(i.toMutation(r._key,Di.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Qd(e,this._firestore);return this._mutations=this._mutations.concat(new qi(t._key,Di.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new L(O.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Qd(e,t){if((e=(0,l.Ku)(e)).firestore!==t)throw new L(O.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function Jd(){return new od("serverTimestamp")}function Yd(e){return Uu(e=_u(e,Fu)),new Wd(e,(t=>Kd(e,t)))}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){E=e}(o.MF),(0,o.om)(new s.uA("firestore",((e,n)=>{let{instanceIdentifier:r,options:i}=n;const o=e.getProvider("app").getImmediate(),s=new Fu(new V(e.getProvider("auth-internal")),new q(o,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new L(O.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Tn(e.options.projectId,t)}(o,r),o);return i=Object.assign({useFetchStreams:t},i),s._setSettings(i),s}),"PUBLIC").setMultipleInstances(!0)),(0,o.KO)(x,I,e),(0,o.KO)(x,I,"esm2017")}()},496:(e,t,n)=>{n.d(t,{El:()=>l,Ge:()=>a,Kc:()=>o,procesarSolicitud:()=>s});var r=n(472),i=n(213);const o=async(e,t,n,o)=>{try{if(!e||!e.length)return o&&o("No hay solicitudes pendientes para procesar"),{success:!0,message:"No hay solicitudes pendientes para procesar"};o&&o("Iniciando procesamiento de solicitudes...");const a=[...e],l=t.map((e=>({orden:e.order,centroActual:e.id,estaAsignada:!0,docId:e.docId,timestamp:e.timestamp||0,centro:e.centro,localidad:e.localidad,municipio:e.municipio}))),c=[...a,...l].sort(((e,t)=>Number(e.orden)-Number(t.orden)));o&&o(`Procesando ${c.length} solicitudes por prioridad...`);const u=n.map((e=>({...e,asignadas:0,asignacionesPorOrden:[]}))),d=u.reduce(((e,t)=>(e[t.id]=t,e)),{});o&&o("Eliminando asignaciones existentes para recalcular...");for(const e of t)e.docId&&await(0,r.kd)((0,r.H9)(i.db,"asignaciones",e.docId));for(const e of u)e.docId&&await(0,r.mZ)((0,r.H9)(i.db,"centros",e.docId),{asignadas:0});let h=0,f=0;const p=[],g=new Set,m=[],y=[];for(const e of c){if(g.has(e.orden))continue;o&&o(`Procesando solicitud/asignaci\xf3n #${e.orden} (procesadas: ${g.size})`);let t=!1,n=null;if(e.estaAsignada&&e.centroActual){const o=d[e.centroActual];if(o&&o.asignadas<o.plazas){o.asignadas++,o.asignacionesPorOrden.push(e.orden);const s={order:e.orden,id:o.id,localidad:o.localidad||e.localidad,centro:o.centro||e.centro,municipio:o.municipio||e.municipio,timestamp:Date.now(),mantenida:!0},a=(0,r.H9)((0,r.rJ)(i.db,"asignaciones"));await(0,r.BN)(a,s),p.push({...s,docId:a.id}),t=!0,n=o,y.push({tipo:"MANTENIDA",orden:e.orden,centroId:o.id,centro:o.centro,mensaje:`Asignaci\xf3n mantenida en ${o.centro}`})}}if(!t){const o=e.centrosIds||(e.estaAsignada?[e.centroActual]:[]),s=o.length>0?o.map((e=>d[e])).filter(Boolean):u.sort(((e,t)=>e.asignadas/e.plazas-t.asignadas/t.plazas));for(const a of s){if(a.asignadas<a.plazas){a.asignadas++,a.asignacionesPorOrden.push(e.orden);const o={order:e.orden,id:a.id,localidad:a.localidad,centro:a.centro,municipio:a.municipio,timestamp:Date.now()},s=(0,r.H9)((0,r.rJ)(i.db,"asignaciones"));await(0,r.BN)(s,o),p.push({...o,docId:s.id}),h++,t=!0,n=a,!e.estaAsignada&&e.docId&&m.push(e.docId),y.push({tipo:e.estaAsignada?"REASIGNADA":"ASIGNADA",orden:e.orden,centroId:a.id,centro:a.centro,mensaje:e.estaAsignada?`Reasignada de ${e.centro||"centro anterior"} a ${a.centro}`:`Asignada a ${a.centro}`});break}if(a.asignacionesPorOrden.length>0){const o=a.asignacionesPorOrden,s=Math.max(...o);if(Number(s)>Number(e.orden)){console.log(`Posible desplazamiento: Orden ${e.orden} tiene mayor prioridad que ${s} en ${a.centro}`);const o=p.find((e=>e.order==s&&e.id===a.id));if(o){c.find((e=>e.orden==s));const l=u.filter((e=>e.id!==a.id&&e.asignadas<e.plazas));if(l.length>0){const c=l[0];a.asignacionesPorOrden=a.asignacionesPorOrden.filter((e=>e!=s)),a.asignacionesPorOrden.push(e.orden);const u={order:e.orden,id:a.id,localidad:a.localidad,centro:a.centro,municipio:a.municipio,timestamp:Date.now(),priorizado:!0},d=(0,r.H9)((0,r.rJ)(i.db,"asignaciones"));await(0,r.BN)(d,u),p.push({...u,docId:d.id}),c.asignadas++,c.asignacionesPorOrden.push(s);const h={order:s,id:c.id,localidad:c.localidad,centro:c.centro,municipio:c.municipio,timestamp:Date.now(),desplazada:!0,centroAnterior:a.centro},g=(0,r.H9)((0,r.rJ)(i.db,"asignaciones"));await(0,r.BN)(g,h),o.docId&&await(0,r.kd)((0,r.H9)(i.db,"asignaciones",o.docId));const v=p.findIndex((e=>e.order==s&&e.id===a.id));v>=0&&p.splice(v,1),p.push({...h,docId:g.id}),t=!0,n=a,f++,!e.estaAsignada&&e.docId&&m.push(e.docId),y.push({tipo:"PRIORIZADA",orden:e.orden,centroId:a.id,centro:a.centro,mensaje:`Priorizada en ${a.centro}, desplazando a orden ${s}`}),y.push({tipo:"DESPLAZADA",orden:s,centroId:c.id,centro:c.centro,centroAnterior:a.centro,mensaje:`Desplazada de ${a.centro} a ${c.centro} por orden ${e.orden} de mayor prioridad`});break}}}}}}g.add(e.orden),t||(y.push({tipo:"NO_ASIGNABLE",orden:e.orden,mensaje:"No hay plazas disponibles en ninguno de los centros solicitados"}),!e.estaAsignada&&e.docId&&m.push(e.docId))}o&&o(`Registrando ${y.length} operaciones en el historial...`);for(const e of y)try{const t=(0,r.H9)((0,r.rJ)(i.db,"historialSolicitudes")),n={orden:e.orden,estado:e.tipo,fechaHistorico:(new Date).toISOString(),timestamp:Date.now()};void 0!==e.centroId&&(n.centroId=e.centroId),void 0!==e.centro&&(n.centroAsignado=e.centro),void 0!==e.centroAnterior&&(n.centroAnterior=e.centroAnterior),void 0!==e.mensaje&&(n.mensaje=e.mensaje),await(0,r.BN)(t,n)}catch(s){console.error(`Error al registrar historial para orden ${e.orden}:`,s)}if(m.length>0){o&&o(`Eliminando ${m.length} solicitudes procesadas...`);let e=0;for(const t of m)try{await(0,r.kd)((0,r.H9)(i.db,"solicitudesPendientes",t)),e++}catch(s){console.error(`Error al eliminar solicitud ${t}:`,s)}o&&o(`Se eliminaron ${e} solicitudes pendientes ya procesadas.`)}o&&o("Actualizando contadores en los centros...");for(const e of u)e.docId&&await(0,r.mZ)((0,r.H9)(i.db,"centros",e.docId),{asignadas:e.asignadas});return o&&o(`Procesamiento completado. ${h} nuevas asignaciones, ${f} reasignaciones.`),{success:!0,nuevasAsignaciones:p,eliminadas:m.length,asignacionesNuevas:h,reasignaciones:f,message:`Asignaciones procesadas por prioridad. ${h} nuevas, ${f} reasignaciones.`}}catch(s){return console.error("Error en procesarSolicitudes:",s),o&&o("Error: "+s.message),{success:!1,message:s.message}}},s=async(e,t,n)=>{try{if(console.log("Procesando solicitud individual:",e),!e||!e.centrosIds||!Array.isArray(e.centrosIds))return{success:!1,message:"La solicitud no tiene formato correcto"};if(0===e.centrosIds.length)return{success:!1,message:"La solicitud no tiene centros seleccionados",noAsignable:!0};let i=null,o=null;for(const n of e.centrosIds){const e=t[n];if(e){if(console.log(`Verificando centro ${e.nombre}: ${e.plazasDisponibles} plazas disponibles`),e.plazasDisponibles>0){i=e,o=n;break}}else console.log(`Centro no encontrado: ${n}`)}if(!i)return{success:!1,message:"No hay plazas disponibles en los centros seleccionados",noAsignable:!0};const s=(0,r.wP)(n),a={numeroOrden:e.orden||0,centerId:o,nombreCentro:i.nombre,timestamp:Date.now(),fechaAsignacion:(new Date).toISOString(),municipio:i.municipio||"",localidad:i.localidad||"",historial:[{accion:"asignaci\xf3n inicial",timestamp:Date.now(),detalles:`Asignado a ${i.nombre}`}]},l=(0,r.H9)((0,r.rJ)(n,"asignaciones"));s.set(l,a);const c=(0,r.H9)(n,"centros",o);return s.update(c,{plazasOcupadas:(i.plazasOcupadas||0)+1}),await s.commit(),console.log(`Asignaci\xf3n creada exitosamente para solicitud ${e.orden} en centro ${i.nombre}`),{success:!0,centroAsignado:i,centroId:o,asignacionId:l.id}}catch(i){return console.error("Error al procesar solicitud individual:",i),{success:!1,message:`Error al procesar: ${i.message}`}}},a=async(e,t,n)=>{try{for(const t of e)if(t.docId)try{await(0,r.mZ)((0,r.H9)(n,"centros",t.docId),{asignadas:0})}catch(i){console.error(`Error al resetear contador para ${t.centro}:`,i)}const o={};for(const e of t){const t=e.centroId||e.id;t&&(o[t]=(o[t]||0)+1)}let s=0,a=0;for(const t of e){const e=t.id;if(e&&o[e]&&t.docId)try{await(0,r.mZ)((0,r.H9)(n,"centros",t.docId),{asignadas:o[e]}),s++}catch(i){console.error(`Error al actualizar contador para ${t.centro}:`,i),a++}}return{success:!0,actualizados:s,errores:a,message:`Contadores reiniciados. ${s} centros actualizados.`}}catch(i){return console.error("Error al resetear contadores:",i),{success:!1,error:i.message,message:"Error al resetear contadores: "+i.message}}},l=async(e,t,n)=>{try{if(!Array.isArray(e))return console.error("Error: centros debe ser un array",e),{success:!1,message:"Lista de centros inv\xe1lida",error:"centros debe ser un array"};if(!Array.isArray(t))return console.error("Error: asignaciones debe ser un array",t),{success:!1,message:"Lista de asignaciones inv\xe1lida",error:"asignaciones debe ser un array"};if(!n)return console.error("Error: no se proporcion\xf3 la referencia a la base de datos"),{success:!1,message:"Referencia a la base de datos no proporcionada",error:"db es requerido"};console.log("Verificando centros con exceso de asignaciones...");const o=e.filter((e=>e&&"object"===typeof e&&!isNaN(e.asignadas)&&!isNaN(e.plazas)));if(0===o.length)return console.log("No hay centros v\xe1lidos para verificar"),{success:!0,message:"No hay centros v\xe1lidos para verificar",corregidos:0};const s=o.filter((e=>e.asignadas>e.plazas));if(0===s.length)return console.log("No se encontraron centros con exceso de asignaciones"),{success:!0,message:"No hay centros con exceso",corregidos:0};console.log(`Centros con exceso: ${s.length}`);const a=o.filter((e=>e.asignadas<e.plazas));let l=0,c=0,u=0;for(const e of s){if(!e.centro||!e.id){console.warn("Centro inv\xe1lido:",e);continue}console.log(`Centro ${e.centro}: ${e.asignadas} asignadas, ${e.plazas} plazas`);const o=t.filter((t=>t&&t.id===e.id));if(!o.length){console.warn(`No se encontraron asignaciones para ${e.centro}`);continue}o.sort(((e,t)=>(Number(e.order)||0)-(Number(t.order)||0)));if(e.asignadas-e.plazas<=0)continue;const s=o.slice(e.plazas);console.log(`Procesando ${s.length} asignaciones excedentes en ${e.centro}`);for(const t of s)try{let o=!1;const s=a.filter((t=>t.id!==e.id));if(s.length>0){const i=[...s].sort(((e,t)=>e.asignadas/e.plazas-t.asignadas/t.plazas))[0];if(i&&i.asignadas<i.plazas){const s=(0,r.H9)((0,r.rJ)(n,"asignaciones")),a={order:t.order,id:i.id,localidad:i.localidad,centro:i.centro,municipio:i.municipio,timestamp:Date.now(),reasignado:!0,centroOriginal:e.centro};await(0,r.BN)(s,a),await(0,r.mZ)((0,r.H9)(n,"centros",i.docId),{asignadas:i.asignadas+1});const l=(0,r.H9)((0,r.rJ)(n,"historialSolicitudes")),u={orden:t.order,centroIdOriginal:t.id,centroIdNuevo:i.id,estado:"REASIGNADO",mensaje:`Reasignaci\xf3n de ${e.centro} a ${i.centro} por exceso de plazas`,centroOriginal:t.centro||e.centro,centroAsignado:i.centro,localidad:i.localidad,municipio:i.municipio,fechaHistorico:(new Date).toISOString(),timestamp:Date.now()};await(0,r.BN)(l,u),i.asignadas++,o=!0,c++,console.log(`Asignaci\xf3n ${t.order} reasignada de ${e.centro} a ${i.centro}`)}}if(!o)try{const i=(0,r.H9)((0,r.rJ)(n,"historialSolicitudes")),o={orden:t.order,centroId:t.id,estado:"EXCESO_NO_REASIGNABLE",mensaje:`Centro ${e.centro} con exceso de plazas. Se mantiene la asignaci\xf3n actual.`,centroAsignado:t.centro||e.centro,localidad:t.localidad||e.localidad,municipio:t.municipio||e.municipio,fechaHistorico:(new Date).toISOString(),timestamp:Date.now()};await(0,r.BN)(i,o),console.log(`Asignaci\xf3n ${t.order} en exceso en ${e.centro}, pero se mantiene sin convertir a solicitud pendiente`),l++}catch(i){console.error(`Error al registrar en historial para orden ${t.order}:`,i)}t.docId?(await(0,r.kd)((0,r.H9)(n,"asignaciones",t.docId)),l++,console.log(`Asignaci\xf3n ${t.docId} eliminada`)):console.warn(`Asignaci\xf3n sin docId para orden ${t.order}`)}catch(i){console.error(`Error al corregir asignaci\xf3n para orden ${t.order}:`,i)}if(e.docId)try{await(0,r.mZ)((0,r.H9)(n,"centros",e.docId),{asignadas:e.plazas}),console.log(`Contador actualizado para ${e.centro}: ${e.plazas}`)}catch(i){console.error(`Error al actualizar contador para ${e.centro}:`,i)}else console.warn(`Centro ${e.centro} sin docId, no se actualiz\xf3 contador`)}return{success:!0,message:`Se corrigieron ${l} asignaciones excedentes (${c} reasignadas, ${u} recuperadas)`,corregidos:l,reasignados:c,recuperados:u}}catch(i){return console.error("Error en verificaci\xf3n y correcci\xf3n:",i),{success:!1,error:i.message,message:"Error en verificaci\xf3n: "+i.message}}}},529:(e,t,n)=>{n.d(t,{cY:()=>p,FA:()=>k,g:()=>T,dM:()=>_,u:()=>a,Uj:()=>s,p9:()=>$,Fy:()=>g,tD:()=>L,bD:()=>N,hp:()=>O,T9:()=>h,Tj:()=>u,yU:()=>d,XA:()=>f,Ku:()=>B,ZQ:()=>m,sr:()=>b,c1:()=>v,Im:()=>A,lT:()=>x,zW:()=>S,jZ:()=>y,lV:()=>w,nr:()=>I,Am:()=>P,I9:()=>R,eX:()=>E});const r=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<e.length;i+=3){const t=e[i],o=i+1<e.length,s=o?e[i+1]:0,a=i+2<e.length,l=a?e[i+2]:0,c=t>>2,u=(3&t)<<4|s>>4;let d=(15&s)<<2|l>>6,h=63&l;a||(h=64,o||(d=64)),r.push(n[c],n[u],n[d],n[h])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const o=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){const o=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{const o=e[n++],s=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&s)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<e.length;){const t=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0;++i;const a=i<e.length?n[e.charAt(i)]:64;++i;const l=i<e.length?n[e.charAt(i)]:64;if(++i,null==t||null==s||null==a||null==l)throw new o;const c=t<<2|s>>4;if(r.push(c),64!==a){const e=s<<4&240|a>>2;if(r.push(e),64!==l){const e=a<<6&192|l;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(e){return function(e){const t=r(e);return i.encodeByteArray(t,!0)}(e).replace(/\./g,"")},a=function(e){try{return i.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};const l=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,c=()=>{try{return l()||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"/asignacion-plazas",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyDo7X1BLIW1hNYQpJLZcDws_L4aGHJWXOQ",REACT_APP_FIREBASE_AUTH_DOMAIN:"asignacion-plazas.firebaseapp.com",REACT_APP_FIREBASE_PROJECT_ID:"asignacion-plazas",REACT_APP_FIREBASE_STORAGE_BUCKET:"asignacion-plazas.firebasestorage.app",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"525955676079",REACT_APP_FIREBASE_APP_ID:"1:525955676079:web:a7e0b00391e75c902fe15a",REACT_APP_FIREBASE_MEASUREMENT_ID:"G-E0DLWYPVKP"}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const t=e&&a(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},u=e=>{var t,n;return null===(n=null===(t=c())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},d=e=>{const t=u(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},h=()=>{var e;return null===(e=c())||void 0===e?void 0:e.config},f=e=>{var t;return null===(t=c())||void 0===t?void 0:t[`_${e}`]};class p{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"===typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function g(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}function m(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function y(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(m())}function v(){return"undefined"!==typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function b(){const e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function w(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function x(){const e=m();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function I(){return!function(){var e;const t=null===(e=c())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(r){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function S(){try{return"object"===typeof indexedDB}catch(e){return!1}}function E(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(n){t(n)}}))}function _(){return!("undefined"===typeof navigator||!navigator.cookieEnabled)}class T extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,T.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,k.prototype.create)}}class k{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},n=`${this.service}/${e}`,r=this.errors[e],i=r?function(e,t){return e.replace(C,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(r,t):"Error",o=`${this.serviceName}: ${i} (${n}).`;return new T(n,o,t)}}const C=/\{\$([^}]+)}/g;function A(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function N(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],o=t[i];if(D(n)&&D(o)){if(!N(n,o))return!1}else if(n!==o)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function D(e){return null!==e&&"object"===typeof e}function P(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function R(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function O(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function L(e,t){const n=new j(e,t);return n.subscribe.bind(n)}class j{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!==typeof e||null===e)return!1;for(const n of t)if(n in e&&"function"===typeof e[n])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=M),void 0===r.error&&(r.error=M),void 0===r.complete&&(r.complete=M);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(n){"undefined"!==typeof console&&console.error&&console.error(n)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function M(){}const z=1e3,F=2,V=144e5,U=.5;function $(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F;const n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:z)*Math.pow(t,e),r=Math.round(U*n*(Math.random()-.5)*2);return Math.min(V,n+r)}function B(e){return e&&e._delegate?e._delegate:e}},579:(e,t,n)=>{e.exports=n(153)},730:(e,t,n)=>{var r=n(43),i=n(853);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,a={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(a[e]=t,e=0;e<t.length;e++)s.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function g(e,t,n,r,i,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new g(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new g(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new g(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new g(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new g(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new g(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function v(e){return e[1].toUpperCase()}function b(e,t,n,r){var i=m.hasOwnProperty(t)?m[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(p,e)||!d.call(f,e)&&(h.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,v);m[t]=new g(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,v);m[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,v);m[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)}));var w=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),I=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),k=Symbol.for("react.context"),C=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var R=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=O&&e[O]||e["@@iterator"])?e:null}var j,M=Object.assign;function z(e){if(void 0===j)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);j=t&&t[1]||""}return"\n"+j+e}var F=!1;function V(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),o=r.stack.split("\n"),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||i[s]!==o[a]){var l="\n"+i[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=a);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?z(e):""}function U(e){switch(e.tag){case 5:return z(e.type);case 16:return z("Lazy");case 13:return z("Suspense");case 19:return z("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function $(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case I:return"Portal";case _:return"Profiler";case E:return"StrictMode";case A:return"Suspense";case N:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case k:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case C:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case D:return null!==(t=e.displayName||null)?t:$(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return $(e(t))}catch(n){}}return null}function B(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return $(t);case 8:return t===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function q(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function K(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function G(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function W(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=q(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function X(e,t){Y(e,t);var n=q(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&W(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+q(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:q(n)}}function oe(e,t){var n=q(t.value),r=q(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function he(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function ge(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=ge(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(fe).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var ye=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ve(e,t){if(t){if(ye[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var we=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ie=null,Se=null,Ee=null;function _e(e){if(e=bi(e)){if("function"!==typeof Ie)throw Error(o(280));var t=e.stateNode;t&&(t=xi(t),Ie(e.stateNode,e.type,t))}}function Te(e){Se?Ee?Ee.push(e):Ee=[e]:Se=e}function ke(){if(Se){var e=Se,t=Ee;if(Ee=Se=null,_e(e),t)for(e=0;e<t.length;e++)_e(t[e])}}function Ce(e,t){return e(t)}function Ae(){}var Ne=!1;function De(e,t,n){if(Ne)return e(t,n);Ne=!0;try{return Ce(e,t,n)}finally{Ne=!1,(null!==Se||null!==Ee)&&(Ae(),ke())}}function Pe(e,t){var n=e.stateNode;if(null===n)return null;var r=xi(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Re=!1;if(u)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){Re=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch(ue){Re=!1}function Le(e,t,n,r,i,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var je=!1,Me=null,ze=!1,Fe=null,Ve={onError:function(e){je=!0,Me=e}};function Ue(e,t,n,r,i,o,s,a,l){je=!1,Me=null,Le.apply(Ve,arguments)}function $e(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Be(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function qe(e){if($e(e)!==e)throw Error(o(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=$e(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var s=i.alternate;if(null===s){if(null!==(r=i.return)){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return qe(i),e;if(s===r)return qe(i),t;s=s.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=s;else{for(var a=!1,l=i.child;l;){if(l===n){a=!0,n=i,r=s;break}if(l===r){a=!0,r=i,n=s;break}l=l.sibling}if(!a){for(l=s.child;l;){if(l===n){a=!0,n=s,r=i;break}if(l===r){a=!0,r=s,n=i;break}l=l.sibling}if(!a)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?Ke(e):null}function Ke(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ke(e);if(null!==t)return t;e=e.sibling}return null}var Ge=i.unstable_scheduleCallback,We=i.unstable_cancelCallback,Qe=i.unstable_shouldYield,Je=i.unstable_requestPaint,Ye=i.unstable_now,Xe=i.unstable_getCurrentPriorityLevel,Ze=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,ot=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/lt|0)|0},at=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~i;0!==a?r=dt(a):0!==(o&=s)&&(r=dt(o))}else 0!==(s=n&~i)?r=dt(s):0!==o&&(r=dt(o));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(o=t&-t)||16===i&&0!==(4194240&o)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-st(t)),r|=e[n],t&=~i;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function yt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function vt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-st(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var bt=0;function wt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var xt,It,St,Et,_t,Tt=!1,kt=[],Ct=null,At=null,Nt=null,Dt=new Map,Pt=new Map,Rt=[],Ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":Ct=null;break;case"dragenter":case"dragleave":At=null;break;case"mouseover":case"mouseout":Nt=null;break;case"pointerover":case"pointerout":Dt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function jt(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=bi(t))&&It(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Mt(e){var t=vi(e.target);if(null!==t){var n=$e(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Be(n)))return e.blockedOn=t,void _t(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function zt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=bi(n))&&It(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);we=r,n.target.dispatchEvent(r),we=null,t.shift()}return!0}function Ft(e,t,n){zt(e)&&n.delete(t)}function Vt(){Tt=!1,null!==Ct&&zt(Ct)&&(Ct=null),null!==At&&zt(At)&&(At=null),null!==Nt&&zt(Nt)&&(Nt=null),Dt.forEach(Ft),Pt.forEach(Ft)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,Tt||(Tt=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Vt)))}function $t(e){function t(t){return Ut(t,e)}if(0<kt.length){Ut(kt[0],e);for(var n=1;n<kt.length;n++){var r=kt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Ct&&Ut(Ct,e),null!==At&&Ut(At,e),null!==Nt&&Ut(Nt,e),Dt.forEach(t),Pt.forEach(t),n=0;n<Rt.length;n++)(r=Rt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Rt.length&&null===(n=Rt[0]).blockedOn;)Mt(n),null===n.blockedOn&&Rt.shift()}var Bt=w.ReactCurrentBatchConfig,qt=!0;function Ht(e,t,n,r){var i=bt,o=Bt.transition;Bt.transition=null;try{bt=1,Gt(e,t,n,r)}finally{bt=i,Bt.transition=o}}function Kt(e,t,n,r){var i=bt,o=Bt.transition;Bt.transition=null;try{bt=4,Gt(e,t,n,r)}finally{bt=i,Bt.transition=o}}function Gt(e,t,n,r){if(qt){var i=Qt(e,t,n,r);if(null===i)qr(e,t,r,Wt,n),Lt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Ct=jt(Ct,e,t,n,r,i),!0;case"dragenter":return At=jt(At,e,t,n,r,i),!0;case"mouseover":return Nt=jt(Nt,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return Dt.set(o,jt(Dt.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Pt.set(o,jt(Pt.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Lt(e,r),4&t&&-1<Ot.indexOf(e)){for(;null!==i;){var o=bi(i);if(null!==o&&xt(o),null===(o=Qt(e,t,n,r))&&qr(e,t,r,Wt,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else qr(e,t,r,null,n)}}var Wt=null;function Qt(e,t,n,r){if(Wt=null,null!==(e=vi(e=xe(r))))if(null===(t=$e(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Be(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Wt=e,null}function Jt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xe()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Yt=null,Xt=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=Xt,r=n.length,i="value"in Yt?Yt.value:Yt.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[o-t];t++);return Zt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,i,o){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,an,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(cn),dn=M({},cn,{view:0,detail:0}),hn=on(dn),fn=M({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_n,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(sn=e.screenX-ln.screenX,an=e.screenY-ln.screenY):an=sn=0,ln=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:an}}),pn=on(fn),gn=on(M({},fn,{dataTransfer:0})),mn=on(M({},dn,{relatedTarget:0})),yn=on(M({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),vn=M({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=on(vn),wn=on(M({},cn,{data:0})),xn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},In={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function En(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function _n(){return En}var Tn=M({},dn,{key:function(e){if(e.key){var t=xn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?In[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_n,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),kn=on(Tn),Cn=on(M({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),An=on(M({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_n})),Nn=on(M({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Dn=M({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Pn=on(Dn),Rn=[9,13,27,32],On=u&&"CompositionEvent"in window,Ln=null;u&&"documentMode"in document&&(Ln=document.documentMode);var jn=u&&"TextEvent"in window&&!Ln,Mn=u&&(!On||Ln&&8<Ln&&11>=Ln),zn=String.fromCharCode(32),Fn=!1;function Vn(e,t){switch(e){case"keyup":return-1!==Rn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var $n=!1;var Bn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Bn[e.type]:"textarea"===t}function Hn(e,t,n,r){Te(r),0<(t=Kr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Kn=null,Gn=null;function Wn(e){zr(e,0)}function Qn(e){if(G(wi(e)))return e}function Jn(e,t){if("change"===e)return t}var Yn=!1;if(u){var Xn;if(u){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}Xn=Zn}else Xn=!1;Yn=Xn&&(!document.documentMode||9<document.documentMode)}function tr(){Kn&&(Kn.detachEvent("onpropertychange",nr),Gn=Kn=null)}function nr(e){if("value"===e.propertyName&&Qn(Gn)){var t=[];Hn(t,Gn,e,xe(e)),De(Wn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Gn=n,(Kn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Gn)}function or(e,t){if("click"===e)return Qn(t)}function sr(e,t){if("input"===e||"change"===e)return Qn(t)}var ar="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function lr(e,t){if(ar(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!d.call(t,i)||!ar(e[i],t[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function dr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hr(){for(var e=window,t=W();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=W((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=hr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&dr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=ur(n,o);var s=ur(n,r);i&&s&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gr=u&&"documentMode"in document&&11>=document.documentMode,mr=null,yr=null,vr=null,br=!1;function wr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==mr||mr!==W(r)||("selectionStart"in(r=mr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},vr&&lr(vr,r)||(vr=r,0<(r=Kr(yr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function xr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ir={animationend:xr("Animation","AnimationEnd"),animationiteration:xr("Animation","AnimationIteration"),animationstart:xr("Animation","AnimationStart"),transitionend:xr("Transition","TransitionEnd")},Sr={},Er={};function _r(e){if(Sr[e])return Sr[e];if(!Ir[e])return e;var t,n=Ir[e];for(t in n)if(n.hasOwnProperty(t)&&t in Er)return Sr[e]=n[t];return e}u&&(Er=document.createElement("div").style,"AnimationEvent"in window||(delete Ir.animationend.animation,delete Ir.animationiteration.animation,delete Ir.animationstart.animation),"TransitionEvent"in window||delete Ir.transitionend.transition);var Tr=_r("animationend"),kr=_r("animationiteration"),Cr=_r("animationstart"),Ar=_r("transitionend"),Nr=new Map,Dr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pr(e,t){Nr.set(e,t),l(t,[e])}for(var Rr=0;Rr<Dr.length;Rr++){var Or=Dr[Rr];Pr(Or.toLowerCase(),"on"+(Or[0].toUpperCase()+Or.slice(1)))}Pr(Tr,"onAnimationEnd"),Pr(kr,"onAnimationIteration"),Pr(Cr,"onAnimationStart"),Pr("dblclick","onDoubleClick"),Pr("focusin","onFocus"),Pr("focusout","onBlur"),Pr(Ar,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lr));function Mr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,s,a,l,c){if(Ue.apply(this,arguments),je){if(!je)throw Error(o(198));var u=Me;je=!1,Me=null,ze||(ze=!0,Fe=u)}}(r,t,void 0,e),e.currentTarget=null}function zr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;Mr(i,a,c),o=l}else for(s=0;s<r.length;s++){if(l=(a=r[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;Mr(i,a,c),o=l}}}if(ze)throw e=Fe,ze=!1,Fe=null,e}function Fr(e,t){var n=t[gi];void 0===n&&(n=t[gi]=new Set);var r=e+"__bubble";n.has(r)||(Br(t,e,2,!1),n.add(r))}function Vr(e,t,n){var r=0;t&&(r|=4),Br(n,e,r,t)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function $r(e){if(!e[Ur]){e[Ur]=!0,s.forEach((function(t){"selectionchange"!==t&&(jr.has(t)||Vr(t,!1,e),Vr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ur]||(t[Ur]=!0,Vr("selectionchange",!1,t))}}function Br(e,t,n,r){switch(Jt(t)){case 1:var i=Ht;break;case 4:i=Kt;break;default:i=Gt}n=i.bind(null,t,n,e),i=void 0,!Re||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function qr(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;s=s.return}for(;null!==a;){if(null===(s=vi(a)))return;if(5===(l=s.tag)||6===l){r=o=s;continue e}a=a.parentNode}}r=r.return}De((function(){var r=o,i=xe(n),s=[];e:{var a=Nr.get(e);if(void 0!==a){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=kn;break;case"focusin":c="focus",l=mn;break;case"focusout":c="blur",l=mn;break;case"beforeblur":case"afterblur":l=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=An;break;case Tr:case kr:case Cr:l=yn;break;case Ar:l=Nn;break;case"scroll":l=hn;break;case"wheel":l=Pn;break;case"copy":case"cut":case"paste":l=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Cn}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==a?a+"Capture":null:a;u=[];for(var f,p=r;null!==p;){var g=(f=p).stateNode;if(5===f.tag&&null!==g&&(f=g,null!==h&&(null!=(g=Pe(p,h))&&u.push(Hr(p,g,f)))),d)break;p=p.return}0<u.length&&(a=new l(a,c,null,n,i),s.push({event:a,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===we||!(c=n.relatedTarget||n.fromElement)||!vi(c)&&!c[pi])&&(l||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?vi(c):null)&&(c!==(d=$e(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=pn,g="onMouseLeave",h="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=Cn,g="onPointerLeave",h="onPointerEnter",p="pointer"),d=null==l?a:wi(l),f=null==c?a:wi(c),(a=new u(g,p+"leave",l,n,i)).target=d,a.relatedTarget=f,g=null,vi(i)===r&&((u=new u(h,p+"enter",c,n,i)).target=f,u.relatedTarget=d,g=u),d=g,l&&c)e:{for(h=c,p=0,f=u=l;f;f=Gr(f))p++;for(f=0,g=h;g;g=Gr(g))f++;for(;0<p-f;)u=Gr(u),p--;for(;0<f-p;)h=Gr(h),f--;for(;p--;){if(u===h||null!==h&&u===h.alternate)break e;u=Gr(u),h=Gr(h)}u=null}else u=null;null!==l&&Wr(s,a,l,u,!1),null!==c&&null!==d&&Wr(s,d,c,u,!0)}if("select"===(l=(a=r?wi(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var m=Jn;else if(qn(a))if(Yn)m=sr;else{m=ir;var y=rr}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(m=or);switch(m&&(m=m(e,r))?Hn(s,m,n,i):(y&&y(e,a,r),"focusout"===e&&(y=a._wrapperState)&&y.controlled&&"number"===a.type&&ee(a,"number",a.value)),y=r?wi(r):window,e){case"focusin":(qn(y)||"true"===y.contentEditable)&&(mr=y,yr=r,vr=null);break;case"focusout":vr=yr=mr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,wr(s,n,i);break;case"selectionchange":if(gr)break;case"keydown":case"keyup":wr(s,n,i)}var v;if(On)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else $n?Vn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Mn&&"ko"!==n.locale&&($n||"onCompositionStart"!==b?"onCompositionEnd"===b&&$n&&(v=en()):(Xt="value"in(Yt=i)?Yt.value:Yt.textContent,$n=!0)),0<(y=Kr(r,b)).length&&(b=new wn(b,e,null,n,i),s.push({event:b,listeners:y}),v?b.data=v:null!==(v=Un(n))&&(b.data=v))),(v=jn?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Fn=!0,zn);case"textInput":return(e=t.data)===zn&&Fn?null:e;default:return null}}(e,n):function(e,t){if($n)return"compositionend"===e||!On&&Vn(e,t)?(e=en(),Zt=Xt=Yt=null,$n=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Kr(r,"onBeforeInput")).length&&(i=new wn("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),i.data=v))}zr(s,t)}))}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Kr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=Pe(e,n))&&r.unshift(Hr(e,o,i)),null!=(o=Pe(e,t))&&r.push(Hr(e,o,i))),e=e.return}return r}function Gr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Wr(e,t,n,r,i){for(var o=t._reactName,s=[];null!==n&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===r)break;5===a.tag&&null!==c&&(a=c,i?null!=(l=Pe(n,o))&&s.unshift(Hr(n,l,a)):i||null!=(l=Pe(n,o))&&s.push(Hr(n,l,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Qr=/\r\n?/g,Jr=/\u0000|\uFFFD/g;function Yr(e){return("string"===typeof e?e:""+e).replace(Qr,"\n").replace(Jr,"")}function Xr(e,t,n){if(t=Yr(t),Yr(e)!==t&&n)throw Error(o(425))}function Zr(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,oi="function"===typeof Promise?Promise:void 0,si="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof oi?function(e){return oi.resolve(null).then(e).catch(ai)}:ri;function ai(e){setTimeout((function(){throw e}))}function li(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void $t(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);$t(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ui(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),hi="__reactFiber$"+di,fi="__reactProps$"+di,pi="__reactContainer$"+di,gi="__reactEvents$"+di,mi="__reactListeners$"+di,yi="__reactHandles$"+di;function vi(e){var t=e[hi];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pi]||n[hi]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ui(e);null!==e;){if(n=e[hi])return n;e=ui(e)}return t}n=(e=n).parentNode}return null}function bi(e){return!(e=e[hi]||e[pi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function wi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function xi(e){return e[fi]||null}var Ii=[],Si=-1;function Ei(e){return{current:e}}function _i(e){0>Si||(e.current=Ii[Si],Ii[Si]=null,Si--)}function Ti(e,t){Si++,Ii[Si]=e.current,e.current=t}var ki={},Ci=Ei(ki),Ai=Ei(!1),Ni=ki;function Di(e,t){var n=e.type.contextTypes;if(!n)return ki;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Pi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ri(){_i(Ai),_i(Ci)}function Oi(e,t,n){if(Ci.current!==ki)throw Error(o(168));Ti(Ci,t),Ti(Ai,n)}function Li(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(o(108,B(e)||"Unknown",i));return M({},n,r)}function ji(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ki,Ni=Ci.current,Ti(Ci,e),Ti(Ai,Ai.current),!0}function Mi(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=Li(e,t,Ni),r.__reactInternalMemoizedMergedChildContext=e,_i(Ai),_i(Ci),Ti(Ci,e)):_i(Ai),Ti(Ai,n)}var zi=null,Fi=!1,Vi=!1;function Ui(e){null===zi?zi=[e]:zi.push(e)}function $i(){if(!Vi&&null!==zi){Vi=!0;var e=0,t=bt;try{var n=zi;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}zi=null,Fi=!1}catch(i){throw null!==zi&&(zi=zi.slice(e+1)),Ge(Ze,$i),i}finally{bt=t,Vi=!1}}return null}var Bi=[],qi=0,Hi=null,Ki=0,Gi=[],Wi=0,Qi=null,Ji=1,Yi="";function Xi(e,t){Bi[qi++]=Ki,Bi[qi++]=Hi,Hi=e,Ki=t}function Zi(e,t,n){Gi[Wi++]=Ji,Gi[Wi++]=Yi,Gi[Wi++]=Qi,Qi=e;var r=Ji;e=Yi;var i=32-st(r)-1;r&=~(1<<i),n+=1;var o=32-st(t)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Ji=1<<32-st(t)+i|n<<i|r,Yi=o+e}else Ji=1<<o|n<<i|r,Yi=e}function eo(e){null!==e.return&&(Xi(e,1),Zi(e,1,0))}function to(e){for(;e===Hi;)Hi=Bi[--qi],Bi[qi]=null,Ki=Bi[--qi],Bi[qi]=null;for(;e===Qi;)Qi=Gi[--Wi],Gi[Wi]=null,Yi=Gi[--Wi],Gi[Wi]=null,Ji=Gi[--Wi],Gi[Wi]=null}var no=null,ro=null,io=!1,oo=null;function so(e,t){var n=Dc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ao(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,ro=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,ro=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qi?{id:Ji,overflow:Yi}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Dc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,ro=null,!0);default:return!1}}function lo(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function co(e){if(io){var t=ro;if(t){var n=t;if(!ao(e,t)){if(lo(e))throw Error(o(418));t=ci(n.nextSibling);var r=no;t&&ao(e,t)?so(r,n):(e.flags=-4097&e.flags|2,io=!1,no=e)}}else{if(lo(e))throw Error(o(418));e.flags=-4097&e.flags|2,io=!1,no=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!io)return uo(e),io=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ro)){if(lo(e))throw fo(),Error(o(418));for(;t;)so(e,t),t=ci(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ro=ci(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ro=null}}else ro=no?ci(e.stateNode.nextSibling):null;return!0}function fo(){for(var e=ro;e;)e=ci(e.nextSibling)}function po(){ro=no=null,io=!1}function go(e){null===oo?oo=[e]:oo.push(e)}var mo=w.ReactCurrentBatchConfig;function yo(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=r,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=i.refs;null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function vo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function bo(e){return(0,e._init)(e._payload)}function wo(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Rc(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Mc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var o=n.type;return o===S?d(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===P&&bo(o)===t.type)?((r=i(t,n.props)).ref=yo(e,t,n),r.return=e,r):((r=Oc(n.type,n.key,n.props,null,e.mode,r)).ref=yo(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=zc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function d(e,t,n,r,o){return null===t||7!==t.tag?((t=Lc(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Mc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case x:return(n=Oc(t.type,t.key,t.props,null,e.mode,n)).ref=yo(e,null,t),n.return=e,n;case I:return(t=zc(t,e.mode,n)).return=e,t;case P:return h(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Lc(t,e.mode,n,null)).return=e,t;vo(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return n.key===i?c(e,t,n,r):null;case I:return n.key===i?u(e,t,n,r):null;case P:return f(e,t,(i=n._init)(n._payload),r)}if(te(n)||L(n))return null!==i?null:d(e,t,n,r,null);vo(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case x:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case I:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case P:return p(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||L(r))return d(t,e=e.get(n)||null,r,i,null);vo(t,r)}return null}function g(i,o,a,l){for(var c=null,u=null,d=o,g=o=0,m=null;null!==d&&g<a.length;g++){d.index>g?(m=d,d=null):m=d.sibling;var y=f(i,d,a[g],l);if(null===y){null===d&&(d=m);break}e&&d&&null===y.alternate&&t(i,d),o=s(y,o,g),null===u?c=y:u.sibling=y,u=y,d=m}if(g===a.length)return n(i,d),io&&Xi(i,g),c;if(null===d){for(;g<a.length;g++)null!==(d=h(i,a[g],l))&&(o=s(d,o,g),null===u?c=d:u.sibling=d,u=d);return io&&Xi(i,g),c}for(d=r(i,d);g<a.length;g++)null!==(m=p(d,i,g,a[g],l))&&(e&&null!==m.alternate&&d.delete(null===m.key?g:m.key),o=s(m,o,g),null===u?c=m:u.sibling=m,u=m);return e&&d.forEach((function(e){return t(i,e)})),io&&Xi(i,g),c}function m(i,a,l,c){var u=L(l);if("function"!==typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var d=u=null,g=a,m=a=0,y=null,v=l.next();null!==g&&!v.done;m++,v=l.next()){g.index>m?(y=g,g=null):y=g.sibling;var b=f(i,g,v.value,c);if(null===b){null===g&&(g=y);break}e&&g&&null===b.alternate&&t(i,g),a=s(b,a,m),null===d?u=b:d.sibling=b,d=b,g=y}if(v.done)return n(i,g),io&&Xi(i,m),u;if(null===g){for(;!v.done;m++,v=l.next())null!==(v=h(i,v.value,c))&&(a=s(v,a,m),null===d?u=v:d.sibling=v,d=v);return io&&Xi(i,m),u}for(g=r(i,g);!v.done;m++,v=l.next())null!==(v=p(g,i,m,v.value,c))&&(e&&null!==v.alternate&&g.delete(null===v.key?m:v.key),a=s(v,a,m),null===d?u=v:d.sibling=v,d=v);return e&&g.forEach((function(e){return t(i,e)})),io&&Xi(i,m),u}return function e(r,o,s,l){if("object"===typeof s&&null!==s&&s.type===S&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case x:e:{for(var c=s.key,u=o;null!==u;){if(u.key===c){if((c=s.type)===S){if(7===u.tag){n(r,u.sibling),(o=i(u,s.props.children)).return=r,r=o;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===P&&bo(c)===u.type){n(r,u.sibling),(o=i(u,s.props)).ref=yo(r,u,s),o.return=r,r=o;break e}n(r,u);break}t(r,u),u=u.sibling}s.type===S?((o=Lc(s.props.children,r.mode,l,s.key)).return=r,r=o):((l=Oc(s.type,s.key,s.props,null,r.mode,l)).ref=yo(r,o,s),l.return=r,r=l)}return a(r);case I:e:{for(u=s.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){n(r,o.sibling),(o=i(o,s.children||[])).return=r,r=o;break e}n(r,o);break}t(r,o),o=o.sibling}(o=zc(s,r.mode,l)).return=r,r=o}return a(r);case P:return e(r,o,(u=s._init)(s._payload),l)}if(te(s))return g(r,o,s,l);if(L(s))return m(r,o,s,l);vo(r,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==o&&6===o.tag?(n(r,o.sibling),(o=i(o,s)).return=r,r=o):(n(r,o),(o=Mc(s,r.mode,l)).return=r,r=o),a(r)):n(r,o)}}var xo=wo(!0),Io=wo(!1),So=Ei(null),Eo=null,_o=null,To=null;function ko(){To=_o=Eo=null}function Co(e){var t=So.current;_i(So),e._currentValue=t}function Ao(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function No(e,t){Eo=e,To=_o=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ba=!0),e.firstContext=null)}function Do(e){var t=e._currentValue;if(To!==e)if(e={context:e,memoizedValue:t,next:null},null===_o){if(null===Eo)throw Error(o(308));_o=e,Eo.dependencies={lanes:0,firstContext:e}}else _o=_o.next=e;return t}var Po=null;function Ro(e){null===Po?Po=[e]:Po.push(e)}function Oo(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Ro(t)):(n.next=i.next,i.next=n),t.interleaved=n,Lo(e,r)}function Lo(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var jo=!1;function Mo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function zo(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Fo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Vo(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Cl)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,Lo(e,n)}return null===(i=r.interleaved)?(t.next=t,Ro(r)):(t.next=i.next,i.next=t),r.interleaved=t,Lo(e,n)}function Uo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}function $o(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Bo(e,t,n,r){var i=e.updateQueue;jo=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==o){var d=i.baseState;for(s=0,u=c=l=null,a=o;;){var h=a.lane,f=a.eventTime;if((r&h)===h){null!==u&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=e,g=a;switch(h=t,f=n,g.tag){case 1:if("function"===typeof(p=g.payload)){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(h="function"===typeof(p=g.payload)?p.call(f,d,h):p)||void 0===h)break e;d=M({},d,h);break e;case 2:jo=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=f,l=d):u=u.next=f,s|=h;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(h=a).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{s|=i.lane,i=i.next}while(i!==t)}else null===o&&(i.shared.lanes=0);jl|=s,e.lanes=s,e.memoizedState=d}}function qo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(o(191,i));i.call(r)}}}var Ho={},Ko=Ei(Ho),Go=Ei(Ho),Wo=Ei(Ho);function Qo(e){if(e===Ho)throw Error(o(174));return e}function Jo(e,t){switch(Ti(Wo,t),Ti(Go,e),Ti(Ko,Ho),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}_i(Ko),Ti(Ko,t)}function Yo(){_i(Ko),_i(Go),_i(Wo)}function Xo(e){Qo(Wo.current);var t=Qo(Ko.current),n=le(t,e.type);t!==n&&(Ti(Go,e),Ti(Ko,n))}function Zo(e){Go.current===e&&(_i(Ko),_i(Go))}var es=Ei(0);function ts(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ns=[];function rs(){for(var e=0;e<ns.length;e++)ns[e]._workInProgressVersionPrimary=null;ns.length=0}var is=w.ReactCurrentDispatcher,os=w.ReactCurrentBatchConfig,ss=0,as=null,ls=null,cs=null,us=!1,ds=!1,hs=0,fs=0;function ps(){throw Error(o(321))}function gs(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ar(e[n],t[n]))return!1;return!0}function ms(e,t,n,r,i,s){if(ss=s,as=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,is.current=null===e||null===e.memoizedState?Zs:ea,e=n(r,i),ds){s=0;do{if(ds=!1,hs=0,25<=s)throw Error(o(301));s+=1,cs=ls=null,t.updateQueue=null,is.current=ta,e=n(r,i)}while(ds)}if(is.current=Xs,t=null!==ls&&null!==ls.next,ss=0,cs=ls=as=null,us=!1,t)throw Error(o(300));return e}function ys(){var e=0!==hs;return hs=0,e}function vs(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===cs?as.memoizedState=cs=e:cs=cs.next=e,cs}function bs(){if(null===ls){var e=as.alternate;e=null!==e?e.memoizedState:null}else e=ls.next;var t=null===cs?as.memoizedState:cs.next;if(null!==t)cs=t,ls=e;else{if(null===e)throw Error(o(310));e={memoizedState:(ls=e).memoizedState,baseState:ls.baseState,baseQueue:ls.baseQueue,queue:ls.queue,next:null},null===cs?as.memoizedState=cs=e:cs=cs.next=e}return cs}function ws(e,t){return"function"===typeof t?t(e):t}function xs(e){var t=bs(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=ls,i=r.baseQueue,s=n.pending;if(null!==s){if(null!==i){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,n.pending=null}if(null!==i){s=i.next,r=r.baseState;var l=a=null,c=null,u=s;do{var d=u.lane;if((ss&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,a=r):c=c.next=h,as.lanes|=d,jl|=d}u=u.next}while(null!==u&&u!==s);null===c?a=r:c.next=l,ar(r,t.memoizedState)||(ba=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{s=i.lane,as.lanes|=s,jl|=s,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Is(e){var t=bs(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,s=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{s=e(s,a.action),a=a.next}while(a!==i);ar(s,t.memoizedState)||(ba=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function Ss(){}function Es(e,t){var n=as,r=bs(),i=t(),s=!ar(r.memoizedState,i);if(s&&(r.memoizedState=i,ba=!0),r=r.queue,js(ks.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==cs&&1&cs.memoizedState.tag){if(n.flags|=2048,Ds(9,Ts.bind(null,n,r,i,t),void 0,null),null===Al)throw Error(o(349));0!==(30&ss)||_s(n,t,i)}return i}function _s(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=as.updateQueue)?(t={lastEffect:null,stores:null},as.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ts(e,t,n,r){t.value=n,t.getSnapshot=r,Cs(t)&&As(e)}function ks(e,t,n){return n((function(){Cs(t)&&As(e)}))}function Cs(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ar(e,n)}catch(r){return!0}}function As(e){var t=Lo(e,1);null!==t&&nc(t,e,1,-1)}function Ns(e){var t=vs();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ws,lastRenderedState:e},t.queue=e,e=e.dispatch=Ws.bind(null,as,e),[t.memoizedState,e]}function Ds(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=as.updateQueue)?(t={lastEffect:null,stores:null},as.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Ps(){return bs().memoizedState}function Rs(e,t,n,r){var i=vs();as.flags|=e,i.memoizedState=Ds(1|t,n,void 0,void 0===r?null:r)}function Os(e,t,n,r){var i=bs();r=void 0===r?null:r;var o=void 0;if(null!==ls){var s=ls.memoizedState;if(o=s.destroy,null!==r&&gs(r,s.deps))return void(i.memoizedState=Ds(t,n,o,r))}as.flags|=e,i.memoizedState=Ds(1|t,n,o,r)}function Ls(e,t){return Rs(8390656,8,e,t)}function js(e,t){return Os(2048,8,e,t)}function Ms(e,t){return Os(4,2,e,t)}function zs(e,t){return Os(4,4,e,t)}function Fs(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Vs(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Os(4,4,Fs.bind(null,t,e),n)}function Us(){}function $s(e,t){var n=bs();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&gs(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Bs(e,t){var n=bs();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&gs(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function qs(e,t,n){return 0===(21&ss)?(e.baseState&&(e.baseState=!1,ba=!0),e.memoizedState=n):(ar(n,t)||(n=gt(),as.lanes|=n,jl|=n,e.baseState=!0),t)}function Hs(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=os.transition;os.transition={};try{e(!1),t()}finally{bt=n,os.transition=r}}function Ks(){return bs().memoizedState}function Gs(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Qs(e))Js(t,n);else if(null!==(n=Oo(e,t,n,r))){nc(n,e,r,ec()),Ys(n,t,r)}}function Ws(e,t,n){var r=tc(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Qs(e))Js(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,ar(a,s)){var l=t.interleaved;return null===l?(i.next=i,Ro(t)):(i.next=l.next,l.next=i),void(t.interleaved=i)}}catch(c){}null!==(n=Oo(e,t,i,r))&&(nc(n,e,r,i=ec()),Ys(n,t,r))}}function Qs(e){var t=e.alternate;return e===as||null!==t&&t===as}function Js(e,t){ds=us=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Ys(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,vt(e,n)}}var Xs={readContext:Do,useCallback:ps,useContext:ps,useEffect:ps,useImperativeHandle:ps,useInsertionEffect:ps,useLayoutEffect:ps,useMemo:ps,useReducer:ps,useRef:ps,useState:ps,useDebugValue:ps,useDeferredValue:ps,useTransition:ps,useMutableSource:ps,useSyncExternalStore:ps,useId:ps,unstable_isNewReconciler:!1},Zs={readContext:Do,useCallback:function(e,t){return vs().memoizedState=[e,void 0===t?null:t],e},useContext:Do,useEffect:Ls,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Rs(4194308,4,Fs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Rs(4194308,4,e,t)},useInsertionEffect:function(e,t){return Rs(4,2,e,t)},useMemo:function(e,t){var n=vs();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=vs();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Gs.bind(null,as,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},vs().memoizedState=e},useState:Ns,useDebugValue:Us,useDeferredValue:function(e){return vs().memoizedState=e},useTransition:function(){var e=Ns(!1),t=e[0];return e=Hs.bind(null,e[1]),vs().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=as,i=vs();if(io){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Al)throw Error(o(349));0!==(30&ss)||_s(r,t,n)}i.memoizedState=n;var s={value:n,getSnapshot:t};return i.queue=s,Ls(ks.bind(null,r,s,e),[e]),r.flags|=2048,Ds(9,Ts.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=vs(),t=Al.identifierPrefix;if(io){var n=Yi;t=":"+t+"R"+(n=(Ji&~(1<<32-st(Ji)-1)).toString(32)+n),0<(n=hs++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=fs++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ea={readContext:Do,useCallback:$s,useContext:Do,useEffect:js,useImperativeHandle:Vs,useInsertionEffect:Ms,useLayoutEffect:zs,useMemo:Bs,useReducer:xs,useRef:Ps,useState:function(){return xs(ws)},useDebugValue:Us,useDeferredValue:function(e){return qs(bs(),ls.memoizedState,e)},useTransition:function(){return[xs(ws)[0],bs().memoizedState]},useMutableSource:Ss,useSyncExternalStore:Es,useId:Ks,unstable_isNewReconciler:!1},ta={readContext:Do,useCallback:$s,useContext:Do,useEffect:js,useImperativeHandle:Vs,useInsertionEffect:Ms,useLayoutEffect:zs,useMemo:Bs,useReducer:Is,useRef:Ps,useState:function(){return Is(ws)},useDebugValue:Us,useDeferredValue:function(e){var t=bs();return null===ls?t.memoizedState=e:qs(t,ls.memoizedState,e)},useTransition:function(){return[Is(ws)[0],bs().memoizedState]},useMutableSource:Ss,useSyncExternalStore:Es,useId:Ks,unstable_isNewReconciler:!1};function na(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function ra(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var ia={isMounted:function(e){return!!(e=e._reactInternals)&&$e(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),o=Fo(r,i);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Vo(e,o,i))&&(nc(t,e,i,r),Uo(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),i=tc(e),o=Fo(r,i);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Vo(e,o,i))&&(nc(t,e,i,r),Uo(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),i=Fo(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Vo(e,i,r))&&(nc(t,e,r,n),Uo(t,e,r))}};function oa(e,t,n,r,i,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(i,o))}function sa(e,t,n){var r=!1,i=ki,o=t.contextType;return"object"===typeof o&&null!==o?o=Do(o):(i=Pi(t)?Ni:Ci.current,o=(r=null!==(r=t.contextTypes)&&void 0!==r)?Di(e,i):ki),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ia,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function aa(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ia.enqueueReplaceState(t,t.state,null)}function la(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs={},Mo(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=Do(o):(o=Pi(t)?Ni:Ci.current,i.context=Di(e,o)),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(ra(e,t,o,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&ia.enqueueReplaceState(i,i.state,null),Bo(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function ca(e,t){try{var n="",r=t;do{n+=U(r),r=r.return}while(r);var i=n}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i,digest:null}}function ua(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function da(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ha="function"===typeof WeakMap?WeakMap:Map;function fa(e,t,n){(n=Fo(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){ql||(ql=!0,Hl=r),da(0,t)},n}function pa(e,t,n){(n=Fo(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){da(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){da(0,t),"function"!==typeof r&&(null===Kl?Kl=new Set([this]):Kl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ga(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ha;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=_c.bind(null,e,t,n),t.then(e,e))}function ma(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ya(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Fo(-1,1)).tag=2,Vo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var va=w.ReactCurrentOwner,ba=!1;function wa(e,t,n,r){t.child=null===e?Io(t,null,n,r):xo(t,e.child,n,r)}function xa(e,t,n,r,i){n=n.render;var o=t.ref;return No(t,i),r=ms(e,t,n,r,o,i),n=ys(),null===e||ba?(io&&n&&eo(t),t.flags|=1,wa(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,qa(e,t,i))}function Ia(e,t,n,r,i){if(null===e){var o=n.type;return"function"!==typeof o||Pc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Oc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Sa(e,t,o,r,i))}if(o=e.child,0===(e.lanes&i)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(s,r)&&e.ref===t.ref)return qa(e,t,i)}return t.flags|=1,(e=Rc(o,r)).ref=t.ref,e.return=t,t.child=e}function Sa(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(lr(o,r)&&e.ref===t.ref){if(ba=!1,t.pendingProps=r=o,0===(e.lanes&i))return t.lanes=e.lanes,qa(e,t,i);0!==(131072&e.flags)&&(ba=!0)}}return Ta(e,t,n,r,i)}function Ea(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ti(Rl,Pl),Pl|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ti(Rl,Pl),Pl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==o?o.baseLanes:n,Ti(Rl,Pl),Pl|=r}else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,Ti(Rl,Pl),Pl|=r;return wa(e,t,i,n),t.child}function _a(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ta(e,t,n,r,i){var o=Pi(n)?Ni:Ci.current;return o=Di(t,o),No(t,i),n=ms(e,t,n,r,o,i),r=ys(),null===e||ba?(io&&r&&eo(t),t.flags|=1,wa(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,qa(e,t,i))}function ka(e,t,n,r,i){if(Pi(n)){var o=!0;ji(t)}else o=!1;if(No(t,i),null===t.stateNode)Ba(e,t),sa(t,n,r),la(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=Do(c):c=Di(t,c=Pi(n)?Ni:Ci.current);var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate;d||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==r||l!==c)&&aa(t,s,r,c),jo=!1;var h=t.memoizedState;s.state=h,Bo(t,r,s,i),l=t.memoizedState,a!==r||h!==l||Ai.current||jo?("function"===typeof u&&(ra(t,n,u,r),l=t.memoizedState),(a=jo||oa(t,n,a,r,h,l,c))?(d||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),s.props=r,s.state=l,s.context=c,r=a):("function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,zo(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:na(t.type,a),s.props=c,d=t.pendingProps,h=s.context,"object"===typeof(l=n.contextType)&&null!==l?l=Do(l):l=Di(t,l=Pi(n)?Ni:Ci.current);var f=n.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==d||h!==l)&&aa(t,s,r,l),jo=!1,h=t.memoizedState,s.state=h,Bo(t,r,s,i);var p=t.memoizedState;a!==d||h!==p||Ai.current||jo?("function"===typeof f&&(ra(t,n,f,r),p=t.memoizedState),(c=jo||oa(t,n,c,r,h,p,l)||!1)?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,p,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,p,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),s.props=r,s.state=p,s.context=l,r=c):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Ca(e,t,n,r,o,i)}function Ca(e,t,n,r,i,o){_a(e,t);var s=0!==(128&t.flags);if(!r&&!s)return i&&Mi(t,n,!1),qa(e,t,o);r=t.stateNode,va.current=t;var a=s&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=xo(t,e.child,null,o),t.child=xo(t,null,a,o)):wa(e,t,a,o),t.memoizedState=r.state,i&&Mi(t,n,!0),t.child}function Aa(e){var t=e.stateNode;t.pendingContext?Oi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Oi(0,t.context,!1),Jo(e,t.containerInfo)}function Na(e,t,n,r,i){return po(),go(i),t.flags|=256,wa(e,t,n,r),t.child}var Da,Pa,Ra,Oa,La={dehydrated:null,treeContext:null,retryLane:0};function ja(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ma(e,t,n){var r,i=t.pendingProps,s=es.current,a=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&s)),r?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Ti(es,1&s),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=i.children,e=i.fallback,a?(i=t.mode,a=t.child,l={mode:"hidden",children:l},0===(1&i)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=jc(l,i,0,null),e=Lc(e,i,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=ja(n),t.memoizedState=La,e):za(t,l));if(null!==(s=e.memoizedState)&&null!==(r=s.dehydrated))return function(e,t,n,r,i,s,a){if(n)return 256&t.flags?(t.flags&=-257,Fa(e,t,a,r=ua(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,i=t.mode,r=jc({mode:"visible",children:r.children},i,0,null),(s=Lc(s,i,a,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,0!==(1&t.mode)&&xo(t,e.child,null,a),t.child.memoizedState=ja(a),t.memoizedState=La,s);if(0===(1&t.mode))return Fa(e,t,a,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var l=r.dgst;return r=l,Fa(e,t,a,r=ua(s=Error(o(419)),r,void 0))}if(l=0!==(a&e.childLanes),ba||l){if(null!==(r=Al)){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|a))?0:i)&&i!==s.retryLane&&(s.retryLane=i,Lo(e,i),nc(r,e,i,-1))}return gc(),Fa(e,t,a,r=ua(Error(o(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=kc.bind(null,e),i._reactRetry=t,null):(e=s.treeContext,ro=ci(i.nextSibling),no=t,io=!0,oo=null,null!==e&&(Gi[Wi++]=Ji,Gi[Wi++]=Yi,Gi[Wi++]=Qi,Ji=e.id,Yi=e.overflow,Qi=t),t=za(t,r.children),t.flags|=4096,t)}(e,t,l,i,r,s,n);if(a){a=i.fallback,l=t.mode,r=(s=e.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&l)&&t.child!==s?((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null):(i=Rc(s,c)).subtreeFlags=14680064&s.subtreeFlags,null!==r?a=Rc(r,a):(a=Lc(a,l,n,null)).flags|=2,a.return=t,i.return=t,i.sibling=a,t.child=i,i=a,a=t.child,l=null===(l=e.child.memoizedState)?ja(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~n,t.memoizedState=La,i}return e=(a=e.child).sibling,i=Rc(a,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function za(e,t){return(t=jc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Fa(e,t,n,r){return null!==r&&go(r),xo(t,e.child,null,n),(e=za(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Va(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Ao(e.return,t,n)}function Ua(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function $a(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(wa(e,t,r.children,n),0!==(2&(r=es.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Va(e,n,t);else if(19===e.tag)Va(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ti(es,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===ts(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Ua(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ts(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Ua(t,!0,n,null,o);break;case"together":Ua(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ba(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qa(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),jl|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Rc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Rc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ha(e,t){if(!io)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ka(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ga(e,t,n){var r=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ka(t),null;case 1:case 17:return Pi(t.type)&&Ri(),Ka(t),null;case 3:return r=t.stateNode,Yo(),_i(Ai),_i(Ci),rs(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(sc(oo),oo=null))),Pa(e,t),Ka(t),null;case 5:Zo(t);var i=Qo(Wo.current);if(n=t.type,null!==e&&null!=t.stateNode)Ra(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(o(166));return Ka(t),null}if(e=Qo(Ko.current),ho(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[hi]=t,r[fi]=s,e=0!==(1&t.mode),n){case"dialog":Fr("cancel",r),Fr("close",r);break;case"iframe":case"object":case"embed":Fr("load",r);break;case"video":case"audio":for(i=0;i<Lr.length;i++)Fr(Lr[i],r);break;case"source":Fr("error",r);break;case"img":case"image":case"link":Fr("error",r),Fr("load",r);break;case"details":Fr("toggle",r);break;case"input":J(r,s),Fr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Fr("invalid",r);break;case"textarea":ie(r,s),Fr("invalid",r)}for(var l in ve(n,s),i=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==s.suppressHydrationWarning&&Xr(r.textContent,c,e),i=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&Xr(r.textContent,c,e),i=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Fr("scroll",r)}switch(n){case"input":K(r),Z(r,s,!0);break;case"textarea":K(r),se(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=Zr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[hi]=t,e[fi]=r,Da(e,t,!1,!1),t.stateNode=e;e:{switch(l=be(n,r),n){case"dialog":Fr("cancel",e),Fr("close",e),i=r;break;case"iframe":case"object":case"embed":Fr("load",e),i=r;break;case"video":case"audio":for(i=0;i<Lr.length;i++)Fr(Lr[i],e);i=r;break;case"source":Fr("error",e),i=r;break;case"img":case"image":case"link":Fr("error",e),Fr("load",e),i=r;break;case"details":Fr("toggle",e),i=r;break;case"input":J(e,r),i=Q(e,r),Fr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=M({},r,{value:void 0}),Fr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Fr("invalid",e)}for(s in ve(n,i),c=i)if(c.hasOwnProperty(s)){var u=c[s];"style"===s?me(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===s?"string"===typeof u?("textarea"!==n||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(a.hasOwnProperty(s)?null!=u&&"onScroll"===s&&Fr("scroll",e):null!=u&&b(e,s,u,l))}switch(n){case"input":K(e),Z(e,r,!1);break;case"textarea":K(e),se(e);break;case"option":null!=r.value&&e.setAttribute("value",""+q(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?ne(e,!!r.multiple,s,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ka(t),null;case 6:if(e&&null!=t.stateNode)Oa(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));if(n=Qo(Wo.current),Qo(Ko.current),ho(t)){if(r=t.stateNode,n=t.memoizedProps,r[hi]=t,(s=r.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:Xr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Xr(r.nodeValue,n,0!==(1&e.mode))}s&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[hi]=t,t.stateNode=r}return Ka(t),null;case 13:if(_i(es),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(io&&null!==ro&&0!==(1&t.mode)&&0===(128&t.flags))fo(),po(),t.flags|=98560,s=!1;else if(s=ho(t),null!==r&&null!==r.dehydrated){if(null===e){if(!s)throw Error(o(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(o(317));s[hi]=t}else po(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ka(t),s=!1}else null!==oo&&(sc(oo),oo=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&es.current)?0===Ol&&(Ol=3):gc())),null!==t.updateQueue&&(t.flags|=4),Ka(t),null);case 4:return Yo(),Pa(e,t),null===e&&$r(t.stateNode.containerInfo),Ka(t),null;case 10:return Co(t.type._context),Ka(t),null;case 19:if(_i(es),null===(s=t.memoizedState))return Ka(t),null;if(r=0!==(128&t.flags),null===(l=s.rendering))if(r)Ha(s,!1);else{if(0!==Ol||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ts(e))){for(t.flags|=128,Ha(s,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=14680066,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ti(es,1&es.current|2),t.child}e=e.sibling}null!==s.tail&&Ye()>$l&&(t.flags|=128,r=!0,Ha(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=ts(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ha(s,!0),null===s.tail&&"hidden"===s.tailMode&&!l.alternate&&!io)return Ka(t),null}else 2*Ye()-s.renderingStartTime>$l&&1073741824!==n&&(t.flags|=128,r=!0,Ha(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=s.last)?n.sibling=l:t.child=l,s.last=l)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Ye(),t.sibling=null,n=es.current,Ti(es,r?1&n|2:1&n),t):(Ka(t),null);case 22:case 23:return dc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Pl)&&(Ka(t),6&t.subtreeFlags&&(t.flags|=8192)):Ka(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Wa(e,t){switch(to(t),t.tag){case 1:return Pi(t.type)&&Ri(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Yo(),_i(Ai),_i(Ci),rs(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Zo(t),null;case 13:if(_i(es),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));po()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return _i(es),null;case 4:return Yo(),null;case 10:return Co(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Da=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Pa=function(){},Ra=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,Qo(Ko.current);var o,s=null;switch(n){case"input":i=Q(e,i),r=Q(e,r),s=[];break;case"select":i=M({},i,{value:void 0}),r=M({},r,{value:void 0}),s=[];break;case"textarea":i=re(e,i),r=re(e,r),s=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(u in ve(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Fr("scroll",e),s||l===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},Oa=function(e,t,n,r){n!==r&&(t.flags|=4)};var Qa=!1,Ja=!1,Ya="function"===typeof WeakSet?WeakSet:Set,Xa=null;function Za(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Ec(e,t,r)}else n.current=null}function el(e,t,n){try{n()}catch(r){Ec(e,t,r)}}var tl=!1;function nl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,void 0!==o&&el(t,n,o)}i=i.next}while(i!==r)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function il(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ol(e){var t=e.alternate;null!==t&&(e.alternate=null,ol(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hi],delete t[fi],delete t[gi],delete t[mi],delete t[yi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function sl(e){return 5===e.tag||3===e.tag||4===e.tag}function al(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(ll(e,t,n),e=e.sibling;null!==e;)ll(e,t,n),e=e.sibling}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}var ul=null,dl=!1;function hl(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(it,n)}catch(a){}switch(n.tag){case 5:Ja||Za(n,t);case 6:var r=ul,i=dl;ul=null,hl(e,t,n),dl=i,null!==(ul=r)&&(dl?(e=ul,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):ul.removeChild(n.stateNode));break;case 18:null!==ul&&(dl?(e=ul,n=n.stateNode,8===e.nodeType?li(e.parentNode,n):1===e.nodeType&&li(e,n),$t(e)):li(ul,n.stateNode));break;case 4:r=ul,i=dl,ul=n.stateNode.containerInfo,dl=!0,hl(e,t,n),ul=r,dl=i;break;case 0:case 11:case 14:case 15:if(!Ja&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,void 0!==s&&(0!==(2&o)||0!==(4&o))&&el(n,t,s),i=i.next}while(i!==r)}hl(e,t,n);break;case 1:if(!Ja&&(Za(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Ec(n,t,a)}hl(e,t,n);break;case 21:hl(e,t,n);break;case 22:1&n.mode?(Ja=(r=Ja)||null!==n.memoizedState,hl(e,t,n),Ja=r):hl(e,t,n);break;default:hl(e,t,n)}}function pl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ya),t.forEach((function(t){var r=Cc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function gl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var s=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:ul=l.stateNode,dl=!1;break e;case 3:case 4:ul=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===ul)throw Error(o(160));fl(s,a,i),ul=null,dl=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(u){Ec(i,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)ml(t,e),t=t.sibling}function ml(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(gl(t,e),yl(e),4&r){try{nl(3,e,e.return),rl(3,e)}catch(m){Ec(e,e.return,m)}try{nl(5,e,e.return)}catch(m){Ec(e,e.return,m)}}break;case 1:gl(t,e),yl(e),512&r&&null!==n&&Za(n,n.return);break;case 5:if(gl(t,e),yl(e),512&r&&null!==n&&Za(n,n.return),32&e.flags){var i=e.stateNode;try{he(i,"")}catch(m){Ec(e,e.return,m)}}if(4&r&&null!=(i=e.stateNode)){var s=e.memoizedProps,a=null!==n?n.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&Y(i,s),be(l,a);var u=be(l,s);for(a=0;a<c.length;a+=2){var d=c[a],h=c[a+1];"style"===d?me(i,h):"dangerouslySetInnerHTML"===d?de(i,h):"children"===d?he(i,h):b(i,d,h,u)}switch(l){case"input":X(i,s);break;case"textarea":oe(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var p=s.value;null!=p?ne(i,!!s.multiple,p,!1):f!==!!s.multiple&&(null!=s.defaultValue?ne(i,!!s.multiple,s.defaultValue,!0):ne(i,!!s.multiple,s.multiple?[]:"",!1))}i[fi]=s}catch(m){Ec(e,e.return,m)}}break;case 6:if(gl(t,e),yl(e),4&r){if(null===e.stateNode)throw Error(o(162));i=e.stateNode,s=e.memoizedProps;try{i.nodeValue=s}catch(m){Ec(e,e.return,m)}}break;case 3:if(gl(t,e),yl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{$t(t.containerInfo)}catch(m){Ec(e,e.return,m)}break;case 4:default:gl(t,e),yl(e);break;case 13:gl(t,e),yl(e),8192&(i=e.child).flags&&(s=null!==i.memoizedState,i.stateNode.isHidden=s,!s||null!==i.alternate&&null!==i.alternate.memoizedState||(Ul=Ye())),4&r&&pl(e);break;case 22:if(d=null!==n&&null!==n.memoizedState,1&e.mode?(Ja=(u=Ja)||d,gl(t,e),Ja=u):gl(t,e),yl(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Xa=e,d=e.child;null!==d;){for(h=Xa=d;null!==Xa;){switch(p=(f=Xa).child,f.tag){case 0:case 11:case 14:case 15:nl(4,f,f.return);break;case 1:Za(f,f.return);var g=f.stateNode;if("function"===typeof g.componentWillUnmount){r=f,n=f.return;try{t=r,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(m){Ec(r,n,m)}}break;case 5:Za(f,f.return);break;case 22:if(null!==f.memoizedState){xl(h);continue}}null!==p?(p.return=f,Xa=p):xl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{i=h.stateNode,u?"function"===typeof(s=i.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=h.stateNode,a=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=ge("display",a))}catch(m){Ec(e,e.return,m)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(m){Ec(e,e.return,m)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:gl(t,e),yl(e),4&r&&pl(e);case 21:}}function yl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(sl(n)){var r=n;break e}n=n.return}throw Error(o(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(he(i,""),r.flags&=-33),cl(e,al(e),i);break;case 3:case 4:var s=r.stateNode.containerInfo;ll(e,al(e),s);break;default:throw Error(o(161))}}catch(a){Ec(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function vl(e,t,n){Xa=e,bl(e,t,n)}function bl(e,t,n){for(var r=0!==(1&e.mode);null!==Xa;){var i=Xa,o=i.child;if(22===i.tag&&r){var s=null!==i.memoizedState||Qa;if(!s){var a=i.alternate,l=null!==a&&null!==a.memoizedState||Ja;a=Qa;var c=Ja;if(Qa=s,(Ja=l)&&!c)for(Xa=i;null!==Xa;)l=(s=Xa).child,22===s.tag&&null!==s.memoizedState?Il(i):null!==l?(l.return=s,Xa=l):Il(i);for(;null!==o;)Xa=o,bl(o,t,n),o=o.sibling;Xa=i,Qa=a,Ja=c}wl(e)}else 0!==(8772&i.subtreeFlags)&&null!==o?(o.return=i,Xa=o):wl(e)}}function wl(e){for(;null!==Xa;){var t=Xa;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ja||rl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Ja)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:na(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&qo(t,s,r);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}qo(t,a,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&$t(h)}}}break;default:throw Error(o(163))}Ja||512&t.flags&&il(t)}catch(f){Ec(t,t.return,f)}}if(t===e){Xa=null;break}if(null!==(n=t.sibling)){n.return=t.return,Xa=n;break}Xa=t.return}}function xl(e){for(;null!==Xa;){var t=Xa;if(t===e){Xa=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Xa=n;break}Xa=t.return}}function Il(e){for(;null!==Xa;){var t=Xa;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{rl(4,t)}catch(l){Ec(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(l){Ec(t,i,l)}}var o=t.return;try{il(t)}catch(l){Ec(t,o,l)}break;case 5:var s=t.return;try{il(t)}catch(l){Ec(t,s,l)}}}catch(l){Ec(t,t.return,l)}if(t===e){Xa=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Xa=a;break}Xa=t.return}}var Sl,El=Math.ceil,_l=w.ReactCurrentDispatcher,Tl=w.ReactCurrentOwner,kl=w.ReactCurrentBatchConfig,Cl=0,Al=null,Nl=null,Dl=0,Pl=0,Rl=Ei(0),Ol=0,Ll=null,jl=0,Ml=0,zl=0,Fl=null,Vl=null,Ul=0,$l=1/0,Bl=null,ql=!1,Hl=null,Kl=null,Gl=!1,Wl=null,Ql=0,Jl=0,Yl=null,Xl=-1,Zl=0;function ec(){return 0!==(6&Cl)?Ye():-1!==Xl?Xl:Xl=Ye()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Cl)&&0!==Dl?Dl&-Dl:null!==mo.transition?(0===Zl&&(Zl=gt()),Zl):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Jt(e.type)}function nc(e,t,n,r){if(50<Jl)throw Jl=0,Yl=null,Error(o(185));yt(e,n,r),0!==(2&Cl)&&e===Al||(e===Al&&(0===(2&Cl)&&(Ml|=n),4===Ol&&ac(e,Dl)),rc(e,r),1===n&&0===Cl&&0===(1&t.mode)&&($l=Ye()+500,Fi&&$i()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-st(o),a=1<<s,l=i[s];-1===l?0!==(a&n)&&0===(a&r)||(i[s]=ft(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var r=ht(e,e===Al?Dl:0);if(0===r)null!==n&&We(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&We(n),1===t)0===e.tag?function(e){Fi=!0,Ui(e)}(lc.bind(null,e)):Ui(lc.bind(null,e)),si((function(){0===(6&Cl)&&$i()})),n=null;else{switch(wt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Ac(n,ic.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ic(e,t){if(Xl=-1,Zl=0,0!==(6&Cl))throw Error(o(327));var n=e.callbackNode;if(Ic()&&e.callbackNode!==n)return null;var r=ht(e,e===Al?Dl:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=mc(e,r);else{t=r;var i=Cl;Cl|=2;var s=pc();for(Al===e&&Dl===t||(Bl=null,$l=Ye()+500,hc(e,t));;)try{vc();break}catch(l){fc(e,l)}ko(),_l.current=s,Cl=i,null!==Nl?t=0:(Al=null,Dl=0,t=Ol)}if(0!==t){if(2===t&&(0!==(i=pt(e))&&(r=i,t=oc(e,i))),1===t)throw n=Ll,hc(e,0),ac(e,r),rc(e,Ye()),n;if(6===t)ac(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!ar(o(),i))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=mc(e,r))&&(0!==(s=pt(e))&&(r=s,t=oc(e,s))),1===t))throw n=Ll,hc(e,0),ac(e,r),rc(e,Ye()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(o(345));case 2:case 5:xc(e,Vl,Bl);break;case 3:if(ac(e,r),(130023424&r)===r&&10<(t=Ul+500-Ye())){if(0!==ht(e,0))break;if(((i=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(xc.bind(null,e,Vl,Bl),t);break}xc(e,Vl,Bl);break;case 4:if(ac(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var a=31-st(r);s=1<<a,(a=t[a])>i&&(i=a),r&=~s}if(r=i,10<(r=(120>(r=Ye()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*El(r/1960))-r)){e.timeoutHandle=ri(xc.bind(null,e,Vl,Bl),r);break}xc(e,Vl,Bl);break;default:throw Error(o(329))}}}return rc(e,Ye()),e.callbackNode===n?ic.bind(null,e):null}function oc(e,t){var n=Fl;return e.current.memoizedState.isDehydrated&&(hc(e,t).flags|=256),2!==(e=mc(e,t))&&(t=Vl,Vl=n,null!==t&&sc(t)),e}function sc(e){null===Vl?Vl=e:Vl.push.apply(Vl,e)}function ac(e,t){for(t&=~zl,t&=~Ml,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),r=1<<n;e[n]=-1,t&=~r}}function lc(e){if(0!==(6&Cl))throw Error(o(327));Ic();var t=ht(e,0);if(0===(1&t))return rc(e,Ye()),null;var n=mc(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=oc(e,r))}if(1===n)throw n=Ll,hc(e,0),ac(e,t),rc(e,Ye()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,xc(e,Vl,Bl),rc(e,Ye()),null}function cc(e,t){var n=Cl;Cl|=1;try{return e(t)}finally{0===(Cl=n)&&($l=Ye()+500,Fi&&$i())}}function uc(e){null!==Wl&&0===Wl.tag&&0===(6&Cl)&&Ic();var t=Cl;Cl|=1;var n=kl.transition,r=bt;try{if(kl.transition=null,bt=1,e)return e()}finally{bt=r,kl.transition=n,0===(6&(Cl=t))&&$i()}}function dc(){Pl=Rl.current,_i(Rl)}function hc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Nl)for(n=Nl.return;null!==n;){var r=n;switch(to(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Ri();break;case 3:Yo(),_i(Ai),_i(Ci),rs();break;case 5:Zo(r);break;case 4:Yo();break;case 13:case 19:_i(es);break;case 10:Co(r.type._context);break;case 22:case 23:dc()}n=n.return}if(Al=e,Nl=e=Rc(e.current,null),Dl=Pl=t,Ol=0,Ll=null,zl=Ml=jl=0,Vl=Fl=null,null!==Po){for(t=0;t<Po.length;t++)if(null!==(r=(n=Po[t]).interleaved)){n.interleaved=null;var i=r.next,o=n.pending;if(null!==o){var s=o.next;o.next=i,r.next=s}n.pending=r}Po=null}return e}function fc(e,t){for(;;){var n=Nl;try{if(ko(),is.current=Xs,us){for(var r=as.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}us=!1}if(ss=0,cs=ls=as=null,ds=!1,hs=0,Tl.current=null,null===n||null===n.return){Ol=1,Ll=t,Nl=null;break}e:{var s=e,a=n.return,l=n,c=t;if(t=Dl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var f=d.alternate;f?(d.updateQueue=f.updateQueue,d.memoizedState=f.memoizedState,d.lanes=f.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=ma(a);if(null!==p){p.flags&=-257,ya(p,a,l,0,t),1&p.mode&&ga(s,u,t),c=u;var g=(t=p).updateQueue;if(null===g){var m=new Set;m.add(c),t.updateQueue=m}else g.add(c);break e}if(0===(1&t)){ga(s,u,t),gc();break e}c=Error(o(426))}else if(io&&1&l.mode){var y=ma(a);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),ya(y,a,l,0,t),go(ca(c,l));break e}}s=c=ca(c,l),4!==Ol&&(Ol=2),null===Fl?Fl=[s]:Fl.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,$o(s,fa(0,c,t));break e;case 1:l=c;var v=s.type,b=s.stateNode;if(0===(128&s.flags)&&("function"===typeof v.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Kl||!Kl.has(b)))){s.flags|=65536,t&=-t,s.lanes|=t,$o(s,pa(s,l,t));break e}}s=s.return}while(null!==s)}wc(n)}catch(w){t=w,Nl===n&&null!==n&&(Nl=n=n.return);continue}break}}function pc(){var e=_l.current;return _l.current=Xs,null===e?Xs:e}function gc(){0!==Ol&&3!==Ol&&2!==Ol||(Ol=4),null===Al||0===(268435455&jl)&&0===(268435455&Ml)||ac(Al,Dl)}function mc(e,t){var n=Cl;Cl|=2;var r=pc();for(Al===e&&Dl===t||(Bl=null,hc(e,t));;)try{yc();break}catch(i){fc(e,i)}if(ko(),Cl=n,_l.current=r,null!==Nl)throw Error(o(261));return Al=null,Dl=0,Ol}function yc(){for(;null!==Nl;)bc(Nl)}function vc(){for(;null!==Nl&&!Qe();)bc(Nl)}function bc(e){var t=Sl(e.alternate,e,Pl);e.memoizedProps=e.pendingProps,null===t?wc(e):Nl=t,Tl.current=null}function wc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ga(n,t,Pl)))return void(Nl=n)}else{if(null!==(n=Wa(n,t)))return n.flags&=32767,void(Nl=n);if(null===e)return Ol=6,void(Nl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Nl=t);Nl=t=e}while(null!==t);0===Ol&&(Ol=5)}function xc(e,t,n){var r=bt,i=kl.transition;try{kl.transition=null,bt=1,function(e,t,n,r){do{Ic()}while(null!==Wl);if(0!==(6&Cl))throw Error(o(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-st(n),o=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~o}}(e,s),e===Al&&(Nl=Al=null,Dl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Gl||(Gl=!0,Ac(tt,(function(){return Ic(),null}))),s=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||s){s=kl.transition,kl.transition=null;var a=bt;bt=1;var l=Cl;Cl|=4,Tl.current=null,function(e,t){if(ei=qt,fr(e=hr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(x){n=null;break e}var a=0,l=-1,c=-1,u=0,d=0,h=e,f=null;t:for(;;){for(var p;h!==n||0!==i&&3!==h.nodeType||(l=a+i),h!==s||0!==r&&3!==h.nodeType||(c=a+r),3===h.nodeType&&(a+=h.nodeValue.length),null!==(p=h.firstChild);)f=h,h=p;for(;;){if(h===e)break t;if(f===n&&++u===i&&(l=a),f===s&&++d===r&&(c=a),null!==(p=h.nextSibling))break;f=(h=f).parentNode}h=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},qt=!1,Xa=t;null!==Xa;)if(e=(t=Xa).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Xa=e;else for(;null!==Xa;){t=Xa;try{var g=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var m=g.memoizedProps,y=g.memoizedState,v=t.stateNode,b=v.getSnapshotBeforeUpdate(t.elementType===t.type?m:na(t.type,m),y);v.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var w=t.stateNode.containerInfo;1===w.nodeType?w.textContent="":9===w.nodeType&&w.documentElement&&w.removeChild(w.documentElement);break;default:throw Error(o(163))}}catch(x){Ec(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,Xa=e;break}Xa=t.return}g=tl,tl=!1}(e,n),ml(n,e),pr(ti),qt=!!ei,ti=ei=null,e.current=n,vl(n,e,i),Je(),Cl=l,bt=a,kl.transition=s}else e.current=n;if(Gl&&(Gl=!1,Wl=e,Ql=i),s=e.pendingLanes,0===s&&(Kl=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Ye()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(ql)throw ql=!1,e=Hl,Hl=null,e;0!==(1&Ql)&&0!==e.tag&&Ic(),s=e.pendingLanes,0!==(1&s)?e===Yl?Jl++:(Jl=0,Yl=e):Jl=0,$i()}(e,t,n,r)}finally{kl.transition=i,bt=r}return null}function Ic(){if(null!==Wl){var e=wt(Ql),t=kl.transition,n=bt;try{if(kl.transition=null,bt=16>e?16:e,null===Wl)var r=!1;else{if(e=Wl,Wl=null,Ql=0,0!==(6&Cl))throw Error(o(331));var i=Cl;for(Cl|=4,Xa=e.current;null!==Xa;){var s=Xa,a=s.child;if(0!==(16&Xa.flags)){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Xa=u;null!==Xa;){var d=Xa;switch(d.tag){case 0:case 11:case 15:nl(8,d,s)}var h=d.child;if(null!==h)h.return=d,Xa=h;else for(;null!==Xa;){var f=(d=Xa).sibling,p=d.return;if(ol(d),d===u){Xa=null;break}if(null!==f){f.return=p,Xa=f;break}Xa=p}}}var g=s.alternate;if(null!==g){var m=g.child;if(null!==m){g.child=null;do{var y=m.sibling;m.sibling=null,m=y}while(null!==m)}}Xa=s}}if(0!==(2064&s.subtreeFlags)&&null!==a)a.return=s,Xa=a;else e:for(;null!==Xa;){if(0!==(2048&(s=Xa).flags))switch(s.tag){case 0:case 11:case 15:nl(9,s,s.return)}var v=s.sibling;if(null!==v){v.return=s.return,Xa=v;break e}Xa=s.return}}var b=e.current;for(Xa=b;null!==Xa;){var w=(a=Xa).child;if(0!==(2064&a.subtreeFlags)&&null!==w)w.return=a,Xa=w;else e:for(a=b;null!==Xa;){if(0!==(2048&(l=Xa).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(I){Ec(l,l.return,I)}if(l===a){Xa=null;break e}var x=l.sibling;if(null!==x){x.return=l.return,Xa=x;break e}Xa=l.return}}if(Cl=i,$i(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(it,e)}catch(I){}r=!0}return r}finally{bt=n,kl.transition=t}}return!1}function Sc(e,t,n){e=Vo(e,t=fa(0,t=ca(n,t),1),1),t=ec(),null!==e&&(yt(e,1,t),rc(e,t))}function Ec(e,t,n){if(3===e.tag)Sc(e,e,n);else for(;null!==t;){if(3===t.tag){Sc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Kl||!Kl.has(r))){t=Vo(t,e=pa(t,e=ca(n,e),1),1),e=ec(),null!==t&&(yt(t,1,e),rc(t,e));break}}t=t.return}}function _c(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Al===e&&(Dl&n)===n&&(4===Ol||3===Ol&&(130023424&Dl)===Dl&&500>Ye()-Ul?hc(e,0):zl|=n),rc(e,t)}function Tc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=ec();null!==(e=Lo(e,t))&&(yt(e,t,n),rc(e,n))}function kc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Tc(e,n)}function Cc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(o(314))}null!==r&&r.delete(t),Tc(e,n)}function Ac(e,t){return Ge(e,t)}function Nc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dc(e,t,n,r){return new Nc(e,t,n,r)}function Pc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Rc(e,t){var n=e.alternate;return null===n?((n=Dc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Oc(e,t,n,r,i,s){var a=2;if(r=e,"function"===typeof e)Pc(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case S:return Lc(n.children,i,s,t);case E:a=8,i|=8;break;case _:return(e=Dc(12,n,t,2|i)).elementType=_,e.lanes=s,e;case A:return(e=Dc(13,n,t,i)).elementType=A,e.lanes=s,e;case N:return(e=Dc(19,n,t,i)).elementType=N,e.lanes=s,e;case R:return jc(n,i,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:a=10;break e;case k:a=9;break e;case C:a=11;break e;case D:a=14;break e;case P:a=16,r=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Dc(a,n,t,i)).elementType=e,t.type=r,t.lanes=s,t}function Lc(e,t,n,r){return(e=Dc(7,e,r,t)).lanes=n,e}function jc(e,t,n,r){return(e=Dc(22,e,r,t)).elementType=R,e.lanes=n,e.stateNode={isHidden:!1},e}function Mc(e,t,n){return(e=Dc(6,e,null,t)).lanes=n,e}function zc(e,t,n){return(t=Dc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Vc(e,t,n,r,i,o,s,a,l){return e=new Fc(e,t,n,a,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Dc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mo(o),e}function Uc(e){if(!e)return ki;e:{if($e(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Pi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Pi(n))return Li(e,n,t)}return t}function $c(e,t,n,r,i,o,s,a,l){return(e=Vc(n,r,!0,e,0,o,0,a,l)).context=Uc(null),n=e.current,(o=Fo(r=ec(),i=tc(n))).callback=void 0!==t&&null!==t?t:null,Vo(n,o,i),e.current.lanes=i,yt(e,i,r),rc(e,r),e}function Bc(e,t,n,r){var i=t.current,o=ec(),s=tc(i);return n=Uc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Fo(o,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Vo(i,t,s))&&(nc(e,i,s,o),Uo(e,i,s)),s}function qc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Kc(e,t){Hc(e,t),(e=e.alternate)&&Hc(e,t)}Sl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ai.current)ba=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ba=!1,function(e,t,n){switch(t.tag){case 3:Aa(t),po();break;case 5:Xo(t);break;case 1:Pi(t.type)&&ji(t);break;case 4:Jo(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ti(So,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ti(es,1&es.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ma(e,t,n):(Ti(es,1&es.current),null!==(e=qa(e,t,n))?e.sibling:null);Ti(es,1&es.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return $a(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ti(es,es.current),r)break;return null;case 22:case 23:return t.lanes=0,Ea(e,t,n)}return qa(e,t,n)}(e,t,n);ba=0!==(131072&e.flags)}else ba=!1,io&&0!==(1048576&t.flags)&&Zi(t,Ki,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ba(e,t),e=t.pendingProps;var i=Di(t,Ci.current);No(t,n),i=ms(null,t,r,e,i,n);var s=ys();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pi(r)?(s=!0,ji(t)):s=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Mo(t),i.updater=ia,t.stateNode=i,i._reactInternals=t,la(t,r,e,n),t=Ca(null,t,r,!0,s,n)):(t.tag=0,io&&s&&eo(t),wa(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ba(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Pc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===C)return 11;if(e===D)return 14}return 2}(r),e=na(r,e),i){case 0:t=Ta(null,t,r,e,n);break e;case 1:t=ka(null,t,r,e,n);break e;case 11:t=xa(null,t,r,e,n);break e;case 14:t=Ia(null,t,r,na(r.type,e),n);break e}throw Error(o(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Ta(e,t,r,i=t.elementType===r?i:na(r,i),n);case 1:return r=t.type,i=t.pendingProps,ka(e,t,r,i=t.elementType===r?i:na(r,i),n);case 3:e:{if(Aa(t),null===e)throw Error(o(387));r=t.pendingProps,i=(s=t.memoizedState).element,zo(e,t),Bo(t,r,null,n);var a=t.memoizedState;if(r=a.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Na(e,t,r,n,i=ca(Error(o(423)),t));break e}if(r!==i){t=Na(e,t,r,n,i=ca(Error(o(424)),t));break e}for(ro=ci(t.stateNode.containerInfo.firstChild),no=t,io=!0,oo=null,n=Io(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(po(),r===i){t=qa(e,t,n);break e}wa(e,t,r,n)}t=t.child}return t;case 5:return Xo(t),null===e&&co(t),r=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,a=i.children,ni(r,i)?a=null:null!==s&&ni(r,s)&&(t.flags|=32),_a(e,t),wa(e,t,a,n),t.child;case 6:return null===e&&co(t),null;case 13:return Ma(e,t,n);case 4:return Jo(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=xo(t,null,r,n):wa(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,xa(e,t,r,i=t.elementType===r?i:na(r,i),n);case 7:return wa(e,t,t.pendingProps,n),t.child;case 8:case 12:return wa(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value,Ti(So,r._currentValue),r._currentValue=a,null!==s)if(ar(s.value,a)){if(s.children===i.children&&!Ai.current){t=qa(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){a=s.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===s.tag){(c=Fo(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),Ao(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(o(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),Ao(a,n,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}wa(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,No(t,n),r=r(i=Do(i)),t.flags|=1,wa(e,t,r,n),t.child;case 14:return i=na(r=t.type,t.pendingProps),Ia(e,t,r,i=na(r.type,i),n);case 15:return Sa(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:na(r,i),Ba(e,t),t.tag=1,Pi(r)?(e=!0,ji(t)):e=!1,No(t,n),sa(t,r,i),la(t,r,i,n),Ca(null,t,r,!0,e,n);case 19:return $a(e,t,n);case 22:return Ea(e,t,n)}throw Error(o(156,t.tag))};var Gc="function"===typeof reportError?reportError:function(e){console.error(e)};function Wc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Xc(){}function Zc(e,t,n,r,i){var o=n._reactRootContainer;if(o){var s=o;if("function"===typeof i){var a=i;i=function(){var e=qc(s);a.call(e)}}Bc(t,s,e,i)}else s=function(e,t,n,r,i){if(i){if("function"===typeof r){var o=r;r=function(){var e=qc(s);o.call(e)}}var s=$c(t,r,e,0,null,!1,0,"",Xc);return e._reactRootContainer=s,e[pi]=s.current,$r(8===e.nodeType?e.parentNode:e),uc(),s}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var a=r;r=function(){var e=qc(l);a.call(e)}}var l=Vc(e,0,!1,null,0,!1,0,"",Xc);return e._reactRootContainer=l,e[pi]=l.current,$r(8===e.nodeType?e.parentNode:e),uc((function(){Bc(t,l,n,r)})),l}(n,t,e,i,r);return qc(s)}Qc.prototype.render=Wc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Bc(e,t,null,null)},Qc.prototype.unmount=Wc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;uc((function(){Bc(null,e,null,null)})),t[pi]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Et();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Rt.length&&0!==t&&t<Rt[n].priority;n++);Rt.splice(n,0,e),0===n&&Mt(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(vt(t,1|n),rc(t,Ye()),0===(6&Cl)&&($l=Ye()+500,$i()))}break;case 13:uc((function(){var t=Lo(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}})),Kc(e,1)}},It=function(e){if(13===e.tag){var t=Lo(e,134217728);if(null!==t)nc(t,e,134217728,ec());Kc(e,134217728)}},St=function(e){if(13===e.tag){var t=tc(e),n=Lo(e,t);if(null!==n)nc(n,e,t,ec());Kc(e,t)}},Et=function(){return bt},_t=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},Ie=function(e,t,n){switch(t){case"input":if(X(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=xi(r);if(!i)throw Error(o(90));G(r),X(r,i)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ce=cc,Ae=uc;var eu={usingClientEntryPoint:!1,Events:[bi,wi,xi,Te,ke,cc]},tu={findFiberByHostInstance:vi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nu={bundleType:tu.bundleType,version:tu.version,rendererPackageName:tu.rendererPackageName,rendererConfig:tu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:w.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:tu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{it=ru.inject(nu),ot=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Jc(t))throw Error(o(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:I,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Jc(e))throw Error(o(299));var n=!1,r="",i=Gc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=Vc(e,1,!1,null,0,n,0,r,i),e[pi]=t.current,$r(8===e.nodeType?e.parentNode:e),new Wc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return uc(e)},t.hydrate=function(e,t,n){if(!Yc(t))throw Error(o(200));return Zc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Jc(e))throw Error(o(405));var r=null!=n&&n.hydratedSources||null,i=!1,s="",a=Gc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=$c(t,null,e,1,null!=n?n:null,i,0,s,a),e[pi]=t.current,$r(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Qc(t)},t.render=function(e,t,n){if(!Yc(t))throw Error(o(200));return Zc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Yc(e))throw Error(o(40));return!!e._reactRootContainer&&(uc((function(){Zc(null,null,e,!1,(function(){e._reactRootContainer=null,e[pi]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Yc(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return Zc(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},799:(e,t,n)=>{n.d(t,{P2:()=>m});const r=(e,t)=>t.some((t=>e instanceof t));let i,o;const s=new WeakMap,a=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap;let d={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||l.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return p(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function h(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(g(this),n),p(s.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return p(e.apply(g(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];const o=e.call(g(this),t,...r);return l.set(o,t.sort?t.sort():[t]),p(o)}}function f(e){return"function"===typeof e?h(e):(e instanceof IDBTransaction&&function(e){if(a.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)}));a.set(e,t)}(e),r(e,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,d):e)}function p(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(p(e.result)),r()},o=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",o)}));return t.then((t=>{t instanceof IDBCursor&&s.set(t,e)})).catch((()=>{})),u.set(t,e),t}(e);if(c.has(e))return c.get(e);const t=f(e);return t!==e&&(c.set(e,t),u.set(t,e)),t}const g=e=>u.get(e);function m(e,t){let{blocked:n,upgrade:r,blocking:i,terminated:o}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const s=indexedDB.open(e,t),a=p(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(p(s.result),e.oldVersion,e.newVersion,p(s.transaction),e)})),n&&s.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{o&&e.addEventListener("close",(()=>o())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}const y=["get","getKey","getAll","getAllKeys","count"],v=["put","add","delete","clear"],b=new Map;function w(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(b.get(t))return b.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=v.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!y.includes(n))return;const o=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let o=t.store;for(var s=arguments.length,a=new Array(s>1?s-1:0),l=1;l<s;l++)a[l-1]=arguments[l];return r&&(o=o.index(a.shift())),(await Promise.all([o[n](...a),i&&t.done]))[0]};return b.set(t,o),o}d=(e=>({...e,get:(t,n,r)=>w(t,n)||e.get(t,n,r),has:(t,n)=>!!w(t,n)||e.has(t,n)}))(d)},812:(e,t,n)=>{n.d(t,{h1:()=>a,uA:()=>i});var r=n(529);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const o="[DEFAULT]";class s{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(n){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:o})}catch(t){}for(const[e,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});n.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[i,o]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(i)&&o.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const o=this.instances.get(r);return o&&e(o,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(r){}}getOrInitializeService(e){let{instanceIdentifier:t,options:n={}}=e,r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===o?void 0:i),options:n}),this.instances.set(t,r),this.instancesOptions.set(t,n),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch(s){}var i;return r||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return this.component?this.component.multipleInstances?e:o:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new s(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},853:(e,t,n)=>{e.exports=n(234)},950:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.m=e,n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>"static/js/"+e+".4b8be825.chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="asignacion-plazas:";n.l=(r,i,o,s)=>{if(e[r])e[r].push(i);else{var a,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==r||d.getAttribute("data-webpack")==t+o){a=d;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+o),a.src=r),e[r]=[i];var h=(t,n)=>{a.onerror=a.onload=null,clearTimeout(f);var i=e[r];if(delete e[r],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(n))),t)return t(n)},f=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),l&&document.head.appendChild(a)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/asignacion-plazas/",(()=>{var e={792:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var o=new Promise(((n,r)=>i=e[t]=[n,r]));r.push(i[2]=o);var s=n.p+n.u(t),a=new Error;n.l(s,(r=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,i[1](a)}}),"chunk-"+t,t)}};var t=(t,r)=>{var i,o,s=r[0],a=r[1],l=r[2],c=0;if(s.some((t=>0!==e[t]))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(l)l(n)}for(t&&t(r);c<s.length;c++)o=s[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0},r=self.webpackChunkasignacion_plazas=self.webpackChunkasignacion_plazas||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r=n(43),i=n(391),o=n(472),s=n(213),a=n(496),l=n(579);const c=e=>{let{assignments:t=[],availablePlazas:n=[]}=e;const[i,o]=(0,r.useState)(""),[s,a]=(0,r.useState)("TODOS"),[c,u]=(0,r.useState)(""),[d,h]=(0,r.useState)(1),[f]=(0,r.useState)(10),[p,g]=(0,r.useState)({key:"order",direction:"asc"});(0,r.useEffect)((()=>{if(!Array.isArray(t))return u("Error: Los datos de asignaciones no son v\xe1lidos"),void console.error("Dashboard: assignments debe ser un array");const e=t.filter((e=>!e||"object"!==typeof e||!e.numeroOrden&&!e.order||!e.nombreCentro&&!e.centro||!e.timestamp));e.length>0&&console.warn("Algunas asignaciones tienen estructura inv\xe1lida:",e),u("")}),[t]);const m=e=>{if(!e)return"Fecha no disponible";try{return new Date(e).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch(c){return console.error("Error al formatear fecha:",c),"Fecha inv\xe1lida"}};if(c)return(0,l.jsx)("div",{style:{textAlign:"center",padding:"20px",backgroundColor:"#fff3cd",borderRadius:"8px",color:"#856404",margin:"20px 0"},children:(0,l.jsx)("p",{children:c})});if(!t.length)return(0,l.jsxs)("div",{style:{textAlign:"center",padding:"40px 20px",backgroundColor:"#f5f7fa",borderRadius:"8px",color:"#5c6c7c"},children:[(0,l.jsx)("div",{style:{fontSize:"36px",marginBottom:"15px"},children:"\ud83d\udccb"}),(0,l.jsx)("div",{style:{fontSize:"18px",fontWeight:"bold",marginBottom:"10px"},children:"No hay asignaciones realizadas"}),(0,l.jsx)("div",{style:{fontSize:"14px"},children:"Las asignaciones aparecer\xe1n aqu\xed una vez procesadas las solicitudes"})]});const y=(()=>{if(!Array.isArray(t))return[];let e=t;return i&&(e=e.filter((e=>{var t;if(!e)return!1;return[null===(t=e.numeroOrden||e.order)||void 0===t?void 0:t.toString(),e.nombreCentro||e.centro,e.localidad,e.municipio].filter(Boolean).some((e=>e.toLowerCase().includes(i.toLowerCase())))}))),"TODOS"!==s&&(e=e.filter((e=>e&&e.estado===s))),(n=e)&&Array.isArray(n)?[...n].sort(((e,t)=>{if(!e||!t)return 0;let n,r;return"order"===p.key?(n=void 0!==e.numeroOrden?e.numeroOrden:e.order,r=void 0!==t.numeroOrden?t.numeroOrden:t.order):"centro"===p.key?(n=e.nombreCentro||e.centro||"",r=t.nombreCentro||t.centro||""):(n=e[p.key],r=t[p.key]),"order"===p.key&&(n=Number(n)||0,r=Number(r)||0),n<r?"asc"===p.direction?-1:1:n>r?"asc"===p.direction?1:-1:0})):[];var n})(),v=Math.ceil(y.length/f),b=d*f,w=b-f,x=y.slice(w,b),I=e=>{e<1||e>v||h(e)},S=e=>{g((t=>({key:e,direction:t.key===e&&"asc"===t.direction?"desc":"asc"})))},E={container:{position:"relative",padding:"20px",backgroundColor:"#f4f6f9",borderRadius:"8px",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"},infoContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",flexWrap:"wrap",gap:"15px"},statsContainer:{display:"flex",gap:"15px",flexWrap:"wrap"},statCard:{backgroundColor:"#ffffff",borderRadius:"6px",padding:"15px",minWidth:"140px",boxShadow:"0 2px 5px rgba(0,0,0,0.06)",flex:1},statValue:{fontSize:"24px",fontWeight:"bold",color:"#2d3748",marginBottom:"5px"},statLabel:{fontSize:"13px",color:"#718096"},searchBar:{display:"flex",gap:"10px",marginBottom:"20px"},input:{flex:"1",padding:"10px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"14px"},select:{padding:"10px 12px",borderRadius:"6px",border:"1px solid #e2e8f0",fontSize:"14px",backgroundColor:"#fff"},tableContainer:{overflowX:"auto",backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 2px 5px rgba(0,0,0,0.05)"},table:{width:"100%",borderCollapse:"collapse",fontSize:"14px"},tableHeader:{backgroundColor:"#f8fafc",color:"#4a5568",textAlign:"left",padding:"12px 15px",fontWeight:"bold",borderBottom:"2px solid #e2e8f0",cursor:"pointer",transition:"background-color 0.2s",position:"sticky",top:0},tableCell:{padding:"12px 15px",borderBottom:"1px solid #e2e8f0",color:"#2d3748",whiteSpace:"nowrap"},pagination:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"15px 0",fontSize:"14px"},pageButton:{padding:"6px 12px",margin:"0 4px",backgroundColor:"#f1f5f9",border:"none",borderRadius:"4px",cursor:"pointer",transition:"background-color 0.2s",fontSize:"13px"},activePageButton:{backgroundColor:"#3182ce",color:"#ffffff"},textCenter:{textAlign:"center"},badge:{display:"inline-block",padding:"3px 8px",borderRadius:"12px",fontSize:"12px",fontWeight:"bold",textAlign:"center"},badgePrimary:{backgroundColor:"#ebf5ff",color:"#3182ce"},badgeSuccess:{backgroundColor:"#e6fffa",color:"#38b2ac"},badgeWarning:{backgroundColor:"#fffaf0",color:"#dd6b20"},badgeReasignado:{backgroundColor:"#fef0f5",color:"#d53f8c",border:"1px dashed #d53f8c"},infoRow:{marginBottom:"15px",backgroundColor:"#f8fafc",borderRadius:"6px",padding:"10px 15px",fontSize:"14px",color:"#4a5568",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},orderContainer:{display:"flex",alignItems:"center",gap:"8px"},orderBadge:{color:"#000",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"bold"},sortIcon:{marginLeft:"4px",display:"inline-block",fontSize:"10px"},leyendaContainer:{marginTop:"20px",padding:"15px",backgroundColor:"#ffffff",borderRadius:"8px",boxShadow:"0 2px 5px rgba(0,0,0,0.05)",fontSize:"13px"},leyendaTitle:{fontSize:"14px",fontWeight:"bold",marginBottom:"10px"},leyendaItems:{display:"flex",flexWrap:"wrap",gap:"15px"},leyendaItem:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"}},_={total:y.length,centros:[...new Set(y.map((e=>e.nombreCentro||e.centro)))].length,reasignados:y.filter((e=>e.reasignado)).length},T=["TODOS",...new Set(y.filter((e=>e.estado)).map((e=>e.estado)))];return(0,l.jsxs)("div",{style:E.container,children:[(0,l.jsx)("div",{style:E.infoContainer,children:(0,l.jsxs)("div",{style:E.statsContainer,children:[(0,l.jsxs)("div",{style:E.statCard,children:[(0,l.jsx)("div",{style:E.statValue,children:_.total}),(0,l.jsx)("div",{style:E.statLabel,children:"Asignaciones totales"})]}),(0,l.jsxs)("div",{style:E.statCard,children:[(0,l.jsx)("div",{style:E.statValue,children:_.centros}),(0,l.jsx)("div",{style:E.statLabel,children:"Centros con asignaciones"})]}),(0,l.jsxs)("div",{style:E.statCard,children:[(0,l.jsx)("div",{style:E.statValue,children:_.reasignados}),(0,l.jsx)("div",{style:E.statLabel,children:"Reasignaciones"})]})]})}),(()=>{const e=t.reduce(((e,t)=>{if(!t)return e;const n=t.centerId||t.id;return n?(e[n]||(e[n]={id:n,centro:t.nombreCentro||t.centro||"Centro desconocido",count:0,plazas:0}),e[n].count++,e):e}),{});for(const t in e){const r=n.find((e=>e.id===t));r&&(e[t].plazas=r.plazas||0)}const r=Object.values(e).filter((e=>e.count>e.plazas&&e.plazas>0));return r.length>0?(0,l.jsxs)("div",{style:{backgroundColor:"#fff5f5",borderLeft:"4px solid #e53e3e",borderRadius:"4px",padding:"12px 15px",marginBottom:"20px",fontSize:"14px",color:"#742a2a",boxShadow:"0 1px 3px rgba(0,0,0,0.1)"},children:[(0,l.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"16px"},children:"\u26a0\ufe0f Se detectaron centros con exceso de asignaciones"}),(0,l.jsx)("div",{style:{marginBottom:"10px"},children:"Los siguientes centros tienen m\xe1s asignaciones que plazas disponibles:"}),(0,l.jsx)("ul",{style:{margin:"10px 0",paddingLeft:"25px"},children:r.map((e=>(0,l.jsxs)("li",{style:{marginBottom:"5px"},children:[(0,l.jsxs)("strong",{children:[e.centro,":"]})," ",e.count," asignaciones para ",e.plazas," plazas"]},e.id)))}),(0,l.jsx)("div",{style:{marginTop:"10px",fontSize:"13px"},children:"Se recomienda ejecutar la verificaci\xf3n y correcci\xf3n autom\xe1tica de asignaciones."})]}):null})(),(0,l.jsxs)("div",{style:E.searchBar,children:[(0,l.jsx)("input",{type:"text",placeholder:"Buscar por n\xba de orden, centro, localidad...",value:i,onChange:e=>{o(e.target.value),h(1)},style:E.input}),(0,l.jsx)("select",{value:s,onChange:e=>{a(e.target.value),h(1)},style:E.select,children:T.map((e=>(0,l.jsx)("option",{value:e,children:"TODOS"===e?"Todos los estados":e},e)))})]}),(0,l.jsx)("div",{style:E.tableContainer,children:(0,l.jsxs)("table",{style:E.table,children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{style:E.tableHeader,onClick:()=>S("order"),children:(0,l.jsxs)("div",{style:E.orderContainer,children:["N\xba Orden",(0,l.jsx)("span",{style:E.sortIcon,children:"order"===p.key&&("asc"===p.direction?"\u25b2":"\u25bc")})]})}),(0,l.jsxs)("th",{style:E.tableHeader,onClick:()=>S("centro"),children:["Centro",(0,l.jsx)("span",{style:E.sortIcon,children:"centro"===p.key&&("asc"===p.direction?"\u25b2":"\u25bc")})]}),(0,l.jsxs)("th",{style:E.tableHeader,onClick:()=>S("localidad"),children:["Ubicaci\xf3n",(0,l.jsx)("span",{style:{fontSize:"12px",fontWeight:"normal",display:"block"},children:"Localidad / Municipio"}),(0,l.jsx)("span",{style:E.sortIcon,children:"localidad"===p.key&&("asc"===p.direction?"\u25b2":"\u25bc")})]}),(0,l.jsxs)("th",{style:E.tableHeader,onClick:()=>S("timestamp"),children:["Fecha",(0,l.jsx)("span",{style:E.sortIcon,children:"timestamp"===p.key&&("asc"===p.direction?"\u25b2":"\u25bc")})]})]})}),(0,l.jsxs)("tbody",{children:[x.map(((e,t)=>(0,l.jsxs)("tr",{style:e.reasignado?{backgroundColor:"#fff9fb"}:{},children:[(0,l.jsx)("td",{style:E.tableCell,children:(0,l.jsx)("div",{style:E.orderContainer,children:(0,l.jsx)("div",{style:E.orderBadge,children:e.numeroOrden||e.order})})}),(0,l.jsx)("td",{style:E.tableCell,children:(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:e.nombreCentro||e.centerName||e.centro}),e.reasignado&&(0,l.jsxs)("div",{style:{fontSize:"12px",color:"#d53f8c",marginTop:"4px"},children:["Reasignado de: ",e.centroOriginal||e.centroPrevio]})]})}),(0,l.jsx)("td",{style:E.tableCell,children:(0,l.jsxs)("div",{children:[e.localidad&&(0,l.jsx)("div",{style:{fontWeight:"medium"},children:e.localidad}),e.municipio&&e.municipio!==e.localidad&&(0,l.jsxs)("div",{style:{color:"#4a5568",fontSize:"13px",marginTop:e.localidad?"3px":"0",display:"flex",alignItems:"center"},children:[(0,l.jsx)("span",{style:{marginRight:"4px"},children:"\ud83d\udccd"}),e.municipio]}),!e.localidad&&!e.municipio&&(0,l.jsx)("span",{style:{color:"#a0aec0",fontStyle:"italic"}})]})}),(0,l.jsx)("td",{style:E.tableCell,children:m(e.timestamp)})]},e.docId||t))),0===x.length&&(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:"5",style:{...E.tableCell,textAlign:"center",padding:"30px 15px"},children:"No se encontraron asignaciones que coincidan con los filtros."})})]})]})}),v>1&&(0,l.jsxs)("div",{style:E.pagination,children:[(0,l.jsxs)("div",{children:["Mostrando ",w+1,"-",Math.min(b,y.length)," de ",y.length]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("button",{style:E.pageButton,onClick:()=>I(1),disabled:1===d,children:"\xab"}),(0,l.jsx)("button",{style:E.pageButton,onClick:()=>I(d-1),disabled:1===d,children:"\u2039"}),Array.from({length:Math.min(5,v)},((e,t)=>{let n;return n=v<=5||d<=3?t+1:d>=v-2?v-4+t:d-2+t,(0,l.jsx)("button",{style:{...E.pageButton,...d===n?E.activePageButton:{}},onClick:()=>I(n),children:n},n)})),(0,l.jsx)("button",{style:E.pageButton,onClick:()=>I(d+1),disabled:d===v,children:"\u203a"}),(0,l.jsx)("button",{style:E.pageButton,onClick:()=>I(v),disabled:d===v,children:"\xbb"})]})]})]})},u=e=>{let{availablePlazas:t=[],assignments:n=[],searchTerm:i="",setSearchTerm:o,orderNumber:s,setOrderNumber:a,centrosSeleccionados:c=[],setCentrosSeleccionados:u,handleOrderSubmit:d,isProcessing:h=!1}=e;const[f,p]=(0,r.useState)(""),[g,m]=(0,r.useState)(1),[y,v]=(0,r.useState)(10),[b,w]=(0,r.useState)("undefined"!==typeof window?window.innerWidth:1200),[x,I]=(0,r.useState)(null),[S,E]=(0,r.useState)(""),[_,T]=(0,r.useState)(""),[k,C]=(0,r.useState)(""),[A,N]=(0,r.useState)(null);(0,r.useEffect)((()=>{o&&a&&u&&d||console.error("PlazasDisponibles: Faltan funciones de callback requeridas")}),[o,a,u,d]),(0,r.useEffect)((()=>{const e=()=>{w(window.innerWidth)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]);const D=b<768,P=e=>{const n=new Set;return t.forEach((t=>{t[e]&&n.add(t[e])})),Array.from(n).sort()},R=P("asi"),O=P("departamento"),L=P("municipio"),j=[...t.filter((e=>{if(i){const t=i.toLowerCase();if(!(e.centro&&e.centro.toLowerCase().includes(t)||e.nombre&&e.nombre.toLowerCase().includes(t)||e.nombreCentro&&e.nombreCentro.toLowerCase().includes(t)||e.localidad&&e.localidad.toLowerCase().includes(t)||e.municipio&&e.municipio.toLowerCase().includes(t)||e.codigo&&e.codigo.toLowerCase().includes(t)||e.asi&&e.asi.toLowerCase().includes(t)||e.departamento&&e.departamento.toLowerCase().includes(t)))return!1}return(!S||e.asi===S)&&(!_||e.departamento===_)&&(!k||e.municipio===k)}))].sort(((e,t)=>{var n;const r=e.plazas-(e.asignadas||0),i=t.plazas-(t.asignadas||0);return 0===i&&r>0?-1:0===r&&i>0?1:r!==i?i-r:(null===(n=e.centro)||void 0===n?void 0:n.localeCompare(t.centro||""))||0})),M=Math.ceil(j.length/y),z=g*y,F=z-y,V=j.slice(F,z),U=t.reduce(((e,t)=>e+(t.plazas||0)),0),$=(t.reduce(((e,t)=>e+(t.asignadas||0)),0),()=>{I(null)}),B=e=>{try{const t=Number(e.target.value);if(!t||isNaN(t))return void console.error("ID de centro inv\xe1lido:",e.target.value);e.target.checked?c.includes(t)||u((e=>[...e,t])):u((e=>e.filter((e=>e!==t))))}catch(f){console.error("Error al seleccionar centro:",f)}};return(0,l.jsxs)("div",{className:"plazas-container",children:[A&&(0,l.jsx)("div",{className:`submit-message ${A.type}`,style:{padding:"10px 15px",margin:"10px 0",borderRadius:"4px",backgroundColor:"success"===A.type?"#d4edda":"#f8d7da",color:"success"===A.type?"#155724":"#721c24",border:"1px solid "+("success"===A.type?"#c3e6cb":"#f5c6cb")},children:A.message}),(0,l.jsxs)("div",{style:{marginBottom:"25px",padding:"20px",backgroundColor:"#f8f9fa",borderRadius:"8px",border:"1px solid #e9ecef",boxShadow:"0 2px 8px rgba(0,0,0,0.05)"},children:[(0,l.jsx)("h3",{style:{fontSize:"18px",color:"#343a40",marginTop:0,marginBottom:"15px",borderBottom:"2px solid #e9ecef",paddingBottom:"10px"},children:"Solicitar una plaza"}),(0,l.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),p(""),!s)return void p("Por favor ingrese un n\xfamero de orden");if(!c.length)return void p("Por favor seleccione al menos un centro");c.filter((e=>{const n=t.find((t=>t.id===e));return!n||n.plazas<=n.asignadas})).length>0?p("Algunos centros seleccionados ya no tienen plazas disponibles"):d(s,c)},children:[(0,l.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,l.jsx)("label",{htmlFor:"orderNumber",style:{display:"block",marginBottom:"8px",fontWeight:"bold",color:"#495057"},children:"N\xfamero de Orden:"}),(0,l.jsx)("input",{type:"number",id:"orderNumber",value:s,onChange:e=>{const t=e.target.value;if(p(""),""===t)return void a("");const n=Number(t);isNaN(n)?p("Por favor ingrese un n\xfamero v\xe1lido"):n<1?p("El n\xfamero de orden debe ser mayor a 0"):Number.isInteger(n)?a(n):p("El n\xfamero de orden debe ser un n\xfamero entero")},style:{width:"100%",padding:"12px 15px",border:"1px solid #ddd",borderRadius:"6px",fontSize:"16px",boxShadow:"inset 0 1px 3px rgba(0,0,0,0.05)"},required:!0,placeholder:"Introduce tu n\xfamero de orden"})]}),(0,l.jsxs)("div",{style:{padding:"12px 15px",backgroundColor:"#e6f7ff",border:"1px solid #91d5ff",borderRadius:"6px",marginBottom:"15px",fontSize:"14px",color:"#1890ff",display:"flex",alignItems:"flex-start",gap:"10px"},children:[(0,l.jsx)("span",{style:{fontSize:"18px"},children:"\u2139\ufe0f"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"Informaci\xf3n importante:"})," Puedes solicitar plazas aunque aparezcan como completas. El sistema asignar\xe1 las plazas priorizando por n\xfamero de orden (menor n\xfamero = mayor prioridad), incluso si la plaza ya est\xe1 asignada a alguien con un n\xfamero de orden mayor."]})]}),(0,l.jsxs)("div",{style:{padding:"10px 15px",backgroundColor:"#e9f5fe",borderRadius:"6px",marginBottom:"20px",fontSize:"14px",borderLeft:"4px solid #3498db"},children:[(0,l.jsx)("strong",{children:"Importante:"})," Selecciona tus centros por orden de preferencia. El primer centro que selecciones ser\xe1 tu primera opci\xf3n."]}),c.length>0&&(0,l.jsxs)("div",{style:{marginBottom:"20px",padding:"15px",backgroundColor:"#e8f5e9",borderRadius:"6px",border:"1px solid #c8e6c9"},children:[(0,l.jsx)("strong",{style:{color:"#2E7D32"},children:"Centros seleccionados en orden de preferencia:"}),(0,l.jsx)("ol",{style:{paddingLeft:"25px",marginTop:"10px",marginBottom:"0",color:"#333"},children:c.map(((e,n)=>{const r=t.find((t=>t.id===e));return r?(0,l.jsxs)("li",{style:{marginBottom:"8px"},children:[(0,l.jsx)("strong",{children:r.nombre||r.nombreCentro||r.centro}),r.localidad&&(0,l.jsxs)("span",{style:{color:"#555",marginLeft:"5px"},children:["- ",r.localidad]}),r.municipio&&r.municipio!==r.localidad&&(0,l.jsxs)("span",{style:{marginLeft:"5px",color:"#4a5568",fontSize:"13px"},children:[(0,l.jsx)("span",{style:{marginRight:"4px"},children:"\ud83d\udccd"}),r.municipio]}),0===n&&(0,l.jsx)("span",{style:{display:"inline-block",marginLeft:"8px",fontSize:"12px",color:"#d35400",backgroundColor:"#fff3cd",padding:"1px 5px",borderRadius:"10px",fontWeight:"bold"},children:"1\xaa opci\xf3n"})]},e):null}))}),(0,l.jsx)("div",{style:{marginTop:"10px",textAlign:"right"},children:(0,l.jsx)("button",{type:"button",onClick:()=>u([]),style:{padding:"6px 12px",backgroundColor:"#f8d7da",color:"#721c24",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"13px"},children:"Limpiar selecci\xf3n"})})]}),(0,l.jsx)("div",{style:{textAlign:"center"},children:(0,l.jsx)("button",{type:"submit",disabled:h||0===c.length,style:{padding:"12px 25px",backgroundImage:h?"linear-gradient(to right, #cccccc, #dddddd)":"linear-gradient(to right, #3498db, #2980b9)",color:"white",border:"none",borderRadius:"6px",cursor:h||0===c.length?"not-allowed":"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:"500",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:h?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{style:{display:"inline-block",width:"18px",height:"18px",border:"3px solid rgba(255,255,255,0.3)",borderRadius:"50%",borderTopColor:"white",animation:"spin 1s linear infinite",marginRight:"10px"}}),"Procesando..."]}):(0,l.jsx)(l.Fragment,{children:"Solicitar Plaza"})})})]})]}),(0,l.jsxs)("div",{className:"search-container",children:[(0,l.jsx)("input",{type:"text",className:"search-box",placeholder:"Buscar por centro, municipio o c\xf3digo...",value:i,onChange:e=>{o(e.target.value),m(1)}}),i&&(0,l.jsx)("button",{className:"clear-search",onClick:()=>o(""),children:"\xd7"})]}),(0,l.jsxs)("div",{className:"filters-container",children:[(0,l.jsxs)("select",{className:"filter-select",value:S,onChange:e=>{E(e.target.value),m(1)},children:[(0,l.jsx)("option",{value:"",children:"Todos los ASI"}),R.map((e=>(0,l.jsx)("option",{value:e,children:e},e)))]}),(0,l.jsxs)("select",{className:"filter-select",value:_,onChange:e=>{T(e.target.value),m(1)},children:[(0,l.jsx)("option",{value:"",children:"Todos los departamentos"}),O.map((e=>(0,l.jsx)("option",{value:e,children:e},e)))]}),(0,l.jsxs)("select",{className:"filter-select",value:k,onChange:e=>{C(e.target.value),m(1)},children:[(0,l.jsx)("option",{value:"",children:"Todos los municipios"}),L.map((e=>(0,l.jsx)("option",{value:e,children:e},e)))]}),(0,l.jsxs)("select",{className:"filter-select",value:y,onChange:e=>{v(Number(e.target.value)),m(1)},children:[(0,l.jsx)("option",{value:10,children:"10 por p\xe1gina"}),(0,l.jsx)("option",{value:25,children:"25 por p\xe1gina"}),(0,l.jsx)("option",{value:50,children:"50 por p\xe1gina"}),(0,l.jsx)("option",{value:100,children:"100 por p\xe1gina"})]})]}),(0,l.jsxs)("div",{className:"results-info",children:[(0,l.jsxs)("span",{children:["Mostrando ",V.length," de ",j.length," centros"]}),(0,l.jsxs)("span",{children:["Total plazas: ",U]})]}),(0,l.jsx)("div",{className:"plazas-grid",children:0===j.length?(0,l.jsxs)("div",{className:"empty-state",children:[(0,l.jsx)("div",{className:"empty-icon",children:"\ud83d\udd0d"}),(0,l.jsx)("p",{children:"No se encontraron plazas con los criterios seleccionados."}),(0,l.jsx)("button",{className:"reset-filters",onClick:()=>{o(""),m(1)},children:"Limpiar filtros"})]}):(0,l.jsxs)("table",{className:"tabla-plazas",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{style:{width:"60px"}}),(0,l.jsx)("th",{children:"C\xf3digo"}),(0,l.jsx)("th",{className:"centro-column",children:"Centro"}),(0,l.jsx)("th",{children:"Ubicaci\xf3n"}),(0,l.jsx)("th",{children:"Plazas"}),b<768&&(0,l.jsx)("th",{style:{width:"40px"},children:"Info"})]})}),(0,l.jsx)("tbody",{children:V.map(((e,t)=>{const n=Math.max(0,e.plazas-(e.asignadas||0)),r=c.includes(e.id);let i=t%2===0?"white":"#f9f9f9";r?i="#e6f7ff":0===n?i="#ffe6e6":n<=2&&(i="#fff3cd");const o=e.docId||`plaza-${e.id}-${t}`;return(0,l.jsxs)("tr",{style:{backgroundColor:i,transition:"background-color 0.2s ease"},onClick:()=>{D&&(r?u(c.filter((t=>t!==e.id))):c.includes(e.id)||u([...c,e.id]))},children:[(0,l.jsx)("td",{children:(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",justifyContent:"center"},children:[(0,l.jsx)("input",{type:"checkbox",id:`plaza-${e.id}`,value:e.id,onChange:B,checked:c.includes(e.id),style:{width:"20px",height:"20px",cursor:"pointer"}}),c.includes(e.id)&&(0,l.jsx)("span",{style:{backgroundImage:"linear-gradient(135deg, #1976D2, #2196F3)",color:"white",borderRadius:"50%",width:"28px",height:"28px",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"14px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:c.indexOf(e.id)+1})]})}),(0,l.jsx)("td",{children:e.codigo}),(0,l.jsx)("td",{className:"centro-column",title:e.nombre||e.nombreCentro||e.centro,children:e.nombre||e.nombreCentro||e.centro}),(0,l.jsx)("td",{children:(0,l.jsxs)("div",{children:[e.localidad&&(0,l.jsx)("div",{style:{fontWeight:"medium"},children:e.localidad}),e.municipio&&e.municipio!==e.localidad&&(0,l.jsxs)("div",{style:{color:"#4a5568",fontSize:"13px",marginTop:e.localidad?"3px":"0",display:"flex",alignItems:"center"},children:[(0,l.jsx)("span",{style:{marginRight:"4px"},children:"\ud83d\udccd"}),e.municipio]}),!e.localidad&&!e.municipio&&(0,l.jsx)("span",{style:{color:"#a0aec0",fontStyle:"italic"}})]})}),(0,l.jsx)("td",{children:e.plazas}),b<768&&(0,l.jsx)("td",{children:(0,l.jsx)("button",{className:"info-button",onClick:t=>{t.stopPropagation(),(e=>{I({...e,disponibles:e.plazas-(e.asignadas||0)})})(e)},children:"\u2139\ufe0f"})})]},o)}))})]})}),j.length>0&&(0,l.jsxs)("div",{className:"pagination",children:[(0,l.jsx)("button",{className:"pagination-button",onClick:()=>m(1),disabled:1===g,children:"\xab\xab"}),(0,l.jsx)("button",{className:"pagination-button",onClick:()=>m((e=>Math.max(1,e-1))),disabled:1===g,children:"\xab"}),(M<=5?Array.from({length:M},((e,t)=>t+1)):g<=3?[1,2,3,4,5]:g>=M-2?[M-4,M-3,M-2,M-1,M]:[g-2,g-1,g,g+1,g+2]).map((e=>(0,l.jsx)("button",{className:"pagination-button "+(g===e?"active":""),onClick:()=>m(e),children:e},e))),(0,l.jsx)("button",{className:"pagination-button",onClick:()=>m((e=>Math.min(M,e+1))),disabled:g===M,children:"\xbb"}),(0,l.jsx)("button",{className:"pagination-button",onClick:()=>m(M),disabled:g===M,children:"\xbb\xbb"})]}),x&&(0,l.jsx)("div",{className:"info-modal",children:(0,l.jsxs)("div",{className:"info-content",children:[(0,l.jsx)("h3",{children:"Informaci\xf3n del centro"}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Centro:"})," ",x.nombre||x.nombreCentro||x.centro]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"C\xf3digo:"})," ",x.codigo]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Municipio:"})," ",x.municipio]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Departamento:"})," ",x.departamento]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"ASI:"})," ",x.asi]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Plazas disponibles:"})," ",x.disponibles]}),(0,l.jsxs)("div",{className:"modal-footer",children:[(0,l.jsx)("button",{className:"close-button",onClick:$,children:"Cerrar"}),(0,l.jsx)("button",{className:"select-button",onClick:()=>{B({target:{value:x.id}}),$()},children:"Seleccionar"})]})]})}),(0,l.jsx)("style",{children:"\n        .plazas-container {\n          background-color: white;\n          border-radius: 8px;\n          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n          padding: 20px;\n          height: 100%;\n          display: flex;\n          flex-direction: column;\n          overflow: hidden;\n          max-width: 100%;\n          box-sizing: border-box;\n        }\n        \n        .search-container {\n          position: relative;\n          margin-bottom: 15px;\n          width: 100%;\n          max-width: 100%;\n          box-sizing: border-box;\n        }\n        \n        .search-box {\n          width: 100%;\n          padding: 14px 16px;\n          border: 2px solid #ddd;\n          border-radius: 6px;\n          font-size: 16px;\n          transition: border-color 0.3s;\n          box-sizing: border-box;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n        \n        .search-box:focus {\n          border-color: #1976d2;\n          outline: none;\n          box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.2);\n        }\n        \n        .clear-search {\n          position: absolute;\n          right: 10px;\n          top: 50%;\n          transform: translateY(-50%);\n          background: none;\n          border: none;\n          font-size: 24px;\n          cursor: pointer;\n          color: #999;\n          padding: 5px;\n          line-height: 1;\n          z-index: 5;\n        }\n        \n        .clear-search:hover {\n          color: #333;\n        }\n        \n        .filters-container {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 10px;\n          margin-bottom: 15px;\n          max-width: 100%;\n          box-sizing: border-box;\n        }\n        \n        .filter-select {\n          padding: 10px;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          min-width: 150px;\n          flex: 1 1 auto;\n          box-sizing: border-box;\n          max-width: 100%;\n        }\n        \n        @media (max-width: 768px) {\n          .filters-container {\n            flex-direction: column;\n            gap: 8px;\n          }\n          \n          .filter-select {\n            width: 100%;\n            min-width: auto;\n          }\n          \n          .search-box {\n            padding: 12px 14px;\n            font-size: 14px;\n          }\n          \n          .clear-search {\n            right: 5px;\n            font-size: 20px;\n          }\n        }\n        \n        .results-info {\n          display: flex;\n          justify-content: space-between;\n          margin-bottom: 10px;\n          font-size: 14px;\n          color: #555;\n          font-weight: 500;\n          flex-wrap: wrap;\n          width: 100%;\n          box-sizing: border-box;\n        }\n        \n        .plazas-grid {\n          overflow-y: auto;\n          height: 100%;\n          border: 1px solid #eee;\n          border-radius: 4px;\n          margin-bottom: 15px;\n          -webkit-overflow-scrolling: touch;\n        }\n        \n        .tabla-plazas {\n          width: 100%;\n          border-collapse: collapse;\n          table-layout: fixed;\n        }\n        \n        .tabla-plazas th {\n          background-color: #f5f5f5;\n          position: sticky;\n          top: 0;\n          padding: 12px 10px;\n          text-align: left;\n          border-bottom: 2px solid #ddd;\n          z-index: 10;\n          font-weight: 600;\n        }\n        \n        .tabla-plazas td {\n          padding: 12px 10px;\n          border-bottom: 1px solid #eee;\n          word-break: break-word;\n        }\n        \n        .centro-column {\n          max-width: 300px;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n        \n        .tabla-plazas tr:hover {\n          background-color: #f9f9f9;\n        }\n        \n        .selected-row {\n          background-color: #e3f2fd;\n        }\n        \n        .selected-row:hover {\n          background-color: #bbdefb;\n        }\n        \n        .empty-state {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          padding: 40px 0;\n          text-align: center;\n          color: #757575;\n        }\n        \n        .empty-icon {\n          font-size: 48px;\n          margin-bottom: 20px;\n        }\n        \n        .reset-filters {\n          margin-top: 15px;\n          padding: 8px 16px;\n          background-color: #1976d2;\n          color: white;\n          border: none;\n          border-radius: 4px;\n          cursor: pointer;\n        }\n        \n        .pagination {\n          display: flex;\n          justify-content: center;\n          gap: 5px;\n          margin-top: 15px;\n          flex-wrap: wrap;\n        }\n        \n        .pagination-button {\n          padding: 8px 12px;\n          border: 1px solid #ddd;\n          background-color: white;\n          border-radius: 4px;\n          cursor: pointer;\n          transition: all 0.2s;\n        }\n        \n        .pagination-button.active {\n          background-color: #1976d2;\n          color: white;\n          border-color: #1976d2;\n        }\n        \n        .pagination-button:hover:not(:disabled) {\n          background-color: #f0f0f0;\n          border-color: #bbb;\n        }\n        \n        .pagination-button:disabled {\n          cursor: not-allowed;\n          opacity: 0.5;\n        }\n        \n        .info-button {\n          background: none;\n          border: none;\n          cursor: pointer;\n          font-size: 18px;\n          padding: 2px;\n        }\n        \n        .info-modal {\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          background-color: rgba(0, 0, 0, 0.5);\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          z-index: 1000;\n        }\n        \n        .info-content {\n          background-color: white;\n          border-radius: 8px;\n          padding: 20px;\n          width: 90%;\n          max-width: 500px;\n          max-height: 80vh;\n          overflow-y: auto;\n          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n        }\n        \n        .info-content h3 {\n          margin-top: 0;\n          color: #1a237e;\n          border-bottom: 1px solid #eee;\n          padding-bottom: 10px;\n        }\n        \n        .modal-footer {\n          display: flex;\n          justify-content: flex-end;\n          gap: 10px;\n          margin-top: 20px;\n          border-top: 1px solid #eee;\n          padding-top: 15px;\n        }\n        \n        .close-button, .select-button {\n          padding: 8px 16px;\n          border-radius: 4px;\n          border: none;\n          cursor: pointer;\n        }\n        \n        .close-button {\n          background-color: #f5f5f5;\n          color: #333;\n        }\n        \n        .select-button {\n          background-color: #1976d2;\n          color: white;\n        }\n        \n        /* Dise\xf1o responsive */\n        @media (max-width: 768px) {\n          .plazas-container {\n            padding: 15px 10px;\n          }\n          \n          .filters-container {\n            flex-direction: column;\n            gap: 8px;\n          }\n          \n          .filter-select {\n            width: 100%;\n          }\n          \n          .tabla-plazas th, .tabla-plazas td {\n            padding: 10px 5px;\n            font-size: 13px;\n          }\n          \n          .tabla-plazas th:nth-child(1) {\n            width: 65px;\n          }\n          \n          .tabla-plazas th:nth-child(2) {\n            width: 60px;\n          }\n          \n          .tabla-plazas th:nth-child(4) {\n            width: 80px;\n          }\n          \n          .tabla-plazas th:nth-child(5) {\n            width: 45px;\n          }\n          \n          .centro-column {\n            max-width: 100px;\n          }\n          \n          .pagination-button {\n            padding: 6px 10px;\n            font-size: 13px;\n          }\n          \n          h2 {\n            font-size: 20px;\n            margin-top: 0;\n          }\n          \n          form > div {\n            margin-bottom: 10px !important;\n          }\n          \n          .search-box {\n            padding: 10px 12px;\n            font-size: 14px;\n          }\n        }\n        \n        /* Animaciones */\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      "})]})},d=e=>{let{solicitudes:t=[],assignments:n=[],availablePlazas:i=[]}=e;const[o,s]=(0,r.useState)(1),[a,c]=(0,r.useState)(10),[u,d]=(0,r.useState)(""),[h,f]=(0,r.useState)(""),[p,g]=(0,r.useState)("undefined"!==typeof window?window.innerWidth:1200),[m,y]=(0,r.useState)({key:"orden",direction:"asc"});if((0,r.useEffect)((()=>Array.isArray(t)?Array.isArray(n)?Array.isArray(i)?void f(""):(f("Error: Las plazas disponibles no son v\xe1lidas"),void console.error("SolicitudesPendientes: availablePlazas debe ser un array")):(f("Error: Las asignaciones no son v\xe1lidas"),void console.error("SolicitudesPendientes: assignments debe ser un array")):(f("Error: Las solicitudes no son v\xe1lidas"),void console.error("SolicitudesPendientes: solicitudes debe ser un array"))),[t,n,i]),(0,r.useEffect)((()=>{const e=()=>{g(window.innerWidth)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),h)return(0,l.jsx)("div",{style:{textAlign:"center",padding:"20px",backgroundColor:"#fff3cd",borderRadius:"8px",color:"#856404",margin:"20px 0"},children:(0,l.jsx)("p",{children:h})});const v=p<768,b=(w=(Array.isArray(t)?t:[]).filter((e=>!!e&&(void 0===e.orden||null===e.orden?(console.warn("Solicitud sin n\xfamero de orden:",e),!1):!(!Array.isArray(e.centrosIds)&&!Array.isArray(e.centrosSeleccionados))||(console.warn("Solicitud sin centros seleccionados:",e),!1)))).filter((e=>{var t;return[null===(t=e.orden)||void 0===t?void 0:t.toString(),...(e.centrosIds||e.centrosSeleccionados||[]).map((e=>{const t=i.find((t=>t.id===e));return t?[t.nombre||t.nombreCentro||t.centro,t.localidad,t.municipio]:[]})).flat()].filter(Boolean).some((e=>e.toLowerCase().includes(u.toLowerCase())))})))&&Array.isArray(w)?[...w].sort(((e,t)=>{if(!e||!t)return 0;let n=e[m.key],r=t[m.key];return"orden"===m.key&&(n=Number(n)||0,r=Number(r)||0),n<r?"asc"===m.direction?-1:1:n>r?"asc"===m.direction?1:-1:0})):[];var w;const x=Math.ceil(b.length/a),I=o*a,S=I-a,E=b.slice(S,I),_=e=>{e<1||e>x||s(e)};return t.length?(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{style:{marginBottom:"15px",fontSize:"14px",padding:"12px 15px",backgroundColor:"#fff7f0",borderRadius:"6px",borderLeft:"4px solid #d35400",boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:["A continuaci\xf3n se muestran las solicitudes pendientes con sus preferencias de centros en orden.",(0,l.jsx)("p",{style:{color:"#d35400",fontWeight:"bold",marginTop:"8px",marginBottom:"0"},children:"\u26a0\ufe0f Las solicitudes se procesan por orden de prioridad (n\xfamero de orden menor = mayor prioridad)"})]}),(0,l.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,l.jsxs)("div",{style:{marginBottom:"10px",position:"relative"},children:[(0,l.jsx)("input",{type:"text",placeholder:"Buscar por n\xfamero de orden o centro...",value:u,onChange:e=>{d(e.target.value),s(1)},style:{padding:"12px 15px",paddingLeft:"40px",border:"1px solid #ddd",borderRadius:"6px",width:"100%",fontSize:"16px",boxShadow:"inset 0 1px 3px rgba(0,0,0,0.05)"}}),(0,l.jsx)("div",{style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#666",fontSize:"18px"},children:"\ud83d\udd0d"})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"10px"},children:[(0,l.jsxs)("div",{style:{marginBottom:"10px",fontSize:"14px",color:"#666"},children:["Mostrando ",(0,l.jsxs)("strong",{children:[b.length>0?S+1:0,"-",Math.min(I,b.length)]})," de ",(0,l.jsx)("strong",{children:b.length})," solicitudes",u&&` (filtradas de ${t.length})`]}),(0,l.jsx)("div",{children:(0,l.jsxs)("select",{value:a,onChange:e=>{c(Number(e.target.value)),s(1)},style:{padding:"8px 12px",border:"1px solid #ddd",borderRadius:"6px",backgroundColor:"white",boxShadow:"0 1px 3px rgba(0,0,0,0.05)"},children:[(0,l.jsx)("option",{value:10,children:"10 por p\xe1gina"}),(0,l.jsx)("option",{value:25,children:"25 por p\xe1gina"}),(0,l.jsx)("option",{value:50,children:"50 por p\xe1gina"}),(0,l.jsx)("option",{value:b.length,children:"Ver todas"})]})})]})]}),v&&(0,l.jsx)("div",{style:{marginBottom:"15px",fontSize:"13px",color:"#666",textAlign:"center",backgroundColor:"#fff3cd",padding:"8px",borderRadius:"4px"},children:"\u2190 Desliza para ver la tabla completa \u2192"}),(0,l.jsx)("div",{style:{overflowX:"auto",border:"1px solid #e1e8f0",borderRadius:"6px",WebkitOverflowScrolling:"touch"},children:(0,l.jsxs)("table",{className:"responsive-table",style:{width:"100%",borderCollapse:"collapse",minWidth:v?"768px":"auto"},children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{style:{backgroundImage:"linear-gradient(to right, #fef5ec, #fde4ce)",position:"sticky",top:0,zIndex:5},children:[(0,l.jsx)("th",{style:{border:"1px solid #ddd",padding:"12px 15px",textAlign:"left",color:"#d35400"},children:"N\xba Orden"}),(0,l.jsx)("th",{style:{border:"1px solid #ddd",padding:"12px 15px",textAlign:"left",color:"#d35400"},children:"Fecha/Hora"}),(0,l.jsx)("th",{style:{border:"1px solid #ddd",padding:"12px 15px",textAlign:"left",color:"#d35400"},children:"Centros Seleccionados (en orden de preferencia)"}),(0,l.jsx)("th",{style:{border:"1px solid #ddd",padding:"12px 15px",textAlign:"center",color:"#d35400"},children:"Estado"})]})}),(0,l.jsxs)("tbody",{children:[E.map(((e,t)=>{const r=new Date(e.timestamp),o=`${r.toLocaleDateString()} ${r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,s=n.some((t=>t.order===e.orden)),a=n.find((t=>t.order===e.orden)),c=s?"#e8f5e9":t%2===0?"white":"#fef9f4";return(0,l.jsxs)("tr",{style:{backgroundColor:c,opacity:s?.8:1,transition:"background-color 0.2s ease"},children:[(0,l.jsxs)("td",{style:{border:"1px solid #ddd",padding:"12px 15px",fontWeight:"bold",backgroundColor:e.orden<=50?"#fff3cd":"inherit"},children:[e.orden,e.orden<=50&&(0,l.jsx)("span",{style:{display:"inline-block",marginLeft:"8px",fontSize:"12px",color:"#856404",backgroundColor:"#fff3cd",padding:"2px 6px",borderRadius:"12px",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:"Alta prioridad"})]}),(0,l.jsx)("td",{style:{border:"1px solid #ddd",padding:"12px 15px"},children:o}),(0,l.jsx)("td",{style:{border:"1px solid #ddd",padding:"12px 15px"},children:(0,l.jsx)("ol",{style:{margin:"0",paddingLeft:"20px"},children:Array.isArray((null===e||void 0===e?void 0:e.centrosIds)||(null===e||void 0===e?void 0:e.centrosSeleccionados))?((null===e||void 0===e?void 0:e.centrosIds)||(null===e||void 0===e?void 0:e.centrosSeleccionados)||[]).map(((e,t)=>{const n=e&&i&&Array.isArray(i)?i.find((t=>t&&t.id===e)):null,r=a&&a.id===e;return(0,l.jsx)("li",{style:{marginBottom:"8px",backgroundColor:r?"#f1f8e9":"transparent",padding:r?"4px 8px":"0",borderRadius:r?"4px":"0",border:r?"1px solid #c8e6c9":"none"},children:n?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("strong",{style:{color:0===t?"#d35400":"inherit"},children:n.nombre||n.nombreCentro||n.centro}),(0,l.jsxs)("div",{className:"centro-localidad",children:[n.localidad&&`- ${n.localidad}`,n.municipio&&n.municipio!==n.localidad&&(0,l.jsxs)("span",{style:{marginLeft:"5px",color:"#4a5568",fontSize:"13px"},children:[(0,l.jsx)("span",{style:{marginRight:"4px"},children:"\ud83d\udccd"}),n.municipio]})]}),0===t&&(0,l.jsx)("span",{style:{display:"inline-block",marginLeft:"8px",fontSize:"12px",color:"#d35400",backgroundColor:"#fff3cd",padding:"1px 5px",borderRadius:"10px",fontWeight:"bold"},children:"1\xaa opci\xf3n"}),n.plazas&&void 0!==n.asignadas&&n.plazas-n.asignadas<=0&&!r&&(0,l.jsx)("span",{style:{color:"#e74c3c",marginLeft:"10px",fontSize:"12px",fontWeight:"bold",backgroundColor:"#ffebee",padding:"1px 6px",borderRadius:"10px"},children:"Completo"}),r&&(0,l.jsx)("span",{style:{color:"#2E7D32",marginLeft:"10px",fontSize:"12px",fontWeight:"bold",backgroundColor:"#e8f5e9",padding:"1px 6px",borderRadius:"10px"},children:"\u2713 Asignado"})]}):(0,l.jsx)("span",{style:{color:"#999"},children:e})},t)})):(0,l.jsx)("li",{children:"No hay centros seleccionados"})})}),(0,l.jsx)("td",{style:{border:"1px solid #ddd",padding:"12px 15px",textAlign:"center"},children:s?(0,l.jsx)("div",{style:{backgroundColor:"#e8f5e9",color:"#2E7D32",padding:"8px 12px",borderRadius:"6px",fontSize:"14px",fontWeight:"bold",border:"1px solid #c8e6c9",display:"inline-block"},children:"\u2713 Asignado"}):(0,l.jsx)("div",{style:{backgroundColor:"#fff7e6",color:"#f39c12",padding:"8px 12px",borderRadius:"6px",fontSize:"14px",fontWeight:"bold",border:"1px solid #ffeeba",display:"inline-block"},children:"Pendiente"})})]},t)})),0===E.length&&(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:"4",style:{textAlign:"center",padding:"30px",color:"#666"},children:u?`No se encontraron solicitudes que coincidan con "${u}"`:"No hay solicitudes pendientes para mostrar"})})]})]})}),b.length>a&&(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"center",marginTop:"20px",gap:"5px",flexWrap:"wrap"},children:[(0,l.jsx)("button",{onClick:()=>_(o-1),disabled:1===o,style:{padding:"8px 12px",backgroundColor:1===o?"#f1f1f1":"white",border:"1px solid #ddd",borderRadius:"4px",cursor:1===o?"not-allowed":"pointer"},children:"\xab Anterior"}),Array.from({length:Math.min(5,x)},((e,t)=>{let n;return n=x<=5||o<=3?t+1:o>=x-2?x-4+t:o-2+t,(0,l.jsx)("button",{onClick:()=>_(n),style:{padding:"8px 12px",backgroundColor:o===n?"#e67e22":"white",color:o===n?"white":"#333",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer"},children:n},n)})),(0,l.jsx)("button",{onClick:()=>_(o+1),disabled:o===x,style:{padding:"8px 12px",backgroundColor:o===x?"#f1f1f1":"white",border:"1px solid #ddd",borderRadius:"4px",cursor:o===x?"not-allowed":"pointer"},children:"Siguiente \xbb"})]})]}):(0,l.jsxs)("div",{style:{textAlign:"center",padding:"40px 20px",backgroundColor:"#f5f7fa",borderRadius:"8px",color:"#5c6c7c"},children:[(0,l.jsx)("div",{style:{fontSize:"36px",marginBottom:"15px"},children:"\ud83d\udcdd"}),(0,l.jsx)("div",{style:{fontSize:"18px",fontWeight:"bold",marginBottom:"10px"},children:"No hay solicitudes pendientes"}),(0,l.jsx)("div",{style:{fontSize:"14px"},children:'Las solicitudes aparecer\xe1n aqu\xed cuando se env\xeden desde la pesta\xf1a "Plazas Disponibles"'})]})};const h=function(){return(0,l.jsx)("footer",{style:{marginTop:"60px",padding:"20px 15px",borderTop:"1px solid #ddd",backgroundColor:"#f8f9fa",textAlign:"center",color:"#333",fontSize:"14px",width:"100%",position:"relative",display:"block"},children:(0,l.jsxs)("div",{style:{maxWidth:"1280px",margin:"0 auto"},children:[(0,l.jsxs)("p",{style:{margin:"10px 0"},children:["Realizado por ",(0,l.jsx)("a",{href:"https://ag-marketing.es",target:"_blank",rel:"noopener noreferrer",style:{color:"#18539E",textDecoration:"none",fontWeight:"bold"},children:"AG-Marketing"})]}),(0,l.jsxs)("p",{style:{margin:"10px 0"},children:["\xa9 ",(new Date).getFullYear()," - Todos los derechos reservados"]})]})})},f=e=>{let{assignments:t=[],availablePlazas:i=[],solicitudes:s=[],procesarTodasLasSolicitudes:a,procesarSolicitudesPorMinuto:c,cargarDatosDesdeFirebase:u,eliminarSolicitudesDuplicadas:d,limpiarDuplicadosHistorial:h,db:f,loadingProcess:p,processingMessage:g,showNotification:m,lastProcessed:y,procesarSolicitudes:v}=e;const[b,w]=(0,r.useState)(!1),[x,I]=(0,r.useState)(!1),[S,E]=(0,r.useState)(""),[_,T]=(0,r.useState)(""),[k,C]=(0,r.useState)(""),[A,N]=(0,r.useState)("");if(!b)return(0,l.jsxs)("div",{style:{maxWidth:"1280px",margin:"0 auto",padding:"20px",fontFamily:"Arial, sans-serif",display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"column"},children:[(0,l.jsx)("h1",{style:{marginBottom:"30px",color:"#2c3e50"},children:"Panel de Administraci\xf3n"}),(0,l.jsxs)("div",{style:{backgroundColor:"white",padding:"30px",borderRadius:"10px",boxShadow:"0 4px 15px rgba(0,0,0,0.1)",width:"100%",maxWidth:"400px"},children:[(0,l.jsx)("h2",{style:{textAlign:"center",marginBottom:"25px"},children:"Autenticaci\xf3n Requerida"}),x&&(0,l.jsx)("div",{style:{backgroundColor:"#f8d7da",color:"#721c24",padding:"10px",borderRadius:"5px",marginBottom:"15px",textAlign:"center"},children:"Contrase\xf1a incorrecta. Int\xe9ntalo de nuevo."}),(0,l.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,l.jsx)("label",{style:{display:"block",marginBottom:"8px",fontWeight:"bold"},children:"Contrase\xf1a de Administrador:"}),(0,l.jsx)("input",{type:"password",value:S,onChange:e=>E(e.target.value),style:{width:"100%",padding:"12px",border:"1px solid #ddd",borderRadius:"5px",fontSize:"16px"},placeholder:"Ingrese la contrase\xf1a",onKeyDown:e=>{"Enter"===e.key&&("SoyAdmin"===S?w(!0):I(!0))}})]}),(0,l.jsx)("button",{onClick:()=>{"SoyAdmin"===S?w(!0):I(!0)},style:{width:"100%",padding:"12px",backgroundColor:"#3498db",color:"white",border:"none",borderRadius:"5px",fontSize:"16px",fontWeight:"bold",cursor:"pointer"},children:"Acceder"}),(0,l.jsx)("div",{style:{marginTop:"20px",textAlign:"center"},children:(0,l.jsx)("a",{href:"/",style:{color:"#3498db",textDecoration:"none"},children:"Volver a la p\xe1gina principal"})})]})]});return(0,l.jsxs)("div",{style:{maxWidth:"1280px",margin:"0 auto",padding:"20px",fontFamily:"Arial, sans-serif"},children:[(0,l.jsx)("style",{children:"\n          @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n          }\n          \n          .processing-btn {\n            position: relative;\n            padding-left: 30px; /* Espacio para el spinner */\n            display: inline-flex;\n            align-items: center;\n          }\n          \n          .processing-indicator {\n            position: absolute;\n            left: 10px;\n            width: 15px;\n            height: 15px;\n            border: 2px solid rgba(255, 255, 255, 0.3);\n            border-radius: 50%;\n            border-top-color: white;\n            animation: spin 1s linear infinite;\n          }\n        "}),(0,l.jsx)("h1",{style:{textAlign:"center",marginBottom:"20px"},children:"Panel de Administraci\xf3n"}),(0,l.jsxs)("div",{style:{backgroundColor:"#f8f9fa",padding:"15px",borderRadius:"10px",marginBottom:"20px",textAlign:"center",border:"1px solid #e9ecef"},children:[(0,l.jsx)("h3",{style:{marginTop:0,color:"#2c3e50"},children:"Bienvenido al Panel de Administraci\xf3n"}),(0,l.jsx)("p",{children:"Desde aqu\xed puede gestionar las solicitudes pendientes sin que aparezca la pantalla de mantenimiento para los usuarios del sistema. Puede procesar todas las solicitudes a la vez o una por una."}),(0,l.jsx)("p",{style:{fontWeight:"bold",color:"#3498db"},children:"El sistema procesa solicitudes por orden de prioridad, desplazando asignaciones si es necesario."})]}),(0,l.jsxs)("div",{style:{backgroundColor:"white",padding:"20px",borderRadius:"10px",boxShadow:"0 2px 10px rgba(0,0,0,0.05)",marginBottom:"20px",display:"flex",flexDirection:"column",gap:"15px"},children:[(0,l.jsx)("h2",{children:"Acciones de Administraci\xf3n"}),(0,l.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"15px"},children:[(0,l.jsxs)("button",{onClick:async()=>{await d(),await h(),m("Duplicados eliminados correctamente","success")},style:{padding:"15px 20px",backgroundColor:"#e74c3c",color:"white",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},disabled:p,children:[(0,l.jsx)("span",{children:"\ud83d\uddd1\ufe0f"})," Eliminar Duplicados"]}),(0,l.jsxs)("button",{onClick:()=>a({respetarAsignacionesExistentes:!1}),style:{padding:"15px 20px",backgroundColor:"#3498db",color:"white",border:"none",borderRadius:"5px",cursor:t.length>0?"pointer":"not-allowed",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",opacity:t.length>0?1:.6},disabled:0===t.length||p,children:[(0,l.jsx)("span",{children:"\ud83d\udd04"})," Reasignar Plazas por Orden"]}),(0,l.jsxs)("button",{onClick:c,style:{padding:"15px 20px",backgroundColor:"#2ecc71",color:"white",border:"none",borderRadius:"5px",cursor:t.length>0?"pointer":"not-allowed",fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",opacity:t.length>0?1:.6},disabled:0===t.length||p,children:[(0,l.jsx)("span",{children:"\u25b6\ufe0f"})," Procesar Siguiente Solicitud"]})]})]}),g&&(0,l.jsxs)("div",{style:{marginTop:"15px",padding:"15px",backgroundColor:"#f8f9fa",borderRadius:"5px",fontStyle:"italic",marginBottom:"20px",textAlign:"center",border:"1px solid #e9ecef",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"Estado:"})," ",g||A]}),(0,l.jsx)("button",{onClick:async()=>{N("Recargando datos...");const e=await u();N(e?"Datos recargados correctamente":"Error al recargar datos"),setTimeout((()=>{N("")}),2e3)},style:{padding:"5px 10px",backgroundColor:"#3498db",color:"white",border:"none",borderRadius:"3px",cursor:"pointer",fontSize:"13px"},children:"\ud83d\udd04 Recargar datos"})]}),(0,l.jsxs)("div",{style:{backgroundColor:"white",padding:"20px",borderRadius:"10px",boxShadow:"0 2px 10px rgba(0,0,0,0.05)",marginBottom:"20px"},children:[(0,l.jsx)("h2",{children:"Asignaciones Actuales"}),(0,l.jsxs)("div",{style:{marginBottom:"15px",padding:"10px 15px",borderRadius:"5px",backgroundColor:"#e8f4f8",fontSize:"14px",border:"1px solid #c8e1e9",color:"#2980b9"},children:[(0,l.jsx)("strong",{children:"Informaci\xf3n:"}),' El bot\xf3n "Reasignar" convierte una asignaci\xf3n actual en una solicitud pendiente, permitiendo que se reasigne a otro centro si hay mejor opci\xf3n disponible.']}),(0,l.jsx)("div",{style:{marginBottom:"15px"},children:(0,l.jsx)("input",{type:"text",placeholder:"Buscar por n\xfamero de orden o centro...",value:_,onChange:e=>T(e.target.value),style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"5px",marginBottom:"10px"}})}),t.length>0?(0,l.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{style:{backgroundColor:"#f8f9fa"},children:[(0,l.jsx)("th",{style:{padding:"10px",textAlign:"left"},children:"Orden"}),(0,l.jsx)("th",{style:{padding:"10px",textAlign:"left"},children:"Centro Asignado"}),(0,l.jsx)("th",{style:{padding:"10px",textAlign:"left"},children:"Plazas Disponibles"}),(0,l.jsx)("th",{style:{padding:"10px",textAlign:"left"},children:"Acciones"})]})}),(0,l.jsx)("tbody",{children:t.sort(((e,t)=>{const n=e.numeroOrden||e.order||0,r=t.numeroOrden||t.order||0;return Number(n)-Number(r)})).filter((e=>{const t=_.toLowerCase(),n=(e.numeroOrden||e.order||"").toString(),r=e.nombreCentro||e.centerName||"";return n.includes(t)||r.toLowerCase().includes(t)})).map(((e,t)=>{const n=(e=>{if(!e)return console.warn("encontrarCentro: assignment es undefined o null"),{id:"desconocido",nombre:"Centro desconocido",plazas:0,asignadas:0,municipio:"",localidad:""};let t=null;try{if(e.centroAsociado?t=e.centroAsociado:e.centerId&&i&&Array.isArray(i)&&(t=i.find((t=>t&&t.id===e.centerId))),!t&&e.nombreCentro&&"Centro no encontrado"!==e.nombreCentro&&i&&Array.isArray(i)){const r=e.nombreCentro.toLowerCase();if(t=i.find((e=>e&&e.nombre&&e.nombre.toLowerCase()===r||e&&e.centro&&e.centro.toLowerCase()===r)),!t)try{const e=r.normalize("NFD").replace(/[\u0300-\u036f]/g,"");t=i.find((t=>!(!t||!t.nombre&&!t.centro)&&(t.nombre||t.centro||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")===e))}catch(n){console.error("Error al normalizar nombre:",n)}}}catch(n){console.error("Error en la b\xfasqueda de centro:",n)}return t?(t.plazasTotal=t.plazasTotal||t.plazas||0,t.plazasOcupadas=t.plazasOcupadas||t.asignadas||0,t.plazasDisponibles=Math.max(0,t.plazasTotal-t.plazasOcupadas)):t={id:e.centerId||"desconocido",nombre:e.nombreCentro||e.centerName||"Centro desconocido",plazas:0,plazasTotal:0,asignadas:0,plazasOcupadas:0,plazasDisponibles:0,municipio:e.municipio||"",localidad:e.localidad||""},t})(e),r=n.plazasTotal||n.plazas||0,s=n.plazasOcupadas||n.asignadas||0,a=Math.max(0,r-s);return(0,l.jsxs)("tr",{style:{borderBottom:"1px solid #eee"},children:[(0,l.jsx)("td",{style:{padding:"10px"},children:e.numeroOrden||e.order}),(0,l.jsx)("td",{style:{padding:"10px"},children:e.nombreCentro||e.centerName}),(0,l.jsx)("td",{style:{padding:"10px"},children:(0,l.jsxs)("div",{style:{padding:"5px",borderRadius:"3px",border:"1px solid #e6f2ff"},children:[(0,l.jsxs)("div",{style:{display:"flex",fontSize:"13px",justifyContent:"center",gap:"5px"},children:[(0,l.jsx)("span",{style:{color:a>0?"#2ecc71":"#e74c3c",fontWeight:"bold"},children:a}),(0,l.jsx)("span",{children:"disponibles de"}),(0,l.jsx)("span",{children:r}),r>0&&(0,l.jsxs)("span",{style:{marginLeft:"5px",backgroundColor:a>0?"#e8f5e9":"#ffebee",padding:"0px 5px",borderRadius:"10px",fontSize:"12px"},children:[Math.round(a/r*100),"%"]})]}),n.municipio&&(0,l.jsxs)("div",{style:{fontSize:"12px",color:"#718096",marginTop:"3px",textAlign:"center"},children:[n.municipio,n.localidad&&n.localidad!==n.municipio&&` (${n.localidad})`]})]})}),(0,l.jsx)("td",{style:{padding:"10px"},children:(0,l.jsx)("button",{onClick:()=>(async e=>{try{if(!e)return void m("Error: Asignaci\xf3n no v\xe1lida","error");N("Procesando reasignaci\xf3n...");const t=e.docId||e.id;if(!t)return console.warn("Advertencia: La asignaci\xf3n no tiene identificador v\xe1lido:",e),m("Error: La asignaci\xf3n no tiene un identificador v\xe1lido","error"),void N("");if(!e.order&&!e.numeroOrden)return m("Error: No se pudo obtener el n\xfamero de orden","error"),void N("");const n=e.numeroOrden||e.order,r={orden:n,centrosIds:Array.isArray(e.centrosIds)?e.centrosIds:e.centerId?[e.centerId]:[],timestamp:(0,o.O5)()};console.log("Nueva solicitud a crear:",r);const i=(0,o.wP)(f),s=(0,o.H9)((0,o.rJ)(f,"solicitudesPendientes"));i.set(s,r);const a=(0,o.H9)(f,"asignaciones",t);i.delete(a);const l=new Date,c={orden:n,estado:"REASIGNANDO",mensaje:"Reasignaci\xf3n manual desde el panel de administraci\xf3n",fechaHistorico:l.toISOString(),timestamp:l.getTime()};e.centerId?c.centroAnterior=e.centerId:e.centro&&"string"===typeof e.centro&&(c.centroAnterior=e.centro),console.log("Datos de historial a crear:",c);const d=(0,o.H9)((0,o.rJ)(f,"historialSolicitudes"));i.set(d,c),await i.commit(),N(""),await u(),m(`Asignaci\xf3n para orden ${n} movida a solicitudes pendientes`,"success")}catch(t){console.error("Error al reasignar:",t),N(""),m(`Error al reasignar: ${t.message}`,"error")}})(e),style:{padding:"5px 10px",backgroundColor:"#f39c12",color:"white",border:"none",borderRadius:"3px",cursor:"pointer"},disabled:p,children:"Reasignar"})})]},e.docId||e.id||`assignment-${t}`)}))})]}):(0,l.jsx)("p",{children:"No hay asignaciones."})]}),(0,l.jsxs)("div",{style:{backgroundColor:"white",padding:"20px",borderRadius:"10px",boxShadow:"0 2px 10px rgba(0,0,0,0.05)",marginBottom:"20px"},children:[(0,l.jsx)("h2",{children:"Solicitudes Pendientes"}),(0,l.jsx)("div",{style:{marginBottom:"15px"},children:(0,l.jsx)("input",{type:"text",placeholder:"Buscar por n\xfamero de orden...",value:k,onChange:e=>C(e.target.value),style:{width:"100%",padding:"10px",border:"1px solid #ddd",borderRadius:"5px",marginBottom:"10px"}})}),s.length>0?(0,l.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{style:{backgroundColor:"#f8f9fa"},children:[(0,l.jsx)("th",{style:{padding:"10px",textAlign:"left"},children:"Orden"}),(0,l.jsx)("th",{style:{padding:"10px",textAlign:"left"},children:"Centros Solicitados"}),(0,l.jsx)("th",{style:{padding:"10px",textAlign:"left"},children:"Plazas Disponibles"}),(0,l.jsx)("th",{style:{padding:"10px",textAlign:"left"},children:"Acciones"})]})}),(0,l.jsx)("tbody",{children:s.sort(((e,t)=>Number(e.orden)-Number(t.orden))).filter((e=>{const t=k.toLowerCase();return String(e.orden).includes(t)})).map((e=>(0,l.jsxs)("tr",{style:{borderBottom:"1px solid #eee"},children:[(0,l.jsx)("td",{style:{padding:"10px"},children:e.orden}),(0,l.jsx)("td",{style:{padding:"10px"},children:e.centrosIds.map(((t,n)=>{let r=i.find((e=>e.id===t));if(r||(r=i.find((e=>e.id===t))),!r&&"string"===typeof t&&t.length>5){const e=t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");r=i.find((t=>(t.nombre||t.centro||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")===e))}if(!r&&"string"===typeof t&&t.length>5){const e=t.toLowerCase(),n=i.find((t=>t.nombre&&t.nombre.toLowerCase().includes(e)||t.centro&&t.centro.toLowerCase().includes(e)));n&&(r=n)}r||(r={plazas:0,plazasTotal:0,asignadas:0,plazasDisponibles:0});const o=r.plazasTotal||r.plazas||0,s=r.plazasOcupadas||r.asignadas||0,a=Math.max(0,o-s);return(0,l.jsxs)("div",{style:{marginBottom:n<e.centrosIds.length-1?"5px":"0",padding:"5px",backgroundColor:0===n?"#f2f9ff":"transparent",borderRadius:"3px",border:"1px solid #e6f2ff"},children:[(0,l.jsx)("div",{style:{fontWeight:"bold",fontSize:"14px"},children:r.nombre||"Centro desconocido"}),(0,l.jsxs)("div",{style:{display:"flex",marginTop:"3px",fontSize:"13px",justifyContent:"center",gap:"5px"},children:[(0,l.jsx)("span",{style:{color:a>0?"#2ecc71":"#e74c3c",fontWeight:"bold"},children:a}),(0,l.jsx)("span",{children:"disponibles de"}),(0,l.jsx)("span",{children:o}),o>0&&(0,l.jsxs)("span",{style:{marginLeft:"5px",backgroundColor:a>0?"#e8f5e9":"#ffebee",padding:"0px 5px",borderRadius:"10px",fontSize:"12px"},children:[Math.round(a/o*100),"%"]})]})]},t)}))}),(0,l.jsx)("td",{style:{padding:"10px"},children:(0,l.jsx)("button",{onClick:async()=>{try{if(N(`Procesando solicitud ${e.orden}...`),!e||!e.orden)throw new Error("Datos de solicitud incompletos");if(!e.centrosIds||!Array.isArray(e.centrosIds)||0===e.centrosIds.length)throw new Error("La solicitud no tiene centros seleccionados");const{procesarSolicitud:r}=await Promise.resolve().then(n.bind(n,496)),s=await r(e,i,f);if(console.log("Resultado procesamiento individual:",s),s.success&&e.docId)try{N("Eliminando solicitud procesada..."),await(0,o.kd)((0,o.H9)(f,"solicitudesPendientes",e.docId))}catch(t){console.error("Error al eliminar solicitud procesada:",t)}if(N("Actualizando datos..."),await u(),N(""),s.success)m(`Solicitud ${e.orden} procesada correctamente`,"success");else{if(!s.noAsignable)throw new Error(s.message||"Error desconocido");m(`No se pudo asignar la solicitud: ${s.message}`,"warning")}}catch(t){console.error("Error al procesar solicitud:",t),N(""),m(`Error al procesar solicitud: ${t.message}`,"error")}},style:{padding:"5px 10px",backgroundColor:"#3498db",color:"white",border:"none",borderRadius:"3px",cursor:"pointer"},disabled:p||A,children:A&&A.includes(`Procesando solicitud ${e.orden}`)?(0,l.jsxs)("span",{className:"processing-btn",children:[(0,l.jsx)("span",{className:"processing-indicator"}),"Procesando..."]}):"Procesar"})})]},e.docId)))})]}):(0,l.jsx)("p",{children:"No hay solicitudes pendientes."})]}),(0,l.jsx)("div",{style:{textAlign:"center",marginTop:"20px"},children:(0,l.jsx)("a",{href:"/",style:{padding:"10px 20px",backgroundColor:"#f8f9fa",color:"#333",textDecoration:"none",borderRadius:"5px",fontWeight:"bold"},children:"Volver a la p\xe1gina principal"})}),(0,l.jsxs)("div",{style:{marginTop:"20px",padding:"15px",backgroundColor:"#f8f9fa",borderRadius:"5px",textAlign:"center",fontSize:"14px",color:"#666"},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[(0,l.jsx)("h3",{style:{margin:0,fontSize:"16px",color:"#2c3e50"},children:"Resumen de plazas"}),(0,l.jsx)("button",{onClick:()=>{N("Recalculando plazas disponibles...");i.map((e=>{const n=e.plazasTotal||e.plazas||0,r=t.filter((t=>t.centerId===e.id||t.nombreCentro===e.nombre)).length;return{...e,asignadas:r,plazasOcupadas:r,plazasDisponibles:Math.max(0,n-r)}}));N("Plazas disponibles actualizadas correctamente"),setTimeout((()=>N("")),2e3)},style:{padding:"5px 10px",backgroundColor:"#2ecc71",color:"white",border:"none",borderRadius:"3px",cursor:"pointer",fontSize:"13px"},children:"\ud83d\udd04 Recalcular plazas"})]}),(0,l.jsxs)("p",{children:["Plazas asignadas: ",t.length," / Plazas totales: ",i.reduce(((e,t)=>e+(t.plazasTotal||t.plazas||0)),0)," / Plazas disponibles: ",i.reduce(((e,t)=>{const n=t.plazasTotal||t.plazas||0,r=t.plazasOcupadas||t.asignadas||0;return e+Math.max(0,n-r)}),0)]}),(()=>{const e=i.reduce(((e,t)=>e+(t.plazasTotal||t.plazas||0)),0),n=t.length,r=e>0?Math.round(n/e*100):0;let o="#2ecc71";return r>75?o="#e74c3c":r>50?o="#f39c12":r>25&&(o="#3498db"),(0,l.jsx)("div",{style:{marginTop:"10px",marginBottom:"15px"},children:(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[(0,l.jsx)("div",{style:{width:"70%",maxWidth:"500px"},children:(0,l.jsx)("div",{style:{width:"100%",height:"10px",backgroundColor:"#ecf0f1",borderRadius:"5px",overflow:"hidden"},children:(0,l.jsx)("div",{style:{width:`${r}%`,height:"100%",backgroundColor:o,transition:"width 0.5s ease"}})})}),(0,l.jsxs)("div",{style:{fontWeight:"bold",color:o},children:[r,"% ocupadas"]})]})})})(),(0,l.jsxs)("p",{children:["Centros disponibles: ",i.length]}),(0,l.jsxs)("p",{children:["\xdaltima actualizaci\xf3n: ",y&&"function"===typeof y.getTime?y.toLocaleString():"No disponible"]})]}),(0,l.jsx)("div",{style:{marginTop:"40px"},children:(0,l.jsx)("footer",{style:{padding:"20px 15px",borderTop:"1px solid #ddd",backgroundColor:"#f8f9fa",textAlign:"center",color:"#333",fontSize:"14px",width:"100%",position:"relative",display:"block"},children:(0,l.jsxs)("div",{style:{maxWidth:"1280px",margin:"0 auto"},children:[(0,l.jsxs)("p",{style:{margin:"10px 0"},children:["Realizado por ",(0,l.jsx)("a",{href:"https://ag-marketing.es",target:"_blank",rel:"noopener noreferrer",style:{color:"#18539E",textDecoration:"none",fontWeight:"bold"},children:"AG-Marketing"})]}),(0,l.jsxs)("p",{style:{margin:"10px 0"},children:["\xa9 ",(new Date).getFullYear()," - Todos los derechos reservados"]})]})})})]})};const p=function(){const[e,t]=(0,r.useState)([]),[n,i]=(0,r.useState)([]),[p,g]=(0,r.useState)([]),[m,y]=(0,r.useState)([]),[v,b]=(0,r.useState)(!1),[w,x]=(0,r.useState)(""),[I,S]=(0,r.useState)(!1),[E,_]=(0,r.useState)(new Date),[T,k]=(0,r.useState)(45),[C,A]=(0,r.useState)(!1),[N,D]=(0,r.useState)(!1),[P,R]=(0,r.useState)(!1),[O,L]=(0,r.useState)("Iniciando sistema y verificando datos..."),[j,M]=(0,r.useState)(10),[z,F]=(0,r.useState)(!1),[V,U]=(0,r.useState)(!1),[$,B]=(0,r.useState)(!1),[q,H]=(0,r.useState)(""),[K,G]=(0,r.useState)([]),[W,Q]=(0,r.useState)(!1),[J,Y]=(0,r.useState)(null),[X,Z]=(0,r.useState)(""),[ee,te]=(0,r.useState)(""),[ne,re]=(0,r.useState)(!1),[ie,oe]=(0,r.useState)(""),[se,ae]=(0,r.useState)("success"),[le,ce]=(0,r.useState)("asignaciones"),ue=(0,r.useRef)(!1),de=(0,r.useRef)(!1),he=(0,r.useRef)(!1),fe=(0,r.useRef)(null),pe=((0,r.useRef)(0),(0,r.useRef)(null)),ge=(0,r.useRef)(0),me=(0,r.useRef)(!1),[ye,ve]=(0,r.useState)(!1),[be,we]=(0,r.useState)({show:!1,message:"",type:""}),[xe,Ie]=(0,r.useState)(""),[Se,Ee]=(0,r.useState)(!1),[_e,Te]=(0,r.useState)(""),[ke,Ce]=(0,r.useState)(!1),[Ae,Ne]=(0,r.useState)(""),[De,Pe]=(0,r.useState)("all"),[Re,Oe]=(0,r.useState)({}),[Le,je]=(0,r.useState)({}),[Me,ze]=(0,r.useState)({}),[Fe,Ve]=(0,r.useState)({}),[Ue,$e]=(0,r.useState)({asignaciones:0,pendientes:0,centros:0,historial:0}),Be=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";oe(e),ae(t),re(!0),"error"!==t&&setTimeout((()=>{re(!1)}),5e3)},qe=async()=>{if(!C){A(!0),x("Reseteando y recalculando contadores de asignaciones...");try{await Ge();const t=await(0,a.Ge)(e,n,s.db);ge.current=Date.now(),await Ge(),t.success?Be(`Contadores recalculados correctamente: ${t.actualizados} centros actualizados.`,"success"):Be(`Error al recalcular contadores: ${t.message}`,"error")}catch(t){console.error("Error al resetear contadores:",t),Be(`Error al resetear contadores: ${t.message}`,"error")}finally{A(!1),x("")}}},He=async e=>{try{let u=null;if(e&&e.target&&e.target.files&&e.target.files.length>0)u=e.target.files[0];else try{const e="/asignacion-plazas/plazas.csv",t=await fetch(e);if(t.ok)u=await t.blob();else{console.log("CSV no encontrado en la ubicaci\xf3n predeterminada, abriendo di\xe1logo de selecci\xf3n...");const e=document.createElement("input");e.type="file",e.accept=".csv";const t=new Promise((t=>{e.onchange=e=>t(e.target.files[0])}));e.click(),u=await t}}catch(c){console.error("Error al intentar cargar CSV autom\xe1ticamente:",c);const e=document.createElement("input");e.type="file",e.accept=".csv";const t=new Promise((t=>{e.onchange=e=>t(e.target.files[0])}));e.click(),u=await t}S(!0),x("Cargando y procesando archivo CSV...");try{x("Obteniendo centros existentes...");const e=await(0,o.GG)((0,o.rJ)(s.db,"centros")),c={},d={};e.forEach((e=>{const t=e.data();if(t.codigo&&(c[t.codigo]={...t,docId:e.id}),t.centro){const n=t.centro.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");d[n]={...t,docId:e.id}}})),console.log(`Se encontraron ${e.size} centros existentes`);const h=await fetch(u);if(!h.ok)throw new Error(`Error al cargar el CSV: ${h.status} - ${h.statusText}`);const f=await h.text();if(f.length<100)throw new Error("El archivo CSV parece estar vac\xedo o es demasiado peque\xf1o");const p=f.split("\n").map((e=>e.replace(/"/g,"").trim())).filter(Boolean);if(p.length<5)throw new Error("El archivo CSV no contiene suficientes l\xedneas de datos");let g=p.findIndex((e=>e.includes("A.S.I.;")));if(-1===g){const e=p.findIndex((e=>e.includes("ASI;")||e.includes("DEPARTAMENTO;")||e.includes("CODIGO;")));if(-1===e)throw new Error("No se encontr\xf3 una l\xednea de encabezado v\xe1lida en el CSV");g=e}if(p[g].split(";").length<5)throw new Error("El formato del encabezado no es v\xe1lido, faltan columnas necesarias");const m=new Set,y=new Set,v=[],b=[];let w=Object.keys(c).length+1,I=0,E=0,_=0;x("Analizando datos del CSV...");for(let o=g+1;o<p.length;o++){var t,n,r,i,a,l;const e=p[o].trim();if(!e)continue;if(e.includes("de 11")||e.includes("TOTAL ="))continue;const s=e.split(";");if(s.length<5){E++;continue}const u=(null===(t=s[0])||void 0===t?void 0:t.trim())||"",h=(null===(n=s[1])||void 0===n?void 0:n.trim())||"",f=(null===(r=s[2])||void 0===r?void 0:r.trim())||"",g=(null===(i=s[3])||void 0===i?void 0:i.trim())||"",S=(null===(a=s[4])||void 0===a?void 0:a.trim())||"";if(!f||f.length<2){console.warn(`L\xednea ${o+1}: C\xf3digo inv\xe1lido o ausente: "${f}"`),E++;continue}if(!g||g.length<2){console.warn(`L\xednea ${o+1}: Nombre de centro inv\xe1lido o ausente: "${g}"`),E++;continue}if(!S){console.warn(`L\xednea ${o+1}: Municipio ausente para centro: "${g}"`),E++;continue}const T=`${f}-${g}-${S}`.toLowerCase();if(m.has(T)){_++;continue}y.has(f)&&console.warn(`Posible duplicado con c\xf3digo ${f}: "${g}" en ${S}`),m.add(T),y.add(f);let k=1;if(s.length>5&&null!==(l=s[5])&&void 0!==l&&l.trim()){const e=s[5].trim(),t=parseInt(e);!isNaN(t)&&t>0?k=t:console.warn(`L\xednea ${o+1}: Valor de plazas inv\xe1lido: "${e}", usando 1 por defecto`)}else console.warn(`L\xednea ${o+1}: No se especific\xf3 n\xfamero de plazas para "${g}", usando 1 por defecto`);I+=k;const C=c[f],A=g.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,""),N=d[A];C?b.push({...C,asi:u||C.asi,departamento:h||C.departamento,centro:g||C.centro,localidad:S||C.localidad,municipio:S||C.municipio,plazas:k,asignadas:C.asignadas||0}):N?b.push({...N,asi:u||N.asi,departamento:h||N.departamento,codigo:f||N.codigo,localidad:S||N.localidad,municipio:S||N.municipio,plazas:k,asignadas:N.asignadas||0}):v.push({id:w++,asi:u,departamento:h,codigo:f,centro:g,localidad:S,municipio:S,plazas:k,asignadas:0}),(v.length+b.length)%100===0&&x(`Procesando CSV: ${v.length} nuevos, ${b.length} actualizados...`)}if(0===v.length+b.length)throw new Error("No se pudieron extraer centros v\xe1lidos del CSV");x(`Actualizando ${b.length} centros existentes...`);for(const t of b)t.docId&&await(0,o.mZ)((0,o.H9)(s.db,"centros",t.docId),{...t});x(`A\xf1adiendo ${v.length} nuevos centros a Firebase...`);const T=100;for(let t=0;t<v.length;t+=T){const e=v.slice(t,t+T);x(`A\xf1adiendo nuevos centros: ${t}/${v.length}`);for(const t of e){const e=(0,o.H9)((0,o.rJ)(s.db,"centros"));await(0,o.BN)(e,{...t,docId:e.id})}}return x("Datos cargados correctamente"),await Ge(),S(!1),Be(`Se han actualizado ${b.length} centros y a\xf1adido ${v.length} nuevos centros correctamente`,"success"),!0}catch(c){return console.error("Error al cargar o procesar el CSV:",c),Be(`Error en la importaci\xf3n: ${c.message}`,"error"),S(!1),!1}}catch(c){return console.error("Error al cargar datos desde CSV:",c),Be(`Error al cargar datos desde CSV: ${c.message}`,"error"),S(!1),!1}},Ke=async e=>{try{x(`Limpiando colecci\xf3n ${e}...`);const t=await(0,o.GG)((0,o.rJ)(s.db,e));if(t.size>0)for(const n of t.docs)await(0,o.kd)((0,o.H9)(s.db,e,n.id));return!0}catch(t){throw console.error(`Error al limpiar colecci\xf3n ${e}:`,t),t}},Ge=async()=>{console.log("Iniciando carga de datos desde Firebase...");try{console.log("Verificando colecciones disponibles en Firebase..."),console.log("Intentando cargar centros...");let e=await(0,o.GG)((0,o.rJ)(s.db,"centros"));if(e.empty){console.warn("\u26a0\ufe0f No se encontraron centros en la colecci\xf3n 'centros'");const t=(0,o.rJ)(s.db,"centrosTrabajo");e=await(0,o.GG)(t),e.empty?console.error("\u274c No se encontraron centros en ninguna colecci\xf3n"):console.log("\u2705 Se encontraron centros en la colecci\xf3n 'centrosTrabajo':",e.size)}else console.log("\u2705 Se encontraron centros en la colecci\xf3n 'centros':",e.size);console.log("Intentando cargar asignaciones para contar plazas ocupadas...");let n=await(0,o.GG)((0,o.rJ)(s.db,"asignaciones"));if(n.empty){console.warn("\u26a0\ufe0f No se encontraron asignaciones en la colecci\xf3n 'asignaciones'");const e=(0,o.rJ)(s.db,"asignacionesActuales");n=await(0,o.GG)(e),n.empty?console.error("\u274c No se encontraron asignaciones en ninguna colecci\xf3n"):console.log("\u2705 Se encontraron asignaciones en la colecci\xf3n 'asignacionesActuales':",n.size)}else console.log("\u2705 Se encontraron asignaciones en la colecci\xf3n 'asignaciones':",n.size);const r={};n.forEach((e=>{const t=e.data();if(t&&t.centerId){const e=t.centerId;r[e]=(r[e]||0)+1}})),console.log("Conteo de asignaciones por centro:",r);const a=new Set,l=new Set,c=new Map,u=[];e.forEach((e=>{const t=e.data(),n=t.nombre||t.centro||"Centro sin nombre",i=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim(),o=t.codigoCentro||t.codigo||"",s=parseInt(t.plazas||t.plazasTotal||0,10),a=r[e.id]||0,l=Math.max(0,s-a);u.push({id:e.id,docId:e.id,nombre:n,nombreNormalizado:i,codigo:o,plazas:s,asignadas:a,plazasDisponibles:l,plazasOcupadas:a,plazasTotal:s,direccion:t.direccion||"",codigoCentro:o,estadoCentro:t.estadoCentro||"Activo",municipio:t.municipio||"",localidad:t.localidad||"",esDuplicado:!1,duplicadoDe:null})})),console.log(`Se encontraron ${u.length} centros en total antes de filtrar`);for(let t=0;t<u.length;t++){const e=u[t];if(!e.esDuplicado)if(a.has(e.id))e.esDuplicado=!0;else if(e.codigo&&l.has(e.codigo)&&console.warn(`Posible duplicado por c\xf3digo: ${e.codigo} - ${e.nombre}`),c.has(e.nombreNormalizado)){const t=c.get(e.nombreNormalizado);console.warn(`Duplicado por nombre: "${e.nombre}" duplica a ID=${t}`),e.esDuplicado=!0,e.duplicadoDe=t}else a.add(e.id),e.codigo&&l.add(e.codigo),c.set(e.nombreNormalizado,e.id)}const d=u.filter((e=>!e.esDuplicado));console.log(`Despu\xe9s de eliminar duplicados, quedan ${d.length} centros`);let h=d;h.length>366&&(console.warn(`A\xfan hay m\xe1s centros (${h.length}) de los esperados (366). Limitando...`),h=[...h].sort(((e,t)=>t.plazasTotal-e.plazasTotal)).slice(0,366));let f={};h.forEach((e=>{f[e.id]=e})),console.log(`Finalmente se cargar\xe1n ${Object.keys(f).length} centros`),0===Object.keys(f).length&&(console.warn("\u26a0\ufe0f Creando centros de prueba para diagn\xf3stico"),f.centro1={id:"centro1",nombre:"Centro de Prueba 1",plazas:10,asignadas:0,plazasDisponibles:10,plazasOcupadas:0,plazasTotal:10,direccion:"Direcci\xf3n de prueba",codigoCentro:"CP001",estadoCentro:"Activo",municipio:"Municipio de Prueba 1",localidad:"Localidad de Prueba 1"},f.centro2={id:"centro2",nombre:"Centro de Prueba 2",plazas:7,asignadas:2,plazasDisponibles:5,plazasOcupadas:2,plazasTotal:7,direccion:"Otra direcci\xf3n",codigoCentro:"CP002",estadoCentro:"Activo",municipio:"Municipio de Prueba 2",localidad:"Localidad de Prueba 2"}),console.log("Centros procesados:",Object.keys(f).length),console.log("Procesando asignaciones para mostrar...");const p={},m={};Object.values(f).forEach((e=>{if(p[e.id]=e,e.nombre){const t=e.nombre.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");m[t]=e}if(e.centro&&e.centro!==e.nombre){const t=e.centro.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");m[t]=e}})),console.log("Centros indexados:",{porId:Object.keys(p).length,porNombre:Object.keys(m).length});let v={};n.forEach((e=>{const t=e.data();if(console.log("Asignaci\xf3n encontrada:",e.id,t),t){let n=p[t.centerId];if(!n&&t.centro){const e=t.centro.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");n=m[e],n&&console.log(`Centro encontrado por campo 'centro': "${t.centro}" corresponde a ID=${n.id}`)}if(!n&&t.centerId&&"string"===typeof t.centerId){const e=t.centerId.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");n=m[e],n&&console.log(`Centro encontrado por centerId como nombre: "${t.centerId}" corresponde a ID=${n.id}`)}if(!n&&t.centerName){const e=t.centerName.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");n=m[e],n&&console.log(`Centro encontrado por centerName: "${t.centerName}" corresponde a ID=${n.id}`)}let r="Centro no encontrado";n?r=n.nombre:t.centro?r=t.centro:t.centerName?r=t.centerName:t.centerId&&"string"===typeof t.centerId&&t.centerId.length>5&&(r=t.centerId),v[e.id]={id:e.id,numeroOrden:t.order||t.numeroOrden||0,centerId:t.centerId||t.centro||"",centroPrevio:t.centroPrevio||t.centroAnterior||"",nombreCentro:r,timestamp:t.timestamp||Date.now(),fechaAsignacion:t.fechaAsignacion||(new Date).toISOString(),centroAsociado:n,municipio:t.municipio||(n?n.municipio:""),localidad:t.localidad||(n?n.localidad:"")}}})),console.log("Asignaciones procesadas:",Object.keys(v).length),console.log("Intentando cargar solicitudes pendientes...");const b=(0,o.rJ)(s.db,"solicitudesPendientes"),w=await(0,o.GG)(b);w.empty?console.warn("\u26a0\ufe0f No se encontraron solicitudes pendientes"):console.log("\u2705 Se encontraron solicitudes pendientes:",w.size);let x={};w.forEach((e=>{const t=e.data();console.log("Solicitud encontrada:",e.id,t),x[e.id]={id:e.id,numeroOrden:t.orden||t.numeroOrden||0,centrosIds:t.centrosIds||t.centrosSeleccionados||[],timestamp:t.timestamp||Date.now(),fechaSolicitud:t.fechaSolicitud||(new Date).toISOString(),estado:t.estado||"Pendiente"}})),console.log("Solicitudes procesadas:",Object.keys(x).length),console.log("Intentando cargar historial...");const I=(0,o.rJ)(s.db,"historialSolicitudes"),S=await(0,o.GG)(I);S.empty?console.warn("\u26a0\ufe0f No se encontr\xf3 historial de solicitudes"):console.log("\u2705 Se encontr\xf3 historial de solicitudes:",S.size);let E=[];S.forEach((e=>{var t,n;const r=e.data();E.push({id:e.id,numeroOrden:r.orden||r.numeroOrden||0,centerId:r.centerId||r.centro||"",centroPrevio:r.centroPrevio||"",centroAnterior:r.centroAnterior||"",nombreCentro:(null===(t=f[r.centerId])||void 0===t?void 0:t.nombre)||"Centro no encontrado",nombreCentroAnterior:r.centroAnterior?(null===(n=f[r.centroAnterior])||void 0===n?void 0:n.nombre)||"Centro no encontrado":"",timestamp:r.timestamp||Date.now(),fechaHistorico:r.fechaHistorico||(new Date).toISOString(),estado:r.estado||"Procesado",accion:r.accion||"Asignaci\xf3n",mensaje:r.mensaje||""})})),E.sort(((e,t)=>(t.timestamp||0)-(e.timestamp||0))),console.log("Historial procesado:",E.length,"registros"),t(Object.values(f)),i(Object.values(v)),g(Object.values(x)),y(E),Oe(f),je(v),ze(x);const _=Object.keys(v).length,T=Object.keys(x).length,k=Object.keys(f).length;$e({asignaciones:_,pendientes:T,centros:k,historial:E.length});let C={};Object.values(f).forEach((e=>{const t=e.plazasTotal||e.plazas||0,n=e.asignadas||e.plazasOcupadas||0,r=e.plazasDisponibles||Math.max(0,t-n);C[e.id]={id:e.id,nombre:e.nombre,plazas:t,asignadas:n,plazasDisponibles:r,plazasTotal:t,plazasOcupadas:n,codigoCentro:e.codigoCentro,estadoCentro:e.estadoCentro,municipio:e.municipio||"",localidad:e.localidad||""}})),Ve(C);const A=Object.values(f).reduce(((e,t)=>e+(t.plazasTotal||t.plazas||0)),0),N=Object.values(f).reduce(((e,t)=>e+(t.asignadas||t.plazasOcupadas||0)),0),D=Object.values(f).reduce(((e,t)=>{const n=t.plazasTotal||t.plazas||0,r=t.asignadas||t.plazasOcupadas||0;return e+Math.max(0,n-r)}),0);return console.log("Datos de plazas actualizados. Totales:",{totalCentros:Object.keys(f).length,totalPlazas:A,plazasAsignadas:N,plazasDisponibles:D}),console.log("Datos cargados correctamente:",{centros:k,asignaciones:_,pendientes:T,historial:E.length}),!0}catch(e){return console.error("Error al cargar datos desde Firebase:",e),console.error("Detalles del error:",e.code,e.message,e.stack),!1}},We=()=>{const e=(0,o.aQ)((0,o.rJ)(s.db,"centros"),(e=>{const n=new Set,r=new Map,i=[];e.forEach((e=>{const t=e.data(),n=t.nombre||t.centro||"Centro sin nombre",r=n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim();i.push({...t,docId:e.id,id:e.id,nombre:n,nombreNormalizado:r,esDuplicado:!1,duplicadoDe:null})}));for(let t=0;t<i.length;t++){const e=i[t];e.esDuplicado||(n.has(e.id)?e.esDuplicado=!0:r.has(e.nombreNormalizado)?(e.esDuplicado=!0,e.duplicadoDe=r.get(e.nombreNormalizado)):(n.add(e.id),r.set(e.nombreNormalizado,e.id)))}let o=i.filter((e=>!e.esDuplicado));o.length>366&&(o=[...o].sort(((e,t)=>(t.plazas||t.plazasTotal||0)-(e.plazas||e.plazasTotal||0))).slice(0,366)),o.length>0&&(t(o),console.log(`Listener: Actualizados ${o.length} centros filtrados`))})),n=(0,o.aQ)((0,o.rJ)(s.db,"asignaciones"),(e=>{const t=[];e.forEach((e=>{const n=e.data(),r={...n,docId:e.id,order:"number"===typeof n.order?n.order:Number(n.order)||0,centro:n.centro||"No disponible",localidad:n.localidad||"No disponible",municipio:n.municipio||"No disponible",timestamp:n.timestamp||Date.now(),estado:n.estado||"ASIGNADA"};t.push(r)})),t.sort(((e,t)=>(Number(e.order)||0)-(Number(t.order)||0))),i(t)})),r=(0,o.aQ)((0,o.rJ)(s.db,"solicitudesPendientes"),(e=>{const t=[];e.forEach((e=>{const n=e.data(),r={...n,docId:e.id,orden:"number"===typeof n.orden?n.orden:Number(n.orden)||0,centrosIds:n.centrosIds||n.centrosSeleccionados||[]};t.push(r)})),g(t)})),a=(0,o.aQ)((0,o.rJ)(s.db,"historialSolicitudes"),(e=>{const t=[];e.forEach((e=>{t.push({...e.data(),docId:e.id})})),y(t)}));return()=>{e(),n(),r(),a()}},Qe=async()=>{try{S(!0),x("Cargando CSV autom\xe1ticamente...");try{const l="/asignacion-plazas/plazas.csv",c=await fetch(l);if(!c.ok)throw new Error(`Error al cargar el CSV: ${c.status} - ${c.statusText}`);const u=await c.text();if(!u||u.length<100)throw new Error("El archivo CSV est\xe1 vac\xedo o es demasiado peque\xf1o");const d=u.split("\n").map((e=>e.replace(/"/g,"").trim())).filter(Boolean);if(d.length<5)throw new Error("El archivo CSV no contiene suficientes l\xedneas de datos");let h=d.findIndex((e=>e.includes("A.S.I.;")));if(-1===h){const e=d.findIndex((e=>e.includes("ASI;")||e.includes("DEPARTAMENTO;")||e.includes("CODIGO;")));if(-1===e)throw new Error("No se encontr\xf3 una l\xednea de encabezado v\xe1lida en el CSV");h=e}if(d[h].split(";").length<5)throw new Error("El formato del encabezado no es v\xe1lido, faltan columnas necesarias");const f=new Set,p=new Set,g=[];let m=1,y=0,v=0,b=0;x("Analizando datos del CSV...");for(let o=h+1;o<d.length;o++){var e,t,n,r,i,a;const s=d[o].trim();if(!s)continue;if(s.includes("de 11")||s.includes("TOTAL ="))continue;const l=s.split(";");if(l.length<5){v++;continue}const c=(null===(e=l[0])||void 0===e?void 0:e.trim())||"",u=(null===(t=l[1])||void 0===t?void 0:t.trim())||"",h=(null===(n=l[2])||void 0===n?void 0:n.trim())||"",w=(null===(r=l[3])||void 0===r?void 0:r.trim())||"",I=(null===(i=l[4])||void 0===i?void 0:i.trim())||"";if(!h||h.length<2){console.warn(`L\xednea ${o+1}: C\xf3digo inv\xe1lido o ausente: "${h}"`),v++;continue}if(!w||w.length<2){console.warn(`L\xednea ${o+1}: Nombre de centro inv\xe1lido o ausente: "${w}"`),v++;continue}if(!I){console.warn(`L\xednea ${o+1}: Municipio ausente para centro: "${w}"`),v++;continue}const S=`${h}-${w}-${I}`.toLowerCase();if(f.has(S)){b++;continue}p.has(h)&&console.warn(`Posible duplicado con c\xf3digo ${h}: "${w}" en ${I}`),f.add(S),p.add(h);let E=1;if(l.length>5&&null!==(a=l[5])&&void 0!==a&&a.trim()){const e=l[5].trim(),t=parseInt(e);!isNaN(t)&&t>0?E=t:console.warn(`L\xednea ${o+1}: Valor de plazas inv\xe1lido: "${e}", usando 1 por defecto`)}else console.warn(`L\xednea ${o+1}: No se especific\xf3 n\xfamero de plazas para "${w}", usando 1 por defecto`);y+=E,g.push({id:m++,asi:c,departamento:u,codigo:h,centro:w,localidad:I,municipio:I,plazas:E,asignadas:0}),g.length%100===0&&x(`Procesando CSV: ${g.length} centros encontrados...`)}if(0===g.length)throw new Error("No se pudieron extraer centros v\xe1lidos del CSV");const w=7066;if(y!==w){const e=[...g].sort(((e,t)=>t.plazas-e.plazas)),t=y-w;if(Math.abs(t)>100&&console.warn(`Diferencia muy grande (${t} plazas) entre el total calculado y el objetivo`),t>0){let n=t,r=0;for(;n>0&&r<Math.min(5,e.length);){const i=e[r],o=Math.min(Math.ceil(t/5),i.plazas-1,n);o>0&&(i.plazas-=o,n-=o),r++}n>0&&(e[0].plazas-=n)}else if(t<0){let n=Math.abs(t),r=0;for(;n>0&&r<Math.min(5,e.length);){const i=e[r],o=Math.min(Math.ceil(Math.abs(t)/5),n);i.plazas+=o,n-=o,r++}n>0&&(e[0].plazas+=n)}const n=g.reduce(((e,t)=>e+t.plazas),0);if(n!==w)throw console.error(`Error en el ajuste: ${n} \u2260 ${w}`),new Error(`No se pudo ajustar el n\xfamero de plazas correctamente: ${n} \u2260 ${w}`)}x(`A\xf1adiendo ${g.length} centros a Firebase...`);let I=0;if((await(0,o.GG)((0,o.rJ)(s.db,"centros"))).size>0)return Be("Se encontraron datos existentes. Usando datos actuales para evitar duplicaci\xf3n.","warning"),S(!1),await Ge();const E=100;for(let e=0;e<g.length;e+=E){const t=g.slice(e,e+E);x(`A\xf1adiendo centros: ${e}/${g.length}`);for(const e of t){const t=(0,o.H9)((0,o.rJ)(s.db,"centros"));await(0,o.BN)(t,{...e,docId:t.id}),I++}}return x("Datos cargados correctamente"),await Ge(),S(!1),Be(`Se han cargado ${I} centros y exactamente ${w} plazas autom\xe1ticamente`,"success"),!0}catch(l){return console.error("Error al cargar CSV autom\xe1ticamente:",l),S(!1),!1}}catch(l){return console.error("Error al cargar CSV autom\xe1ticamente:",l),S(!1),!1}};(0,r.useEffect)((()=>{let e;return(async()=>{console.log("Inicializando aplicaci\xf3n...");try{console.log("Verificando si ya hay datos en Firebase...");const i=await(0,o.GG)((0,o.rJ)(s.db,"centros"));if(i.empty){console.log("No se encontraron centros. Intentando cargar desde CSV...");(await fetch("/asignacion-plazas/plazas.csv")).ok?(console.log("CSV encontrado, cargando datos autom\xe1ticamente..."),await He(),console.log("Datos cargados desde CSV inicial.")):console.warn("CSV no encontrado en ubicaci\xf3n predeterminada")}else console.log("Datos existentes encontrados:",i.size,"centros");const a=window.location.pathname.split("/"),l="admin"===a[a.length-1];if(F(l),ue.current||de.current)return;ue.current=!0;try{if(l){R(!0),L("Cargando datos para el panel de administraci\xf3n..."),M(5);const e=await et();if(!e.success)return R(!0),void L(`Error de conexi\xf3n: ${e.message}. Intenta recargar la p\xe1gina.`);L("Cargando centros y solicitudes..."),M(30);try{await Ge(),console.log("Datos cargados correctamente para el panel de admin"),M(100),L("\xa1Datos cargados correctamente!"),setTimeout((()=>{R(!1)}),1e3)}catch(t){console.error("Error al cargar datos para el panel de admin:",t),L(`Error al cargar datos: ${t.message}`),setTimeout((()=>{R(!1)}),2e3)}return de.current=!0,void(ue.current=!1)}const i=!(await(0,o.GG)((0,o.rJ)(s.db,"solicitudesPendientes"))).empty;(i||l)&&(R(!0),L("Iniciando sistema y verificando conexi\xf3n..."),M(5));const a=await et();if(!a.success)return R(!0),void L(`Error de conexi\xf3n: ${a.message}. Intenta recargar la p\xe1gina.`);(i||l)&&(L("Verificando datos..."),M(10));const c=await(0,o.GG)((0,o.rJ)(s.db,"centros"));if(0===c.size){L("Cargando datos iniciales..."),M(20),await Ke("centros");await Qe()||await He()}else L("Cargando datos existentes..."),M(30),await Ge();e=We(),L("Limpiando duplicados iniciales..."),M(50),console.log("Ejecutando limpieza inicial de duplicados");const u=await Xe();if(u.error)console.error("Error durante la limpieza inicial:",u.error);else{const e=u.eliminadosSolicitudes+u.eliminadosAsignaciones+u.eliminadosHistorial;console.log(`Limpieza inicial completada: ${e} elementos duplicados eliminados`)}L("Moviendo solicitudes hist\xf3ricas a pendientes..."),M(60);try{const e=await Ze();e.error?console.error("Error en el volcado de historial:",e.error):e.volcados>0?(console.log(`Volcado inicial: ${e.volcados} solicitudes recuperadas del historial`),L(`Recuperadas ${e.volcados} solicitudes del historial`)):console.log("No hubo solicitudes para recuperar del historial")}catch(n){console.error("Error durante el volcado de historial:",n)}L("Procesando solicitudes pendientes..."),M(70);try{console.log("Procesando todas las solicitudes pendientes al inicio..."),await Je();const e=(await(0,o.GG)((0,o.rJ)(s.db,"solicitudesPendientes"))).docs.length;M(100),e>0?(L(`Hay ${e} solicitudes pendientes por procesar.`),console.log(`Quedan ${e} solicitudes pendientes despu\xe9s del procesamiento inicial`)):(L("\xa1Sistema iniciado correctamente!"),setTimeout((()=>{R(!1),Be("Sistema iniciado correctamente.","success")}),2e3))}catch(r){console.error("Error al procesar solicitudes iniciales:",r),L(`Error al procesar solicitudes: ${r.message}`),M(100),setTimeout((()=>{R(!1),Be("Se produjo un error durante el procesamiento inicial: "+r.message,"error")}),2e3)}de.current=!0}catch(t){console.error("Error durante la inicializaci\xf3n:",t),L(`Error: ${t.message}`),setTimeout((()=>{R(!1),Be("Error durante la inicializaci\xf3n: "+t.message,"error")}),2e3)}finally{ue.current=!1}}catch(t){console.error("Error durante la inicializaci\xf3n:",t),L(`Error: ${t.message}`),setTimeout((()=>{R(!1),Be("Error durante la inicializaci\xf3n: "+t.message,"error")}),2e3)}})(),()=>{e&&e()}}),[]),(0,r.useEffect)((()=>{if(e.length>0){return(async()=>{p.length>0&&!v&&(await Je(!0),k(45))})(),()=>{fe.current&&clearInterval(fe.current)}}}),[e.length]),(0,r.useEffect)((()=>(N||(pe.current=setInterval((()=>{k((e=>e<=1?(!v&&p.length>0&&!N&&Je(!0),45):e-1))}),1e3)),()=>{pe.current&&clearInterval(pe.current)})),[v,p.length,N]);const Je=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{respetarAsignacionesExistentes:r=!0}=t;if(he.current)return console.log("Ya hay un procesamiento en curso. Espera a que termine."),!1;he.current=!0,x("Iniciando procesamiento de solicitudes...");try{const t=await(0,o.GG)((0,o.rJ)(s.db,"solicitudesPendientes"));if(t.empty)return console.log("No hay solicitudes pendientes para procesar."),x("No hay solicitudes pendientes para procesar."),setTimeout((()=>{x(""),he.current=!1}),3e3),!0;const u=t.docs.map((e=>({...e.data(),docId:e.id,centrosIds:e.data().centrosIds||e.data().centrosSeleccionados||[]}))).sort(((e,t)=>Number(e.orden)-Number(t.orden)));console.log(`Procesando ${u.length} solicitudes pendientes ordenadas por prioridad...`),x(`Procesando ${u.length} solicitudes pendientes...`);let d=n;r?(console.log("Modo ejecuci\xf3n autom\xe1tica: Se respetar\xe1n las asignaciones existentes"),d=[]):console.log("Modo ejecuci\xf3n manual: Se procesar\xe1n todas las asignaciones seg\xfan prioridad");const h=await(0,a.Kc)(u,d,e,x);if(h.error)console.error("Error al procesar solicitudes:",h.error),x(`Error: ${h.error}`);else{if(console.log("Procesamiento completado:",h.message),x(h.message),!r)try{const e=await tt();e&&e.corregidos>0&&(console.log(`Corregidas ${e.corregidos} asignaciones con exceso`),x((t=>`${t} Corregidas ${e.corregidos} asignaciones con exceso.`)))}catch(i){console.error("Error en verificaci\xf3n de asignaciones:",i)}Ie((new Date).toLocaleString());try{await Ge()}catch(l){console.error("Error al recargar datos:",l)}}try{const e=(await(0,o.GG)((0,o.rJ)(s.db,"solicitudesPendientes"))).docs.length;e>0?(console.log(`A\xfan quedan ${e} solicitudes pendientes por procesar`),x((t=>`${t} A\xfan quedan ${e} solicitudes pendientes.`)),e<5&&(console.log("Realizando un segundo intento autom\xe1tico para procesar solicitudes restantes..."),setTimeout((()=>{Je({respetarAsignacionesExistentes:r})}),3e3))):P&&setTimeout((()=>{R(!1),Be("Sistema iniciado correctamente","success")}),2e3)}catch(c){console.error("Error al verificar solicitudes pendientes:",c)}return!0}catch(u){return console.error("Error general al procesar solicitudes:",u),x(`Error al procesar solicitudes: ${u.message}`),!1}finally{setTimeout((()=>{he.current=!1}),3e3)}},Ye={container:{maxWidth:"1280px",margin:"0 auto",padding:"20px",backgroundColor:"#f8f9fa",minHeight:"calc(100vh - 120px)",fontFamily:"Arial, sans-serif",position:"relative"},header:{textAlign:"center",marginBottom:"30px",borderBottom:"1px solid #e7e7e7",paddingBottom:"15px"},title:{color:"#2c3e50",fontSize:"28px",margin:"0 0 10px 0"},subtitle:{color:"#7f8c8d",fontSize:"16px",fontWeight:"normal",margin:0},tabs:{display:"flex",gap:"2px",marginBottom:"20px",backgroundColor:"#e9ecef",borderRadius:"10px",padding:"3px",overflow:"hidden"},tab:{padding:"12px 20px",cursor:"pointer",flex:1,textAlign:"center",borderRadius:"8px",transition:"all 0.3s ease",fontSize:"15px",fontWeight:"500"},activeTab:{backgroundColor:"#fff",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",color:"#3498db"},inactiveTab:{backgroundColor:"transparent",color:"#7f8c8d"},sectionTitle:{fontSize:"20px",color:"#2c3e50",marginBottom:"15px",paddingBottom:"8px",borderBottom:"2px solid #e7e7e7"},cardContainer:{backgroundColor:"white",borderRadius:"10px",padding:"20px",boxShadow:"0 2px 10px rgba(0,0,0,0.05)",marginBottom:"20px"},popup:{position:"fixed",top:"20px",right:"20px",padding:"15px 20px",borderRadius:"10px",boxShadow:"0 3px 15px rgba(0,0,0,0.2)",zIndex:1e3,maxWidth:"350px",animation:"slideIn 0.3s ease"},processingButton:{padding:"12px 20px",backgroundImage:v?"linear-gradient(to right, #cccccc, #dddddd)":"linear-gradient(to right, #3498db, #2980b9)",color:"white",border:"none",borderRadius:"6px",cursor:v||0===p.length?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"15px",fontWeight:"500",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",margin:"10px auto"},reloadButton:{padding:"12px 20px",backgroundImage:I?"linear-gradient(to right, #cccccc, #dddddd)":"linear-gradient(to right, #e74c3c, #c0392b)",color:"white",border:"none",borderRadius:"6px",cursor:I?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"15px",fontWeight:"500",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",margin:"10px auto"},adminPanel:{display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"20px"},adminButton:{padding:"12px 20px",backgroundImage:"linear-gradient(to right, #3498db, #2980b9)",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"15px",fontWeight:"500",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",margin:"10px auto"}};(0,r.useEffect)((()=>{const e=()=>{const e=Date.now(),t=ge.current;(0===t||e-t>36e5)&&qe()};n.length>10&&e();const t=setInterval((()=>{e()}),9e5);return()=>clearInterval(t)}),[n.length]);const Xe=async()=>{try{console.log("Ejecutando eliminaci\xf3n de solicitudes y asignaciones duplicadas...");const e=await(0,o.GG)((0,o.rJ)(s.db,"solicitudesPendientes")),t={},n=e.docs.length;e.docs.forEach((e=>{const n={...e.data(),docId:e.id},r=n.orden;r&&(t[r]?t[r].push(n):t[r]=[n])}));let r=0;Object.keys(t).forEach((e=>{const n=t[e];n.length>1&&(r+=n.length-1)}));const i=await(0,o.GG)((0,o.rJ)(s.db,"asignaciones")),a={},l=i.docs.length;i.docs.forEach((e=>{const t={...e.data(),docId:e.id},n=t.order;n&&(a[n]?a[n].push(t):a[n]=[t])}));let c=0;Object.keys(a).forEach((e=>{const t=a[e];t.length>1&&(c+=t.length-1)}));const u=await(0,o.GG)((0,o.rJ)(s.db,"historialSolicitudes")),d={};u.docs.forEach((e=>{const t={...e.data(),docId:e.id},n=t.orden,r=t.estado||"DESCONOCIDO";if(!n)return;const i=`${n}-${r}`;d[i]?d[i].push(t):d[i]=[t]}));let h=0;if(Object.keys(d).forEach((e=>{const t=d[e];t.length>1&&(h+=t.length-1)})),0===r&&0===c&&0===h)return console.log("No se encontraron elementos duplicados"),{eliminadosSolicitudes:0,eliminadosAsignaciones:0,eliminadosHistorial:0,totalSolicitudes:n,totalAsignaciones:l};console.log(`Se encontraron ${r} solicitudes duplicadas, ${c} asignaciones duplicadas y ${h} entradas duplicadas en historial`);const f=(0,o.wP)(s.db);let p=0,g=0,m=0;for(const y in t){const e=t[y];if(e.length>1){e.sort(((e,t)=>{const n=e.timestamp||0;return(t.timestamp||0)-n}));const t=e.slice(1);for(const e of t)f.delete((0,o.H9)(s.db,"solicitudesPendientes",e.docId)),p++}}for(const y in a){const e=a[y];if(e.length>1){e.sort(((e,t)=>{const n=e.timestamp||0;return(t.timestamp||0)-n}));const t=e.slice(1);for(const e of t)f.delete((0,o.H9)(s.db,"asignaciones",e.docId)),g++}}for(const y in d){const e=d[y];if(e.length>1){e.sort(((e,t)=>{const n=e.timestamp||0;return(t.timestamp||0)-n}));const t=e.slice(1);for(const e of t)f.delete((0,o.H9)(s.db,"historialSolicitudes",e.docId)),m++}}return(p>0||g>0||m>0)&&await f.commit(),console.log(`Se eliminaron ${p} solicitudes duplicadas, ${g} asignaciones duplicadas y ${m} entradas duplicadas en historial`),{eliminadosSolicitudes:p,eliminadosAsignaciones:g,eliminadosHistorial:m,totalSolicitudes:n,totalAsignaciones:l}}catch(e){return console.error("Error al eliminar duplicados:",e),{error:e.message,eliminadosSolicitudes:0,eliminadosAsignaciones:0,eliminadosHistorial:0}}};(0,r.useEffect)((()=>{if(me.current)return void console.log("Verificaci\xf3n ya programada, ignorando programaci\xf3n duplicada");me.current=!0;const e=()=>{const t=new Date,n=new Date;n.setHours(2,0,0,0),t.getHours()>=2&&n.setDate(n.getDate()+1);const r=n.getTime()-t.getTime();console.log(`Verificaci\xf3n diaria programada para ejecutarse en ${Math.floor(r/36e5)} horas y ${Math.floor(r%36e5/6e4)} minutos (2:00 AM)`);const i=setTimeout((()=>{console.log("Comprobando si se debe ejecutar la verificaci\xf3n diaria (2:00 AM)"),(()=>{const e=localStorage.getItem("ultimaVerificacionDiaria");if(e){const t=new Date(Number(e)),n=new Date;if(t.getDate()===n.getDate()&&t.getMonth()===n.getMonth()&&t.getFullYear()===n.getFullYear())return console.log(`La verificaci\xf3n diaria ya se ejecut\xf3 hoy a las ${t.toLocaleTimeString()}`),!0}return!1})()?(console.log("Saltando verificaci\xf3n, ya se ejecut\xf3 hoy"),e()):(console.log("Iniciando verificaci\xf3n diaria programada (2:00 AM)"),Je({respetarAsignacionesExistentes:!0}).then((()=>{localStorage.setItem("ultimaVerificacionDiaria",Date.now().toString()),console.log("Verificaci\xf3n diaria completada y marcada como ejecutada hoy"),e()})))}),r);return i},t=e();return()=>{clearTimeout(t),me.current=!1}}),[]),(0,r.useEffect)((()=>{(async()=>{console.log("Iniciando limpieza inicial de duplicados...");if(!W&&!v){await Xe();"true"!==localStorage.getItem("historialLimpiado")&&(console.log("Ejecutando limpieza de duplicados en historial..."),await nt())}})()}),[W,v]);const Ze=async()=>{try{console.log("Volcando datos de historial a solicitudes pendientes...");const e=await(0,o.GG)((0,o.rJ)(s.db,"historialSolicitudes"));if(e.empty)return console.log("No hay entradas en el historial para procesar"),{volcados:0};const t=e.docs.map((e=>({...e.data(),docId:e.id})));console.log(`Se encontraron ${t.length} entradas en el historial`);const n=t.slice(0,5);console.log("Ejemplos de entradas en historial:",n);const r={};t.forEach((e=>{const t=e.estado||"SIN_ESTADO";r[t]=(r[t]||0)+1})),console.log("Conteo de estados en historial:",r);const i=t.filter((e=>e.centrosIds&&e.centrosIds.length>0)).length;console.log(`Entradas con centrosIds v\xe1lidos: ${i} de ${t.length}`);const a=await(0,o.GG)((0,o.rJ)(s.db,"solicitudesPendientes")),l=new Set;a.docs.forEach((e=>{const t=e.data();t.orden&&l.add(t.orden)}));(await(0,o.GG)((0,o.rJ)(s.db,"asignaciones"))).docs.forEach((e=>{const t=e.data();t.order&&l.add(t.order)})),console.log(`Se encontraron ${l.size} \xf3rdenes ya existentes`);const c=t.filter((e=>!!e.orden&&(!l.has(e.orden)&&(e.centrosIds&&e.centrosIds.length||!e.centroId?e.centrosIds&&e.centrosIds.length>0:(e.centrosIds=[e.centroId],!0)))));if(console.log(`Se volcar\xe1n ${c.length} entradas del historial`),0===c.length)return{volcados:0};console.log("Ejemplos de entradas a volcar:",c.slice(0,3));const u=100;let d=0;for(let h=0;h<c.length;h+=u){const e=(0,o.wP)(s.db),t=c.slice(h,h+u);for(const n of t){const t={orden:n.orden,centrosIds:n.centrosIds||[n.centroId],timestamp:Date.now(),intentosFallidos:0},r={};if(Object.entries(t).forEach((e=>{let[t,i]=e;void 0!==i?r[t]=i:"centrosIds"===t&&(n.centroId?r.centrosIds=[n.centroId]:console.warn(`No se pudo recuperar centrosIds para orden ${n.orden}`))})),r.orden&&r.centrosIds){const t=(0,o.H9)((0,o.rJ)(s.db,"solicitudesPendientes"));e.set(t,r),d++}}await e.commit(),console.log(`Procesado lote ${h/u+1} (${t.length} entradas)`)}return console.log(`Se volcaron ${d} entradas del historial a solicitudes pendientes`),{volcados:d}}catch(e){return console.error("Error al volcar datos del historial:",e),{error:e.message,volcados:0}}},et=async()=>{try{await(0,o.GG)((0,o.P)((0,o.rJ)(s.db,"centros"),(0,o.AB)(1)));return console.log("Conexi\xf3n con Firebase verificada correctamente."),{success:!0,message:"Conexi\xf3n establecida correctamente."}}catch(e){return console.error("Error de conexi\xf3n con Firebase:",e),Be("Error de conexi\xf3n con la base de datos. Por favor, verifica tu conexi\xf3n a internet.","error"),{success:!1,error:e,message:e.message}}};(0,r.useEffect)((()=>{let e;return(async()=>{if(!ue.current&&!de.current){ue.current=!0;try{R(!0),L("Iniciando sistema y verificando conexi\xf3n..."),M(5);const r=await et();if(!r.success)return void L(`Error de conexi\xf3n: ${r.message}. Intenta recargar la p\xe1gina.`);L("Verificando datos..."),M(10);const i=await(0,o.GG)((0,o.rJ)(s.db,"centros"));if(0===i.size){L("Cargando datos iniciales..."),M(20),await Ke("centros");await Qe()||await He()}else L("Cargando datos existentes..."),M(30),await Ge();e=We(),L("Limpiando duplicados iniciales..."),M(50),console.log("Ejecutando limpieza inicial de duplicados");const a=await Xe();if(a.error)console.error("Error durante la limpieza inicial:",a.error);else{const e=a.eliminadosSolicitudes+a.eliminadosAsignaciones+a.eliminadosHistorial;console.log(`Limpieza inicial completada: ${e} elementos duplicados eliminados`)}L("Moviendo solicitudes hist\xf3ricas a pendientes..."),M(60);try{const e=await Ze();e.error?console.error("Error en el volcado de historial:",e.error):e.volcados>0?(console.log(`Volcado inicial: ${e.volcados} solicitudes recuperadas del historial`),L(`Recuperadas ${e.volcados} solicitudes del historial`)):console.log("No hubo solicitudes para recuperar del historial")}catch(t){console.error("Error durante el volcado de historial:",t)}L("Procesando solicitudes pendientes..."),M(70);try{console.log("Procesando todas las solicitudes pendientes al inicio..."),await Je();const e=(await(0,o.GG)((0,o.rJ)(s.db,"solicitudesPendientes"))).docs.length;M(100),e>0?(L(`Hay ${e} solicitudes pendientes por procesar.`),console.log(`Quedan ${e} solicitudes pendientes despu\xe9s del procesamiento inicial`)):(L("\xa1Sistema iniciado correctamente!"),setTimeout((()=>{R(!1),Be("Sistema iniciado correctamente.","success")}),2e3))}catch(n){console.error("Error al procesar solicitudes iniciales:",n),L(`Error al procesar solicitudes: ${n.message}`),M(100),setTimeout((()=>{R(!1),Be("Se produjo un error durante el procesamiento inicial: "+n.message,"error")}),2e3)}de.current=!0}catch(r){console.error("Error durante la inicializaci\xf3n:",r),L(`Error: ${r.message}`),setTimeout((()=>{R(!1),Be("Error durante la inicializaci\xf3n: "+r.message,"error")}),2e3)}finally{ue.current=!1}}})(),()=>{e&&e()}}),[]);const tt=async()=>{try{if((()=>{try{const e=localStorage.getItem("ultimaVerificacionAsignaciones");if(e){const t=new Date(e),n=new Date;if(t.toDateString()===n.toDateString())return!0}return!1}catch(e){return console.error("Error al verificar ejecuci\xf3n previa:",e),!1}})())return void console.log("La verificaci\xf3n de asignaciones ya se ejecut\xf3 hoy.");L("Verificando y corrigiendo asignaciones existentes..."),M(10),R(!0),await new Promise((e=>setTimeout(e,1e3)));try{if(L("Cargando datos actuales..."),M(20),await Ge(),0===e.length){L("No hay centros disponibles. Cargando desde CSV..."),M(30);if(!(await fetch("/asignacion-plazas/plazas.csv")).ok)throw new Error("No se encontr\xf3 el archivo CSV de centros");await He()}if(!e||!Array.isArray(e))return console.error("Error: availablePlazas debe ser un array",e),L("Error: No hay datos de centros disponibles"),await new Promise((e=>setTimeout(e,2e3))),R(!1),void Be("Error: No hay datos de centros disponibles","error");M(40),L("Comprobando excesos de asignaciones en centros..."),await new Promise((e=>setTimeout(e,500)));const t=e.filter((e=>e.asignadas>e.plazas));if(0===t.length)return M(100),L("No se encontraron centros con exceso de asignaciones. Todo est\xe1 correcto."),await new Promise((e=>setTimeout(e,2e3))),R(!1),Be("Verificaci\xf3n completada: No hay centros con exceso de asignaciones","success"),localStorage.setItem("ultimaVerificacionDiaria",Date.now().toString()),{success:!0,message:"No hay centros con exceso",corregidos:0};M(60),L(`Encontrados ${t.length} centros con exceso de asignaciones. Comenzando reasignaci\xf3n...`),await new Promise((e=>setTimeout(e,1e3)));const r=await(0,a.El)(e,n,s.db);return M(90),L(r.success?`${r.message}. Actualizando interfaz...`:`Error durante la verificaci\xf3n: ${r.message}`),await Ge(),M(100),L(r.success?`Verificaci\xf3n completada exitosamente. Se corrigieron ${r.corregidos} asignaciones (${r.reasignados} reasignadas).`:`Error durante la verificaci\xf3n: ${r.message}`),await new Promise((e=>setTimeout(e,2e3))),R(!1),r.success?(Be(r.message,"success"),localStorage.setItem("ultimaVerificacionDiaria",Date.now().toString())):Be(r.message||"Error al verificar asignaciones","error"),r}catch(t){console.error("Error al verificar asignaciones:",t),L(`Error al verificar asignaciones: ${t.message}`),await new Promise((e=>setTimeout(e,2e3))),R(!1),Be("Error al verificar asignaciones: "+t.message,"error")}}catch(t){console.error("Error al verificar asignaciones:",t),L(`Error al verificar asignaciones: ${t.message}`),await new Promise((e=>setTimeout(e,2e3))),R(!1),Be("Error al verificar asignaciones: "+t.message,"error")}},nt=async()=>{try{if("true"===localStorage.getItem("historialLimpiado"))return console.log("La limpieza del historial ya se ha realizado con \xe9xito anteriormente"),{success:!0,eliminados:0,yaRealizado:!0};x&&x("Limpiando duplicados en historial de solicitudes...");const e=[];if((await(0,o.GG)((0,o.P)((0,o.rJ)(s.db,"historialSolicitudes"),(0,o.AB)(1e4)))).forEach((t=>{e.push({...t.data(),docId:t.id})})),0===e.length)return Be("No hay entradas en el historial de solicitudes","info"),{success:!0,eliminados:0};console.log(`Procesando ${e.length} documentos del historial`);const t={};e.forEach((e=>{const n=e.orden;if(!n)return;let r="desconocida";if(e.timestamp){const t=new Date(e.timestamp);r=`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`}else e.fechaHistorico&&(r=e.fechaHistorico.split("T")[0]);const i=`${n}-${e.estado||"DESCONOCIDO"}-${e.centroId||e.centroAsignado||"sin-centro"}-${r}`;t[i]?t[i].push(e):t[i]=[e]}));let n=0;if(Object.values(t).forEach((e=>{e.length>1&&(n+=e.length-1)})),0===n)return Be("No se encontraron entradas duplicadas en el historial","success"),localStorage.setItem("historialLimpiado","true"),{success:!0,eliminados:0};console.log(`Se encontraron ${n} entradas duplicadas para eliminar`);const r=450;let i=0,a=0,l=[];for(const o in t){const e=t[o];e.length>1&&(e.sort(((e,t)=>{const n=e.timestamp||0;return(t.timestamp||0)-n})),l.push(...e.slice(1)))}for(let c=0;c<l.length;c+=r){const e=(0,o.wP)(s.db),t=l.slice(c,c+r);for(const n of t)n.docId&&(e.delete((0,o.H9)(s.db,"historialSolicitudes",n.docId)),i++);await e.commit(),a+=t.length,console.log(`Procesado lote ${Math.floor(c/r)+1}: ${t.length} elementos (total ${a}/${l.length})`),await new Promise((e=>setTimeout(e,1e3))),x&&x(`Limpiando duplicados: ${a}/${l.length} (${Math.round(a/l.length*100)}%)`)}return i>0&&(console.log(`Se eliminaron ${i} entradas duplicadas del historial`),Be(`Se han eliminado ${i} entradas duplicadas del historial`,"success"),localStorage.setItem("historialLimpiado","true")),await Ge(),{success:!0,eliminados:i}}catch(e){return console.error("Error al limpiar duplicados del historial:",e),Be(`Error al limpiar duplicados: ${e.message}`,"error"),{success:!1,error:e.message}}finally{x&&x("")}};(0,r.useEffect)((()=>{const e=()=>{const e=Date.now(),t=ge.current;(0===t||e-t>36e5)&&qe()};n.length>10&&e();const t=setInterval((()=>{e()}),9e5);return()=>clearInterval(t)}),[n.length]);const rt=async()=>{if(he.current)return console.log("Ya hay un procesamiento en curso. Se omite la verificaci\xf3n por minuto."),!1;try{const t=await(0,o.GG)((0,o.rJ)(s.db,"solicitudesPendientes"));if(t.empty)return console.log("No hay solicitudes pendientes para procesar en la verificaci\xf3n por minuto."),!0;const n=t.docs.map((e=>({...e.data(),docId:e.id,centrosIds:e.data().centrosIds||e.data().centrosSeleccionados||[]})));console.log(`Verificaci\xf3n por minuto: Procesando ${n.length} solicitudes pendientes...`);const r=n.sort(((e,t)=>Number(e.orden)-Number(t.orden))),i=(await(0,o.GG)((0,o.rJ)(s.db,"asignaciones"))).docs.map((e=>({...e.data(),docId:e.id}))),a={};i.forEach((e=>{e.centerId&&(a[e.centerId]||(a[e.centerId]=[]),a[e.centerId].push(e))}));const l=new Map;i.forEach((e=>{e.order&&l.set(e.order,e)}));let c=0,u=0;const d=(0,o.wP)(s.db);for(const h of r){const t=Number(h.orden);if(l.has(t)){console.log(`La orden ${t} ya tiene una asignaci\xf3n.`),d.delete((0,o.H9)(s.db,"solicitudesPendientes",h.docId));continue}let n=null,r=null;for(const o of h.centrosIds){const i=e.find((e=>e.id===o));if(i){if(i.asignadas<i.plazas){n=o;break}{const e=(a[o]||[]).reduce(((e,t)=>{const n=Number(e.order||0);return Number(t.order||0)>n?t:e}),{order:0});if(e.order&&Number(e.order)>t){n=o,r=e;break}}}}if(!n){console.log(`No se encontr\xf3 plaza disponible para la orden ${t}.`);continue}const i=e.find((e=>e.id===n));if(r){console.log(`Desplazando asignaci\xf3n de orden ${r.order} para asignar orden ${t} en centro ${n}`),d.delete((0,o.H9)(s.db,"asignaciones",r.docId));const e={orden:r.order,centrosIds:[r.centerId],timestamp:(0,o.O5)(),desplazada:!0,desplazadaPor:t},i=(0,o.H9)((0,o.rJ)(s.db,"solicitudesPendientes"));d.set(i,e);const a=(0,o.H9)((0,o.rJ)(s.db,"historialSolicitudes"));d.set(a,{orden:r.order,centroAnterior:r.centerId,centroId:null,estado:"DESPLAZADA",mensaje:`Desplazada por orden ${t} de mayor prioridad`,fechaHistorico:(new Date).toISOString(),timestamp:Date.now()}),u++}const f={order:t,centerId:n,centerName:i?i.nombre:"Centro Desconocido",timestamp:(0,o.O5)()},p=(0,o.H9)((0,o.rJ)(s.db,"asignaciones"));d.set(p,f),d.delete((0,o.H9)(s.db,"solicitudesPendientes",h.docId));const g=(0,o.H9)((0,o.rJ)(s.db,"historialSolicitudes"));d.set(g,{orden:t,centroId:n,estado:r?"PRIORIZADA":"ASIGNADA",mensaje:r?`Asignada con prioridad, desplazando orden ${r.order}`:"Asignada durante procesamiento regular",fechaHistorico:(new Date).toISOString(),timestamp:Date.now()}),c++}return 0===c&&0===u?(console.log("Verificaci\xf3n por minuto: No se realizaron cambios en las asignaciones."),!0):(await d.commit(),console.log(`Verificaci\xf3n por minuto completada: ${c} nuevas asignaciones, ${u} reasignaciones por prioridad.`),(c>0||u>0)&&(await Ge(),Ie((new Date).toLocaleString()),c+u>0&&Be(`Procesamiento autom\xe1tico: ${c} nuevas asignaciones, ${u} reasignaciones por prioridad.`,"success")),!0)}catch(t){return console.error("Error en procesamiento por minuto:",t),!1}};return(0,r.useEffect)((()=>{console.log("Configurando verificaci\xf3n de solicitudes cada minuto...");const e=setTimeout((()=>{rt()}),3e4),t=setInterval((()=>{rt()}),6e4);return()=>{clearTimeout(e),clearInterval(t)}}),[]),z?(0,l.jsx)(f,{assignments:n,availablePlazas:e,solicitudes:p,procesarTodasLasSolicitudes:Je,procesarSolicitudesPorMinuto:rt,cargarDatosDesdeFirebase:Ge,eliminarSolicitudesDuplicadas:Xe,limpiarDuplicadosHistorial:nt,db:s.db,loadingProcess:v,processingMessage:w,showNotification:Be,lastProcessed:E,procesarSolicitudes:a.Kc}):(0,l.jsxs)("div",{className:"App",style:Ye.container,children:[Se&&(0,l.jsx)("div",{className:"modal-backdrop",children:(0,l.jsxs)("div",{className:"modal-content password-modal",children:[(0,l.jsx)("h3",{children:"Verificaci\xf3n de Administrador"}),(0,l.jsx)("p",{children:"Ingrese la contrase\xf1a para ejecutar la verificaci\xf3n"}),(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),"SoyAdmin"===_e?(Ee(!1),Te(""),Ce(!1),Je({respetarAsignacionesExistentes:!1})):(Ce(!0),setTimeout((()=>Ce(!1)),3e3))},children:[(0,l.jsx)("input",{type:"password",value:_e,onChange:e=>Te(e.target.value),placeholder:"Contrase\xf1a"}),ke&&(0,l.jsx)("p",{className:"error-message",children:ke}),(0,l.jsxs)("div",{className:"modal-actions",children:[(0,l.jsx)("button",{type:"button",className:"modal-button cancel",onClick:()=>{Ee(!1),Te(""),Ce("")},children:"Cancelar"}),(0,l.jsx)("button",{type:"submit",className:"modal-button",children:"Verificar"})]})]})]})}),P&&(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"#0a192f",zIndex:9999,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",color:"white",padding:"20px"},children:(0,l.jsxs)("div",{style:{backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"16px",padding:"40px",maxWidth:"500px",width:"90%",textAlign:"center",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.2)",backdropFilter:"blur(8px)"},children:[(0,l.jsx)("div",{style:{fontSize:"28px",fontWeight:"bold",marginBottom:"20px",color:"#64ffda"},children:"SISTEMA EN MANTENIMIENTO"}),(0,l.jsx)("div",{style:{fontSize:"18px",lineHeight:"1.6",marginBottom:"10px"},children:O||"Estamos verificando y actualizando las asignaciones..."}),(0,l.jsxs)("div",{style:{fontSize:"16px",marginBottom:"20px"},children:["Solicitudes pendientes: ",p.length]}),(0,l.jsx)("div",{style:{width:"100%",height:"8px",backgroundColor:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",marginBottom:"10px",overflow:"hidden"},children:(0,l.jsx)("div",{style:{height:"100%",width:`${j}%`,backgroundColor:"#64ffda",borderRadius:"4px",transition:"width 0.5s ease"}})}),(0,l.jsxs)("div",{style:{fontSize:"14px",color:"#8892b0"},children:[j,"% completado"]}),(0,l.jsx)("div",{style:{marginTop:"30px",fontSize:"14px",color:"#8892b0",fontStyle:"italic"},children:"Por favor espere. El sistema volver\xe1 a estar disponible autom\xe1ticamente."})]})}),(0,l.jsxs)("div",{style:Ye.header,children:[(0,l.jsx)("h1",{style:Ye.title,children:"Sistema de Asignaci\xf3n de Plazas"}),(()=>{const e=localStorage.getItem("ultimaVerificacionDiaria");if(!e)return!0;const t=new Date(Number(e)),n=new Date;return!(t.getDate()===n.getDate()&&t.getMonth()===n.getMonth()&&t.getFullYear()===n.getFullYear())})()&&(0,l.jsx)("div",{style:{position:"absolute",top:"20px",right:"20px",zIndex:50},children:(0,l.jsx)("button",{onClick:()=>Ee(!0),style:{padding:"12px 20px",backgroundColor:"#3498db",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"15px",fontWeight:"500",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:"\ud83d\udd04 Verificar Asignaciones Hoy"})}),(0,l.jsxs)("div",{style:Ye.tabs,children:[(0,l.jsx)("div",{style:{...Ye.tab,..."asignaciones"===le?Ye.activeTab:Ye.inactiveTab},onClick:()=>ce("asignaciones"),children:"\ud83d\udccb Historial de Asignaciones"}),(0,l.jsx)("div",{style:{...Ye.tab,..."solicitudes"===le?Ye.activeTab:Ye.inactiveTab},onClick:()=>ce("solicitudes"),children:"\ud83d\udd0d Solicitudes Pendientes"}),(0,l.jsx)("div",{style:{...Ye.tab,..."plazas"===le?Ye.activeTab:Ye.inactiveTab},onClick:()=>ce("plazas"),children:"\ud83c\udfe2 Plazas Disponibles"})]})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px",fontSize:"14px",color:"#666",padding:"8px 12px",backgroundColor:"#f0f8ff",borderRadius:"6px"},children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{style:{fontWeight:"bold",marginRight:"5px"},children:"Plazas disponibles:"}),7066-n.length," de 7066"," "]}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap"},children:[p.length>0&&(0,l.jsx)("span",{style:{marginRight:"10px",color:v?"#e74c3c":"#2ecc71"},children:v?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{style:{display:"inline-block",width:"12px",height:"12px",border:"2px solid rgba(231,76,60,0.3)",borderRadius:"50%",borderTopColor:"#e74c3c",animation:"spin 1s linear infinite",marginRight:"5px",verticalAlign:"middle"}}),"Procesando ",p.length," solicitudes..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{style:{color:"#2ecc71",marginRight:"5px"},children:"\u25cf"}),p.length," solicitudes pendientes"]})}),(0,l.jsx)("span",{style:{fontWeight:"bold",marginRight:"5px"},children:"\xdaltima actualizaci\xf3n:"}),E&&"function"===typeof E.getTime?(()=>{const e=E.getHours(),t=E.getMinutes();return 2===e&&0===t?"Actualizado":new Intl.DateTimeFormat("es-ES",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(E)})():"No disponible"]})]}),"asignaciones"===le&&(0,l.jsxs)("div",{style:Ye.cardContainer,children:[(0,l.jsx)("h3",{style:Ye.sectionTitle,children:"Historial de Asignaciones"}),(0,l.jsx)(c,{assignments:n,availablePlazas:e})]}),"solicitudes"===le&&(0,l.jsxs)("div",{style:Ye.cardContainer,children:[(0,l.jsx)("h3",{style:Ye.sectionTitle,children:"Solicitudes Pendientes"}),(0,l.jsx)(d,{solicitudes:p||[],assignments:n||[],availablePlazas:e||[]})]}),"plazas"===le&&(0,l.jsxs)("div",{style:Ye.cardContainer,children:[(0,l.jsx)("h3",{style:Ye.sectionTitle,children:"Plazas Disponibles"}),e.length>0?(0,l.jsx)(u,{availablePlazas:e,assignments:n,searchTerm:X,setSearchTerm:Z,orderNumber:q,setOrderNumber:H,centrosSeleccionados:K,setCentrosSeleccionados:G,handleOrderSubmit:async(e,t)=>{if(console.log(`Iniciando env\xedo de solicitud para orden ${e}`),void 0===e||null===e||""===e)return console.error("Error en enviarSolicitud: orderNumber es null, undefined o vac\xedo"),Be("Error: N\xfamero de orden inv\xe1lido","error"),!1;if(!t||!Array.isArray(t)||0===t.length)return console.error("Error en enviarSolicitud: No hay centros seleccionados",t),Be("Error: Debe seleccionar al menos un centro","error"),!1;const n=Number(e);if(isNaN(n))return console.error("Error en enviarSolicitud: orderNumber no es un n\xfamero v\xe1lido",e),Be("Error: N\xfamero de orden inv\xe1lido","error"),!1;console.log(`Procesando solicitud para orden ${n} con centros:`,t);try{const e=await et();if(!e||!e.success)return console.error("Error de conexi\xf3n con Firebase:",(null===e||void 0===e?void 0:e.error)||"Sin detalles adicionales"),Be("Error de conexi\xf3n con la base de datos. Por favor, verifica tu conexi\xf3n a internet.","error"),!1;try{if(!(await(0,o.GG)((0,o.P)((0,o.rJ)(s.db,"asignaciones"),(0,o._M)("order","==",n)))).empty)return console.log(`Ya existe una asignaci\xf3n para la orden ${n}`),Be(`La orden ${n} ya tiene una asignaci\xf3n en el sistema.`,"error"),!1}catch(r){return console.error("Error al verificar asignaciones existentes:",r),Be("Error al verificar asignaciones existentes. Intente nuevamente.","error"),!1}let i=null;try{const e=await(0,o.GG)((0,o.P)((0,o.rJ)(s.db,"solicitudesPendientes"),(0,o._M)("orden","==",n)));e.empty||(i=e.docs[0].id,console.log(`Encontrada solicitud existente con ID ${i} para orden ${n}`))}catch(r){return console.error("Error al verificar solicitudes pendientes existentes:",r),Be("Error al verificar solicitudes pendientes. Intente nuevamente.","error"),!1}try{if(i)await(0,o.mZ)((0,o.H9)(s.db,"solicitudesPendientes",i),{centrosSeleccionados:t,timestamp:(0,o.O5)()}),console.log(`Actualizada solicitud existente ${i} para orden ${n}`);else{const e={orden:n,centrosIds:t,timestamp:(0,o.O5)()};await(0,o.BN)((0,o.H9)((0,o.rJ)(s.db,"solicitudesPendientes")),e),console.log(`Creada nueva solicitud para orden ${n}`)}console.log(`Solicitud para orden ${n} enviada correctamente`),Be(`Solicitud para orden ${n} enviada correctamente. Ser\xe1 procesada autom\xe1ticamente.`,"success"),await Ge();const e=new Date,r=(0,o.H9)((0,o.rJ)(s.db,"historialSolicitudes"));return await(0,o.BN)(r,{orden:n,centrosIds:t,estado:"PENDIENTE",mensaje:"Solicitud a\xf1adida a la cola de procesamiento",fechaHistorico:e.toISOString(),timestamp:e.getTime()}),H(""),G([]),ce("solicitudes"),!0}catch(r){return console.error("Error al guardar solicitud:",r),Be(`Error al procesar la solicitud: ${r.message}`,"error"),!1}}catch(r){return console.error(`Error al enviar solicitud para orden ${n}:`,r),Be(`Error al enviar solicitud: ${r.message}`,"error"),!1}},isProcessing:W}):(0,l.jsxs)("div",{style:{textAlign:"center",padding:"40px 20px",backgroundColor:"#f5f7fa",borderRadius:"8px",color:"#5c6c7c"},children:[(0,l.jsx)("div",{style:{fontSize:"36px",marginBottom:"15px"},children:"\ud83c\udfe2"}),(0,l.jsx)("div",{style:{fontSize:"18px",fontWeight:"bold",marginBottom:"10px"},children:"Cargando plazas..."}),(0,l.jsx)("div",{style:{fontSize:"14px",marginBottom:"20px"},children:"Por favor espera mientras se cargan los datos de los centros."}),(0,l.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"},children:[(0,l.jsx)("div",{style:{width:"20px",height:"20px",border:"3px solid rgba(0,0,0,0.1)",borderRadius:"50%",borderTopColor:"#3498db",animation:"spin 1s linear infinite"}}),(0,l.jsx)("div",{children:"Cargando datos..."})]})]})]}),(0,l.jsx)(h,{}),ne&&(0,l.jsx)("div",{style:{...Ye.popup,backgroundColor:"success"===se?"#d4edda":"warning"===se?"#fff3cd":"#f8d7da",color:"success"===se?"#155724":"warning"===se?"#856404":"#721c24"},children:(0,l.jsxs)("div",{style:{display:"flex",alignItems:"flex-start"},children:[(0,l.jsx)("div",{style:{flex:1},children:ie}),(0,l.jsx)("button",{onClick:()=>re(!1),style:{background:"none",border:"none",cursor:"pointer",fontSize:"18px",marginLeft:"10px",color:"inherit"},children:"\xd7"})]})}),(v||I)&&(0,l.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:999},children:(0,l.jsxs)("div",{style:{backgroundColor:"white",padding:"20px",borderRadius:"10px",boxShadow:"0 0 20px rgba(0,0,0,0.2)",maxWidth:"500px",width:"90%",textAlign:"center"},children:[(0,l.jsx)("div",{style:{marginBottom:"15px",fontSize:"18px"},children:I?"Cargando datos...":"Procesando solicitudes..."}),(0,l.jsx)("div",{children:w}),(0,l.jsx)("div",{style:{width:"100%",height:"4px",backgroundColor:"#f1f1f1",borderRadius:"2px",marginTop:"15px",overflow:"hidden",position:"relative"},children:(0,l.jsx)("div",{style:{position:"absolute",top:0,left:0,height:"100%",width:"30%",backgroundColor:"#3498db",borderRadius:"2px",animation:"loading 1.5s infinite ease-in-out"}})})]})}),(0,l.jsx)("style",{children:"\n        @keyframes slideIn {\n          0% { transform: translateX(100%); opacity: 0; }\n          100% { transform: translateX(0); opacity: 1; }\n        }\n        @keyframes loading {\n          0% { left: -30%; }\n          100% { left: 100%; }\n        }\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      "})]})},g=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,453)).then((t=>{let{getCLS:n,getFID:r,getFCP:i,getLCP:o,getTTFB:s}=t;n(e),r(e),i(e),o(e),s(e)}))};i.createRoot(document.getElementById("root")).render((0,l.jsx)(r.StrictMode,{children:(0,l.jsx)(p,{})})),g()})();
//# sourceMappingURL=main.67f5c0e5.js.map